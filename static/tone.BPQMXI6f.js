import{j as l}from"./jsx-runtime.DZ3s2XAB.js";import{a as h,o as c,G as F,b as R,c as b,d as T,s as V,P as A}from"./index.CnQ0ruKL.js";import E from"./index.FIxribuB.js";import{Button as _}from"./button.Bu1Rz1rf.js";import"./_sentry-release-injection-file.B-UwqLso.js";import"./index.D4IXJ7me.js";import"./_commonjsHelpers.DqoTaOmB.js";import"./tslib.es6.Cs9ISZJD.js";import"./preload-helper.ddZQF9G8.js";/* empty css                       */import"./react-icons.esm.Bm3uWd-S.js";import"./createLucideIcon.Bi-ZCKuD.js";import"./index.CEsCW6vM.js";import"./index.Dr6BPF-b.js";import"./utils.CQ2vwKer.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new i.Error().stack;t&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[t]="e30a7ed0-ffd9-4dbb-a2a6-c7b696756320",i._sentryDebugIdIdentifier="sentry-dbid-e30a7ed0-ffd9-4dbb-a2a6-c7b696756320")}catch{}})();class m extends h{constructor(){const t=c(m.getDefaults(),arguments,["channels"]);super(t),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(h.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class d extends h{constructor(){const t=c(d.getDefaults(),arguments,["type","size"]);super(t),this.name="Analyser",this._analysers=[],this._buffers=[],this.input=this.output=this._gain=new F({context:this.context}),this._split=new m({context:this.context,channels:t.channels}),this.input.connect(this._split),R(t.channels,1);for(let s=0;s<t.channels;s++)this._analysers[s]=this.context.createAnalyser(),this._split.connect(this._analysers[s],s,0);this.size=t.size,this.type=t.type,this.smoothing=t.smoothing}static getDefaults(){return Object.assign(h.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,s)=>{const a=this._buffers[s];this._type==="fft"?t.getFloatFrequencyData(a):this._type==="waveform"&&t.getFloatTimeDomainData(a)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach((s,a)=>{s.fftSize=t*2,this._buffers[a]=new Float32Array(t)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){b(t==="waveform"||t==="fft",`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach(s=>s.smoothingTimeConstant=t)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class u extends h{constructor(){super(c(u.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new d({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class p extends u{constructor(){const t=c(p.getDefaults(),arguments,["size"]);super(t),this.name="FFT",this.normalRange=t.normalRange,this._analyser.type="fft",this.size=t.size}static getDefaults(){return Object.assign(h.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map(s=>this.normalRange?T(s):s)}get size(){return this._analyser.size}set size(t){this._analyser.size=t}get smoothing(){return this._analyser.smoothing}set smoothing(t){this._analyser.smoothing=t}getFrequencyOfIndex(t){return b(0<=t&&t<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),t*this.context.sampleRate/(this.size*2)}}class y extends u{constructor(){const t=c(y.getDefaults(),arguments,["size"]);super(t),this.name="Waveform",this._analyser.type="waveform",this.size=t.size}static getDefaults(){return Object.assign(u.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(t){this._analyser.size=t}}const Q=({curve:i})=>{let t,s,a=!1,f,w=()=>{s&&s.start(),a=!0},z=()=>{s&&s.stop(),a=!1};const x=e=>{const D=async()=>{await V(),s=new A("/assets/sorry.mp3").toDestination(),t=new p(2048).toDestination(),f=new y(2048),i?s.connect(f):s.connect(t),e.createCanvas(e.windowWidth-100,240),e.frameRate(120),e.background(255,255,255)},v=()=>{if(a&&t&&f)if(e.background(255,255,255),e.strokeWeight(4),e.stroke(255),i){let n=f.getValue(),r=e.map(n[0],-1,1,0,255),g=e.noise(e.frameCount);e.stroke(r,255-r,g*255),e.noFill(),e.beginShape();for(let o=0;o<n.length;o++){let C=e.map(o,0,n.length,0,e.width),k=e.map(n[o],-1,1,e.height,0);e.vertex(C,k)}e.endShape()}else{let n=t.getValue();e.noStroke(),e.fill(0,0,0);for(let r=0;r<n.length;r++){let g=e.map(r,0,n.length,0,e.width),o=e.map(n[r],-100,0,0,e.height);e.rect(g,e.height,e.width/n.length,-o)}}},j=()=>{e.resizeCanvas(e.windowWidth-100,240)};e.setup=D,e.draw=v,e.windowResized=j};return l.jsxs(l.Fragment,{children:[l.jsx(E,{sketch:x}),l.jsxs("div",{className:"flex gap-10",children:[l.jsx(_,{className:"m-auto",onClick:w,children:"播放"}),l.jsx(_,{className:"m-auto",onClick:z,children:"结束"})]})]})};export{Q as default};
//# sourceMappingURL=tone.BPQMXI6f.js.map
