{"version":3,"file":"gear.BxuW4kT3.js","sources":["../../src/components/react/d3/gear.tsx"],"sourcesContent":["import * as d3 from \"d3\";\nimport { useEffect, useRef } from \"react\";\n\nconst Gear = () => {\n  const ref = useRef<SVGSVGElement | null>(null);\n\n  function gear({ teeth, radius, annulus, toothRadius, holeRadius }: any) {\n    const n = teeth;\n    let r2 = Math.abs(radius);\n    let r0 = r2 - toothRadius;\n    let r1 = r2 + toothRadius;\n    let r3 = holeRadius;\n    if (annulus) (r3 = r0), (r0 = r1), (r1 = r3), (r3 = r2 + toothRadius * 3);\n    const da = Math.PI / n;\n    let a0 = -Math.PI / 2 + (annulus ? Math.PI / n : 0);\n    const path = [\"M\", r0 * Math.cos(a0), \",\", r0 * Math.sin(a0)];\n    let i = -1;\n    while (++i < n) {\n      path.push(\n        \"A\",\n        r0,\n        \",\",\n        r0,\n        \" 0 0,1 \",\n        r0 * Math.cos((a0 += da)),\n        \",\",\n        r0 * Math.sin(a0),\n        \"L\",\n        r2 * Math.cos(a0),\n        \",\",\n        r2 * Math.sin(a0),\n        \"L\",\n        r1 * Math.cos((a0 += da / 3)),\n        \",\",\n        r1 * Math.sin(a0),\n        \"A\",\n        r1,\n        \",\",\n        r1,\n        \" 0 0,1 \",\n        r1 * Math.cos((a0 += da / 3)),\n        \",\",\n        r1 * Math.sin(a0),\n        \"L\",\n        r2 * Math.cos((a0 += da / 3)),\n        \",\",\n        r2 * Math.sin(a0),\n        \"L\",\n        r0 * Math.cos(a0),\n        \",\",\n        r0 * Math.sin(a0)\n      );\n    }\n    path.push(\n      \"M0,\",\n      -r3,\n      \"A\",\n      r3,\n      \",\",\n      r3,\n      \" 0 0,0 0,\",\n      r3,\n      \"A\",\n      r3,\n      \",\",\n      r3,\n      \" 0 0,0 0,\",\n      -r3,\n      \"Z\"\n    );\n    return path.join(\"\");\n  }\n\n  const graphic = () => {\n    const x = Math.sin((2 * Math.PI) / 3);\n    const y = Math.cos((2 * Math.PI) / 3);\n    const svgElement = d3.select(ref.current);\n\n    const svg = svgElement\n      .attr(\"width\", 640)\n      .attr(\"viewBox\", [-0.53, -0.53, 1.06, 1.06])\n      .attr(\"stroke\", \"black\")\n      .attr(\"stroke-width\", 1 / 640)\n      .attr(\n        \"style\",\n        `width:${100}vw;max-width: 100%; height: calc( 100vh - 100px);`\n      );\n\n    const frame = svg.append(\"g\");\n\n    const path = frame\n      .selectAll()\n      .data([\n        {\n          fill: \"#c6dbef\",\n          teeth: 80,\n          radius: -0.5,\n          origin: [0, 0],\n          annulus: true,\n        },\n        { fill: \"#6baed6\", teeth: 16, radius: +0.1, origin: [0, 0] },\n        { fill: \"#9ecae1\", teeth: 32, radius: -0.2, origin: [0, -0.3] },\n        {\n          fill: \"#9ecae1\",\n          teeth: 32,\n          radius: -0.2,\n          origin: [-0.3 * x, -0.3 * y],\n        },\n        {\n          fill: \"#9ecae1\",\n          teeth: 32,\n          radius: -0.2,\n          origin: [0.3 * x, -0.3 * y],\n        },\n      ])\n      .join(\"path\")\n      .attr(\"fill\", d => d.fill)\n      .attr(\"d\", d => gear({ ...d, toothRadius: 0.008, holeRadius: 0.02 }));\n\n    Object.assign(svg.node() as SVGSVGElement, {\n      update({ angle, frameAngle }: { angle: number; frameAngle: number }) {\n        path.attr(\n          \"transform\",\n          d => `translate(${d.origin}) rotate(${(angle / d.radius) % 360})`\n        );\n        frame.attr(\"transform\", `rotate(${frameAngle % 360})`);\n      },\n    });\n  };\n  useEffect(() => {\n    graphic();\n\n    let id = 0;\n    const animate = () => {\n      const speed = 0.08;\n      let angle = 0;\n      let frameAngle = 0;\n\n      let start = 0;\n      const draw = function (timestamp: number) {\n        if (start === 0) {\n          start = timestamp;\n        }\n        // if (timestamp - start < 2000) {\n        (d3.select(ref.current).node() as any).update({ angle, frameAngle });\n        angle += speed;\n        frameAngle += speed / 360;\n        id = requestAnimationFrame(draw);\n        // }\n        // else {\n        //     cancelAnimationFrame(id);\n        // }\n      };\n      id = requestAnimationFrame(draw);\n    };\n    animate();\n\n    // d3.select(ref.current).node()?.addEventListener(\"click\", () => {\n    //     animate();\n    // })\n\n    return () => {\n      cancelAnimationFrame(id);\n    };\n  });\n\n  return <svg ref={ref}></svg>;\n};\n\nexport default Gear;\n"],"names":["Gear","ref","useRef","gear","teeth","radius","annulus","toothRadius","holeRadius","n","r2","r0","r1","r3","da","a0","path","i","graphic","x","y","svg","d3.select","frame","d","angle","frameAngle","useEffect","id","draw","timestamp","jsx"],"mappings":"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"}