{"version":3,"file":"abortController.CajK-WNl.js","sources":["../../src/components/react/little/abortController.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\n// import \"@blocksuite/editor/themes/affine.css\";\n\nimport Editor from \"../editor/code\";\n\nconst FetchWithAbort: React.FC = () => {\n  const [status, setStatus] = useState<string>(\"\"); // 状态信息\n  const abortControllerRef = useRef<AbortController | null>(null); // 引用 AbortController\n  const startFetch = () => {\n    setStatus(\"请求中...\");\n    abortControllerRef.current = new AbortController(); // 创建新的 AbortController\n    const signal = abortControllerRef.current.signal;\n\n    fetch(\"https://httpbin.org/delay/5\", { signal })\n      .then(response => {\n        if (!response.ok) throw new Error(\"网络响应错误\");\n        return response.json();\n      })\n      .then(data => {\n        let str = JSON.stringify(data);\n        //没个逗号后插入换行\n        str = str.replace(/,/g, \",\\n\");\n        setStatus(str);\n      })\n      .catch(err => {\n        if (err.name === \"AbortError\") {\n          setStatus(\"请求已中止\");\n        } else {\n          setStatus(\"请求失败: \" + err.message);\n        }\n      });\n  };\n\n  const abortFetch = () => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort(); // 中止请求\n      setStatus(\"请求已中止\");\n    }\n  };\n\n  return (\n    <div>\n      <h1>中止 Fetch 请求示例</h1>\n      <button\n        className=\"bg-black px-10 text-white mx-20 my-4\"\n        onClick={startFetch}\n      >\n        开始请求\n      </button>\n      <button\n        className=\"bg-white px-10 text-black mx-20 my-4\"\n        onClick={abortFetch}\n      >\n        中止请求\n      </button>\n      <Editor>{status}</Editor>\n    </div>\n  );\n};\n\nexport default FetchWithAbort;\n"],"names":["FetchWithAbort","status","setStatus","useState","abortControllerRef","useRef","startFetch","signal","response","data","str","err","abortFetch","jsx","Editor"],"mappings":"2mBAKA,MAAMA,EAA2B,IAAM,CACrC,KAAM,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAAiB,EAAE,EACzCC,EAAqBC,SAA+B,IAAI,EACxDC,EAAa,IAAM,CACvBJ,EAAU,QAAQ,EACCE,EAAA,QAAU,IAAI,gBAC3B,MAAAG,EAASH,EAAmB,QAAQ,OAE1C,MAAM,8BAA+B,CAAE,OAAAG,CAAQ,CAAA,EAC5C,KAAiBC,GAAA,CAChB,GAAI,CAACA,EAAS,GAAU,MAAA,IAAI,MAAM,QAAQ,EAC1C,OAAOA,EAAS,KAAK,CAAA,CACtB,EACA,KAAaC,GAAA,CACR,IAAAC,EAAM,KAAK,UAAUD,CAAI,EAEvBC,EAAAA,EAAI,QAAQ,KAAM;AAAA,CAAK,EAC7BR,EAAUQ,CAAG,CAAA,CACd,EACA,MAAaC,GAAA,CACRA,EAAI,OAAS,aACfT,EAAU,OAAO,EAEPA,EAAA,SAAWS,EAAI,OAAO,CAClC,CACD,CACL,EAEMC,EAAa,IAAM,CACnBR,EAAmB,UACrBA,EAAmB,QAAQ,MAAM,EACjCF,EAAU,OAAO,EAErB,EAEA,cACG,MACC,CAAA,SAAA,CAAAW,EAAAA,IAAC,MAAG,SAAa,eAAA,CAAA,EACjBA,EAAA,IAAC,SAAA,CACC,UAAU,uCACV,QAASP,EACV,SAAA,MAAA,CAED,EACAO,EAAA,IAAC,SAAA,CACC,UAAU,uCACV,QAASD,EACV,SAAA,MAAA,CAED,EACAC,EAAAA,IAACC,GAAQ,SAAOb,CAAA,CAAA,CAAA,EAClB,CAEJ"}