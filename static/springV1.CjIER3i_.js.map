{"version":3,"file":"springV1.CjIER3i_.js","sources":["../../src/components/react/p5/Oscillation/spring/springV1.tsx"],"sourcesContent":["import type p5 from \"p5\";\nimport Basic from \"@components/react/p5/index.tsx\";\nimport { useCallback, useState, useRef, useEffect } from \"react\";\nimport { BobBob } from \"./Bob\";\nimport { BobSpring } from \"./Spring\";\nimport { useDebounce } from \"@uidotdev/usehooks\";\nimport { Slider } from \"@shadcn/ui/slider\";\nimport { cn } from \"@utils/utils\";\n\nexport default () => {\n  const [k, setK] = useState(0.2); // Elastic coefficient\n  const debounceK = useDebounce(k, 500);\n\n  // Using refs to persist bobs and springs across renders\n  const bobsRef = useRef<BobBob[]>([]);\n  const springsRef = useRef<BobSpring[]>([]);\n\n  const sketch = useCallback(\n    (p: p5) => {\n      const setup = () => {\n        p.createCanvas(p.windowWidth / 2, 240);\n        p.frameRate(120);\n\n        // Initialize bobs\n        const bob1 = new BobBob(p, p.width / 2, 150, 10);\n        const bob2 = new BobBob(p, p.width / 2 + 100, 150, 10);\n        const bob3 = new BobBob(p, p.width / 2 - 100, 150, 20);\n        bobsRef.current.push(bob1, bob2, bob3);\n\n        // Initialize springs connecting bobs to each other\n        springsRef.current.push(\n          new BobSpring(p, 200, debounceK, bob1, bob2),\n          new BobSpring(p, 200, debounceK, bob2, bob3),\n          new BobSpring(p, 200, debounceK, bob3, bob1)\n        );\n      };\n\n      const draw = () => {\n        p.background(255);\n        bobsRef.current.forEach(bob => {\n          // bob.applyForce(gravity);\n          bob.update();\n          bob.handleDrag(p.mouseX, p.mouseY);\n        });\n\n        springsRef.current.forEach(spring => {\n          spring.connect();\n        });\n\n        springsRef.current.forEach(spring => {\n          if (spring.bobA && spring.bobB) {\n            spring.constrainLength(spring.bobA, spring.bobB, 50, 250);\n          } else if (spring.bobA && spring.anchor) {\n            spring.constrainLengthToAnchor(spring.bobA, 50, 250);\n          }\n        });\n        springsRef.current.forEach(spring => spring.show());\n        bobsRef.current.forEach(bob => bob.show());\n      };\n\n      p.mousePressed = () => {\n        bobsRef.current.forEach(bob => {\n          bob.handleMousePressed(p.mouseX, p.mouseY);\n        });\n      };\n\n      p.touchStarted = () => {\n        bobsRef.current.forEach(bob => {\n          bob.handleMousePressed(p.mouseX, p.mouseY);\n        });\n      };\n\n      p.touchEnded = () => {\n        bobsRef.current.forEach(bob => bob.handleMouseReleased());\n      };\n\n      p.mouseReleased = () => {\n        bobsRef.current.forEach(bob => bob.handleMouseReleased());\n      };\n\n      const resize = () => {\n        p.resizeCanvas(p.windowWidth / 2, 240);\n      };\n\n      p.setup = setup;\n      p.draw = draw;\n      p.windowResized = resize;\n    },\n    [debounceK]\n  );\n\n  useEffect(() => {\n    springsRef.current.forEach(spring => {\n      spring.k = debounceK;\n    });\n  }, [debounceK]);\n\n  return (\n    <>\n      <Basic sketch={sketch} showControls />\n      <div>\n        <label>弹性系数：{debounceK}</label>\n        <Slider\n          defaultValue={[0.2]}\n          max={1}\n          min={0.1}\n          step={0.01}\n          className={cn(\"w-[100%] m-4\")}\n          onValueChange={value => {\n            setK(value[0]);\n          }}\n          value={[k]}\n        />\n      </div>\n    </>\n  );\n};\n"],"names":["springV1","k","setK","useState","debounceK","useDebounce","bobsRef","useRef","springsRef","sketch","useCallback","p","setup","bob1","BobBob","bob2","bob3","BobSpring","draw","bob","spring","resize","useEffect","jsxs","Fragment","jsx","Basic","Slider","cn","value"],"mappings":"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"}