import{j as _}from"./jsx-runtime.DZ3s2XAB.js";import W from"./index.FIxribuB.js";import{r as j}from"./index.D4IXJ7me.js";import"./_sentry-release-injection-file.B-UwqLso.js";import"./preload-helper.ddZQF9G8.js";/* empty css                       */import"./react-icons.esm.Bm3uWd-S.js";import"./createLucideIcon.Bi-ZCKuD.js";import"./_commonjsHelpers.DqoTaOmB.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},c=new s.Error().stack;c&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[c]="ce865d44-3eff-4033-9eb4-e71a44a982ec",s._sentryDebugIdIdentifier="sentry-dbid-ce865d44-3eff-4033-9eb4-e71a44a982ec")}catch{}})();var D=function(s,c){return s<c?-1:s>c?1:0},B=function(s){return s.reduce(function(c,g){return c+g},0)},G=function(){function s(g){this.colors=g}var c=s.prototype;return c.palette=function(){return this.colors},c.map=function(g){return g},s}(),S=function(){function s(o,t,a){return(o<<10)+(t<<5)+a}function c(o){var t=[],a=!1;function e(){t.sort(o),a=!0}return{push:function(r){t.push(r),a=!1},peek:function(r){return a||e(),r===void 0&&(r=t.length-1),t[r]},pop:function(){return a||e(),t.pop()},size:function(){return t.length},map:function(r){return t.map(r)},debug:function(){return a||e(),t}}}function g(o,t,a,e,r,n,l){var u=this;u.r1=o,u.r2=t,u.g1=a,u.g2=e,u.b1=r,u.b2=n,u.histo=l}function I(){this.vboxes=new c(function(o,t){return D(o.vbox.count()*o.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function v(o,t){if(t.count()){var a=t.r2-t.r1+1,e=t.g2-t.g1+1,r=Math.max.apply(null,[a,e,t.b2-t.b1+1]);if(t.count()==1)return[t.copy()];var n,l,u,m,x=0,p=[],d=[];if(r==a)for(n=t.r1;n<=t.r2;n++){for(m=0,l=t.g1;l<=t.g2;l++)for(u=t.b1;u<=t.b2;u++)m+=o[s(n,l,u)]||0;p[n]=x+=m}else if(r==e)for(n=t.g1;n<=t.g2;n++){for(m=0,l=t.r1;l<=t.r2;l++)for(u=t.b1;u<=t.b2;u++)m+=o[s(l,n,u)]||0;p[n]=x+=m}else for(n=t.b1;n<=t.b2;n++){for(m=0,l=t.r1;l<=t.r2;l++)for(u=t.g1;u<=t.g2;u++)m+=o[s(l,u,n)]||0;p[n]=x+=m}return p.forEach(function(w,f){d[f]=x-w}),function(w){var f,h,b,F,y,k=w+"1",C=w+"2",E=0;for(n=t[k];n<=t[C];n++)if(p[n]>x/2){for(b=t.copy(),F=t.copy(),y=(f=n-t[k])<=(h=t[C]-n)?Math.min(t[C]-1,~~(n+h/2)):Math.max(t[k],~~(n-1-f/2));!p[y];)y++;for(E=d[y];!E&&p[y-1];)E=d[--y];return b[C]=y,F[k]=b[C]+1,[b,F]}}(r==a?"r":r==e?"g":"b")}}return g.prototype={volume:function(o){var t=this;return t._volume&&!o||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(o){var t=this,a=t.histo;if(!t._count_set||o){var e,r,n,l=0;for(e=t.r1;e<=t.r2;e++)for(r=t.g1;r<=t.g2;r++)for(n=t.b1;n<=t.b2;n++)l+=a[s(e,r,n)]||0;t._count=l,t._count_set=!0}return t._count},copy:function(){var o=this;return new g(o.r1,o.r2,o.g1,o.g2,o.b1,o.b2,o.histo)},avg:function(o){var t=this,a=t.histo;if(!t._avg||o){var e,r,n,l,u=0,m=0,x=0,p=0;if(t.r1===t.r2&&t.g1===t.g2&&t.b1===t.b2)t._avg=[t.r1<<3,t.g1<<3,t.b1<<3];else{for(r=t.r1;r<=t.r2;r++)for(n=t.g1;n<=t.g2;n++)for(l=t.b1;l<=t.b2;l++)u+=e=a[s(r,n,l)]||0,m+=e*(r+.5)*8,x+=e*(n+.5)*8,p+=e*(l+.5)*8;t._avg=u?[~~(m/u),~~(x/u),~~(p/u)]:[~~(8*(t.r1+t.r2+1)/2),~~(8*(t.g1+t.g2+1)/2),~~(8*(t.b1+t.b2+1)/2)]}}return t._avg},contains:function(o){var t=this,a=o[0]>>3;return gval=o[1]>>3,bval=o[2]>>3,a>=t.r1&&a<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},I.prototype={push:function(o){this.vboxes.push({vbox:o,color:o.avg()})},palette:function(){return this.vboxes.map(function(o){return o.color})},size:function(){return this.vboxes.size()},map:function(o){for(var t=this.vboxes,a=0;a<t.size();a++)if(t.peek(a).vbox.contains(o))return t.peek(a).color;return this.nearest(o)},nearest:function(o){for(var t,a,e,r=this.vboxes,n=0;n<r.size();n++)((a=Math.sqrt(Math.pow(o[0]-r.peek(n).color[0],2)+Math.pow(o[1]-r.peek(n).color[1],2)+Math.pow(o[2]-r.peek(n).color[2],2)))<t||t===void 0)&&(t=a,e=r.peek(n).color);return e},forcebw:function(){var o=this.vboxes;o.sort(function(r,n){return D(B(r.color),B(n.color))});var t=o[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(o[0].color=[0,0,0]);var a=o.length-1,e=o[a].color;e[0]>251&&e[1]>251&&e[2]>251&&(o[a].color=[255,255,255])}},{quantize:function(o,t){if(!Number.isInteger(t)||t<1||t>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!o.length||t<2||t>256||!o.length||t<2||t>256)return!1;for(var a=[],e=new Set,r=0;r<o.length;r++){var n=o[r],l=n.join(",");e.has(l)||(e.add(l),a.push(n))}if(a.length<=t)return new G(a);var u=function(f){var h,b=new Array(32768);return f.forEach(function(F){h=s(F[0]>>3,F[1]>>3,F[2]>>3),b[h]=(b[h]||0)+1}),b}(o);u.forEach(function(){});var m=function(f,h){var b,F,y,k=1e6,C=0,E=1e6,N=0,R=1e6,q=0;return f.forEach(function(A){(b=A[0]>>3)<k?k=b:b>C&&(C=b),(F=A[1]>>3)<E?E=F:F>N&&(N=F),(y=A[2]>>3)<R?R=y:y>q&&(q=y)}),new g(k,C,E,N,R,q,h)}(o,u),x=new c(function(f,h){return D(f.count(),h.count())});function p(f,h){for(var b,F=f.size(),y=0;y<1e3;){if(F>=h||y++>1e3)return;if((b=f.pop()).count()){var k=v(u,b),C=k[0],E=k[1];if(!C)return;f.push(C),E&&(f.push(E),F++)}else f.push(b),y++}}x.push(m),p(x,.75*t);for(var d=new c(function(f,h){return D(f.count()*f.volume(),h.count()*h.volume())});x.size();)d.push(x.pop());p(d,t);for(var w=new I;d.size();)w.push(d.pop());return w}}}().quantize,H=function(s){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=s.naturalWidth,this.height=this.canvas.height=s.naturalHeight,this.context.drawImage(s,0,0,this.width,this.height)};H.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var M=function(){};M.prototype.getColor=function(s,c){return c===void 0&&(c=10),this.getPalette(s,5,c)[0]},M.prototype.getPalette=function(s,c,g){var I=function(a){var e=a.colorCount,r=a.quality;if(e!==void 0&&Number.isInteger(e)){if(e===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");e=Math.max(e,2),e=Math.min(e,20)}else e=10;return(r===void 0||!Number.isInteger(r)||r<1)&&(r=10),{colorCount:e,quality:r}}({colorCount:c,quality:g}),v=new H(s),o=function(a,e,r){for(var n,l,u,m,x,p=a,d=[],w=0;w<e;w+=r)l=p[0+(n=4*w)],u=p[n+1],m=p[n+2],((x=p[n+3])===void 0||x>=125)&&(l>250&&u>250&&m>250||d.push([l,u,m]));return d}(v.getImageData().data,v.width*v.height,I.quality),t=S(o,I.colorCount);return t?t.palette():null},M.prototype.getColorFromUrl=function(s,c,g){var I=this,v=document.createElement("img");v.addEventListener("load",function(){var o=I.getPalette(v,5,g);c(o[0],s)}),v.src=s},M.prototype.getImageData=function(s,c){var g=new XMLHttpRequest;g.open("GET",s,!0),g.responseType="arraybuffer",g.onload=function(){if(this.status==200){var I=new Uint8Array(this.response);i=I.length;for(var v=new Array(i),o=0;o<I.length;o++)v[o]=String.fromCharCode(I[o]);var t=v.join(""),a=window.btoa(t);c("data:image/png;base64,"+a)}},g.send()},M.prototype.getColorAsync=function(s,c,g){var I=this;this.getImageData(s,function(v){var o=document.createElement("img");o.addEventListener("load",function(){var t=I.getPalette(o,5,g);c(t[0],this)}),o.src=v})};let P,L,T,U,z;const $=[{background:"#FF5733",text:"#FFFFFF"},{background:"#33FF57",text:"#000000"},{background:"#3357FF",text:"#FFFFFF"},{background:"#F1C40F",text:"#000000"},{background:"#8E44AD",text:"#FFFFFF"},{background:"#E67E22",text:"#FFFFFF"},{background:"#2ECC71",text:"#FFFFFF"},{background:"#3498DB",text:"#FFFFFF"},{background:"#9B59B6",text:"#FFFFFF"},{background:"#F39C12",text:"#FFFFFF"}],et=()=>{const s=j.useRef(null),c=j.useRef(null),[g,I]=j.useState(8),v=j.useRef(null);let o=null;const t=()=>{let e=Math.random()*11%11+1;e=Number(e.toFixed(0)),I(e)},a=j.useCallback(e=>{const r=()=>{U=e.createCanvas(e.windowWidth,e.windowHeight-200,e.WEBGL),U.drop(m),e.textFont(T),z=e.createButton("切换背景颜色").position(20,100).mousePressed(n),c.current.addEventListener("change",d=>{let w=d.target.files[0];if(!w)return;const f=new FileReader;f.onload=h=>{const b=h.target.result;m({type:"image",data:b})},f.onerror=h=>{console.error("读取文件时出错:",h)},f.readAsDataURL(w)},!1)};function n(){let d=Math.floor(Math.random()*$.length);o=null,z.value(d)}const l=d=>{const w=new M;if(v.current.src=d,v.current.complete){let f=w.getColor(v.current),[h,b,F]=f;o=`rgb(${h},${b},${F})`}else v.current.addEventListener("load",function(){let f=w.getColor(v.current),[h,b,F]=f;o=`rgb(${h},${b},${F})`})},u=()=>{let d=`/assets/bg/${g}.webp`;P=e.loadImage(d),z&&l(d),T=e.loadFont("/assets/font/Xingcao.ttf"),L=e.loadModel("/assets/models/obj/up_glucose_bottle.obj",!0,()=>{},()=>{},".obj")},m=d=>{d.type==="image"&&(P=e.createImg(d.data,"").hide(),P.elt.onload=()=>{n(),e.redraw()})},x=()=>{e.textureMode(e.IMAGE),e.background(o||$[z.value()||0].background),e.orbitControl(),e.push(),e.scale(2),e.rotateZ(e.PI),e.rotateY(-e.PI/2),L?(e.texture(P),e.model(L)):console.error("Bottle model is not loaded"),e.push(),e.translate(-100,0,0),e.rotateY(-e.PI/2),e.rotateX(-e.PI),e.fill(o||$[z.value()||0].text),e.text("尝试拖动图片进场景或者点击上传",0,0),e.pop()},p=()=>{e.resizeCanvas(e.windowWidth,e.windowHeight-200),e.redraw()};e.setup=r,e.draw=x,e.preload=u,e.windowResized=p},[g]);return _.jsxs("div",{ref:s,className:"absolute inset-0 w-full h-full",children:[_.jsx(W,{sketch:a,className:"min-h-[80%] flex justify-center items-center"}),_.jsx("input",{type:"file",id:"input",accept:"image/*",className:"hidden",ref:c}),_.jsx("img",{ref:v,className:"hidden"}),_.jsx("label",{htmlFor:"input",className:"block cursor-pointer text-center self-center p-4 m-auto font-semibold text-2xl xing-cao",children:"点击上传材质"}),_.jsx("p",{onClick:t,className:"block cursor-pointer text-center self-center p-4 m-auto font-semibold text-2xl xing-cao",children:"或者点击使用随机图片"})]})};export{et as default};
//# sourceMappingURL=bottle.CqKxldbe.js.map
