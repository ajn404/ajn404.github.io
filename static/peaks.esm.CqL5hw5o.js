import{c as Ii,g as Ln}from"./_commonjsHelpers.DqoTaOmB.js";import"./_sentry-release-injection-file.B-UwqLso.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5620e137-e3bc-48f3-adac-5e45ad57e51e",e._sentryDebugIdIdentifier="sentry-dbid-5620e137-e3bc-48f3-adac-5e45ad57e51e")}catch{}})();var _i={exports:{}},pi={},$={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const t=Math.PI/180;function i(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}e.glob=typeof Ii<"u"?Ii:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},e.Konva={_global:e.glob,version:"9.3.20",isBrowser:i(),isUnminified:/param/.test(function(r){}.toString()),dblClickWindow:400,getAngle(r){return e.Konva.angleDeg?r*t:r},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return e.Konva.DD.isDragging},isTransforming(){var r;return(r=e.Konva.Transformer)===null||r===void 0?void 0:r.isTransforming()},isDragReady(){return!!e.Konva.DD.node},releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(r){e.glob.Konva=r}};const n=r=>{e.Konva[r.prototype.getClassName()]=r};e._registerNode=n,e.Konva._injectGlobal(e.Konva)})($);var dt={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Util=e.Transform=void 0;const t=$;class i{constructor(u=[1,0,0,1,0,0]){this.dirty=!1,this.m=u&&u.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new i(this.m)}copyInto(u){u.m[0]=this.m[0],u.m[1]=this.m[1],u.m[2]=this.m[2],u.m[3]=this.m[3],u.m[4]=this.m[4],u.m[5]=this.m[5]}point(u){const y=this.m;return{x:y[0]*u.x+y[2]*u.y+y[4],y:y[1]*u.x+y[3]*u.y+y[5]}}translate(u,y){return this.m[4]+=this.m[0]*u+this.m[2]*y,this.m[5]+=this.m[1]*u+this.m[3]*y,this}scale(u,y){return this.m[0]*=u,this.m[1]*=u,this.m[2]*=y,this.m[3]*=y,this}rotate(u){const y=Math.cos(u),S=Math.sin(u),E=this.m[0]*y+this.m[2]*S,m=this.m[1]*y+this.m[3]*S,x=this.m[0]*-S+this.m[2]*y,b=this.m[1]*-S+this.m[3]*y;return this.m[0]=E,this.m[1]=m,this.m[2]=x,this.m[3]=b,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(u,y){const S=this.m[0]+this.m[2]*y,E=this.m[1]+this.m[3]*y,m=this.m[2]+this.m[0]*u,x=this.m[3]+this.m[1]*u;return this.m[0]=S,this.m[1]=E,this.m[2]=m,this.m[3]=x,this}multiply(u){const y=this.m[0]*u.m[0]+this.m[2]*u.m[1],S=this.m[1]*u.m[0]+this.m[3]*u.m[1],E=this.m[0]*u.m[2]+this.m[2]*u.m[3],m=this.m[1]*u.m[2]+this.m[3]*u.m[3],x=this.m[0]*u.m[4]+this.m[2]*u.m[5]+this.m[4],b=this.m[1]*u.m[4]+this.m[3]*u.m[5]+this.m[5];return this.m[0]=y,this.m[1]=S,this.m[2]=E,this.m[3]=m,this.m[4]=x,this.m[5]=b,this}invert(){const u=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),y=this.m[3]*u,S=-this.m[1]*u,E=-this.m[2]*u,m=this.m[0]*u,x=u*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),b=u*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=y,this.m[1]=S,this.m[2]=E,this.m[3]=m,this.m[4]=x,this.m[5]=b,this}getMatrix(){return this.m}decompose(){const u=this.m[0],y=this.m[1],S=this.m[2],E=this.m[3],m=this.m[4],x=this.m[5],b=u*E-y*S,A={x:m,y:x,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(u!=0||y!=0){const D=Math.sqrt(u*u+y*y);A.rotation=y>0?Math.acos(u/D):-Math.acos(u/D),A.scaleX=D,A.scaleY=b/D,A.skewX=(u*S+y*E)/b,A.skewY=0}else if(S!=0||E!=0){const D=Math.sqrt(S*S+E*E);A.rotation=Math.PI/2-(E>0?Math.acos(-S/D):-Math.acos(S/D)),A.scaleX=b/D,A.scaleY=D,A.skewX=0,A.skewY=(u*S+y*E)/b}return A.rotation=e.Util._getRotation(A.rotation),A}}e.Transform=i;const n="[object Array]",r="[object Number]",s="[object String]",a="[object Boolean]",o=Math.PI/180,l=180/Math.PI,d="#",c="",w="0",T="Konva warning: ",g="Konva error: ",f="rgb(",v={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},_=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let C=[];const P=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(h){setTimeout(h,60)};e.Util={_isElement(h){return!!(h&&h.nodeType==1)},_isFunction(h){return!!(h&&h.constructor&&h.call&&h.apply)},_isPlainObject(h){return!!h&&h.constructor===Object},_isArray(h){return Object.prototype.toString.call(h)===n},_isNumber(h){return Object.prototype.toString.call(h)===r&&!isNaN(h)&&isFinite(h)},_isString(h){return Object.prototype.toString.call(h)===s},_isBoolean(h){return Object.prototype.toString.call(h)===a},isObject(h){return h instanceof Object},isValidSelector(h){if(typeof h!="string")return!1;const u=h[0];return u==="#"||u==="."||u===u.toUpperCase()},_sign(h){return h===0||h>0?1:-1},requestAnimFrame(h){C.push(h),C.length===1&&P(function(){const u=C;C=[],u.forEach(function(y){y()})})},createCanvasElement(){const h=document.createElement("canvas");try{h.style=h.style||{}}catch{}return h},createImageElement(){return document.createElement("img")},_isInDocument(h){for(;h=h.parentNode;)if(h==document)return!0;return!1},_urlToImage(h,u){const y=e.Util.createImageElement();y.onload=function(){u(y)},y.src=h},_rgbToHex(h,u,y){return((1<<24)+(h<<16)+(u<<8)+y).toString(16).slice(1)},_hexToRgb(h){h=h.replace(d,c);const u=parseInt(h,16);return{r:u>>16&255,g:u>>8&255,b:u&255}},getRandomColor(){let h=(Math.random()*16777215<<0).toString(16);for(;h.length<6;)h=w+h;return d+h},getRGB(h){let u;return h in v?(u=v[h],{r:u[0],g:u[1],b:u[2]}):h[0]===d?this._hexToRgb(h.substring(1)):h.substr(0,4)===f?(u=_.exec(h.replace(/ /g,"")),{r:parseInt(u[1],10),g:parseInt(u[2],10),b:parseInt(u[3],10)}):{r:0,g:0,b:0}},colorToRGBA(h){return h=h||"black",e.Util._namedColorToRBA(h)||e.Util._hex3ColorToRGBA(h)||e.Util._hex4ColorToRGBA(h)||e.Util._hex6ColorToRGBA(h)||e.Util._hex8ColorToRGBA(h)||e.Util._rgbColorToRGBA(h)||e.Util._rgbaColorToRGBA(h)||e.Util._hslColorToRGBA(h)},_namedColorToRBA(h){const u=v[h.toLowerCase()];return u?{r:u[0],g:u[1],b:u[2],a:1}:null},_rgbColorToRGBA(h){if(h.indexOf("rgb(")===0){h=h.match(/rgb\(([^)]+)\)/)[1];const u=h.split(/ *, */).map(Number);return{r:u[0],g:u[1],b:u[2],a:1}}},_rgbaColorToRGBA(h){if(h.indexOf("rgba(")===0){h=h.match(/rgba\(([^)]+)\)/)[1];const u=h.split(/ *, */).map((y,S)=>y.slice(-1)==="%"?S===3?parseInt(y)/100:parseInt(y)/100*255:Number(y));return{r:u[0],g:u[1],b:u[2],a:u[3]}}},_hex8ColorToRGBA(h){if(h[0]==="#"&&h.length===9)return{r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16),a:parseInt(h.slice(7,9),16)/255}},_hex6ColorToRGBA(h){if(h[0]==="#"&&h.length===7)return{r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16),a:1}},_hex4ColorToRGBA(h){if(h[0]==="#"&&h.length===5)return{r:parseInt(h[1]+h[1],16),g:parseInt(h[2]+h[2],16),b:parseInt(h[3]+h[3],16),a:parseInt(h[4]+h[4],16)/255}},_hex3ColorToRGBA(h){if(h[0]==="#"&&h.length===4)return{r:parseInt(h[1]+h[1],16),g:parseInt(h[2]+h[2],16),b:parseInt(h[3]+h[3],16),a:1}},_hslColorToRGBA(h){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(h)){const[u,...y]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(h),S=Number(y[0])/360,E=Number(y[1])/100,m=Number(y[2])/100;let x,b,A;if(E===0)return A=m*255,{r:Math.round(A),g:Math.round(A),b:Math.round(A),a:1};m<.5?x=m*(1+E):x=m+E-m*E;const D=2*m-x,O=[0,0,0];for(let F=0;F<3;F++)b=S+1/3*-(F-1),b<0&&b++,b>1&&b--,6*b<1?A=D+(x-D)*6*b:2*b<1?A=x:3*b<2?A=D+(x-D)*(2/3-b)*6:A=D,O[F]=A*255;return{r:Math.round(O[0]),g:Math.round(O[1]),b:Math.round(O[2]),a:1}}},haveIntersection(h,u){return!(u.x>h.x+h.width||u.x+u.width<h.x||u.y>h.y+h.height||u.y+u.height<h.y)},cloneObject(h){const u={};for(const y in h)this._isPlainObject(h[y])?u[y]=this.cloneObject(h[y]):this._isArray(h[y])?u[y]=this.cloneArray(h[y]):u[y]=h[y];return u},cloneArray(h){return h.slice(0)},degToRad(h){return h*o},radToDeg(h){return h*l},_degToRad(h){return e.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),e.Util.degToRad(h)},_radToDeg(h){return e.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),e.Util.radToDeg(h)},_getRotation(h){return t.Konva.angleDeg?e.Util.radToDeg(h):h},_capitalize(h){return h.charAt(0).toUpperCase()+h.slice(1)},throw(h){throw new Error(g+h)},error(h){console.error(g+h)},warn(h){t.Konva.showWarnings&&console.warn(T+h)},each(h,u){for(const y in h)u(y,h[y])},_inRange(h,u,y){return u<=h&&h<y},_getProjectionToSegment(h,u,y,S,E,m){let x,b,A;const D=(h-y)*(h-y)+(u-S)*(u-S);if(D==0)x=h,b=u,A=(E-y)*(E-y)+(m-S)*(m-S);else{const O=((E-h)*(y-h)+(m-u)*(S-u))/D;O<0?(x=h,b=u,A=(h-E)*(h-E)+(u-m)*(u-m)):O>1?(x=y,b=S,A=(y-E)*(y-E)+(S-m)*(S-m)):(x=h+O*(y-h),b=u+O*(S-u),A=(x-E)*(x-E)+(b-m)*(b-m))}return[x,b,A]},_getProjectionToLine(h,u,y){const S=e.Util.cloneObject(h);let E=Number.MAX_VALUE;return u.forEach(function(m,x){if(!y&&x===u.length-1)return;const b=u[(x+1)%u.length],A=e.Util._getProjectionToSegment(m.x,m.y,b.x,b.y,h.x,h.y),D=A[0],O=A[1],F=A[2];F<E&&(S.x=D,S.y=O,E=F)}),S},_prepareArrayForTween(h,u,y){const S=[],E=[];if(h.length>u.length){const x=u;u=h,h=x}for(let x=0;x<h.length;x+=2)S.push({x:h[x],y:h[x+1]});for(let x=0;x<u.length;x+=2)E.push({x:u[x],y:u[x+1]});const m=[];return E.forEach(function(x){const b=e.Util._getProjectionToLine(x,S,y);m.push(b.x),m.push(b.y)}),m},_prepareToStringify(h){let u;h.visitedByCircularReferenceRemoval=!0;for(const y in h)if(h.hasOwnProperty(y)&&h[y]&&typeof h[y]=="object"){if(u=Object.getOwnPropertyDescriptor(h,y),h[y].visitedByCircularReferenceRemoval||e.Util._isElement(h[y]))if(u.configurable)delete h[y];else return null;else if(e.Util._prepareToStringify(h[y])===null)if(u.configurable)delete h[y];else return null}return delete h.visitedByCircularReferenceRemoval,h},_assign(h,u){for(const y in u)h[y]=u[y];return h},_getFirstPointerId(h){return h.touches?h.changedTouches[0].identifier:h.pointerId||999},releaseCanvas(...h){t.Konva.releaseCanvasOnDestroy&&h.forEach(u=>{u.width=0,u.height=0})},drawRoundedRectPath(h,u,y,S){let E=0,m=0,x=0,b=0;typeof S=="number"?E=m=x=b=Math.min(S,u/2,y/2):(E=Math.min(S[0]||0,u/2,y/2),m=Math.min(S[1]||0,u/2,y/2),b=Math.min(S[2]||0,u/2,y/2),x=Math.min(S[3]||0,u/2,y/2)),h.moveTo(E,0),h.lineTo(u-m,0),h.arc(u-m,m,m,Math.PI*3/2,0,!1),h.lineTo(u,y-b),h.arc(u-b,y-b,b,0,Math.PI/2,!1),h.lineTo(x,y),h.arc(x,y-x,x,Math.PI/2,Math.PI,!1),h.lineTo(0,E),h.arc(E,E,E,Math.PI,Math.PI*3/2,!1)}}})(dt);var Yt={},Rt={},rt={};Object.defineProperty(rt,"__esModule",{value:!0});rt.RGBComponent=On;rt.alphaComponent=Fn;rt.getNumberValidator=Gn;rt.getNumberOrArrayOfNumbersValidator=Rn;rt.getNumberOrAutoValidator=Wn;rt.getStringValidator=Bn;rt.getStringOrGradientValidator=Hn;rt.getFunctionValidator=Vn;rt.getNumberArrayValidator=Un;rt.getBooleanValidator=Nn;rt.getComponentValidator=Xn;const Wt=$,q=dt;function Bt(e){return q.Util._isString(e)?'"'+e+'"':Object.prototype.toString.call(e)==="[object Number]"||q.Util._isBoolean(e)?e:Object.prototype.toString.call(e)}function On(e){return e>255?255:e<0?0:Math.round(e)}function Fn(e){return e>1?1:e<1e-4?1e-4:e}function Gn(){if(Wt.Konva.isUnminified)return function(e,t){return q.Util._isNumber(e)||q.Util.warn(Bt(e)+' is a not valid value for "'+t+'" attribute. The value should be a number.'),e}}function Rn(e){if(Wt.Konva.isUnminified)return function(t,i){let n=q.Util._isNumber(t),r=q.Util._isArray(t)&&t.length==e;return!n&&!r&&q.Util.warn(Bt(t)+' is a not valid value for "'+i+'" attribute. The value should be a number or Array<number>('+e+")"),t}}function Wn(){if(Wt.Konva.isUnminified)return function(e,t){var i=q.Util._isNumber(e),n=e==="auto";return i||n||q.Util.warn(Bt(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or "auto".'),e}}function Bn(){if(Wt.Konva.isUnminified)return function(e,t){return q.Util._isString(e)||q.Util.warn(Bt(e)+' is a not valid value for "'+t+'" attribute. The value should be a string.'),e}}function Hn(){if(Wt.Konva.isUnminified)return function(e,t){const i=q.Util._isString(e),n=Object.prototype.toString.call(e)==="[object CanvasGradient]"||e&&e.addColorStop;return i||n||q.Util.warn(Bt(e)+' is a not valid value for "'+t+'" attribute. The value should be a string or a native gradient.'),e}}function Vn(){if(Wt.Konva.isUnminified)return function(e,t){return q.Util._isFunction(e)||q.Util.warn(Bt(e)+' is a not valid value for "'+t+'" attribute. The value should be a function.'),e}}function Un(){if(Wt.Konva.isUnminified)return function(e,t){const i=Int8Array?Object.getPrototypeOf(Int8Array):null;return i&&e instanceof i||(q.Util._isArray(e)?e.forEach(function(n){q.Util._isNumber(n)||q.Util.warn('"'+t+'" attribute has non numeric element '+n+". Make sure that all elements are numbers.")}):q.Util.warn(Bt(e)+' is a not valid value for "'+t+'" attribute. The value should be a array of numbers.')),e}}function Nn(){if(Wt.Konva.isUnminified)return function(e,t){var i=e===!0||e===!1;return i||q.Util.warn(Bt(e)+' is a not valid value for "'+t+'" attribute. The value should be a boolean.'),e}}function Xn(e){if(Wt.Konva.isUnminified)return function(t,i){return t==null||q.Util.isObject(t)||q.Util.warn(Bt(t)+' is a not valid value for "'+i+'" attribute. The value should be an object with properties '+e),t}}(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const t=dt,i=rt,n="get",r="set";e.Factory={addGetterSetter(s,a,o,l,d){e.Factory.addGetter(s,a,o),e.Factory.addSetter(s,a,l,d),e.Factory.addOverloadedGetterSetter(s,a)},addGetter(s,a,o){var l=n+t.Util._capitalize(a);s.prototype[l]=s.prototype[l]||function(){const d=this.attrs[a];return d===void 0?o:d}},addSetter(s,a,o,l){var d=r+t.Util._capitalize(a);s.prototype[d]||e.Factory.overWriteSetter(s,a,o,l)},overWriteSetter(s,a,o,l){var d=r+t.Util._capitalize(a);s.prototype[d]=function(c){return o&&c!==void 0&&c!==null&&(c=o.call(this,c,a)),this._setAttr(a,c),l&&l.call(this),this}},addComponentsGetterSetter(s,a,o,l,d){const c=o.length,w=t.Util._capitalize,T=n+w(a),g=r+w(a);s.prototype[T]=function(){const v={};for(let _=0;_<c;_++){const C=o[_];v[C]=this.getAttr(a+w(C))}return v};const f=(0,i.getComponentValidator)(o);s.prototype[g]=function(v){const _=this.attrs[a];l&&(v=l.call(this,v,a)),f&&f.call(this,v,a);for(const C in v)v.hasOwnProperty(C)&&this._setAttr(a+w(C),v[C]);return v||o.forEach(C=>{this._setAttr(a+w(C),void 0)}),this._fireChangeEvent(a,_,v),d&&d.call(this),this},e.Factory.addOverloadedGetterSetter(s,a)},addOverloadedGetterSetter(s,a){var o=t.Util._capitalize(a),l=r+o,d=n+o;s.prototype[a]=function(){return arguments.length?(this[l](arguments[0]),this):this[d]()}},addDeprecatedGetterSetter(s,a,o,l){t.Util.error("Adding deprecated "+a);const d=n+t.Util._capitalize(a),c=a+" property is deprecated and will be removed soon. Look at Konva change log for more information.";s.prototype[d]=function(){t.Util.error(c);const w=this.attrs[a];return w===void 0?o:w},e.Factory.addSetter(s,a,l,function(){t.Util.error(c)}),e.Factory.addOverloadedGetterSetter(s,a)},backCompat(s,a){t.Util.each(a,function(o,l){const d=s.prototype[l],c=n+t.Util._capitalize(o),w=r+t.Util._capitalize(o);function T(){d.apply(this,arguments),t.Util.error('"'+o+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}s.prototype[o]=T,s.prototype[c]=T,s.prototype[w]=T})},afterSetFilter(){this._filterUpToDate=!1}}})(Rt);var At={},Gt={};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.HitContext=Gt.SceneContext=Gt.Context=void 0;const en=dt,zn=$;function Yn(e){const t=[],i=e.length,n=en.Util;for(let r=0;r<i;r++){let s=e[r];n._isNumber(s)?s=Math.round(s*1e3)/1e3:n._isString(s)||(s=s+""),t.push(s)}return t}const Mi=",",Zn="(",Kn=")",jn="([",Jn="])",qn=";",$n="()",Qn="=",Li=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],tr=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],er=100;class Ke{constructor(t){this.canvas=t,zn.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,i){let n=this.traceArr,r=n.length,s="",a,o,l,d;for(a=0;a<r;a++)o=n[a],l=o.method,l?(d=o.args,s+=l,t?s+=$n:en.Util._isArray(d[0])?s+=jn+d.join(Mi)+Jn:(i&&(d=d.map(c=>typeof c=="number"?Math.floor(c):c)),s+=Zn+d.join(Mi)+Kn)):(s+=o.property,t||(s+=Qn+o.val)),s+=qn;return s}clearTrace(){this.traceArr=[]}_trace(t){let i=this.traceArr,n;i.push(t),n=i.length,n>=er&&i.shift()}reset(){const t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){const i=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,i.getWidth()/i.pixelRatio,i.getHeight()/i.pixelRatio)}_applyLineCap(t){const i=t.attrs.lineCap;i&&this.setAttr("lineCap",i)}_applyOpacity(t){const i=t.getAbsoluteOpacity();i!==1&&this.setAttr("globalAlpha",i)}_applyLineJoin(t){const i=t.attrs.lineJoin;i&&this.setAttr("lineJoin",i)}setAttr(t,i){this._context[t]=i}arc(t,i,n,r,s,a){this._context.arc(t,i,n,r,s,a)}arcTo(t,i,n,r,s){this._context.arcTo(t,i,n,r,s)}beginPath(){this._context.beginPath()}bezierCurveTo(t,i,n,r,s,a){this._context.bezierCurveTo(t,i,n,r,s,a)}clearRect(t,i,n,r){this._context.clearRect(t,i,n,r)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,i){const n=arguments;if(n.length===2)return this._context.createImageData(t,i);if(n.length===1)return this._context.createImageData(t)}createLinearGradient(t,i,n,r){return this._context.createLinearGradient(t,i,n,r)}createPattern(t,i){return this._context.createPattern(t,i)}createRadialGradient(t,i,n,r,s,a){return this._context.createRadialGradient(t,i,n,r,s,a)}drawImage(t,i,n,r,s,a,o,l,d){const c=arguments,w=this._context;c.length===3?w.drawImage(t,i,n):c.length===5?w.drawImage(t,i,n,r,s):c.length===9&&w.drawImage(t,i,n,r,s,a,o,l,d)}ellipse(t,i,n,r,s,a,o,l){this._context.ellipse(t,i,n,r,s,a,o,l)}isPointInPath(t,i,n,r){return n?this._context.isPointInPath(n,t,i,r):this._context.isPointInPath(t,i,r)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,i,n,r){this._context.fillRect(t,i,n,r)}strokeRect(t,i,n,r){this._context.strokeRect(t,i,n,r)}fillText(t,i,n,r){r?this._context.fillText(t,i,n,r):this._context.fillText(t,i,n)}measureText(t){return this._context.measureText(t)}getImageData(t,i,n,r){return this._context.getImageData(t,i,n,r)}lineTo(t,i){this._context.lineTo(t,i)}moveTo(t,i){this._context.moveTo(t,i)}rect(t,i,n,r){this._context.rect(t,i,n,r)}roundRect(t,i,n,r,s){this._context.roundRect(t,i,n,r,s)}putImageData(t,i,n){this._context.putImageData(t,i,n)}quadraticCurveTo(t,i,n,r){this._context.quadraticCurveTo(t,i,n,r)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,i){this._context.scale(t,i)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,i,n,r,s,a){this._context.setTransform(t,i,n,r,s,a)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,i,n,r){this._context.strokeText(t,i,n,r)}transform(t,i,n,r,s,a){this._context.transform(t,i,n,r,s,a)}translate(t,i){this._context.translate(t,i)}_enableTrace(){let t=this,i=Li.length,n=this.setAttr,r,s;const a=function(o){let l=t[o],d;t[o]=function(){return s=Yn(Array.prototype.slice.call(arguments,0)),d=l.apply(t,arguments),t._trace({method:o,args:s}),d}};for(r=0;r<i;r++)a(Li[r]);t.setAttr=function(){n.apply(t,arguments);const o=arguments[0];let l=arguments[1];(o==="shadowOffsetX"||o==="shadowOffsetY"||o==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),t._trace({property:o,val:l})}}_applyGlobalCompositeOperation(t){const i=t.attrs.globalCompositeOperation;!i||i==="source-over"||this.setAttr("globalCompositeOperation",i)}}Gt.Context=Ke;tr.forEach(function(e){Object.defineProperty(Ke.prototype,e,{get(){return this._context[e]},set(t){this._context[e]=t}})});class ir extends Ke{constructor(t,{willReadFrequently:i=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:i})}_fillColor(t){const i=t.fill();this.setAttr("fillStyle",i),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){const i=t._getLinearGradient();i&&(this.setAttr("fillStyle",i),t._fillFunc(this))}_fillRadialGradient(t){const i=t._getRadialGradient();i&&(this.setAttr("fillStyle",i),t._fillFunc(this))}_fill(t){const i=t.fill(),n=t.getFillPriority();if(i&&n==="color"){this._fillColor(t);return}const r=t.getFillPatternImage();if(r&&n==="pattern"){this._fillPattern(t);return}const s=t.getFillLinearGradientColorStops();if(s&&n==="linear-gradient"){this._fillLinearGradient(t);return}const a=t.getFillRadialGradientColorStops();if(a&&n==="radial-gradient"){this._fillRadialGradient(t);return}i?this._fillColor(t):r?this._fillPattern(t):s?this._fillLinearGradient(t):a&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const i=t.getStrokeLinearGradientStartPoint(),n=t.getStrokeLinearGradientEndPoint(),r=t.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(i.x,i.y,n.x,n.y);if(r){for(let a=0;a<r.length;a+=2)s.addColorStop(r[a],r[a+1]);this.setAttr("strokeStyle",s)}}_stroke(t){const i=t.dash(),n=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!n){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(t),i&&t.dashEnabled()&&(this.setLineDash(i),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),n||this.restore()}}_applyShadow(t){var i,n,r;const s=(i=t.getShadowRGBA())!==null&&i!==void 0?i:"black",a=(n=t.getShadowBlur())!==null&&n!==void 0?n:5,o=(r=t.getShadowOffset())!==null&&r!==void 0?r:{x:0,y:0},l=t.getAbsoluteScale(),d=this.canvas.getPixelRatio(),c=l.x*d,w=l.y*d;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",a*Math.min(Math.abs(c),Math.abs(w))),this.setAttr("shadowOffsetX",o.x*c),this.setAttr("shadowOffsetY",o.y*w)}}Gt.SceneContext=ir;class nr extends Ke{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const i=t.getStrokeScaleEnabled();if(!i){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(t);const n=t.hitStrokeWidth(),r=n==="auto"?t.strokeWidth():n;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),i||this.restore()}}}Gt.HitContext=nr;Object.defineProperty(At,"__esModule",{value:!0});At.HitCanvas=At.SceneCanvas=At.Canvas=void 0;const Ne=dt,nn=Gt,rn=$;let Ge;function rr(){if(Ge)return Ge;const e=Ne.Util.createCanvasElement(),t=e.getContext("2d");return Ge=function(){const i=rn.Konva._global.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return i/n}(),Ne.Util.releaseCanvas(e),Ge}class Ci{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const n=(t||{}).pixelRatio||rn.Konva.pixelRatio||rr();this.pixelRatio=n,this._canvas=Ne.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){const i=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/i,this.getHeight()/i)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";const i=this.pixelRatio;this.getContext()._context.scale(i,i)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";const i=this.pixelRatio;this.getContext()._context.scale(i,i)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,i){this.setWidth(t||0),this.setHeight(i||0)}toDataURL(t,i){try{return this._canvas.toDataURL(t,i)}catch{try{return this._canvas.toDataURL()}catch(r){return Ne.Util.error("Unable to get data URL. "+r.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}At.Canvas=Ci;class sr extends Ci{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new nn.SceneContext(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}At.SceneCanvas=sr;class ar extends Ci{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new nn.HitContext(this),this.setSize(t.width,t.height)}}At.HitCanvas=ar;var je={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;const t=$,i=dt;e.DD={get isDragging(){let n=!1;return e.DD._dragElements.forEach(r=>{r.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return e.DD._dragElements.forEach(r=>{n=r.node}),n},_dragElements:new Map,_drag(n){const r=[];e.DD._dragElements.forEach((s,a)=>{const{node:o}=s,l=o.getStage();l.setPointersPositions(n),s.pointerId===void 0&&(s.pointerId=i.Util._getFirstPointerId(n));const d=l._changedPointerPositions.find(c=>c.id===s.pointerId);if(d){if(s.dragStatus!=="dragging"){const c=o.dragDistance();if(Math.max(Math.abs(d.x-s.startPointerPos.x),Math.abs(d.y-s.startPointerPos.y))<c||(o.startDrag({evt:n}),!o.isDragging()))return}o._setDragPosition(n,s),r.push(o)}}),r.forEach(s=>{s.fire("dragmove",{type:"dragmove",target:s,evt:n},!0)})},_endDragBefore(n){const r=[];e.DD._dragElements.forEach(s=>{const{node:a}=s,o=a.getStage();if(n&&o.setPointersPositions(n),!o._changedPointerPositions.find(c=>c.id===s.pointerId))return;(s.dragStatus==="dragging"||s.dragStatus==="stopped")&&(e.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,s.dragStatus="stopped");const d=s.node.getLayer()||s.node instanceof t.Konva.Stage&&s.node;d&&r.indexOf(d)===-1&&r.push(d)}),r.forEach(s=>{s.draw()})},_endDragAfter(n){e.DD._dragElements.forEach((r,s)=>{r.dragStatus==="stopped"&&r.node.fire("dragend",{type:"dragend",target:r.node,evt:n},!0),r.dragStatus!=="dragging"&&e.DD._dragElements.delete(s)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("touchcancel",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1),window.addEventListener("touchcancel",e.DD._endDragAfter,!1))})(je);Object.defineProperty(Yt,"__esModule",{value:!0});Yt.Node=void 0;const B=dt,xe=Rt,we=At,Nt=$,Tt=je,et=rt,He="absoluteOpacity",Re="allEventListeners",Ft="absoluteTransform",Oi="absoluteScale",$t="canvas",or="Change",hr="children",lr="konva",mi="listening",Fi="mouseenter",Gi="mouseleave",Ri="set",Wi="Shape",Ve=" ",Bi="stage",Xt="transform",dr="Stage",vi="visible",ur=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Ve);let fr=1;class G{constructor(t){this._id=fr++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){(t===Xt||t===Ft)&&this._cache.get(t)?this._cache.get(t).dirty=!0:t?this._cache.delete(t):this._cache.clear()}_getCache(t,i){let n=this._cache.get(t);return(n===void 0||(t===Xt||t===Ft)&&n.dirty===!0)&&(n=i.call(this),this._cache.set(t,n)),n}_calculate(t,i,n){if(!this._attachedDepsListeners.get(t)){const r=i.map(s=>s+"Change.konva").join(Ve);this.on(r,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,n)}_getCanvasCache(){return this._cache.get($t)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===Ft&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has($t)){const{scene:t,filter:i,hit:n}=this._cache.get($t);B.Util.releaseCanvas(t,i,n),this._cache.delete($t)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){const i=t||{};let n={};(i.x===void 0||i.y===void 0||i.width===void 0||i.height===void 0)&&(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let r=Math.ceil(i.width||n.width),s=Math.ceil(i.height||n.height),a=i.pixelRatio,o=i.x===void 0?Math.floor(n.x):i.x,l=i.y===void 0?Math.floor(n.y):i.y,d=i.offset||0,c=i.drawBorder||!1,w=i.hitCanvasPixelRatio||1;if(!r||!s){B.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const T=Math.abs(Math.round(n.x)-o)>.5?1:0,g=Math.abs(Math.round(n.y)-l)>.5?1:0;r+=d*2+T,s+=d*2+g,o-=d,l-=d;const f=new we.SceneCanvas({pixelRatio:a,width:r,height:s}),v=new we.SceneCanvas({pixelRatio:a,width:0,height:0,willReadFrequently:!0}),_=new we.HitCanvas({pixelRatio:w,width:r,height:s}),C=f.getContext(),P=_.getContext();return _.isCache=!0,f.isCache=!0,this._cache.delete($t),this._filterUpToDate=!1,i.imageSmoothingEnabled===!1&&(f.getContext()._context.imageSmoothingEnabled=!1,v.getContext()._context.imageSmoothingEnabled=!1),C.save(),P.save(),C.translate(-o,-l),P.translate(-o,-l),this._isUnderCache=!0,this._clearSelfAndDescendantCache(He),this._clearSelfAndDescendantCache(Oi),this.drawScene(f,this),this.drawHit(_,this),this._isUnderCache=!1,C.restore(),P.restore(),c&&(C.save(),C.beginPath(),C.rect(0,0,r,s),C.closePath(),C.setAttr("strokeStyle","red"),C.setAttr("lineWidth",5),C.stroke(),C.restore()),this._cache.set($t,{scene:f,filter:v,hit:_,x:o,y:l}),this._requestDraw(),this}isCached(){return this._cache.has($t)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,i){const n=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}];let r=1/0,s=1/0,a=-1/0,o=-1/0;const l=this.getAbsoluteTransform(i);return n.forEach(function(d){const c=l.point(d);r===void 0&&(r=a=c.x,s=o=c.y),r=Math.min(r,c.x),s=Math.min(s,c.y),a=Math.max(a,c.x),o=Math.max(o,c.y)}),{x:r,y:s,width:a-r,height:o-s}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const i=this._getCanvasCache();t.translate(i.x,i.y);const n=this._getCachedSceneCanvas(),r=n.pixelRatio;t.drawImage(n._canvas,0,0,n.width/r,n.height/r),t.restore()}_drawCachedHitCanvas(t){const i=this._getCanvasCache(),n=i.hit;t.save(),t.translate(i.x,i.y),t.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),t.restore()}_getCachedSceneCanvas(){let t=this.filters(),i=this._getCanvasCache(),n=i.scene,r=i.filter,s=r.getContext(),a,o,l,d;if(t){if(!this._filterUpToDate){const c=n.pixelRatio;r.setSize(n.width/n.pixelRatio,n.height/n.pixelRatio);try{for(a=t.length,s.clear(),s.drawImage(n._canvas,0,0,n.getWidth()/c,n.getHeight()/c),o=s.getImageData(0,0,r.getWidth(),r.getHeight()),l=0;l<a;l++){if(d=t[l],typeof d!="function"){B.Util.error("Filter should be type of function, but got "+typeof d+" instead. Please check correct filters");continue}d.call(this,o),s.putImageData(o,0,0)}}catch(w){B.Util.error("Unable to apply filter. "+w.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return r}return n}on(t,i){if(this._cache&&this._cache.delete(Re),arguments.length===3)return this._delegate.apply(this,arguments);let n=t.split(Ve),r=n.length,s,a,o,l,d;for(s=0;s<r;s++)a=n[s],o=a.split("."),l=o[0],d=o[1]||"",this.eventListeners[l]||(this.eventListeners[l]=[]),this.eventListeners[l].push({name:d,handler:i});return this}off(t,i){let n=(t||"").split(Ve),r=n.length,s,a,o,l,d,c;if(this._cache&&this._cache.delete(Re),!t)for(a in this.eventListeners)this._off(a);for(s=0;s<r;s++)if(o=n[s],l=o.split("."),d=l[0],c=l[1],d)this.eventListeners[d]&&this._off(d,c,i);else for(a in this.eventListeners)this._off(a,c,i);return this}dispatchEvent(t){const i={target:this,type:t.type,evt:t};return this.fire(t.type,i),this}addEventListener(t,i){return this.on(t,function(n){i.call(this,n.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,i,n){const r=this;this.on(t,function(s){const a=s.target.findAncestors(i,!0,r);for(let o=0;o<a.length;o++)s=B.Util.cloneObject(s),s.currentTarget=a[o],n.call(a[o],s)})}remove(){return this.isDragging()&&this.stopDrag(),Tt.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Ft),this._clearSelfAndDescendantCache(He),this._clearSelfAndDescendantCache(Oi),this._clearSelfAndDescendantCache(Bi),this._clearSelfAndDescendantCache(vi),this._clearSelfAndDescendantCache(mi)}_remove(){this._clearCaches();const t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){const i="get"+B.Util._capitalize(t);return B.Util._isFunction(this[i])?this[i]():this.attrs[t]}getAncestors(){let t=this.getParent(),i=[];for(;t;)i.push(t),t=t.getParent();return i}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{let i,n;if(!t)return this;for(i in t)i!==hr&&(n=Ri+B.Util._capitalize(i),B.Util._isFunction(this[n])?this[n](t[i]):this._setAttr(i,t[i]))}),this}isListening(){return this._getCache(mi,this._isListening)}_isListening(t){if(!this.listening())return!1;const n=this.getParent();return n&&n!==t&&this!==t?n._isListening(t):!0}isVisible(){return this._getCache(vi,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const n=this.getParent();return n&&n!==t&&this!==t?n._isVisible(t):!0}shouldDrawHit(t,i=!1){if(t)return this._isVisible(t)&&this._isListening(t);const n=this.getLayer();let r=!1;Tt.DD._dragElements.forEach(a=>{a.dragStatus==="dragging"&&(a.node.nodeType==="Stage"||a.node.getLayer()===n)&&(r=!0)});const s=!i&&!Nt.Konva.hitOnDragEnabled&&(r||Nt.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let t=this.getDepth(),i=this,n=0,r,s,a,o;function l(c){for(r=[],s=c.length,a=0;a<s;a++)o=c[a],n++,o.nodeType!==Wi&&(r=r.concat(o.getChildren().slice())),o._id===i._id&&(a=s);r.length>0&&r[0].getDepth()<=t&&l(r)}const d=this.getStage();return i.nodeType!==dr&&d&&l(d.getChildren()),n}getDepth(){let t=0,i=this.parent;for(;i;)t++,i=i.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Xt),this._clearSelfAndDescendantCache(Ft)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const t=this.getStage();if(!t)return null;const i=t.getPointerPosition();if(!i)return null;const n=this.getAbsoluteTransform().copy();return n.invert(),n.point(i)}getAbsolutePosition(t){let i=!1,n=this.parent;for(;n;){if(n.isCached()){i=!0;break}n=n.parent}i&&!t&&(t=!0);const r=this.getAbsoluteTransform(t).getMatrix(),s=new B.Transform,a=this.offset();return s.m=r.slice(),s.translate(a.x,a.y),s.getTranslation()}setAbsolutePosition(t){const{x:i,y:n,...r}=this._clearTransform();this.attrs.x=i,this.attrs.y=n,this._clearCache(Xt);const s=this._getAbsoluteTransform().copy();return s.invert(),s.translate(t.x,t.y),t={x:this.attrs.x+s.getTranslation().x,y:this.attrs.y+s.getTranslation().y},this._setTransform(r),this.setPosition({x:t.x,y:t.y}),this._clearCache(Xt),this._clearSelfAndDescendantCache(Ft),this}_setTransform(t){let i;for(i in t)this.attrs[i]=t[i]}_clearTransform(){const t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){let i=t.x,n=t.y,r=this.x(),s=this.y();return i!==void 0&&(r+=i),n!==void 0&&(s+=n),this.setPosition({x:r,y:s}),this}_eachAncestorReverse(t,i){let n=[],r=this.getParent(),s,a;if(!(i&&i._id===this._id)){for(n.unshift(this);r&&(!i||r._id!==i._id);)n.unshift(r),r=r.parent;for(s=n.length,a=0;a<s;a++)t(n[a])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return B.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const t=this.index,i=this.parent.getChildren().length;return t<i-1?(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return B.Util.warn("Node has no parent. moveUp function is ignored."),!1;const t=this.index,i=this.parent.getChildren().length;return t<i-1?(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return B.Util.warn("Node has no parent. moveDown function is ignored."),!1;const t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return B.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(t){if(!this.parent)return B.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&B.Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const i=this.index;return this.parent.children.splice(i,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(He,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let t=this.opacity();const i=this.getParent();return i&&!i._isUnderCache&&(t*=i.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){let t=this.getAttrs(),i,n,r,s,a;const o={attrs:{},className:this.getClassName()};for(i in t)n=t[i],a=B.Util.isObject(n)&&!B.Util._isPlainObject(n)&&!B.Util._isArray(n),!a&&(r=typeof this[i]=="function"&&this[i],delete t[i],s=r?r.call(this):null,t[i]=n,s!==n&&(o.attrs[i]=n));return B.Util._prepareToStringify(o)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,i,n){const r=[];i&&this._isMatch(t)&&r.push(this);let s=this.parent;for(;s;){if(s===n)return r;s._isMatch(t)&&r.push(s),s=s.parent}return r}isAncestorOf(t){return!1}findAncestor(t,i,n){return this.findAncestors(t,i,n)[0]}_isMatch(t){if(!t)return!1;if(typeof t=="function")return t(this);let i=t.replace(/ /g,"").split(","),n=i.length,r,s;for(r=0;r<n;r++)if(s=i[r],B.Util.isValidSelector(s)||(B.Util.warn('Selector "'+s+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),B.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),B.Util.warn("Konva is awesome, right?")),s.charAt(0)==="#"){if(this.id()===s.slice(1))return!0}else if(s.charAt(0)==="."){if(this.hasName(s.slice(1)))return!0}else if(this.className===s||this.nodeType===s)return!0;return!1}getLayer(){const t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(Bi,this._getStage)}_getStage(){const t=this.getParent();return t?t.getStage():null}fire(t,i={},n){return i.target=i.target||this,n?this._fireAndBubble(t,i):this._fire(t,i),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(Ft,this._getAbsoluteTransform)}_getAbsoluteTransform(t){let i;if(t)return i=new B.Transform,this._eachAncestorReverse(function(n){const r=n.transformsEnabled();r==="all"?i.multiply(n.getTransform()):r==="position"&&i.translate(n.x()-n.offsetX(),n.y()-n.offsetY())},t),i;{i=this._cache.get(Ft)||new B.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(i):i.reset();const n=this.transformsEnabled();if(n==="all")i.multiply(this.getTransform());else if(n==="position"){const r=this.attrs.x||0,s=this.attrs.y||0,a=this.attrs.offsetX||0,o=this.attrs.offsetY||0;i.translate(r-a,s-o)}return i.dirty=!1,i}}getAbsoluteScale(t){let i=this;for(;i;)i._isUnderCache&&(t=i),i=i.getParent();const r=this.getAbsoluteTransform(t).decompose();return{x:r.scaleX,y:r.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Xt,this._getTransform)}_getTransform(){var t,i;const n=this._cache.get(Xt)||new B.Transform;n.reset();const r=this.x(),s=this.y(),a=Nt.Konva.getAngle(this.rotation()),o=(t=this.attrs.scaleX)!==null&&t!==void 0?t:1,l=(i=this.attrs.scaleY)!==null&&i!==void 0?i:1,d=this.attrs.skewX||0,c=this.attrs.skewY||0,w=this.attrs.offsetX||0,T=this.attrs.offsetY||0;return(r!==0||s!==0)&&n.translate(r,s),a!==0&&n.rotate(a),(d!==0||c!==0)&&n.skew(d,c),(o!==1||l!==1)&&n.scale(o,l),(w!==0||T!==0)&&n.translate(-1*w,-1*T),n.dirty=!1,n}clone(t){let i=B.Util.cloneObject(this.attrs),n,r,s,a,o;for(n in t)i[n]=t[n];const l=new this.constructor(i);for(n in this.eventListeners)for(r=this.eventListeners[n],s=r.length,a=0;a<s;a++)o=r[a],o.name.indexOf(lr)<0&&(l.eventListeners[n]||(l.eventListeners[n]=[]),l.eventListeners[n].push(o));return l}_toKonvaCanvas(t){t=t||{};const i=this.getClientRect(),n=this.getStage(),r=t.x!==void 0?t.x:Math.floor(i.x),s=t.y!==void 0?t.y:Math.floor(i.y),a=t.pixelRatio||1,o=new we.SceneCanvas({width:t.width||Math.ceil(i.width)||(n?n.width():0),height:t.height||Math.ceil(i.height)||(n?n.height():0),pixelRatio:a}),l=o.getContext(),d=new we.SceneCanvas({width:o.width/o.pixelRatio+Math.abs(r),height:o.height/o.pixelRatio+Math.abs(s),pixelRatio:o.pixelRatio});return t.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(r||s)&&l.translate(-1*r,-1*s),this.drawScene(o,void 0,d),l.restore(),o}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){t=t||{};const i=t.mimeType||null,n=t.quality||null,r=this._toKonvaCanvas(t).toDataURL(i,n);return t.callback&&t.callback(r),r}toImage(t){return new Promise((i,n)=>{try{const r=t?.callback;r&&delete t.callback,B.Util._urlToImage(this.toDataURL(t),function(s){i(s),r?.(s)})}catch(r){n(r)}})}toBlob(t){return new Promise((i,n)=>{try{const r=t?.callback;r&&delete t.callback,this.toCanvas(t).toBlob(s=>{i(s),r?.(s)},t?.mimeType,t?.quality)}catch(r){n(r)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Nt.Konva.dragDistance}_off(t,i,n){let r=this.eventListeners[t],s,a,o;for(s=0;s<r.length;s++)if(a=r[s].name,o=r[s].handler,(a!=="konva"||i==="konva")&&(!i||a===i)&&(!n||n===o)){if(r.splice(s,1),r.length===0){delete this.eventListeners[t];break}s--}}_fireChangeEvent(t,i,n){this._fire(t+or,{oldVal:i,newVal:n})}addName(t){if(!this.hasName(t)){const i=this.name(),n=i?i+" "+t:t;this.name(n)}return this}hasName(t){if(!t)return!1;const i=this.name();return i?(i||"").split(/\s/g).indexOf(t)!==-1:!1}removeName(t){const i=(this.name()||"").split(/\s/g),n=i.indexOf(t);return n!==-1&&(i.splice(n,1),this.name(i.join(" "))),this}setAttr(t,i){const n=this[Ri+B.Util._capitalize(t)];return B.Util._isFunction(n)?n.call(this,i):this._setAttr(t,i),this}_requestDraw(){if(Nt.Konva.autoDrawEnabled){const t=this.getLayer()||this.getStage();t?.batchDraw()}}_setAttr(t,i){const n=this.attrs[t];n===i&&!B.Util.isObject(i)||(i==null?delete this.attrs[t]:this.attrs[t]=i,this._shouldFireChangeEvents&&this._fireChangeEvent(t,n,i),this._requestDraw())}_setComponentAttr(t,i,n){let r;n!==void 0&&(r=this.attrs[t],r||(this.attrs[t]=this.getAttr(t)),this.attrs[t][i]=n,this._fireChangeEvent(t,r,n))}_fireAndBubble(t,i,n){if(i&&this.nodeType===Wi&&(i.target=this),!((t===Fi||t===Gi)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||this.nodeType==="Stage"&&!n))){this._fire(t,i);const s=(t===Fi||t===Gi)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(i&&!i.cancelBubble||!i)&&this.parent&&this.parent.isListening()&&!s&&(n&&n.parent?this._fireAndBubble.call(this.parent,t,i,n):this._fireAndBubble.call(this.parent,t,i))}}_getProtoListeners(t){var i,n,r;const s=(i=this._cache.get(Re))!==null&&i!==void 0?i:{};let a=s?.[t];if(a===void 0){a=[];let o=Object.getPrototypeOf(this);for(;o;){const l=(r=(n=o.eventListeners)===null||n===void 0?void 0:n[t])!==null&&r!==void 0?r:[];a.push(...l),o=Object.getPrototypeOf(o)}s[t]=a,this._cache.set(Re,s)}return a}_fire(t,i){i=i||{},i.currentTarget=this,i.type=t;const n=this._getProtoListeners(t);if(n)for(var r=0;r<n.length;r++)n[r].handler.call(this,i);const s=this.eventListeners[t];if(s)for(var r=0;r<s.length;r++)s[r].handler.call(this,i)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){const i=t?t.pointerId:void 0,n=this.getStage(),r=this.getAbsolutePosition();if(!n)return;const s=n._getPointerById(i)||n._changedPointerPositions[0]||r;Tt.DD._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-r.x,y:s.y-r.y},dragStatus:"ready",pointerId:i})}startDrag(t,i=!0){Tt.DD._dragElements.has(this._id)||this._createDragElement(t);const n=Tt.DD._dragElements.get(this._id);n.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},i)}_setDragPosition(t,i){const n=this.getStage()._getPointerById(i.pointerId);if(!n)return;let r={x:n.x-i.offset.x,y:n.y-i.offset.y};const s=this.dragBoundFunc();if(s!==void 0){const a=s.call(this,r,t);a?r=a:B.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==r.x||this._lastPos.y!==r.y)&&(this.setAbsolutePosition(r),this._requestDraw()),this._lastPos=r}stopDrag(t){const i=Tt.DD._dragElements.get(this._id);i&&(i.dragStatus="stopped"),Tt.DD._endDragBefore(t),Tt.DD._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=Tt.DD._dragElements.get(this._id);return t?t.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){if(!(!(t.evt.button!==void 0)||Nt.Konva.dragButtons.indexOf(t.evt.button)>=0)||this.isDragging())return;let r=!1;Tt.DD._dragElements.forEach(s=>{this.isAncestorOf(s.node)&&(r=!0)}),r||this._createDragElement(t)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const i=Tt.DD._dragElements.get(this._id),n=i&&i.dragStatus==="dragging",r=i&&i.dragStatus==="ready";n?this.stopDrag():r&&Tt.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const i=this.getStage();if(!i)return!1;const n={x:-t.x,y:-t.y,width:i.width()+2*t.x,height:i.height()+2*t.y};return B.Util.haveIntersection(n,this.getClientRect())}static create(t,i){return B.Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,i)}static _createNode(t,i){let n=G.prototype.getClassName.call(t),r=t.children,s,a,o;i&&(t.attrs.container=i),Nt.Konva[n]||(B.Util.warn('Can not find a node with class name "'+n+'". Fallback to "Shape".'),n="Shape");const l=Nt.Konva[n];if(s=new l(t.attrs),r)for(a=r.length,o=0;o<a;o++)s.add(G._createNode(r[o]));return s}}Yt.Node=G;G.prototype.nodeType="Node";G.prototype._attrsAffectingSize=[];G.prototype.eventListeners={};G.prototype.on.call(G.prototype,ur,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(Xt),this._clearSelfAndDescendantCache(Ft)});G.prototype.on.call(G.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(vi)});G.prototype.on.call(G.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(mi)});G.prototype.on.call(G.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(He)});const N=xe.Factory.addGetterSetter;N(G,"zIndex");N(G,"absolutePosition");N(G,"position");N(G,"x",0,(0,et.getNumberValidator)());N(G,"y",0,(0,et.getNumberValidator)());N(G,"globalCompositeOperation","source-over",(0,et.getStringValidator)());N(G,"opacity",1,(0,et.getNumberValidator)());N(G,"name","",(0,et.getStringValidator)());N(G,"id","",(0,et.getStringValidator)());N(G,"rotation",0,(0,et.getNumberValidator)());xe.Factory.addComponentsGetterSetter(G,"scale",["x","y"]);N(G,"scaleX",1,(0,et.getNumberValidator)());N(G,"scaleY",1,(0,et.getNumberValidator)());xe.Factory.addComponentsGetterSetter(G,"skew",["x","y"]);N(G,"skewX",0,(0,et.getNumberValidator)());N(G,"skewY",0,(0,et.getNumberValidator)());xe.Factory.addComponentsGetterSetter(G,"offset",["x","y"]);N(G,"offsetX",0,(0,et.getNumberValidator)());N(G,"offsetY",0,(0,et.getNumberValidator)());N(G,"dragDistance",void 0,(0,et.getNumberValidator)());N(G,"width",0,(0,et.getNumberValidator)());N(G,"height",0,(0,et.getNumberValidator)());N(G,"listening",!0,(0,et.getBooleanValidator)());N(G,"preventDefault",!0,(0,et.getBooleanValidator)());N(G,"filters",void 0,function(e){return this._filterUpToDate=!1,e});N(G,"visible",!0,(0,et.getBooleanValidator)());N(G,"transformsEnabled","all",(0,et.getStringValidator)());N(G,"size");N(G,"dragBoundFunc");N(G,"draggable",!1,(0,et.getBooleanValidator)());xe.Factory.backCompat(G,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var re={};Object.defineProperty(re,"__esModule",{value:!0});re.Container=void 0;const _e=Rt,hi=Yt,Je=rt;class se extends hi.Node{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const i=this.children||[],n=[];return i.forEach(function(r){t(r)&&n.push(r)}),n}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(t.length===0)return this;if(t.length>1){for(let n=0;n<t.length;n++)this.add(t[n]);return this}const i=t[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){const i=this._generalFind(t,!0);return i.length>0?i[0]:void 0}_generalFind(t,i){const n=[];return this._descendants(r=>{const s=r._isMatch(t);return s&&n.push(r),!!(s&&i)}),n}_descendants(t){let i=!1;const n=this.getChildren();for(const r of n){if(i=t(r),i)return!0;if(r.hasChildren()&&(i=r._descendants(t),i))return!0}return!1}toObject(){const t=hi.Node.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(i=>{t.children.push(i.toObject())}),t}isAncestorOf(t){let i=t.getParent();for(;i;){if(i._id===this._id)return!0;i=i.getParent()}return!1}clone(t){const i=hi.Node.prototype.clone.call(this,t);return this.getChildren().forEach(function(n){i.add(n.clone())}),i}getAllIntersections(t){const i=[];return this.find("Shape").forEach(n=>{n.isVisible()&&n.intersects(t)&&i.push(n)}),i}_clearSelfAndDescendantCache(t){var i;super._clearSelfAndDescendantCache(t),!this.isCached()&&((i=this.children)===null||i===void 0||i.forEach(function(n){n._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;(t=this.children)===null||t===void 0||t.forEach(function(i,n){i.index=n}),this._requestDraw()}drawScene(t,i,n){const r=this.getLayer(),s=t||r&&r.getCanvas(),a=s&&s.getContext(),o=this._getCanvasCache(),l=o&&o.scene,d=s&&s.isCache;if(!this.isVisible()&&!d)return this;if(l){a.save();const c=this.getAbsoluteTransform(i).getMatrix();a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._drawCachedSceneCanvas(a),a.restore()}else this._drawChildren("drawScene",s,i,n);return this}drawHit(t,i){if(!this.shouldDrawHit(i))return this;const n=this.getLayer(),r=t||n&&n.hitCanvas,s=r&&r.getContext(),a=this._getCanvasCache();if(a&&a.hit){s.save();const l=this.getAbsoluteTransform(i).getMatrix();s.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",r,i);return this}_drawChildren(t,i,n,r){var s;const a=i&&i.getContext(),o=this.clipWidth(),l=this.clipHeight(),d=this.clipFunc(),c=typeof o=="number"&&typeof l=="number"||d,w=n===this;if(c){a.save();const g=this.getAbsoluteTransform(n);let f=g.getMatrix();a.transform(f[0],f[1],f[2],f[3],f[4],f[5]),a.beginPath();let v;if(d)v=d.call(this,a,this);else{const _=this.clipX(),C=this.clipY();a.rect(_||0,C||0,o,l)}a.clip.apply(a,v),f=g.copy().invert().getMatrix(),a.transform(f[0],f[1],f[2],f[3],f[4],f[5])}const T=!w&&this.globalCompositeOperation()!=="source-over"&&t==="drawScene";T&&(a.save(),a._applyGlobalCompositeOperation(this)),(s=this.children)===null||s===void 0||s.forEach(function(g){g[t](i,n,r)}),T&&a.restore(),c&&a.restore()}getClientRect(t={}){var i;const n=t.skipTransform,r=t.relativeTo;let s,a,o,l,d={x:1/0,y:1/0,width:0,height:0};const c=this;(i=this.children)===null||i===void 0||i.forEach(function(g){if(!g.visible())return;const f=g.getClientRect({relativeTo:c,skipShadow:t.skipShadow,skipStroke:t.skipStroke});f.width===0&&f.height===0||(s===void 0?(s=f.x,a=f.y,o=f.x+f.width,l=f.y+f.height):(s=Math.min(s,f.x),a=Math.min(a,f.y),o=Math.max(o,f.x+f.width),l=Math.max(l,f.y+f.height)))});const w=this.find("Shape");let T=!1;for(let g=0;g<w.length;g++)if(w[g]._isVisible(this)){T=!0;break}return T&&s!==void 0?d={x:s,y:a,width:o-s,height:l-a}:d={x:0,y:0,width:0,height:0},n?d:this._transformedRect(d,r)}}re.Container=se;_e.Factory.addComponentsGetterSetter(se,"clip",["x","y","width","height"]);_e.Factory.addGetterSetter(se,"clipX",void 0,(0,Je.getNumberValidator)());_e.Factory.addGetterSetter(se,"clipY",void 0,(0,Je.getNumberValidator)());_e.Factory.addGetterSetter(se,"clipWidth",void 0,(0,Je.getNumberValidator)());_e.Factory.addGetterSetter(se,"clipHeight",void 0,(0,Je.getNumberValidator)());_e.Factory.addGetterSetter(se,"clipFunc");var sn={},Zt={};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.getCapturedShape=gr;Zt.createEvent=Ti;Zt.hasPointerCapture=_r;Zt.setPointerCapture=pr;Zt.releaseCapture=on;const cr=$,Te=new Map,an=cr.Konva._global.PointerEvent!==void 0;function gr(e){return Te.get(e)}function Ti(e){return{evt:e,pointerId:e.pointerId}}function _r(e,t){return Te.get(e)===t}function pr(e,t){on(e),t.getStage()&&(Te.set(e,t),an&&t._fire("gotpointercapture",Ti(new PointerEvent("gotpointercapture"))))}function on(e,t){const i=Te.get(e);if(!i)return;const n=i.getStage();n&&n.content,Te.delete(e),an&&i._fire("lostpointercapture",Ti(new PointerEvent("lostpointercapture")))}(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stage=e.stages=void 0;const t=dt,i=Rt,n=re,r=$,s=At,a=je,o=$,l=Zt,d="Stage",c="string",w="px",T="mouseout",g="mouseleave",f="mouseover",v="mouseenter",_="mousemove",C="mousedown",P="mouseup",h="pointermove",u="pointerdown",y="pointerup",S="pointercancel",E="lostpointercapture",m="pointerout",x="pointerleave",b="pointerover",A="pointerenter",D="contextmenu",O="touchstart",F="touchend",I="touchmove",Y="touchcancel",z="wheel",at=5,Mt=[[v,"_pointerenter"],[C,"_pointerdown"],[_,"_pointermove"],[P,"_pointerup"],[g,"_pointerleave"],[O,"_pointerdown"],[I,"_pointermove"],[F,"_pointerup"],[Y,"_pointercancel"],[f,"_pointerover"],[z,"_wheel"],[D,"_contextmenu"],[u,"_pointerdown"],[h,"_pointermove"],[y,"_pointerup"],[S,"_pointercancel"],[E,"_lostpointercapture"]],H={mouse:{[m]:T,[x]:g,[b]:f,[A]:v,[h]:_,[u]:C,[y]:P,[S]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[m]:"touchout",[x]:"touchleave",[b]:"touchover",[A]:"touchenter",[h]:I,[u]:O,[y]:F,[S]:Y,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[m]:m,[x]:x,[b]:b,[A]:A,[h]:h,[u]:u,[y]:y,[S]:S,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},st=_t=>_t.indexOf("pointer")>=0?"pointer":_t.indexOf("touch")>=0?"touch":"mouse",yt=_t=>{const p=st(_t);if(p==="pointer")return r.Konva.pointerEventsEnabled&&H.pointer;if(p==="touch")return H.touch;if(p==="mouse")return H.mouse};function ot(_t={}){return(_t.clipFunc||_t.clipWidth||_t.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),_t}const ft="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";e.stages=[];class St extends n.Container{constructor(p){super(ot(p)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),e.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{ot(this.attrs)}),this._checkVisibility()}_validateAdd(p){const k=p.getType()==="Layer",L=p.getType()==="FastLayer";k||L||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const p=this.visible()?"":"none";this.content.style.display=p}setContainer(p){if(typeof p===c){if(p.charAt(0)==="."){const L=p.slice(1);p=document.getElementsByClassName(L)[0]}else{var k;p.charAt(0)!=="#"?k=p:k=p.slice(1),p=document.getElementById(k)}if(!p)throw"Can not find container in document with id "+k}return this._setAttr("container",p),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),p.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const p=this.children,k=p.length;for(let L=0;L<k;L++)p[L].clear();return this}clone(p){return p||(p={}),p.container=typeof document<"u"&&document.createElement("div"),n.Container.prototype.clone.call(this,p)}destroy(){super.destroy();const p=this.content;p&&t.Util._isInDocument(p)&&this.container().removeChild(p);const k=e.stages.indexOf(this);return k>-1&&e.stages.splice(k,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const p=this._pointerPositions[0]||this._changedPointerPositions[0];return p?{x:p.x,y:p.y}:(t.Util.warn(ft),null)}_getPointerById(p){return this._pointerPositions.find(k=>k.id===p)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(p){p=p||{},p.x=p.x||0,p.y=p.y||0,p.width=p.width||this.width(),p.height=p.height||this.height();const k=new s.SceneCanvas({width:p.width,height:p.height,pixelRatio:p.pixelRatio||1}),L=k.getContext()._context,j=this.children;return(p.x||p.y)&&L.translate(-1*p.x,-1*p.y),j.forEach(function(U){if(!U.isVisible())return;const tt=U._toKonvaCanvas(p);L.drawImage(tt._canvas,p.x,p.y,tt.getWidth()/tt.getPixelRatio(),tt.getHeight()/tt.getPixelRatio())}),k}getIntersection(p){if(!p)return null;const k=this.children,L=k.length,j=L-1;for(let U=j;U>=0;U--){const tt=k[U].getIntersection(p);if(tt)return tt}return null}_resizeDOM(){const p=this.width(),k=this.height();this.content&&(this.content.style.width=p+w,this.content.style.height=k+w),this.bufferCanvas.setSize(p,k),this.bufferHitCanvas.setSize(p,k),this.children.forEach(L=>{L.setSize({width:p,height:k}),L.draw()})}add(p,...k){if(arguments.length>1){for(let j=0;j<arguments.length;j++)this.add(arguments[j]);return this}super.add(p);const L=this.children.length;return L>at&&t.Util.warn("The stage has "+L+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),p.setSize({width:this.width(),height:this.height()}),p.draw(),r.Konva.isBrowser&&this.content.appendChild(p.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(p){return l.hasPointerCapture(p,this)}setPointerCapture(p){l.setPointerCapture(p,this)}releaseCapture(p){l.releaseCapture(p,this)}getLayers(){return this.children}_bindContentEvents(){r.Konva.isBrowser&&Mt.forEach(([p,k])=>{this.content.addEventListener(p,L=>{this[k](L)},{passive:!1})})}_pointerenter(p){this.setPointersPositions(p);const k=yt(p.type);k&&this._fire(k.pointerenter,{evt:p,target:this,currentTarget:this})}_pointerover(p){this.setPointersPositions(p);const k=yt(p.type);k&&this._fire(k.pointerover,{evt:p,target:this,currentTarget:this})}_getTargetShape(p){let k=this[p+"targetShape"];return k&&!k.getStage()&&(k=null),k}_pointerleave(p){const k=yt(p.type),L=st(p.type);if(!k)return;this.setPointersPositions(p);const j=this._getTargetShape(L),U=!(r.Konva.isDragging()||r.Konva.isTransforming())||r.Konva.hitOnDragEnabled;j&&U?(j._fireAndBubble(k.pointerout,{evt:p}),j._fireAndBubble(k.pointerleave,{evt:p}),this._fire(k.pointerleave,{evt:p,target:this,currentTarget:this}),this[L+"targetShape"]=null):U&&(this._fire(k.pointerleave,{evt:p,target:this,currentTarget:this}),this._fire(k.pointerout,{evt:p,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(p){const k=yt(p.type),L=st(p.type);if(!k)return;this.setPointersPositions(p);let j=!1;this._changedPointerPositions.forEach(U=>{const tt=this.getIntersection(U);if(a.DD.justDragged=!1,r.Konva["_"+L+"ListenClick"]=!0,!tt||!tt.isListening()){this[L+"ClickStartShape"]=void 0;return}r.Konva.capturePointerEventsEnabled&&tt.setPointerCapture(U.id),this[L+"ClickStartShape"]=tt,tt._fireAndBubble(k.pointerdown,{evt:p,pointerId:U.id}),j=!0;const Ct=p.type.indexOf("touch")>=0;tt.preventDefault()&&p.cancelable&&Ct&&p.preventDefault()}),j||this._fire(k.pointerdown,{evt:p,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(p){const k=yt(p.type),L=st(p.type);if(!k||(r.Konva.isDragging()&&a.DD.node.preventDefault()&&p.cancelable&&p.preventDefault(),this.setPointersPositions(p),!(!(r.Konva.isDragging()||r.Konva.isTransforming())||r.Konva.hitOnDragEnabled)))return;const U={};let tt=!1;const Ct=this._getTargetShape(L);this._changedPointerPositions.forEach(Ut=>{const Z=l.getCapturedShape(Ut.id)||this.getIntersection(Ut),ue=Ut.id,Lt={evt:p,pointerId:ue},fe=Ct!==Z;if(fe&&Ct&&(Ct._fireAndBubble(k.pointerout,{...Lt},Z),Ct._fireAndBubble(k.pointerleave,{...Lt},Z)),Z){if(U[Z._id])return;U[Z._id]=!0}Z&&Z.isListening()?(tt=!0,fe&&(Z._fireAndBubble(k.pointerover,{...Lt},Ct),Z._fireAndBubble(k.pointerenter,{...Lt},Ct),this[L+"targetShape"]=Z),Z._fireAndBubble(k.pointermove,{...Lt})):Ct&&(this._fire(k.pointerover,{evt:p,target:this,currentTarget:this,pointerId:ue}),this[L+"targetShape"]=null)}),tt||this._fire(k.pointermove,{evt:p,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(p){const k=yt(p.type),L=st(p.type);if(!k)return;this.setPointersPositions(p);const j=this[L+"ClickStartShape"],U=this[L+"ClickEndShape"],tt={};let Ct=!1;this._changedPointerPositions.forEach(Ut=>{const Z=l.getCapturedShape(Ut.id)||this.getIntersection(Ut);if(Z){if(Z.releaseCapture(Ut.id),tt[Z._id])return;tt[Z._id]=!0}const ue=Ut.id,Lt={evt:p,pointerId:ue};let fe=!1;r.Konva["_"+L+"InDblClickWindow"]?(fe=!0,clearTimeout(this[L+"DblTimeout"])):a.DD.justDragged||(r.Konva["_"+L+"InDblClickWindow"]=!0,clearTimeout(this[L+"DblTimeout"])),this[L+"DblTimeout"]=setTimeout(function(){r.Konva["_"+L+"InDblClickWindow"]=!1},r.Konva.dblClickWindow),Z&&Z.isListening()?(Ct=!0,this[L+"ClickEndShape"]=Z,Z._fireAndBubble(k.pointerup,{...Lt}),r.Konva["_"+L+"ListenClick"]&&j&&j===Z&&(Z._fireAndBubble(k.pointerclick,{...Lt}),fe&&U&&U===Z&&Z._fireAndBubble(k.pointerdblclick,{...Lt}))):(this[L+"ClickEndShape"]=null,r.Konva["_"+L+"ListenClick"]&&this._fire(k.pointerclick,{evt:p,target:this,currentTarget:this,pointerId:ue}),fe&&this._fire(k.pointerdblclick,{evt:p,target:this,currentTarget:this,pointerId:ue}))}),Ct||this._fire(k.pointerup,{evt:p,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r.Konva["_"+L+"ListenClick"]=!1,p.cancelable&&L!=="touch"&&L!=="pointer"&&p.preventDefault()}_contextmenu(p){this.setPointersPositions(p);const k=this.getIntersection(this.getPointerPosition());k&&k.isListening()?k._fireAndBubble(D,{evt:p}):this._fire(D,{evt:p,target:this,currentTarget:this})}_wheel(p){this.setPointersPositions(p);const k=this.getIntersection(this.getPointerPosition());k&&k.isListening()?k._fireAndBubble(z,{evt:p}):this._fire(z,{evt:p,target:this,currentTarget:this})}_pointercancel(p){this.setPointersPositions(p);const k=l.getCapturedShape(p.pointerId)||this.getIntersection(this.getPointerPosition());k&&k._fireAndBubble(y,l.createEvent(p)),l.releaseCapture(p.pointerId)}_lostpointercapture(p){l.releaseCapture(p.pointerId)}setPointersPositions(p){const k=this._getContentPosition();let L=null,j=null;p=p||window.event,p.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(p.touches,U=>{this._pointerPositions.push({id:U.identifier,x:(U.clientX-k.left)/k.scaleX,y:(U.clientY-k.top)/k.scaleY})}),Array.prototype.forEach.call(p.changedTouches||p.touches,U=>{this._changedPointerPositions.push({id:U.identifier,x:(U.clientX-k.left)/k.scaleX,y:(U.clientY-k.top)/k.scaleY})})):(L=(p.clientX-k.left)/k.scaleX,j=(p.clientY-k.top)/k.scaleY,this.pointerPos={x:L,y:j},this._pointerPositions=[{x:L,y:j,id:t.Util._getFirstPointerId(p)}],this._changedPointerPositions=[{x:L,y:j,id:t.Util._getFirstPointerId(p)}])}_setPointerPosition(p){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(p)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const p=this.content.getBoundingClientRect();return{top:p.top,left:p.left,scaleX:p.width/this.content.clientWidth||1,scaleY:p.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new s.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new s.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!r.Konva.isBrowser)return;const p=this.container();if(!p)throw"Stage has no container. A container is required.";p.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),p.appendChild(this.content),this._resizeDOM()}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(p){p.batchDraw()}),this}}e.Stage=St,St.prototype.nodeType=d,(0,o._registerNode)(St),i.Factory.addGetterSetter(St,"container"),r.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{e.stages.forEach(_t=>{_t.batchDraw()})})})(sn);var Ae={},pe={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Shape=e.shapes=void 0;const t=$,i=dt,n=Rt,r=Yt,s=rt,a=$,o=Zt,l="hasShadow",d="shadowRGBA",c="patternImage",w="linearGradient",T="radialGradient";let g;function f(){return g||(g=i.Util.createCanvasElement().getContext("2d"),g)}e.shapes={};function v(x){const b=this.attrs.fillRule;b?x.fill(b):x.fill()}function _(x){x.stroke()}function C(x){const b=this.attrs.fillRule;b?x.fill(b):x.fill()}function P(x){x.stroke()}function h(){this._clearCache(l)}function u(){this._clearCache(d)}function y(){this._clearCache(c)}function S(){this._clearCache(w)}function E(){this._clearCache(T)}class m extends r.Node{constructor(b){super(b);let A;for(;A=i.Util.getRandomColor(),!(A&&!(A in e.shapes)););this.colorKey=A,e.shapes[A]=this}getContext(){return i.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return i.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(c,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const A=f().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(A&&A.setTransform){const D=new i.Transform;D.translate(this.fillPatternX(),this.fillPatternY()),D.rotate(t.Konva.getAngle(this.fillPatternRotation())),D.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),D.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const O=D.getMatrix(),F=typeof DOMMatrix>"u"?{a:O[0],b:O[1],c:O[2],d:O[3],e:O[4],f:O[5]}:new DOMMatrix(O);A.setTransform(F)}return A}}_getLinearGradient(){return this._getCache(w,this.__getLinearGradient)}__getLinearGradient(){const b=this.fillLinearGradientColorStops();if(b){const A=f(),D=this.fillLinearGradientStartPoint(),O=this.fillLinearGradientEndPoint(),F=A.createLinearGradient(D.x,D.y,O.x,O.y);for(let I=0;I<b.length;I+=2)F.addColorStop(b[I],b[I+1]);return F}}_getRadialGradient(){return this._getCache(T,this.__getRadialGradient)}__getRadialGradient(){const b=this.fillRadialGradientColorStops();if(b){const A=f(),D=this.fillRadialGradientStartPoint(),O=this.fillRadialGradientEndPoint(),F=A.createRadialGradient(D.x,D.y,this.fillRadialGradientStartRadius(),O.x,O.y,this.fillRadialGradientEndRadius());for(let I=0;I<b.length;I+=2)F.addColorStop(b[I],b[I+1]);return F}}getShadowRGBA(){return this._getCache(d,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const b=i.Util.colorToRGBA(this.shadowColor());if(b)return"rgba("+b.r+","+b.g+","+b.b+","+b.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const b=this.hitStrokeWidth();return b==="auto"?this.hasStroke():this.strokeEnabled()&&!!b}intersects(b){const A=this.getStage();if(!A)return!1;const D=A.bufferHitCanvas;return D.getContext().clear(),this.drawHit(D,void 0,!0),D.context.getImageData(Math.round(b.x),Math.round(b.y),1,1).data[3]>0}destroy(){return r.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(b){var A;if(!((A=this.attrs.perfectDrawEnabled)!==null&&A!==void 0?A:!0))return!1;const O=b||this.hasFill(),F=this.hasStroke(),I=this.getAbsoluteOpacity()!==1;if(O&&F&&I)return!0;const Y=this.hasShadow(),z=this.shadowForStrokeEnabled();return!!(O&&F&&Y&&z)}setStrokeHitEnabled(b){i.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),b?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const b=this.size();return{x:this._centroid?-b.width/2:0,y:this._centroid?-b.height/2:0,width:b.width,height:b.height}}getClientRect(b={}){let A=!1,D=this.getParent();for(;D;){if(D.isCached()){A=!0;break}D=D.getParent()}const O=b.skipTransform,F=b.relativeTo||A&&this.getStage()||void 0,I=this.getSelfRect(),z=!b.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,at=I.width+z,Mt=I.height+z,H=!b.skipShadow&&this.hasShadow(),st=H?this.shadowOffsetX():0,yt=H?this.shadowOffsetY():0,ot=at+Math.abs(st),ft=Mt+Math.abs(yt),St=H&&this.shadowBlur()||0,_t=ot+St*2,p=ft+St*2,k={width:_t,height:p,x:-(z/2+St)+Math.min(st,0)+I.x,y:-(z/2+St)+Math.min(yt,0)+I.y};return O?k:this._transformedRect(k,F)}drawScene(b,A,D){const O=this.getLayer();let F=b||O.getCanvas(),I=F.getContext(),Y=this._getCanvasCache(),z=this.getSceneFunc(),at=this.hasShadow(),Mt,H;const st=F.isCache,yt=A===this;if(!this.isVisible()&&!yt)return this;if(Y){I.save();const ft=this.getAbsoluteTransform(A).getMatrix();return I.transform(ft[0],ft[1],ft[2],ft[3],ft[4],ft[5]),this._drawCachedSceneCanvas(I),I.restore(),this}if(!z)return this;if(I.save(),this._useBufferCanvas()&&!st){Mt=this.getStage();const ft=D||Mt.bufferCanvas;H=ft.getContext(),H.clear(),H.save(),H._applyLineJoin(this);var ot=this.getAbsoluteTransform(A).getMatrix();H.transform(ot[0],ot[1],ot[2],ot[3],ot[4],ot[5]),z.call(this,H,this),H.restore();const St=ft.pixelRatio;at&&I._applyShadow(this),I._applyOpacity(this),I._applyGlobalCompositeOperation(this),I.drawImage(ft._canvas,0,0,ft.width/St,ft.height/St)}else{if(I._applyLineJoin(this),!yt){var ot=this.getAbsoluteTransform(A).getMatrix();I.transform(ot[0],ot[1],ot[2],ot[3],ot[4],ot[5]),I._applyOpacity(this),I._applyGlobalCompositeOperation(this)}at&&I._applyShadow(this),z.call(this,I,this)}return I.restore(),this}drawHit(b,A,D=!1){if(!this.shouldDrawHit(A,D))return this;const O=this.getLayer(),F=b||O.hitCanvas,I=F&&F.getContext(),Y=this.hitFunc()||this.sceneFunc(),z=this._getCanvasCache(),at=z&&z.hit;if(this.colorKey||i.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),at){I.save();const H=this.getAbsoluteTransform(A).getMatrix();return I.transform(H[0],H[1],H[2],H[3],H[4],H[5]),this._drawCachedHitCanvas(I),I.restore(),this}if(!Y)return this;if(I.save(),I._applyLineJoin(this),!(this===A)){const H=this.getAbsoluteTransform(A).getMatrix();I.transform(H[0],H[1],H[2],H[3],H[4],H[5])}return Y.call(this,I,this),I.restore(),this}drawHitFromCache(b=0){const A=this._getCanvasCache(),D=this._getCachedSceneCanvas(),O=A.hit,F=O.getContext(),I=O.getWidth(),Y=O.getHeight();F.clear(),F.drawImage(D._canvas,0,0,I,Y);try{const z=F.getImageData(0,0,I,Y),at=z.data,Mt=at.length,H=i.Util._hexToRgb(this.colorKey);for(let st=0;st<Mt;st+=4)at[st+3]>b?(at[st]=H.r,at[st+1]=H.g,at[st+2]=H.b,at[st+3]=255):at[st+3]=0;F.putImageData(z,0,0)}catch(z){i.Util.error("Unable to draw hit graph from cached scene canvas. "+z.message)}return this}hasPointerCapture(b){return o.hasPointerCapture(b,this)}setPointerCapture(b){o.setPointerCapture(b,this)}releaseCapture(b){o.releaseCapture(b,this)}}e.Shape=m,m.prototype._fillFunc=v,m.prototype._strokeFunc=_,m.prototype._fillFuncHit=C,m.prototype._strokeFuncHit=P,m.prototype._centroid=!1,m.prototype.nodeType="Shape",(0,a._registerNode)(m),m.prototype.eventListeners={},m.prototype.on.call(m.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",h),m.prototype.on.call(m.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",u),m.prototype.on.call(m.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",y),m.prototype.on.call(m.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",S),m.prototype.on.call(m.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",E),n.Factory.addGetterSetter(m,"stroke",void 0,(0,s.getStringOrGradientValidator)()),n.Factory.addGetterSetter(m,"strokeWidth",2,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"fillAfterStrokeEnabled",!1),n.Factory.addGetterSetter(m,"hitStrokeWidth","auto",(0,s.getNumberOrAutoValidator)()),n.Factory.addGetterSetter(m,"strokeHitEnabled",!0,(0,s.getBooleanValidator)()),n.Factory.addGetterSetter(m,"perfectDrawEnabled",!0,(0,s.getBooleanValidator)()),n.Factory.addGetterSetter(m,"shadowForStrokeEnabled",!0,(0,s.getBooleanValidator)()),n.Factory.addGetterSetter(m,"lineJoin"),n.Factory.addGetterSetter(m,"lineCap"),n.Factory.addGetterSetter(m,"sceneFunc"),n.Factory.addGetterSetter(m,"hitFunc"),n.Factory.addGetterSetter(m,"dash"),n.Factory.addGetterSetter(m,"dashOffset",0,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"shadowColor",void 0,(0,s.getStringValidator)()),n.Factory.addGetterSetter(m,"shadowBlur",0,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"shadowOpacity",1,(0,s.getNumberValidator)()),n.Factory.addComponentsGetterSetter(m,"shadowOffset",["x","y"]),n.Factory.addGetterSetter(m,"shadowOffsetX",0,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"shadowOffsetY",0,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"fillPatternImage"),n.Factory.addGetterSetter(m,"fill",void 0,(0,s.getStringOrGradientValidator)()),n.Factory.addGetterSetter(m,"fillPatternX",0,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"fillPatternY",0,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(m,"strokeLinearGradientColorStops"),n.Factory.addGetterSetter(m,"fillRadialGradientStartRadius",0),n.Factory.addGetterSetter(m,"fillRadialGradientEndRadius",0),n.Factory.addGetterSetter(m,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(m,"fillPatternRepeat","repeat"),n.Factory.addGetterSetter(m,"fillEnabled",!0),n.Factory.addGetterSetter(m,"strokeEnabled",!0),n.Factory.addGetterSetter(m,"shadowEnabled",!0),n.Factory.addGetterSetter(m,"dashEnabled",!0),n.Factory.addGetterSetter(m,"strokeScaleEnabled",!0),n.Factory.addGetterSetter(m,"fillPriority","color"),n.Factory.addComponentsGetterSetter(m,"fillPatternOffset",["x","y"]),n.Factory.addGetterSetter(m,"fillPatternOffsetX",0,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"fillPatternOffsetY",0,(0,s.getNumberValidator)()),n.Factory.addComponentsGetterSetter(m,"fillPatternScale",["x","y"]),n.Factory.addGetterSetter(m,"fillPatternScaleX",1,(0,s.getNumberValidator)()),n.Factory.addGetterSetter(m,"fillPatternScaleY",1,(0,s.getNumberValidator)()),n.Factory.addComponentsGetterSetter(m,"fillLinearGradientStartPoint",["x","y"]),n.Factory.addComponentsGetterSetter(m,"strokeLinearGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(m,"fillLinearGradientStartPointX",0),n.Factory.addGetterSetter(m,"strokeLinearGradientStartPointX",0),n.Factory.addGetterSetter(m,"fillLinearGradientStartPointY",0),n.Factory.addGetterSetter(m,"strokeLinearGradientStartPointY",0),n.Factory.addComponentsGetterSetter(m,"fillLinearGradientEndPoint",["x","y"]),n.Factory.addComponentsGetterSetter(m,"strokeLinearGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(m,"fillLinearGradientEndPointX",0),n.Factory.addGetterSetter(m,"strokeLinearGradientEndPointX",0),n.Factory.addGetterSetter(m,"fillLinearGradientEndPointY",0),n.Factory.addGetterSetter(m,"strokeLinearGradientEndPointY",0),n.Factory.addComponentsGetterSetter(m,"fillRadialGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(m,"fillRadialGradientStartPointX",0),n.Factory.addGetterSetter(m,"fillRadialGradientStartPointY",0),n.Factory.addComponentsGetterSetter(m,"fillRadialGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(m,"fillRadialGradientEndPointX",0),n.Factory.addGetterSetter(m,"fillRadialGradientEndPointY",0),n.Factory.addGetterSetter(m,"fillPatternRotation",0),n.Factory.addGetterSetter(m,"fillRule",void 0,(0,s.getStringValidator)()),n.Factory.backCompat(m,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(pe);Object.defineProperty(Ae,"__esModule",{value:!0});Ae.Layer=void 0;const Ot=dt,li=re,ce=Yt,ki=Rt,Hi=At,mr=rt,vr=pe,yr=$,wr="#",br="beforeDraw",Sr="draw",hn=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Cr=hn.length;class me extends li.Container{constructor(t){super(t),this.canvas=new Hi.SceneCanvas,this.hitCanvas=new Hi.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);const i=this.getStage();return i&&i.content&&(i.content.removeChild(this.getNativeCanvasElement()),t<i.children.length-1?i.content.insertBefore(this.getNativeCanvasElement(),i.children[t+1].getCanvas()._canvas):i.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){ce.Node.prototype.moveToTop.call(this);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!ce.Node.prototype.moveUp.call(this))return!1;const i=this.getStage();return!i||!i.content?!1:(i.content.removeChild(this.getNativeCanvasElement()),this.index<i.children.length-1?i.content.insertBefore(this.getNativeCanvasElement(),i.children[this.index+1].getCanvas()._canvas):i.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(ce.Node.prototype.moveDown.call(this)){const t=this.getStage();if(t){const i=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),i[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(ce.Node.prototype.moveToBottom.call(this)){const t=this.getStage();if(t){const i=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),i[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const t=this.getNativeCanvasElement();return ce.Node.prototype.remove.call(this),t&&t.parentNode&&Ot.Util._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:i}){return this.canvas.setSize(t,i),this.hitCanvas.setSize(t,i),this._setSmoothEnabled(),this}_validateAdd(t){const i=t.getType();i!=="Group"&&i!=="Shape"&&Ot.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),ce.Node.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){Ot.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){Ot.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,Ot.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;let i=1,n=!1;for(;;){for(let r=0;r<Cr;r++){const s=hn[r],a=this._getIntersection({x:t.x+s.x*i,y:t.y+s.y*i}),o=a.shape;if(o)return o;if(n=!!a.antialiased,!a.antialiased)break}if(n)i+=1;else return null}}_getIntersection(t){const i=this.hitCanvas.pixelRatio,n=this.hitCanvas.context.getImageData(Math.round(t.x*i),Math.round(t.y*i),1,1).data,r=n[3];if(r===255){const s=Ot.Util._rgbToHex(n[0],n[1],n[2]),a=vr.shapes[wr+s];return a?{shape:a}:{antialiased:!0}}else if(r>0)return{antialiased:!0};return{}}drawScene(t,i){const n=this.getLayer(),r=t||n&&n.getCanvas();return this._fire(br,{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),li.Container.prototype.drawScene.call(this,r,i),this._fire(Sr,{node:this}),this}drawHit(t,i){const n=this.getLayer(),r=t||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),li.Container.prototype.drawHit.call(this,r,i),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){Ot.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return Ot.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}destroy(){return Ot.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Ae.Layer=me;me.prototype.nodeType="Layer";(0,yr._registerNode)(me);ki.Factory.addGetterSetter(me,"imageSmoothingEnabled",!0);ki.Factory.addGetterSetter(me,"clearBeforeDraw",!0);ki.Factory.addGetterSetter(me,"hitGraphEnabled",!0,(0,mr.getBooleanValidator)());var qe={};Object.defineProperty(qe,"__esModule",{value:!0});qe.FastLayer=void 0;const Tr=dt,kr=Ae,xr=$;class xi extends kr.Layer{constructor(t){super(t),this.listening(!1),Tr.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}qe.FastLayer=xi;xi.prototype.nodeType="FastLayer";(0,xr._registerNode)(xi);var $e={};Object.defineProperty($e,"__esModule",{value:!0});$e.Group=void 0;const Ar=dt,Pr=re,Er=$;class Ai extends Pr.Container{_validateAdd(t){const i=t.getType();i!=="Group"&&i!=="Shape"&&Ar.Util.throw("You may only add groups and shapes to groups.")}}$e.Group=Ai;Ai.prototype.nodeType="Group";(0,Er._registerNode)(Ai);var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});var ln=Pe.Animation=void 0;const di=$,Vi=dt,ui=function(){return di.glob.performance&&di.glob.performance.now?function(){return di.glob.performance.now()}:function(){return new Date().getTime()}}();class Dt{constructor(t,i){this.id=Dt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:ui(),frameRate:0},this.func=t,this.setLayers(i)}setLayers(t){let i=[];return t&&(i=Array.isArray(t)?t:[t]),this.layers=i,this}getLayers(){return this.layers}addLayer(t){const i=this.layers,n=i.length;for(let r=0;r<n;r++)if(i[r]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){const i=Dt.animations,n=i.length;for(let r=0;r<n;r++)if(i[r].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=ui(),Dt._addAnimation(this),this}stop(){return Dt._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){const i=t.id,n=this.animations,r=n.length;for(let s=0;s<r;s++)if(n[s].id===i){this.animations.splice(s,1);break}}static _runFrames(){const t={},i=this.animations;for(let n=0;n<i.length;n++){const r=i[n],s=r.layers,a=r.func;r._updateFrameObject(ui());const o=s.length;let l;if(a?l=a.call(r,r.frame)!==!1:l=!0,!!l)for(let d=0;d<o;d++){const c=s[d];c._id!==void 0&&(t[c._id]=c)}}for(const n in t)t.hasOwnProperty(n)&&t[n].batchDraw()}static _animationLoop(){const t=Dt;t.animations.length?(t._runFrames(),Vi.Util.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,Vi.Util.requestAnimFrame(this._animationLoop))}}ln=Pe.Animation=Dt;Dt.animations=[];Dt.animIdCounter=0;Dt.animRunning=!1;var dn={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Easings=e.Tween=void 0;const t=dt,i=Pe,n=Yt,r=$,s={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=1,o=2,l=3,d=["fill","stroke","shadowColor"];let c=0;class w{constructor(f,v,_,C,P,h,u){this.prop=f,this.propFunc=v,this.begin=C,this._pos=C,this.duration=h,this._change=0,this.prevPos=0,this.yoyo=u,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=_,this._change=P-this.begin,this.pause()}fire(f){const v=this[f];v&&v()}setTime(f){f>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():f<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=f,this.update())}getTime(){return this._time}setPosition(f){this.prevPos=this._pos,this.propFunc(f),this._pos=f}getPosition(f){return f===void 0&&(f=this._time),this.func(f,this.begin,this._change,this.duration)}play(){this.state=o,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(f){this.pause(),this._time=f,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const f=this.getTimer()-this._startTime;this.state===o?this.setTime(f):this.state===l&&this.setTime(this.duration-f)}pause(){this.state=a,this.fire("onPause")}getTimer(){return new Date().getTime()}}class T{constructor(f){const v=this,_=f.node,C=_._id,P=f.easing||e.Easings.Linear,h=!!f.yoyo;let u,y;typeof f.duration>"u"?u=.3:f.duration===0?u=.001:u=f.duration,this.node=_,this._id=c++;const S=_.getLayer()||(_ instanceof r.Konva.Stage?_.getLayers():null);S||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new i.Animation(function(){v.tween.onEnterFrame()},S),this.tween=new w(y,function(E){v._tweenFunc(E)},P,0,1,u*1e3,h),this._addListeners(),T.attrs[C]||(T.attrs[C]={}),T.attrs[C][this._id]||(T.attrs[C][this._id]={}),T.tweens[C]||(T.tweens[C]={});for(y in f)s[y]===void 0&&this._addAttr(y,f[y]);this.reset(),this.onFinish=f.onFinish,this.onReset=f.onReset,this.onUpdate=f.onUpdate}_addAttr(f,v){const _=this.node,C=_._id;let P,h,u,y,S;const E=T.tweens[C][f];E&&delete T.attrs[C][E][f];let m=_.getAttr(f);if(t.Util._isArray(v))if(P=[],h=Math.max(v.length,m.length),f==="points"&&v.length!==m.length&&(v.length>m.length?(y=m,m=t.Util._prepareArrayForTween(m,v,_.closed())):(u=v,v=t.Util._prepareArrayForTween(v,m,_.closed()))),f.indexOf("fill")===0)for(let x=0;x<h;x++)if(x%2===0)P.push(v[x]-m[x]);else{const b=t.Util.colorToRGBA(m[x]);S=t.Util.colorToRGBA(v[x]),m[x]=b,P.push({r:S.r-b.r,g:S.g-b.g,b:S.b-b.b,a:S.a-b.a})}else for(let x=0;x<h;x++)P.push(v[x]-m[x]);else d.indexOf(f)!==-1?(m=t.Util.colorToRGBA(m),S=t.Util.colorToRGBA(v),P={r:S.r-m.r,g:S.g-m.g,b:S.b-m.b,a:S.a-m.a}):P=v-m;T.attrs[C][this._id][f]={start:m,diff:P,end:v,trueEnd:u,trueStart:y},T.tweens[C][f]=this._id}_tweenFunc(f){const v=this.node,_=T.attrs[v._id][this._id];let C,P,h,u,y,S,E,m;for(C in _){if(P=_[C],h=P.start,u=P.diff,m=P.end,t.Util._isArray(h))if(y=[],E=Math.max(h.length,m.length),C.indexOf("fill")===0)for(S=0;S<E;S++)S%2===0?y.push((h[S]||0)+u[S]*f):y.push("rgba("+Math.round(h[S].r+u[S].r*f)+","+Math.round(h[S].g+u[S].g*f)+","+Math.round(h[S].b+u[S].b*f)+","+(h[S].a+u[S].a*f)+")");else for(S=0;S<E;S++)y.push((h[S]||0)+u[S]*f);else d.indexOf(C)!==-1?y="rgba("+Math.round(h.r+u.r*f)+","+Math.round(h.g+u.g*f)+","+Math.round(h.b+u.b*f)+","+(h.a+u.a*f)+")":y=h+u*f;v.setAttr(C,y)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const f=this.node,v=T.attrs[f._id][this._id];v.points&&v.points.trueEnd&&f.setAttr("points",v.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const f=this.node,v=T.attrs[f._id][this._id];v.points&&v.points.trueStart&&f.points(v.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(f){return this.tween.seek(f*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const f=this.node._id,v=this._id,_=T.tweens[f];this.pause();for(const C in _)delete T.tweens[f][C];delete T.attrs[f][v]}}e.Tween=T,T.attrs={},T.tweens={},n.Node.prototype.to=function(g){const f=g.onFinish;g.node=this,g.onFinish=function(){this.destroy(),f&&f()},new T(g).play()},e.Easings={BackEaseIn(g,f,v,_){return v*(g/=_)*g*((1.70158+1)*g-1.70158)+f},BackEaseOut(g,f,v,_){return v*((g=g/_-1)*g*((1.70158+1)*g+1.70158)+1)+f},BackEaseInOut(g,f,v,_){let C=1.70158;return(g/=_/2)<1?v/2*(g*g*(((C*=1.525)+1)*g-C))+f:v/2*((g-=2)*g*(((C*=1.525)+1)*g+C)+2)+f},ElasticEaseIn(g,f,v,_,C,P){let h=0;return g===0?f:(g/=_)===1?f+v:(P||(P=_*.3),!C||C<Math.abs(v)?(C=v,h=P/4):h=P/(2*Math.PI)*Math.asin(v/C),-(C*Math.pow(2,10*(g-=1))*Math.sin((g*_-h)*(2*Math.PI)/P))+f)},ElasticEaseOut(g,f,v,_,C,P){let h=0;return g===0?f:(g/=_)===1?f+v:(P||(P=_*.3),!C||C<Math.abs(v)?(C=v,h=P/4):h=P/(2*Math.PI)*Math.asin(v/C),C*Math.pow(2,-10*g)*Math.sin((g*_-h)*(2*Math.PI)/P)+v+f)},ElasticEaseInOut(g,f,v,_,C,P){let h=0;return g===0?f:(g/=_/2)===2?f+v:(P||(P=_*(.3*1.5)),!C||C<Math.abs(v)?(C=v,h=P/4):h=P/(2*Math.PI)*Math.asin(v/C),g<1?-.5*(C*Math.pow(2,10*(g-=1))*Math.sin((g*_-h)*(2*Math.PI)/P))+f:C*Math.pow(2,-10*(g-=1))*Math.sin((g*_-h)*(2*Math.PI)/P)*.5+v+f)},BounceEaseOut(g,f,v,_){return(g/=_)<1/2.75?v*(7.5625*g*g)+f:g<2/2.75?v*(7.5625*(g-=1.5/2.75)*g+.75)+f:g<2.5/2.75?v*(7.5625*(g-=2.25/2.75)*g+.9375)+f:v*(7.5625*(g-=2.625/2.75)*g+.984375)+f},BounceEaseIn(g,f,v,_){return v-e.Easings.BounceEaseOut(_-g,0,v,_)+f},BounceEaseInOut(g,f,v,_){return g<_/2?e.Easings.BounceEaseIn(g*2,0,v,_)*.5+f:e.Easings.BounceEaseOut(g*2-_,0,v,_)*.5+v*.5+f},EaseIn(g,f,v,_){return v*(g/=_)*g+f},EaseOut(g,f,v,_){return-v*(g/=_)*(g-2)+f},EaseInOut(g,f,v,_){return(g/=_/2)<1?v/2*g*g+f:-v/2*(--g*(g-2)-1)+f},StrongEaseIn(g,f,v,_){return v*(g/=_)*g*g*g*g+f},StrongEaseOut(g,f,v,_){return v*((g=g/_-1)*g*g*g*g+1)+f},StrongEaseInOut(g,f,v,_){return(g/=_/2)<1?v/2*g*g*g*g*g+f:v/2*((g-=2)*g*g*g*g+2)+f},Linear(g,f,v,_){return v*g/_+f}}})(dn);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;const t=$,i=dt,n=Yt,r=re,s=sn,a=Ae,o=qe,l=$e,d=je,c=pe,w=Pe,T=dn,g=Gt,f=At;e.Konva=i.Util._assign(t.Konva,{Util:i.Util,Transform:i.Transform,Node:n.Node,Container:r.Container,Stage:s.Stage,stages:s.stages,Layer:a.Layer,FastLayer:o.FastLayer,Group:l.Group,DD:d.DD,Shape:c.Shape,shapes:c.shapes,Animation:w.Animation,Tween:T.Tween,Easings:T.Easings,Context:g.Context,Canvas:f.Canvas}),e.default=e.Konva})(pi);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;var i=pi;Object.defineProperty(t,"Konva",{enumerable:!0,get:function(){return i.Konva}});const n=pi;e.exports=n.Konva})(_i,_i.exports);var Dr=_i.exports;const nt=Ln(Dr);var Pi={};Object.defineProperty(Pi,"__esModule",{value:!0});var Qe=Pi.Line=void 0;const ti=Rt,Ir=$,Mr=pe,un=rt;function yi(e,t,i,n,r,s,a){const o=Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2)),l=Math.sqrt(Math.pow(r-i,2)+Math.pow(s-n,2)),d=a*o/(o+l),c=a*l/(o+l),w=i-d*(r-e),T=n-d*(s-t),g=i+c*(r-e),f=n+c*(s-t);return[w,T,g,f]}function Ui(e,t){const i=e.length,n=[];for(let r=2;r<i-2;r+=2){const s=yi(e[r-2],e[r-1],e[r],e[r+1],e[r+2],e[r+3],t);isNaN(s[0])||(n.push(s[0]),n.push(s[1]),n.push(e[r]),n.push(e[r+1]),n.push(s[2]),n.push(s[3]))}return n}class Kt extends Mr.Shape{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){let i=this.points(),n=i.length,r=this.tension(),s=this.closed(),a=this.bezier(),o,l,d;if(n){if(t.beginPath(),t.moveTo(i[0],i[1]),r!==0&&n>4){for(o=this.getTensionPoints(),l=o.length,d=s?0:4,s||t.quadraticCurveTo(o[0],o[1],o[2],o[3]);d<l-2;)t.bezierCurveTo(o[d++],o[d++],o[d++],o[d++],o[d++],o[d++]);s||t.quadraticCurveTo(o[l-2],o[l-1],i[n-2],i[n-1])}else if(a)for(d=2;d<n;)t.bezierCurveTo(i[d++],i[d++],i[d++],i[d++],i[d++],i[d++]);else for(d=2;d<n;d+=2)t.lineTo(i[d],i[d+1]);s?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():Ui(this.points(),this.tension())}_getTensionPointsClosed(){const t=this.points(),i=t.length,n=this.tension(),r=yi(t[i-2],t[i-1],t[0],t[1],t[2],t[3],n),s=yi(t[i-4],t[i-3],t[i-2],t[i-1],t[0],t[1],n),a=Ui(t,n);return[r[2],r[3]].concat(a).concat([s[0],s[1],t[i-2],t[i-1],s[2],s[3],r[0],r[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};this.tension()!==0?t=[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:t=this.points();let i=t[0],n=t[0],r=t[1],s=t[1],a,o;for(let l=0;l<t.length/2;l++)a=t[l*2],o=t[l*2+1],i=Math.min(i,a),n=Math.max(n,a),r=Math.min(r,o),s=Math.max(s,o);return{x:i,y:r,width:n-i,height:s-r}}}Qe=Pi.Line=Kt;Kt.prototype.className="Line";Kt.prototype._attrsAffectingSize=["points","bezier","tension"];(0,Ir._registerNode)(Kt);ti.Factory.addGetterSetter(Kt,"closed",!1);ti.Factory.addGetterSetter(Kt,"bezier",!1);ti.Factory.addGetterSetter(Kt,"tension",0,(0,un.getNumberValidator)());ti.Factory.addGetterSetter(Kt,"points",[],(0,un.getNumberArrayValidator)());var Ei={};Object.defineProperty(Ei,"__esModule",{value:!0});var ve=Ei.Rect=void 0;const Lr=Rt,Or=pe,Fr=$,Gr=dt,Rr=rt;class ei extends Or.Shape{_sceneFunc(t){const i=this.cornerRadius(),n=this.width(),r=this.height();t.beginPath(),i?Gr.Util.drawRoundedRectPath(t,n,r,i):t.rect(0,0,n,r),t.closePath(),t.fillStrokeShape(this)}}ve=Ei.Rect=ei;ei.prototype.className="Rect";(0,Fr._registerNode)(ei);Lr.Factory.addGetterSetter(ei,"cornerRadius",0,(0,Rr.getNumberOrArrayOfNumbersValidator)(4));var ii={};Object.defineProperty(ii,"__esModule",{value:!0});var ee=ii.Text=void 0;ii.stringToArray=Qt;const wi=dt,gt=Rt,Wr=pe,fi=$,jt=rt,Br=$;function Qt(e){return[...e].reduce((t,i,n,r)=>{if(/\p{Emoji}/u.test(i)){const s=r[n+1];s&&/\p{Emoji_Modifier}|\u200D/u.test(s)?(t.push(i+s),r[n+1]=""):t.push(i)}else/\p{Regional_Indicator}{2}/u.test(i+(r[n+1]||""))?t.push(i+r[n+1]):n>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(i)?t[t.length-1]+=i:i&&t.push(i);return t},[])}const ge="auto",Hr="center",fn="inherit",be="justify",Vr="Change.konva",Ur="2d",Ni="-",cn="left",Nr="text",Xr="Text",zr="top",Yr="bottom",Xi="middle",gn="normal",Zr="px ",We=" ",Kr="right",zi="rtl",jr="word",Jr="char",Yi="none",ci="",_n=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],qr=_n.length;function $r(e){return e.split(",").map(t=>{t=t.trim();const i=t.indexOf(" ")>=0,n=t.indexOf('"')>=0||t.indexOf("'")>=0;return i&&!n&&(t=`"${t}"`),t}).join(", ")}let Be;function gi(){return Be||(Be=wi.Util.createCanvasElement().getContext(Ur),Be)}function Qr(e){e.fillText(this._partialText,this._partialTextX,this._partialTextY)}function ts(e){e.setAttr("miterLimit",2),e.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function es(e){return e=e||{},!e.fillLinearGradientColorStops&&!e.fillRadialGradientColorStops&&!e.fillPatternImage&&(e.fill=e.fill||"black"),e}class Q extends Wr.Shape{constructor(t){super(es(t)),this._partialTextX=0,this._partialTextY=0;for(let i=0;i<qr;i++)this.on(_n[i]+Vr,this._setTextData);this._setTextData()}_sceneFunc(t){const i=this.textArr,n=i.length;if(!this.text())return;let r=this.padding(),s=this.fontSize(),a=this.lineHeight()*s,o=this.verticalAlign(),l=this.direction(),d=0,c=this.align(),w=this.getWidth(),T=this.letterSpacing(),g=this.fill(),f=this.textDecoration(),v=f.indexOf("underline")!==-1,_=f.indexOf("line-through")!==-1,C;l=l===fn?t.direction:l;let P=a/2,h=Xi;if(fi.Konva._fixTextRendering){const D=this.measureSize("M");h="alphabetic",P=(D.fontBoundingBoxAscent-D.fontBoundingBoxDescent)/2+a/2}var u=0,y=0;for(l===zi&&t.setAttr("direction",l),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",h),t.setAttr("textAlign",cn),o===Xi?d=(this.getHeight()-n*a-r*2)/2:o===Yr&&(d=this.getHeight()-n*a-r*2),t.translate(r,d+r),C=0;C<n;C++){var u=0,y=0,S=i[C],E=S.text,m=S.width,x=S.lastInParagraph,b,A;if(t.save(),c===Kr?u+=w-m-r*2:c===Hr&&(u+=(w-m-r*2)/2),v){t.save(),t.beginPath();const F=fi.Konva._fixTextRendering?Math.round(s/4):Math.round(s/2),I=u,Y=P+y+F;t.moveTo(I,Y),b=E.split(" ").length-1,A=c===be&&!x?w-r*2:m,t.lineTo(I+Math.round(A),Y),t.lineWidth=s/15;const z=this._getLinearGradient();t.strokeStyle=z||g,t.stroke(),t.restore()}if(_){t.save(),t.beginPath();const F=fi.Konva._fixTextRendering?-Math.round(s/4):0;t.moveTo(u,P+y+F),b=E.split(" ").length-1,A=c===be&&!x?w-r*2:m,t.lineTo(u+Math.round(A),P+y+F),t.lineWidth=s/15;const I=this._getLinearGradient();t.strokeStyle=I||g,t.stroke(),t.restore()}if(l!==zi&&(T!==0||c===be)){b=E.split(" ").length-1;const F=Qt(E);for(let I=0;I<F.length;I++){const Y=F[I];Y===" "&&!x&&c===be&&(u+=(w-r*2-m)/b),this._partialTextX=u,this._partialTextY=P+y,this._partialText=Y,t.fillStrokeShape(this),u+=this.measureSize(Y).width+T}}else T!==0&&t.setAttr("letterSpacing",`${T}px`),this._partialTextX=u,this._partialTextY=P+y,this._partialText=E,t.fillStrokeShape(this);t.restore(),n>1&&(P+=a)}}_hitFunc(t){const i=this.getWidth(),n=this.getHeight();t.beginPath(),t.rect(0,0,i,n),t.closePath(),t.fillStrokeShape(this)}setText(t){const i=wi.Util._isString(t)?t:t==null?"":t+"";return this._setAttr(Nr,i),this}getWidth(){return this.attrs.width===ge||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===ge||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return wi.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var i,n,r,s,a,o,l,d,c,w,T;let g=gi(),f=this.fontSize(),v;g.save(),g.font=this._getContextFont(),v=g.measureText(t),g.restore();const _=f/100;return{actualBoundingBoxAscent:(i=v.actualBoundingBoxAscent)!==null&&i!==void 0?i:71.58203125*_,actualBoundingBoxDescent:(n=v.actualBoundingBoxDescent)!==null&&n!==void 0?n:0,actualBoundingBoxLeft:(r=v.actualBoundingBoxLeft)!==null&&r!==void 0?r:-7.421875*_,actualBoundingBoxRight:(s=v.actualBoundingBoxRight)!==null&&s!==void 0?s:75.732421875*_,alphabeticBaseline:(a=v.alphabeticBaseline)!==null&&a!==void 0?a:0,emHeightAscent:(o=v.emHeightAscent)!==null&&o!==void 0?o:100*_,emHeightDescent:(l=v.emHeightDescent)!==null&&l!==void 0?l:-20*_,fontBoundingBoxAscent:(d=v.fontBoundingBoxAscent)!==null&&d!==void 0?d:91*_,fontBoundingBoxDescent:(c=v.fontBoundingBoxDescent)!==null&&c!==void 0?c:21*_,hangingBaseline:(w=v.hangingBaseline)!==null&&w!==void 0?w:72.80000305175781*_,ideographicBaseline:(T=v.ideographicBaseline)!==null&&T!==void 0?T:-21*_,width:v.width,height:f}}_getContextFont(){return this.fontStyle()+We+this.fontVariant()+We+(this.fontSize()+Zr)+$r(this.fontFamily())}_addTextLine(t){this.align()===be&&(t=t.trim());const n=this._getTextWidth(t);return this.textArr.push({text:t,width:n,lastInParagraph:!1})}_getTextWidth(t){const i=this.letterSpacing(),n=t.length;return gi().measureText(t).width+i*n}_setTextData(){let t=this.text().split(`
`),i=+this.fontSize(),n=0,r=this.lineHeight()*i,s=this.attrs.width,a=this.attrs.height,o=s!==ge&&s!==void 0,l=a!==ge&&a!==void 0,d=this.padding(),c=s-d*2,w=a-d*2,T=0,g=this.wrap(),f=g!==Yi,v=g!==Jr&&f,_=this.ellipsis();this.textArr=[],gi().font=this._getContextFont();const C=_?this._getTextWidth(ci):0;for(let P=0,h=t.length;P<h;++P){let u=t[P],y=this._getTextWidth(u);if(o&&y>c)for(;u.length>0;){let S=0,E=Qt(u).length,m="",x=0;for(;S<E;){const b=S+E>>>1,A=Qt(u),D=A.slice(0,b+1).join(""),O=this._getTextWidth(D);(_&&l&&T+r>w?O+C:O)<=c?(S=b+1,m=D,x=O):E=b}if(m){if(v){const D=Qt(u),O=Qt(m),F=D[O.length],I=F===We||F===Ni;let Y;if(I&&x<=c)Y=O.length;else{const z=O.lastIndexOf(We),at=O.lastIndexOf(Ni);Y=Math.max(z,at)+1}Y>0&&(S=Y,m=D.slice(0,S).join(""),x=this._getTextWidth(m))}if(m=m.trimRight(),this._addTextLine(m),n=Math.max(n,x),T+=r,this._shouldHandleEllipsis(T)){this._tryToAddEllipsisToLastLine();break}if(u=Qt(u).slice(S).join("").trimLeft(),u.length>0&&(y=this._getTextWidth(u),y<=c)){this._addTextLine(u),T+=r,n=Math.max(n,y);break}}else break}else this._addTextLine(u),T+=r,n=Math.max(n,y),this._shouldHandleEllipsis(T)&&P<h-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&T+r>w)break}this.textHeight=i,this.textWidth=n}_shouldHandleEllipsis(t){const i=+this.fontSize(),n=this.lineHeight()*i,r=this.attrs.height,s=r!==ge&&r!==void 0,a=this.padding(),o=r-a*2;return!(this.wrap()!==Yi)||s&&t+n>o}_tryToAddEllipsisToLastLine(){const t=this.attrs.width,i=t!==ge&&t!==void 0,n=this.padding(),r=t-n*2,s=this.ellipsis(),a=this.textArr[this.textArr.length-1];!a||!s||(i&&(this._getTextWidth(a.text+ci)<r||(a.text=a.text.slice(0,a.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(a.text+ci))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const t=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,i=this.hasShadow();return t&&i?!0:super._useBufferCanvas()}}ee=ii.Text=Q;Q.prototype._fillFunc=Qr;Q.prototype._strokeFunc=ts;Q.prototype.className=Xr;Q.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,Br._registerNode)(Q);gt.Factory.overWriteSetter(Q,"width",(0,jt.getNumberOrAutoValidator)());gt.Factory.overWriteSetter(Q,"height",(0,jt.getNumberOrAutoValidator)());gt.Factory.addGetterSetter(Q,"direction",fn);gt.Factory.addGetterSetter(Q,"fontFamily","Arial");gt.Factory.addGetterSetter(Q,"fontSize",12,(0,jt.getNumberValidator)());gt.Factory.addGetterSetter(Q,"fontStyle",gn);gt.Factory.addGetterSetter(Q,"fontVariant",gn);gt.Factory.addGetterSetter(Q,"padding",0,(0,jt.getNumberValidator)());gt.Factory.addGetterSetter(Q,"align",cn);gt.Factory.addGetterSetter(Q,"verticalAlign",zr);gt.Factory.addGetterSetter(Q,"lineHeight",1,(0,jt.getNumberValidator)());gt.Factory.addGetterSetter(Q,"wrap",jr);gt.Factory.addGetterSetter(Q,"ellipsis",!1,(0,jt.getBooleanValidator)());gt.Factory.addGetterSetter(Q,"letterSpacing",0,(0,jt.getNumberValidator)());gt.Factory.addGetterSetter(Q,"text","",(0,jt.getStringValidator)());gt.Factory.addGetterSetter(Q,"textDecoration","");function ae(e,t){this._waveformData=e,this._channelIndex=t}ae.prototype.min_sample=function(e){var t=(e*this._waveformData.channels+this._channelIndex)*2;return this._waveformData._at(t)};ae.prototype.max_sample=function(e){var t=(e*this._waveformData.channels+this._channelIndex)*2+1;return this._waveformData._at(t)};ae.prototype.set_min_sample=function(e,t){var i=(e*this._waveformData.channels+this._channelIndex)*2;return this._waveformData._set_at(i,t)};ae.prototype.set_max_sample=function(e,t){var i=(e*this._waveformData.channels+this._channelIndex)*2+1;return this._waveformData._set_at(i,t)};ae.prototype.min_array=function(){for(var e=this._waveformData.length,t=[],i=0;i<e;i++)t.push(this.min_sample(i));return t};ae.prototype.max_array=function(){for(var e=this._waveformData.length,t=[],i=0;i<e;i++)t.push(this.max_sample(i));return t};var is=127,ns=-128,rs=32767,ss=-32768;function as(e,t){var i=Math.floor(e/t),n=e-i*t;return n>0&&i++,i}function os(e){var t=e.scale,i=e.amplitude_scale,n=e.split_channels,r=e.length,s=e.sample_rate,a=e.channels.map(function(E){return new Float32Array(E)}),o=n?a.length:1,l=24,d=as(r,t),c=e.bits===8?1:2,w=l+d*2*c*o,T=new ArrayBuffer(w),g=new DataView(T),f=0,v=l,_,C,P=new Array(o),h=new Array(o);for(_=0;_<o;_++)P[_]=1/0,h[_]=-1/0;var u=e.bits===8?ns:ss,y=e.bits===8?is:rs;for(g.setInt32(0,2,!0),g.setUint32(4,e.bits===8,!0),g.setInt32(8,s,!0),g.setInt32(12,t,!0),g.setInt32(16,d,!0),g.setInt32(20,o,!0),C=0;C<r;C++){var S=0;if(o===1){for(_=0;_<a.length;++_)S+=a[_][C];S=Math.floor(y*S*i/a.length),S<P[0]&&(P[0]=S,P[0]<u&&(P[0]=u)),S>h[0]&&(h[0]=S,h[0]>y&&(h[0]=y))}else for(_=0;_<o;++_)S=Math.floor(y*a[_][C]*i),S<P[_]&&(P[_]=S,P[_]<u&&(P[_]=u)),S>h[_]&&(h[_]=S,h[_]>y&&(h[_]=y));if(++f===t){for(_=0;_<o;_++)e.bits===8?(g.setInt8(v++,P[_]),g.setInt8(v++,h[_])):(g.setInt16(v,P[_],!0),g.setInt16(v+2,h[_],!0),v+=4),P[_]=1/0,h[_]=-1/0;f=0}}if(f>0)for(_=0;_<o;_++)e.bits===8?(g.setInt8(v++,P[_]),g.setInt8(v++,h[_])):(g.setInt16(v,P[_],!0),g.setInt16(v+2,h[_],!0));return T}function Xe(e){"@babel/helpers - typeof";return Xe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xe(e)}function hs(e){return e&&Xe(e)==="object"&&"sample_rate"in e&&"samples_per_pixel"in e&&"bits"in e&&"length"in e&&"data"in e}function ls(e){var t=e&&Xe(e)==="object"&&"byteLength"in e;if(t){var i=new DataView(e),n=i.getInt32(0,!0);if(n!==1&&n!==2)throw new TypeError("WaveformData.create(): This waveform data version not supported")}return t}function ds(e){var t=e.data,i=e.channels||1,n=24,r=e.bits===8?1:2,s=e.length*2*i;if(t.length!==s)throw new Error("WaveformData.create(): Length mismatch in JSON waveform data");var a=n+t.length*r,o=new ArrayBuffer(a),l=new DataView(o);l.setInt32(0,2,!0),l.setUint32(4,e.bits===8,!0),l.setInt32(8,e.sample_rate,!0),l.setInt32(12,e.samples_per_pixel,!0),l.setInt32(16,e.length,!0),l.setInt32(20,i,!0);var d=n,c;if(e.bits===8)for(c=0;c<t.length;c++)l.setInt8(d++,t[c],!0);else for(c=0;c<t.length;c++)l.setInt16(d,t[c],!0),d+=2;return o}function us(e,t){var i=atob(e);return i}function fs(e,t,i){var n=us(e),r=n.indexOf(`
`,10)+1,s=n.substring(r)+"",a=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(a)}function cs(e,t,i){var n;return function(s){return n=n||fs(e),new Worker(n,s)}}var gs=cs("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQXVkaW9CdWZmZXItYmFzZWQgV2F2ZWZvcm1EYXRhIGdlbmVyYXRvcgogICAqCiAgICogQWRhcHRlZCBmcm9tIEJsb2NrRmlsZTo6Q2FsY1N1bW1hcnkgaW4gQXVkYWNpdHksIHdpdGggcGVybWlzc2lvbi4KICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2F1ZGFjaXR5L2F1ZGFjaXR5L2Jsb2IvCiAgICogICAxMTA4YzEzNzZjMDkxNjYxNjIzMzVmYWI0NzQzMDA4Y2JhNTdjNGVlL3NyYy9CbG9ja0ZpbGUuY3BwI0wxOTgKICAgKi8KCiAgdmFyIElOVDhfTUFYID0gMTI3OwogIHZhciBJTlQ4X01JTiA9IC0xMjg7CiAgdmFyIElOVDE2X01BWCA9IDMyNzY3OwogIHZhciBJTlQxNl9NSU4gPSAtMzI3Njg7CiAgZnVuY3Rpb24gY2FsY3VsYXRlV2F2ZWZvcm1EYXRhTGVuZ3RoKGF1ZGlvX3NhbXBsZV9jb3VudCwgc2NhbGUpIHsKICAgIHZhciBkYXRhX2xlbmd0aCA9IE1hdGguZmxvb3IoYXVkaW9fc2FtcGxlX2NvdW50IC8gc2NhbGUpOwogICAgdmFyIHNhbXBsZXNfcmVtYWluaW5nID0gYXVkaW9fc2FtcGxlX2NvdW50IC0gZGF0YV9sZW5ndGggKiBzY2FsZTsKICAgIGlmIChzYW1wbGVzX3JlbWFpbmluZyA+IDApIHsKICAgICAgZGF0YV9sZW5ndGgrKzsKICAgIH0KICAgIHJldHVybiBkYXRhX2xlbmd0aDsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVXYXZlZm9ybURhdGEob3B0aW9ucykgewogICAgdmFyIHNjYWxlID0gb3B0aW9ucy5zY2FsZTsKICAgIHZhciBhbXBsaXR1ZGVfc2NhbGUgPSBvcHRpb25zLmFtcGxpdHVkZV9zY2FsZTsKICAgIHZhciBzcGxpdF9jaGFubmVscyA9IG9wdGlvbnMuc3BsaXRfY2hhbm5lbHM7CiAgICB2YXIgbGVuZ3RoID0gb3B0aW9ucy5sZW5ndGg7CiAgICB2YXIgc2FtcGxlX3JhdGUgPSBvcHRpb25zLnNhbXBsZV9yYXRlOwogICAgdmFyIGNoYW5uZWxzID0gb3B0aW9ucy5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoY2hhbm5lbCk7CiAgICB9KTsKICAgIHZhciBvdXRwdXRfY2hhbm5lbHMgPSBzcGxpdF9jaGFubmVscyA/IGNoYW5uZWxzLmxlbmd0aCA6IDE7CiAgICB2YXIgaGVhZGVyX3NpemUgPSAyNDsKICAgIHZhciBkYXRhX2xlbmd0aCA9IGNhbGN1bGF0ZVdhdmVmb3JtRGF0YUxlbmd0aChsZW5ndGgsIHNjYWxlKTsKICAgIHZhciBieXRlc19wZXJfc2FtcGxlID0gb3B0aW9ucy5iaXRzID09PSA4ID8gMSA6IDI7CiAgICB2YXIgdG90YWxfc2l6ZSA9IGhlYWRlcl9zaXplICsgZGF0YV9sZW5ndGggKiAyICogYnl0ZXNfcGVyX3NhbXBsZSAqIG91dHB1dF9jaGFubmVsczsKICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodG90YWxfc2l6ZSk7CiAgICB2YXIgZGF0YV92aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICB2YXIgc2NhbGVfY291bnRlciA9IDA7CiAgICB2YXIgb2Zmc2V0ID0gaGVhZGVyX3NpemU7CiAgICB2YXIgY2hhbm5lbCwgaTsKICAgIHZhciBtaW5fdmFsdWUgPSBuZXcgQXJyYXkob3V0cHV0X2NoYW5uZWxzKTsKICAgIHZhciBtYXhfdmFsdWUgPSBuZXcgQXJyYXkob3V0cHV0X2NoYW5uZWxzKTsKICAgIGZvciAoY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBvdXRwdXRfY2hhbm5lbHM7IGNoYW5uZWwrKykgewogICAgICBtaW5fdmFsdWVbY2hhbm5lbF0gPSBJbmZpbml0eTsKICAgICAgbWF4X3ZhbHVlW2NoYW5uZWxdID0gLUluZmluaXR5OwogICAgfQogICAgdmFyIHJhbmdlX21pbiA9IG9wdGlvbnMuYml0cyA9PT0gOCA/IElOVDhfTUlOIDogSU5UMTZfTUlOOwogICAgdmFyIHJhbmdlX21heCA9IG9wdGlvbnMuYml0cyA9PT0gOCA/IElOVDhfTUFYIDogSU5UMTZfTUFYOwogICAgZGF0YV92aWV3LnNldEludDMyKDAsIDIsIHRydWUpOyAvLyBWZXJzaW9uCiAgICBkYXRhX3ZpZXcuc2V0VWludDMyKDQsIG9wdGlvbnMuYml0cyA9PT0gOCwgdHJ1ZSk7IC8vIElzIDggYml0PwogICAgZGF0YV92aWV3LnNldEludDMyKDgsIHNhbXBsZV9yYXRlLCB0cnVlKTsgLy8gU2FtcGxlIHJhdGUKICAgIGRhdGFfdmlldy5zZXRJbnQzMigxMiwgc2NhbGUsIHRydWUpOyAvLyBTY2FsZQogICAgZGF0YV92aWV3LnNldEludDMyKDE2LCBkYXRhX2xlbmd0aCwgdHJ1ZSk7IC8vIExlbmd0aAogICAgZGF0YV92aWV3LnNldEludDMyKDIwLCBvdXRwdXRfY2hhbm5lbHMsIHRydWUpOwogICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzYW1wbGUgPSAwOwogICAgICBpZiAob3V0cHV0X2NoYW5uZWxzID09PSAxKSB7CiAgICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IGNoYW5uZWxzLmxlbmd0aDsgKytjaGFubmVsKSB7CiAgICAgICAgICBzYW1wbGUgKz0gY2hhbm5lbHNbY2hhbm5lbF1baV07CiAgICAgICAgfQogICAgICAgIHNhbXBsZSA9IE1hdGguZmxvb3IocmFuZ2VfbWF4ICogc2FtcGxlICogYW1wbGl0dWRlX3NjYWxlIC8gY2hhbm5lbHMubGVuZ3RoKTsKICAgICAgICBpZiAoc2FtcGxlIDwgbWluX3ZhbHVlWzBdKSB7CiAgICAgICAgICBtaW5fdmFsdWVbMF0gPSBzYW1wbGU7CiAgICAgICAgICBpZiAobWluX3ZhbHVlWzBdIDwgcmFuZ2VfbWluKSB7CiAgICAgICAgICAgIG1pbl92YWx1ZVswXSA9IHJhbmdlX21pbjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHNhbXBsZSA+IG1heF92YWx1ZVswXSkgewogICAgICAgICAgbWF4X3ZhbHVlWzBdID0gc2FtcGxlOwogICAgICAgICAgaWYgKG1heF92YWx1ZVswXSA+IHJhbmdlX21heCkgewogICAgICAgICAgICBtYXhfdmFsdWVbMF0gPSByYW5nZV9tYXg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBvdXRwdXRfY2hhbm5lbHM7ICsrY2hhbm5lbCkgewogICAgICAgICAgc2FtcGxlID0gTWF0aC5mbG9vcihyYW5nZV9tYXggKiBjaGFubmVsc1tjaGFubmVsXVtpXSAqIGFtcGxpdHVkZV9zY2FsZSk7CiAgICAgICAgICBpZiAoc2FtcGxlIDwgbWluX3ZhbHVlW2NoYW5uZWxdKSB7CiAgICAgICAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1pbl92YWx1ZVtjaGFubmVsXSA8IHJhbmdlX21pbikgewogICAgICAgICAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IHJhbmdlX21pbjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHNhbXBsZSA+IG1heF92YWx1ZVtjaGFubmVsXSkgewogICAgICAgICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSBzYW1wbGU7CiAgICAgICAgICAgIGlmIChtYXhfdmFsdWVbY2hhbm5lbF0gPiByYW5nZV9tYXgpIHsKICAgICAgICAgICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSByYW5nZV9tYXg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCsrc2NhbGVfY291bnRlciA9PT0gc2NhbGUpIHsKICAgICAgICBmb3IgKGNoYW5uZWwgPSAwOyBjaGFubmVsIDwgb3V0cHV0X2NoYW5uZWxzOyBjaGFubmVsKyspIHsKICAgICAgICAgIGlmIChvcHRpb25zLmJpdHMgPT09IDgpIHsKICAgICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1pbl92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtYXhfdmFsdWVbY2hhbm5lbF0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCwgbWluX3ZhbHVlW2NoYW5uZWxdLCB0cnVlKTsKICAgICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCArIDIsIG1heF92YWx1ZVtjaGFubmVsXSwgdHJ1ZSk7CiAgICAgICAgICAgIG9mZnNldCArPSA0OwogICAgICAgICAgfQogICAgICAgICAgbWluX3ZhbHVlW2NoYW5uZWxdID0gSW5maW5pdHk7CiAgICAgICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSAtSW5maW5pdHk7CiAgICAgICAgfQogICAgICAgIHNjYWxlX2NvdW50ZXIgPSAwOwogICAgICB9CiAgICB9CiAgICBpZiAoc2NhbGVfY291bnRlciA+IDApIHsKICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuYml0cyA9PT0gOCkgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1pbl92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWF4X3ZhbHVlW2NoYW5uZWxdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCwgbWluX3ZhbHVlW2NoYW5uZWxdLCB0cnVlKTsKICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQxNihvZmZzZXQgKyAyLCBtYXhfdmFsdWVbY2hhbm5lbF0sIHRydWUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGJ1ZmZlcjsKICB9CgogIG9ubWVzc2FnZSA9IGZ1bmN0aW9uIG9ubWVzc2FnZShldnQpIHsKICAgIHZhciBidWZmZXIgPSBnZW5lcmF0ZVdhdmVmb3JtRGF0YShldnQuZGF0YSk7CgogICAgLy8gVHJhbnNmZXIgYnVmZmVyIHRvIHRoZSBjYWxsaW5nIHRocmVhZAogICAgdGhpcy5wb3N0TWVzc2FnZShidWZmZXIsIFtidWZmZXJdKTsKICAgIHRoaXMuY2xvc2UoKTsKICB9OwoKfSkoKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9d2F2ZWZvcm0tZGF0YS13b3JrZXIuanMubWFwCgo=");function pt(e){if(hs(e)&&(e=ds(e)),ls(e)){this._data=new DataView(e),this._offset=this._version()===2?24:20,this._channels=[];for(var t=0;t<this.channels;t++)this._channels[t]=new ae(this,t)}else throw new TypeError("WaveformData.create(): Unknown data format")}var Se={scale:512,bits:8,amplitude_scale:1,split_channels:!1,disable_worker:!1};function _s(e){var t={scale:e.scale||Se.scale,bits:e.bits||Se.bits,amplitude_scale:e.amplitude_scale||Se.amplitude_scale,split_channels:e.split_channels||Se.split_channels,disable_worker:e.disable_worker||Se.disable_worker};return t}function ps(e){for(var t=[],i=0;i<e.numberOfChannels;++i)t.push(e.getChannelData(i).buffer);return t}function pn(e,t,i){var n=ps(e);if(t.disable_worker){var r=os({scale:t.scale,bits:t.bits,amplitude_scale:t.amplitude_scale,split_channels:t.split_channels,length:e.length,sample_rate:e.sampleRate,channels:n});i(null,new pt(r),e)}else{var s=new gs;s.onmessage=function(a){i(null,new pt(a.data),e)},s.postMessage({scale:t.scale,bits:t.bits,amplitude_scale:t.amplitude_scale,split_channels:t.split_channels,length:e.length,sample_rate:e.sampleRate,channels:n},n)}}function ms(e,t,i,n){function r(a){a||(a=new DOMException("EncodingError")),n(a),n=function(){}}var s=e.decodeAudioData(t,function(a){pn(a,i,n)},r);s&&s.catch(r)}pt.create=function(t){return new pt(t)};pt.createFromAudio=function(e,t){var i=_s(e);if(e.audio_context&&e.array_buffer)return ms(e.audio_context,e.array_buffer,i,t);if(e.audio_buffer)return pn(e.audio_buffer,i,t);throw new TypeError("WaveformData.createFromAudio(): Pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")};function ni(e){this._inputData=e.waveformData,this._output_samples_per_pixel=e.scale,this._scale=this._inputData.scale,this._input_buffer_size=this._inputData.length;var t=this._input_buffer_size*this._inputData.scale,i=Math.ceil(t/this._output_samples_per_pixel),n=24,r=this._inputData.bits===8?1:2,s=n+i*2*this._inputData.channels*r;this._output_data=new ArrayBuffer(s),this.output_dataview=new DataView(this._output_data),this.output_dataview.setInt32(0,2,!0),this.output_dataview.setUint32(4,this._inputData.bits===8,!0),this.output_dataview.setInt32(8,this._inputData.sample_rate,!0),this.output_dataview.setInt32(12,this._output_samples_per_pixel,!0),this.output_dataview.setInt32(16,i,!0),this.output_dataview.setInt32(20,this._inputData.channels,!0),this._outputWaveformData=new pt(this._output_data),this._input_index=0,this._output_index=0;var a=this._inputData.channels;this._min=new Array(a),this._max=new Array(a);var o;for(o=0;o<a;++o)this._input_buffer_size>0?(this._min[o]=this._inputData.channel(o).min_sample(this._input_index),this._max[o]=this._inputData.channel(o).max_sample(this._input_index)):(this._min[o]=0,this._max[o]=0);this._min_value=this._inputData.bits===8?-128:-32768,this._max_value=this._inputData.bits===8?127:32767,this._where=0,this._prev_where=0,this._stop=0,this._last_input_index=0}ni.prototype.sample_at_pixel=function(e){return Math.floor(e*this._output_samples_per_pixel)};ni.prototype.next=function(){for(var e=0,t=1e3,i=this._inputData.channels,n,r,s;this._input_index<this._input_buffer_size&&e<t;){for(;Math.floor(this.sample_at_pixel(this._output_index)/this._scale)===this._input_index;){if(this._output_index>0)for(s=0;s<i;++s)n=this._outputWaveformData.channel(s),n.set_min_sample(this._output_index-1,this._min[s]),n.set_max_sample(this._output_index-1,this._max[s]);if(this._last_input_index=this._input_index,this._output_index++,this._where=this.sample_at_pixel(this._output_index),this._prev_where=this.sample_at_pixel(this._output_index-1),this._where!==this._prev_where)for(s=0;s<i;++s)this._min[s]=this._max_value,this._max[s]=this._min_value}for(this._where=this.sample_at_pixel(this._output_index),this._stop=Math.floor(this._where/this._scale),this._stop>this._input_buffer_size&&(this._stop=this._input_buffer_size);this._input_index<this._stop;){for(s=0;s<i;++s)n=this._inputData.channel(s),r=n.min_sample(this._input_index),r<this._min[s]&&(this._min[s]=r),r=n.max_sample(this._input_index),r>this._max[s]&&(this._max[s]=r);this._input_index++}e++}if(this._input_index<this._input_buffer_size)return!1;if(this._input_index!==this._last_input_index)for(s=0;s<i;++s)n=this._outputWaveformData.channel(s),n.set_min_sample(this._output_index-1,this._min[s]),n.set_max_sample(this._output_index-1,this._max[s]);return!0};ni.prototype.getOutputData=function(){return this._output_data};pt.prototype={_getResampleOptions:function(t){var i={};if(i.scale=t.scale,i.width=t.width,i.width!=null&&(typeof i.width!="number"||i.width<=0))throw new RangeError("WaveformData.resample(): width should be a positive integer value");if(i.scale!=null&&(typeof i.scale!="number"||i.scale<=0))throw new RangeError("WaveformData.resample(): scale should be a positive integer value");if(!i.scale&&!i.width)throw new Error("WaveformData.resample(): Missing scale or width option");if(i.width&&(i.scale=Math.floor(this.duration*this.sample_rate/i.width)),i.scale<this.scale)throw new Error("WaveformData.resample(): Zoom level "+i.scale+" too low, minimum: "+this.scale);return i.abortSignal=t.abortSignal,i},resample:function(t){t=this._getResampleOptions(t),t.waveformData=this;for(var i=new ni(t);!i.next(););return new pt(i.getOutputData())},concat:function(){var t=this,i=Array.prototype.slice.call(arguments);i.forEach(function(r){if(t.channels!==r.channels||t.sample_rate!==r.sample_rate||t.bits!==r.bits||t.scale!==r.scale)throw new Error("WaveformData.concat(): Waveforms are incompatible")});var n=this._concatBuffers.apply(this,i);return pt.create(n)},_concatBuffers:function(){var t=Array.prototype.slice.call(arguments),i=this._offset,n=i,r=0,s=[this].concat(t).map(function(f){return f._data.buffer}),a,o;for(a=0;a<s.length;a++){o=s[a];var l=new DataView(o).getInt32(16,!0);n+=o.byteLength-i,r+=l}var d=new ArrayBuffer(n),c=new DataView(s[0]),w=new DataView(d);for(a=0;a<i;a++)w.setUint8(a,c.getUint8(a));w.setInt32(16,r,!0);var T=0,g=new Uint8Array(d,i);for(a=0;a<s.length;a++)o=s[a],g.set(new Uint8Array(o,i),T),T+=o.byteLength-i;return d},slice:function(t){var i=0,n=0;if(t.startIndex!=null&&t.endIndex!=null?(i=t.startIndex,n=t.endIndex):t.startTime!=null&&t.endTime!=null&&(i=this.at_time(t.startTime),n=this.at_time(t.endTime)),i<0)throw new RangeError("startIndex or startTime must not be negative");if(n<0)throw new RangeError("endIndex or endTime must not be negative");i>this.length&&(i=this.length),n>this.length&&(n=this.length),i>n&&(i=n);var r=n-i,s=24,a=this.bits===8?1:2,o=s+r*2*this.channels*a,l=new ArrayBuffer(o),d=new DataView(l);d.setInt32(0,2,!0),d.setUint32(4,this.bits===8,!0),d.setInt32(8,this.sample_rate,!0),d.setInt32(12,this.scale,!0),d.setInt32(16,r,!0),d.setInt32(20,this.channels,!0);for(var c=0;c<r*this.channels*2;c++){var w=this._at(i*this.channels*2+c);this.bits===8?d.setInt8(s+c,w):d.setInt16(s+c*2,w,!0)}return new pt(l)},_version:function(){return this._data.getInt32(0,!0)},get length(){return this._data.getUint32(16,!0)},get bits(){var e=!!this._data.getUint32(4,!0);return e?8:16},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return this._version()===2?this._data.getInt32(20,!0):1},channel:function(t){if(t>=0&&t<this._channels.length)return this._channels[t];throw new RangeError("Invalid channel: "+t)},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},_at:function(t){return this.bits===8?this._data.getInt8(this._offset+t):this._data.getInt16(this._offset+t*2,!0)},_set_at:function(t,i){return this.bits===8?this._data.setInt8(this._offset+t,i):this._data.setInt16(this._offset+t*2,i,!0)},at_time:function(t){return Math.floor(t*this.sample_rate/this.scale)},time:function(t){return t*this.scale/this.sample_rate},toJSON:function(){for(var t={version:2,channels:this.channels,sample_rate:this.sample_rate,samples_per_pixel:this.scale,bits:this.bits,length:this.length,data:[]},i=0;i<this.length;i++)for(var n=0;n<this.channels;n++)t.data.push(this.channel(n).min_sample(i)),t.data.push(this.channel(n).max_sample(i));return t},toArrayBuffer:function(){return this._data.buffer}};function vs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var mn={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1));function r(l,d,c){this.fn=l,this.context=d,this.once=c||!1}function s(l,d,c,w,T){if(typeof c!="function")throw new TypeError("The listener must be a function");var g=new r(c,w||l,T),f=i?i+d:d;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],g]:l._events[f].push(g):(l._events[f]=g,l._eventsCount++),l}function a(l,d){--l._eventsCount===0?l._events=new n:delete l._events[d]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var d=[],c,w;if(this._eventsCount===0)return d;for(w in c=this._events)t.call(c,w)&&d.push(i?w.slice(1):w);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(c)):d},o.prototype.listeners=function(d){var c=i?i+d:d,w=this._events[c];if(!w)return[];if(w.fn)return[w.fn];for(var T=0,g=w.length,f=new Array(g);T<g;T++)f[T]=w[T].fn;return f},o.prototype.listenerCount=function(d){var c=i?i+d:d,w=this._events[c];return w?w.fn?1:w.length:0},o.prototype.emit=function(d,c,w,T,g,f){var v=i?i+d:d;if(!this._events[v])return!1;var _=this._events[v],C=arguments.length,P,h;if(_.fn){switch(_.once&&this.removeListener(d,_.fn,void 0,!0),C){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,c),!0;case 3:return _.fn.call(_.context,c,w),!0;case 4:return _.fn.call(_.context,c,w,T),!0;case 5:return _.fn.call(_.context,c,w,T,g),!0;case 6:return _.fn.call(_.context,c,w,T,g,f),!0}for(h=1,P=new Array(C-1);h<C;h++)P[h-1]=arguments[h];_.fn.apply(_.context,P)}else{var u=_.length,y;for(h=0;h<u;h++)switch(_[h].once&&this.removeListener(d,_[h].fn,void 0,!0),C){case 1:_[h].fn.call(_[h].context);break;case 2:_[h].fn.call(_[h].context,c);break;case 3:_[h].fn.call(_[h].context,c,w);break;case 4:_[h].fn.call(_[h].context,c,w,T);break;default:if(!P)for(y=1,P=new Array(C-1);y<C;y++)P[y-1]=arguments[y];_[h].fn.apply(_[h].context,P)}}return!0},o.prototype.on=function(d,c,w){return s(this,d,c,w,!1)},o.prototype.once=function(d,c,w){return s(this,d,c,w,!0)},o.prototype.removeListener=function(d,c,w,T){var g=i?i+d:d;if(!this._events[g])return this;if(!c)return a(this,g),this;var f=this._events[g];if(f.fn)f.fn===c&&(!T||f.once)&&(!w||f.context===w)&&a(this,g);else{for(var v=0,_=[],C=f.length;v<C;v++)(f[v].fn!==c||T&&!f[v].once||w&&f[v].context!==w)&&_.push(f[v]);_.length?this._events[g]=_.length===1?_[0]:_:a(this,g)}return this},o.prototype.removeAllListeners=function(d){var c;return d?(c=i?i+d:d,this._events[c]&&a(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o})(mn);var ys=mn.exports,vn=vs(ys);function ze(e){"@babel/helpers - typeof";return ze=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ze(e)}function it(e,t,i){this.time=e,this.type=t,this.id=i}it.POINT=0;it.SEGMENT_START=1;it.SEGMENT_END=2;it.sorter=function(e,t){return e.time-t.time};function Zi(e,t){for(e=e.toString();e.length<t;)e="0"+e;return e}function yn(e,t){var i=[],n=Math.floor(e%1*Math.pow(10,t)),r=Math.floor(e),s=Math.floor(r/60),a=Math.floor(s/60);a>0&&i.push(a),i.push(s%60),i.push(r%60);for(var o=0;o<i.length;o++)i[o]=Zi(i[o],2);return i=i.join(":"),t>0&&(i+="."+Zi(n,t)),i}function ws(e,t){if(t===0)return 0;var i=1;e<0&&(i=-1,e=-e);var n=Math.ceil(e);return i*((n+t-1)/t|0)*t}function wt(e,t,i){return e<t?t:e>i?i:e}function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ce(e,t){for(var i in t)M(t,i)&&(e[i]=t[i]);return e}function bs(e){if(e.length===0)return!0;for(var t=e[0],i=1;i<e.length;i++){if(t>=e[i])return!1;t=e[i]}return!0}function bi(e){return typeof e=="number"}function Ss(e){return!(typeof e!="number"||e!==e||e===1/0||e===-1/0)}function ie(e){return typeof e=="number"&&Number.isFinite(e)}function ke(e){return e!==null&&ze(e)==="object"&&!Array.isArray(e)}function te(e){return typeof e=="string"}function Cs(e){return Object.prototype.toString.call(e).includes("ArrayBuffer")}function kt(e){return e==null}function Ts(e){return typeof e=="function"}function wn(e){return e===!0||e===!1}function Si(e){return e instanceof HTMLElement}function ks(e){return Array.isArray(e)}function ri(e){return ke(e)&&M(e,"linearGradientStart")&&M(e,"linearGradientEnd")&&M(e,"linearGradientColorStops")&&bi(e.linearGradientStart)&&bi(e.linearGradientEnd)&&ks(e.linearGradientColorStops)&&e.linearGradientColorStops.length===2}function bn(e){for(;e.parent!==null;){if(e.parent instanceof nt.Layer)return e;e=e.parent}return null}var xs=/HeadlessChrome/.test(navigator.userAgent);function As(){return xs||navigator.webdriver?!1:(typeof document>"u"?"undefined":ze(document))==="object"&&"visibilityState"in document&&document.visibilityState==="visible"}var Sn=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Ps=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,zt={forward:{},reverse:{}},si=0,Ee=1,De=2;zt.forward[it.POINT]=si;zt.forward[it.SEGMENT_START]=Ee;zt.forward[it.SEGMENT_END]=De;zt.reverse[it.POINT]=si;zt.reverse[it.SEGMENT_START]=De;zt.reverse[it.SEGMENT_END]=Ee;var ai={};ai[si]="points.enter";ai[Ee]="segments.enter";ai[De]="segments.exit";var oi={};oi[si]="point";oi[Ee]="segment";oi[De]="segment";function Es(e,t){switch(t.type){case it.POINT:return e.points.getPoint(t.id);case it.SEGMENT_START:case it.SEGMENT_END:return e.segments.getSegment(t.id);default:throw new Error("getPointOrSegment: id not found?")}}function Pt(e){this._cues=[],this._peaks=e,this._previousTime=-1,this._updateCues=this._updateCues.bind(this),this._onPlaying=this._onPlaying.bind(this),this._onSeeked=this._onSeeked.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._onAnimationFrame=this._onAnimationFrame.bind(this),this._rAFHandle=null,this._activeSegments={},this._attachEventHandlers()}Pt.prototype._updateCues=function(){var e=this,t=e._peaks.points.getPoints(),i=e._peaks.segments.getSegments();e._cues.length=0,t.forEach(function(r){e._cues.push(new it(r.time,it.POINT,r.id))}),i.forEach(function(r){e._cues.push(new it(r.startTime,it.SEGMENT_START,r.id)),e._cues.push(new it(r.endTime,it.SEGMENT_END,r.id))}),e._cues.sort(it.sorter);var n=e._peaks.player.getCurrentTime();e._updateActiveSegments(n)};Pt.prototype._onUpdate=function(e,t){var i=e>t,n,r,s;i?(n=0,r=this._cues.length,s=1):(n=this._cues.length-1,r=-1,s=-1);for(var a=n;i?a<r:a>r;a+=s){var o=this._cues[a];if(i?o.time>t:o.time<t){if(i?o.time>e:o.time<e)break;var l=Es(this._peaks,o),d=i?zt.forward[o.type]:zt.reverse[o.type];d===Ee?this._activeSegments[l.id]=l:d===De&&delete this._activeSegments[l.id];var c={time:e};c[oi[d]]=l,this._peaks.emit(ai[d],c)}}};Pt.prototype._onTimeUpdate=function(e){As()||(this._peaks.player.isPlaying()&&!this._peaks.player.isSeeking()&&this._onUpdate(e,this._previousTime),this._previousTime=e)};Pt.prototype._onAnimationFrame=function(){var e=this._peaks.player.getCurrentTime();this._peaks.player.isSeeking()||this._onUpdate(e,this._previousTime),this._previousTime=e,this._peaks.player.isPlaying()&&(this._rAFHandle=Sn(this._onAnimationFrame))};Pt.prototype._onPlaying=function(){this._previousTime=this._peaks.player.getCurrentTime(),this._rAFHandle=Sn(this._onAnimationFrame)};Pt.prototype._onSeeked=function(e){this._previousTime=e,this._updateActiveSegments(e)};function Ds(e){return function(i){return i.id===e}}Pt.prototype._updateActiveSegments=function(e){var t=this,i=t._peaks.segments.getSegmentsAtTime(e);for(var n in t._activeSegments)if(M(t._activeSegments,n)){var r=i.find(Ds(n));r||(t._peaks.emit("segments.exit",{segment:t._activeSegments[n],time:e}),delete t._activeSegments[n])}i.forEach(function(s){s.id in t._activeSegments||(t._activeSegments[s.id]=s,t._peaks.emit("segments.enter",{segment:s,time:e}))})};var Ye=["points.update","points.dragmove","points.add","points.remove","points.remove_all","segments.update","segments.dragged","segments.add","segments.remove","segments.remove_all"];Pt.prototype._attachEventHandlers=function(){this._peaks.on("player.timeupdate",this._onTimeUpdate),this._peaks.on("player.playing",this._onPlaying),this._peaks.on("player.seeked",this._onSeeked);for(var e=0;e<Ye.length;e++)this._peaks.on(Ye[e],this._updateCues);this._updateCues()};Pt.prototype._detachEventHandlers=function(){this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.seeked",this._onSeeked);for(var e=0;e<Ye.length;e++)this._peaks.off(Ye[e],this._updateCues)};Pt.prototype.destroy=function(){this._rAFHandle&&(Ps(this._rAFHandle),this._rAFHandle=null),this._detachEventHandlers(),this._previousTime=-1};var Cn=["id","pid","time","labelText","color","editable"],Is=["update","isVisible","peaks","pid"];function Ms(e,t){kt(e.labelText)&&(e.labelText=""),kt(e.editable)&&(e.editable=!1),kt(e.color)&&(e.color=t.pointMarkerColor)}function Tn(e,t){var i=t?"update()":"add()";if((!t||t&&M(e,"time"))&&!ie(e.time))throw new TypeError("peaks.points."+i+": time should be a numeric value");if(e.time<0)throw new RangeError("peaks.points."+i+": time should not be negative");if(M(e,"labelText")&&!te(e.labelText))throw new TypeError("peaks.points."+i+": labelText must be a string");if(M(e,"editable")&&!wn(e.editable))throw new TypeError("peaks.points."+i+": editable must be true or false");if(M(e,"color")&&!te(e.color)&&!ri(e.color))throw new TypeError("peaks.points."+i+": color must be a string or a valid linear gradient object");Is.forEach(function(n){if(M(e,n))throw new Error("peaks.points."+i+": invalid option name: "+n)}),Cn.forEach(function(n){if(M(e,"_"+n))throw new Error("peaks.points."+i+": invalid option name: _"+n)})}function ye(e,t,i){this._peaks=e,this._pid=t,this._setUserData(i)}ye.prototype._setUserData=function(e){for(var t in e)M(e,t)&&(Cn.indexOf(t)===-1?this[t]=e[t]:this["_"+t]=e[t])};Object.defineProperties(ye.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},time:{enumerable:!0,get:function(){return this._time}},labelText:{get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},editable:{enumerable:!0,get:function(){return this._editable}}});ye.prototype.update=function(e){if(Tn(e,!0),M(e,"id")){if(kt(e.id))throw new TypeError("point.update(): invalid id");this._peaks.points.updatePointId(this,e.id)}this._setUserData(e),this._peaks.emit("points.update",this,e)};ye.prototype.isVisible=function(e,t){return this.time>=e&&this.time<t};ye.prototype._setTime=function(e){this._time=e};function ut(e){this._peaks=e,this._points=[],this._pointsById={},this._pointsByPid={},this._pointIdCounter=0,this._pointPid=0}ut.prototype._getNextPointId=function(){return"peaks.point."+this._pointIdCounter++};ut.prototype._getNextPid=function(){return this._pointPid++};ut.prototype._addPoint=function(e){this._points.push(e),this._pointsById[e.id]=e,this._pointsByPid[e.pid]=e};ut.prototype._createPoint=function(e){var t={};Ce(t,e),kt(t.id)&&(t.id=this._getNextPointId());var i=this._getNextPid();return Ms(t,this._peaks.options),Tn(t,!1),new ye(this._peaks,i,t)};ut.prototype.getPoints=function(){return this._points};ut.prototype.getPoint=function(e){return this._pointsById[e]};ut.prototype.find=function(e,t){return this._points.filter(function(i){return i.isVisible(e,t)})};ut.prototype.add=function(){var e=this,t=Array.isArray(arguments[0]),i=t?arguments[0]:Array.prototype.slice.call(arguments);return i=i.map(function(n){var r=e._createPoint(n);if(M(e._pointsById,r.id))throw new Error("peaks.points.add(): duplicate id");return r}),i.forEach(function(n){e._addPoint(n)}),this._peaks.emit("points.add",{points:i}),t?i:i[0]};ut.prototype.updatePointId=function(e,t){if(this._pointsById[e.id]){if(this._pointsById[t])throw new Error("point.update(): duplicate id");delete this._pointsById[e.id],this._pointsById[t]=e}};ut.prototype._findPoint=function(e){for(var t=[],i=0,n=this._points.length;i<n;i++)e(this._points[i])&&t.push(i);return t};ut.prototype._removeIndexes=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i]-t.length,r=this._points.splice(n,1)[0];delete this._pointsById[r.id],delete this._pointsByPid[r.pid],t.push(r)}return t};ut.prototype._removePoints=function(e){var t=this._findPoint(e),i=this._removeIndexes(t);return this._peaks.emit("points.remove",{points:i}),i};ut.prototype.remove=function(e){return this._removePoints(function(t){return t===e})};ut.prototype.removeById=function(e){return this._removePoints(function(t){return t.id===e})};ut.prototype.removeByTime=function(e){return this._removePoints(function(t){return t.time===e})};ut.prototype.removeAll=function(){this._points=[],this._pointsById={},this._pointsByPid={},this._peaks.emit("points.remove_all")};var kn=["id","pid","startTime","endTime","labelText","color","borderColor","editable"],Ls=["update","isVisible","peaks","pid"];function Os(e,t){kt(e.color)&&(t.overlay?e.color=t.overlayColor:e.color=t.waveformColor),kt(e.borderColor)&&(e.borderColor=t.overlayBorderColor),kt(e.labelText)&&(e.labelText=""),kt(e.editable)&&(e.editable=!1)}function xn(e,t){var i=t?"update()":"add()";if(M(e,"startTime")&&!ie(e.startTime))throw new TypeError("peaks.segments."+i+": startTime should be a valid number");if(M(e,"endTime")&&!ie(e.endTime))throw new TypeError("peaks.segments."+i+": endTime should be a valid number");if(!t&&(!M(e,"startTime")||!M(e,"endTime")))throw new TypeError("peaks.segments."+i+": missing startTime or endTime");if(e.startTime<0)throw new RangeError("peaks.segments."+i+": startTime should not be negative");if(e.endTime<0)throw new RangeError("peaks.segments."+i+": endTime should not be negative");if(e.endTime<e.startTime)throw new RangeError("peaks.segments."+i+": endTime should not be less than startTime");if(M(e,"labelText")&&!te(e.labelText))throw new TypeError("peaks.segments."+i+": labelText must be a string");if(M(e,"editable")&&!wn(e.editable))throw new TypeError("peaks.segments."+i+": editable must be true or false");if(M(e,"color")&&!te(e.color)&&!ri(e.color))throw new TypeError("peaks.segments."+i+": color must be a string or a valid linear gradient object");if(M(e,"borderColor")&&!te(e.borderColor))throw new TypeError("peaks.segments."+i+": borderColor must be a string");Ls.forEach(function(n){if(M(e,n))throw new Error("peaks.segments."+i+": invalid option name: "+n)}),kn.forEach(function(n){if(M(e,"_"+n))throw new Error("peaks.segments."+i+": invalid option name: _"+n)})}function oe(e,t,i){this._peaks=e,this._pid=t,this._id=i.id,this._startTime=i.startTime,this._endTime=i.endTime,this._labelText=i.labelText,this._color=i.color,this._borderColor=i.borderColor,this._editable=i.editable,this._setUserData(i)}oe.prototype._setUserData=function(e){for(var t in e)M(e,t)&&(kn.indexOf(t)===-1?this[t]=e[t]:this["_"+t]=e[t])};Object.defineProperties(oe.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},startTime:{enumerable:!0,get:function(){return this._startTime}},endTime:{enumerable:!0,get:function(){return this._endTime}},labelText:{enumerable:!0,get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},borderColor:{enumerable:!0,get:function(){return this._borderColor}},editable:{enumerable:!0,get:function(){return this._editable}}});oe.prototype.update=function(e){if(xn(e,!0),M(e,"id")){if(kt(e.id))throw new TypeError("segment.update(): invalid id");this._peaks.segments.updateSegmentId(this,e.id)}this._setUserData(e),this._peaks.emit("segments.update",this,e)};oe.prototype.isVisible=function(e,t){return this.startTime<t&&e<this.endTime};oe.prototype._setStartTime=function(e){this._startTime=e};oe.prototype._setEndTime=function(e){this._endTime=e};function J(e){this._peaks=e,this._segments=[],this._segmentsById={},this._segmentsByPid={},this._segmentIdCounter=0,this._segmentPid=0,this._isInserting=!1}J.prototype._getNextSegmentId=function(){return"peaks.segment."+this._segmentIdCounter++};J.prototype._getNextPid=function(){return this._segmentPid++};J.prototype._addSegment=function(e){this._segments.push(e),this._segmentsById[e.id]=e,this._segmentsByPid[e.pid]=e};J.prototype._createSegment=function(e){var t={};Ce(t,e),kt(t.id)&&(t.id=this._getNextSegmentId());var i=this._getNextPid();return Os(t,this._peaks.options.segmentOptions),xn(t,!1),new oe(this._peaks,i,t)};J.prototype.getSegments=function(){return this._segments};J.prototype.getSegment=function(e){return this._segmentsById[e]};J.prototype.getSegmentsAtTime=function(e){return this._segments.filter(function(t){return e>=t.startTime&&e<t.endTime})};J.prototype.find=function(e,t){return this._segments.filter(function(i){return i.isVisible(e,t)})};J.prototype._getSortedSegments=function(){return this._segments.slice().sort(function(e,t){return e.startTime-t.startTime})};J.prototype.findPreviousSegment=function(e){var t=this._getSortedSegments(),i=t.findIndex(function(n){return n.id===e.id});if(i!==-1)return t[i-1]};J.prototype.findNextSegment=function(e){var t=this._getSortedSegments(),i=t.findIndex(function(n){return n.id===e.id});if(i!==-1)return t[i+1]};J.prototype.add=function(){var e=this,t=Array.isArray(arguments[0]),i=t?arguments[0]:Array.prototype.slice.call(arguments);return i=i.map(function(n){var r=e._createSegment(n);if(M(e._segmentsById,r.id))throw new Error("peaks.segments.add(): duplicate id");return r}),i.forEach(function(n){e._addSegment(n)}),this._peaks.emit("segments.add",{segments:i,insert:this._isInserting}),t?i:i[0]};J.prototype.updateSegmentId=function(e,t){if(this._segmentsById[e.id]){if(this._segmentsById[t])throw new Error("segment.update(): duplicate id");delete this._segmentsById[e.id],this._segmentsById[t]=e}};J.prototype._findSegment=function(e){for(var t=[],i=0,n=this._segments.length;i<n;i++)e(this._segments[i])&&t.push(i);return t};J.prototype._removeIndexes=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i]-t.length,r=this._segments.splice(n,1)[0];delete this._segmentsById[r.id],delete this._segmentsByPid[r.pid],t.push(r)}return t};J.prototype._removeSegments=function(e){var t=this._findSegment(e),i=this._removeIndexes(t);return this._peaks.emit("segments.remove",{segments:i}),i};J.prototype.remove=function(e){return this._removeSegments(function(t){return t===e})};J.prototype.removeById=function(e){return this._removeSegments(function(t){return t.id===e})};J.prototype.removeByTime=function(e,t){t=typeof t=="number"?t:0;var i;return t>0?i=function(r){return r.startTime===e&&r.endTime===t}:i=function(r){return r.startTime===e},this._removeSegments(i)};J.prototype.removeAll=function(){this._segments=[],this._segmentsById={},this._segmentsByPid={},this._peaks.emit("segments.remove_all")};J.prototype.setInserting=function(e){this._isInserting=e};J.prototype.isInserting=function(){return this._isInserting};var Fs=["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"],An=32,Pn=9,En=37,Dn=39,Gs=[An,Pn,En,Dn];function Di(e){this.eventEmitter=e,this._handleKeyEvent=this._handleKeyEvent.bind(this),document.addEventListener("keydown",this._handleKeyEvent),document.addEventListener("keypress",this._handleKeyEvent),document.addEventListener("keyup",this._handleKeyEvent)}Di.prototype._handleKeyEvent=function(t){if(Fs.indexOf(t.target.nodeName)===-1){if(Gs.indexOf(t.type)>-1&&t.preventDefault(),t.type==="keydown"||t.type==="keypress")switch(t.keyCode){case An:this.eventEmitter.emit("keyboard.space");break;case Pn:this.eventEmitter.emit("keyboard.tab");break}else if(t.type==="keyup")switch(t.keyCode){case En:t.shiftKey?this.eventEmitter.emit("keyboard.shift_left"):this.eventEmitter.emit("keyboard.left");break;case Dn:t.shiftKey?this.eventEmitter.emit("keyboard.shift_right"):this.eventEmitter.emit("keyboard.right");break}}};Di.prototype.destroy=function(){document.removeEventListener("keydown",this._handleKeyEvent),document.removeEventListener("keypress",this._handleKeyEvent),document.removeEventListener("keyup",this._handleKeyEvent)};function Rs(e){return!!(e.src||e.querySelector("source"))}function xt(e){this._mediaElement=e}xt.prototype._addMediaListener=function(e,t){this._listeners.push({type:e,callback:t}),this._mediaElement.addEventListener(e,t)};xt.prototype.init=function(e){var t=this;if(t._eventEmitter=e,t._listeners=[],t._duration=t.getDuration(),t._addMediaListener("timeupdate",function(){t._eventEmitter.emit("player.timeupdate",t.getCurrentTime())}),t._addMediaListener("playing",function(){t._eventEmitter.emit("player.playing",t.getCurrentTime())}),t._addMediaListener("pause",function(){t._eventEmitter.emit("player.pause",t.getCurrentTime())}),t._addMediaListener("ended",function(){t._eventEmitter.emit("player.ended")}),t._addMediaListener("seeked",function(){t._eventEmitter.emit("player.seeked",t.getCurrentTime())}),t._addMediaListener("canplay",function(){t._eventEmitter.emit("player.canplay")}),t._addMediaListener("error",function(i){t._eventEmitter.emit("player.error",i.target.error)}),t._interval=null,Rs(t._mediaElement)){if(t._mediaElement.error&&t._mediaElement.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED)return Promise.reject(t._mediaElement.error)}else return Promise.resolve();return new Promise(function(i,n){function r(s){t._mediaElement.removeEventListener("loadedmetadata",r),t._mediaElement.removeEventListener("error",r),s.type==="loadedmetadata"?i():n(s.target.error)}t._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING?(t._mediaElement.addEventListener("loadedmetadata",r),t._mediaElement.addEventListener("error",r),t._mediaElement.load()):i()})};xt.prototype.destroy=function(){for(var e=0;e<this._listeners.length;e++){var t=this._listeners[e];this._mediaElement.removeEventListener(t.type,t.callback)}this._listeners.length=0,this._mediaElement=null};xt.prototype.play=function(){return this._mediaElement.play()};xt.prototype.pause=function(){this._mediaElement.pause()};xt.prototype.isPlaying=function(){return!this._mediaElement.paused};xt.prototype.isSeeking=function(){return this._mediaElement.seeking};xt.prototype.getCurrentTime=function(){return this._mediaElement.currentTime};xt.prototype.getDuration=function(){return this._mediaElement.duration};xt.prototype.seek=function(e){this._mediaElement.currentTime=e};function Ie(e,t){this._eventEmitter=e,this._mediaElement=t,this._playerCanPlayHandler=this._playerCanPlayHandler.bind(this),this._playerErrorHandler=this._playerErrorHandler.bind(this)}Ie.prototype.setSource=function(e,t){var i=this;return i._options=e,i._callback=t,i._eventEmitter.on("player.canplay",i._playerCanPlayHandler),i._eventEmitter.on("player.error",i._playerErrorHandler),new Promise(function(n,r){i._resolve=n,i._reject=r,i._eventEmitter.on("player.canplay",i._playerCanPlayHandler),i._eventEmitter.on("player.error",i._playerErrorHandler),i._mediaElement.setAttribute("src",e.mediaUrl),i._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING&&i._mediaElement.load()})};Ie.prototype._reset=function(){this._eventEmitter.removeListener("player.canplay",this._playerCanPlayHandler),this._eventEmitter.removeListener("player.error",this._playerErrorHandler)};Ie.prototype._playerCanPlayHandler=function(){this._reset(),this._resolve()};Ie.prototype._playerErrorHandler=function(e){this._reset(),this._reject(e)};xt.prototype.setSource=function(e){if(!e.mediaUrl)return Promise.reject(new Error("peaks.setSource(): options must contain a mediaUrl when using mediaElement"));var t=new Ie(this._eventEmitter,this._mediaElement);return t.setSource(e)};function Ws(e){for(var t=[],i=e;i;)Object.getOwnPropertyNames(i).forEach(function(n){t.push(n)}),i=Object.getPrototypeOf(i);return t}function Bs(e){var t=["init","destroy","play","pause","isPlaying","isSeeking","getCurrentTime","getDuration","seek"],i=Ws(e);t.forEach(function(n){if(!i.includes(n))throw new TypeError("Peaks.init(): Player method "+n+" is undefined");if(typeof e[n]!="function")throw new TypeError("Peaks.init(): Player method "+n+" is not a function")})}function bt(e,t){this._peaks=e,this._playingSegment=!1,this._segment=null,this._loop=!1,this._playSegmentTimerCallback=this._playSegmentTimerCallback.bind(this),Bs(t),this._adapter=t}bt.prototype.init=function(){return this._adapter.init(this._peaks)};bt.prototype.destroy=function(){this._adapter.destroy()};bt.prototype.play=function(){return this._adapter.play()};bt.prototype.pause=function(){this._adapter.pause()};bt.prototype.isPlaying=function(){return this._adapter.isPlaying()};bt.prototype.isSeeking=function(){return this._adapter.isSeeking()};bt.prototype.getCurrentTime=function(){return this._adapter.getCurrentTime()};bt.prototype.getDuration=function(){return this._adapter.getDuration()};bt.prototype.seek=function(e){if(!ie(e)){this._peaks._logger("peaks.player.seek(): parameter must be a valid time, in seconds");return}this._adapter.seek(e)};bt.prototype.playSegment=function(e,t){var i=this;return!e||!ie(e.startTime)||!ie(e.endTime)?Promise.reject(new Error("peaks.player.playSegment(): parameter must be a segment object")):(i._segment=e,i._loop=t,i.seek(e.startTime),i._peaks.once("player.playing",function(){i._playingSegment||(i._playingSegment=!0,window.requestAnimationFrame(i._playSegmentTimerCallback))}),i.play())};bt.prototype._playSegmentTimerCallback=function(){if(this.isPlaying()){if(this.getCurrentTime()>=this._segment.endTime)if(this._loop)this.seek(this._segment.startTime);else{this.pause(),this._peaks.emit("player.ended"),this._playingSegment=!1;return}}else{this._playingSegment=!1;return}window.requestAnimationFrame(this._playSegmentTimerCallback)};bt.prototype._setSource=function(e){return this._adapter.setSource(e)};function Me(e){this._options=e,this._draggable=e.editable}Me.prototype.init=function(e){var t=10,i=20,n=-5+.5;this._options.view==="zoomview"&&(this._label=new ee({x:2,y:0,text:this._options.point.labelText,textAlign:"left",fontFamily:this._options.fontFamily||"sans-serif",fontSize:this._options.fontSize||10,fontStyle:this._options.fontStyle||"normal",fill:"#000"})),this._handle=new ve({x:n,y:0,width:t,height:i,fill:this._options.color,visible:this._draggable}),this._line=new Qe({x:0,y:0,stroke:this._options.color,strokeWidth:1}),this._time=new ee({x:-24,y:0,text:this._options.layer.formatTime(this._options.point.time),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center"}),this._time.hide(),e.add(this._handle),e.add(this._line),this._label&&e.add(this._label),e.add(this._time),this.fitToView(),this.bindEventHandlers(e)};Me.prototype.bindEventHandlers=function(e){var t=this;t._handle.on("mouseover touchstart",function(){t._draggable&&(t._time.setX(-24-t._time.getWidth()),t._time.show())}),t._handle.on("mouseout touchend",function(){t._draggable&&t._time.hide()}),e.on("dragstart",function(){t._time.setX(-24-t._time.getWidth()),t._time.show()}),e.on("dragend",function(){t._time.hide()})};Me.prototype.fitToView=function(){var e=this._options.layer.getHeight();this._line.points([.5,0,.5,e]),this._label&&this._label.y(12),this._handle&&this._handle.y(e/2-10.5),this._time&&this._time.y(e/2-5)};Me.prototype.update=function(e){e.time!==void 0&&this._time&&this._time.setText(this._options.layer.formatTime(e.time)),e.labelText!==void 0&&this._label&&this._label.text(e.labelText),e.color!==void 0&&(this._handle&&this._handle.fill(e.color),this._line.stroke(e.color)),e.editable!==void 0&&(this._draggable=e.editable,this._handle.visible(this._draggable))};function Le(e){this._options=e,this._editable=e.editable}Le.prototype.init=function(e){var t=10,i=20,n=-5+.5,r=this._options.startMarker?-24:24,s=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new ee({x:r,y:0,text:this._options.layer.formatTime(s),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:this._editable}),this._label.hide(),this._handle=new ve({x:n,y:0,width:t,height:i,fill:this._options.color,stroke:this._options.color,strokeWidth:1,visible:this._editable}),this._line=new Qe({x:0,y:0,stroke:this._options.color,strokeWidth:1,visible:this._editable}),e.add(this._label),e.add(this._line),e.add(this._handle),this.fitToView(),this.bindEventHandlers(e)};Le.prototype.bindEventHandlers=function(e){var t=this,i=t._options.startMarker?-24:24;e.on("dragstart",function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show()}),e.on("dragend",function(){t._label.hide()}),t._handle.on("mouseover touchstart",function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show()}),t._handle.on("mouseout touchend",function(){t._label.hide()})};Le.prototype.fitToView=function(){var e=this._options.layer.getHeight();this._label.y(e/2-5),this._handle.y(e/2-10.5),this._line.points([.5,0,.5,e])};Le.prototype.update=function(e){e.startTime!==void 0&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(e.startTime)),e.endTime!==void 0&&!this._options.startMarker&&this._label.text(this._options.layer.formatTime(e.endTime)),e.editable!==void 0&&(this._editable=e.editable,this._label.visible(this._editable),this._handle.visible(this._editable),this._line.visible(this._editable))};function Hs(e){return e.view==="zoomview"?new Le(e):null}function Vs(e){return new ee({x:12,y:12,text:e.segment.labelText,textAlign:"center",fontFamily:e.fontFamily||"sans-serif",fontSize:e.fontSize||12,fontStyle:e.fontStyle||"normal",fill:"#000"})}function Us(e){return new Me(e)}function Jt(e,t){this._view=e,this._offset=t.highlightOffset,this._color=t.highlightColor,this._layer=new nt.Layer({listening:!1}),this._highlightRect=null,this._startTime=null,this._endTime=null,this._strokeColor=t.highlightStrokeColor,this._opacity=t.highlightOpacity,this._cornerRadius=t.highlightCornerRadius}Jt.prototype.addToStage=function(e){e.add(this._layer)};Jt.prototype.showHighlight=function(e,t){this._highlightRect||this._createHighlightRect(e,t),this._update(e,t)};Jt.prototype._update=function(e,t){this._startTime=e,this._endTime=t;var i=this._view.timeToPixels(e),n=this._view.timeToPixels(t);this._highlightRect.setAttrs({x:i,width:n-i})};Jt.prototype._createHighlightRect=function(e,t){this._startTime=e,this._endTime=t;var i=this._view.timeToPixels(e),n=this._view.timeToPixels(t);this._highlightRect=new ve({x:i,y:0,width:n-i,height:0,stroke:this._strokeColor,strokeWidth:1,fill:this._color,opacity:this._opacity,cornerRadius:this._cornerRadius}),this.fitToView(),this._layer.add(this._highlightRect)};Jt.prototype.removeHighlight=function(){this._highlightRect&&(this._highlightRect.destroy(),this._highlightRect=null)};Jt.prototype.updateHighlight=function(){this._highlightRect&&this._update(this._startTime,this._endTime)};Jt.prototype.fitToView=function(){if(this._highlightRect){var e=this._view.getHeight(),t=wt(this._offset,0,Math.floor(e/2));this._highlightRect.setAttrs({y:t,height:e-t*2})}};function Et(e){this._point=e.point,this._marker=e.marker,this._draggable=e.draggable,this._onDragStart=e.onDragStart,this._onDragMove=e.onDragMove,this._onDragEnd=e.onDragEnd,this._dragBoundFunc=e.dragBoundFunc,this._onMouseEnter=e.onMouseEnter,this._onMouseLeave=e.onMouseLeave,this._group=new nt.Group({name:"point-marker",point:this._point,draggable:this._draggable,dragBoundFunc:e.dragBoundFunc}),this._bindDefaultEventHandlers(),this._marker.init(this._group)}Et.prototype._bindDefaultEventHandlers=function(){var e=this;e._group.on("dragstart",function(t){e._onDragStart(t,e._point)}),e._group.on("dragmove",function(t){e._onDragMove(t,e._point)}),e._group.on("dragend",function(t){e._onDragEnd(t,e._point)}),e._group.on("mouseenter",function(t){e._onMouseEnter(t,e._point)}),e._group.on("mouseleave",function(t){e._onMouseLeave(t,e._point)})};Et.prototype.addToLayer=function(e){e.add(this._group)};Et.prototype.fitToView=function(){this._marker.fitToView()};Et.prototype.getPoint=function(){return this._point};Et.prototype.getX=function(){return this._group.getX()};Et.prototype.setX=function(e){this._group.setX(e)};Et.prototype.getWidth=function(){return this._group.getWidth()};Et.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()};Et.prototype.update=function(e){e.editable!==void 0&&this._group.draggable(e.editable),this._marker.update&&this._marker.update(e)};Et.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()};var Ns="sans-serif",Xs=10,zs="normal";function X(e,t,i){this._peaks=e,this._view=t,this._allowEditing=i,this._pointMarkers={},this._layer=new nt.Layer,this._onPointsDrag=this._onPointsDrag.bind(this),this._onPointMarkerDragStart=this._onPointMarkerDragStart.bind(this),this._onPointMarkerDragMove=this._onPointMarkerDragMove.bind(this),this._onPointMarkerDragEnd=this._onPointMarkerDragEnd.bind(this),this._pointMarkerDragBoundFunc=this._pointMarkerDragBoundFunc.bind(this),this._onPointMarkerMouseEnter=this._onPointMarkerMouseEnter.bind(this),this._onPointMarkerMouseLeave=this._onPointMarkerMouseLeave.bind(this),this._onPointsUpdate=this._onPointsUpdate.bind(this),this._onPointsAdd=this._onPointsAdd.bind(this),this._onPointsRemove=this._onPointsRemove.bind(this),this._onPointsRemoveAll=this._onPointsRemoveAll.bind(this),this._peaks.on("points.update",this._onPointsUpdate),this._peaks.on("points.add",this._onPointsAdd),this._peaks.on("points.remove",this._onPointsRemove),this._peaks.on("points.remove_all",this._onPointsRemoveAll),this._peaks.on("points.dragstart",this._onPointsDrag),this._peaks.on("points.dragmove",this._onPointsDrag),this._peaks.on("points.dragend",this._onPointsDrag)}X.prototype.addToStage=function(e){e.add(this._layer)};X.prototype.enableEditing=function(e){this._allowEditing=e};X.prototype.getPointMarker=function(e){return this._pointMarkers[e.pid]};X.prototype.formatTime=function(e){return this._view.formatTime(e)};X.prototype._onPointsUpdate=function(e,t){var i=this._view.getStartTime(),n=this._view.getEndTime(),r=this.getPointMarker(e),s=e.isVisible(i,n);if(r&&!s)this._removePoint(e);else if(!r&&s)this._updatePoint(e);else if(r&&s){if(M(t,"time")){var a=this._view.timeToPixels(e.time),o=a-this._view.getFrameOffset();r.setX(o)}r.update(t)}};X.prototype._onPointsAdd=function(e){var t=this,i=t._view.getStartTime(),n=t._view.getEndTime();e.points.forEach(function(r){r.isVisible(i,n)&&t._updatePoint(r)})};X.prototype._onPointsRemove=function(e){var t=this;e.points.forEach(function(i){t._removePoint(i)})};X.prototype._onPointsRemoveAll=function(){this._layer.removeChildren(),this._pointMarkers={}};X.prototype._createPointMarker=function(e){var t=this._allowEditing&&e.editable,i=this._peaks.options.createPointMarker({point:e,editable:t,color:e.color,fontFamily:this._peaks.options.fontFamily||Ns,fontSize:this._peaks.options.fontSize||Xs,fontStyle:this._peaks.options.fontStyle||zs,layer:this,view:this._view.getName()});return new Et({point:e,draggable:t,marker:i,onDragStart:this._onPointMarkerDragStart,onDragMove:this._onPointMarkerDragMove,onDragEnd:this._onPointMarkerDragEnd,dragBoundFunc:this._pointMarkerDragBoundFunc,onMouseEnter:this._onPointMarkerMouseEnter,onMouseLeave:this._onPointMarkerMouseLeave})};X.prototype.getHeight=function(){return this._view.getHeight()};X.prototype._addPointMarker=function(e){var t=this._createPointMarker(e);return this._pointMarkers[e.pid]=t,t.addToLayer(this._layer),t};X.prototype._onPointsDrag=function(e){var t=this._updatePoint(e.point);t.update({time:e.point.time})};X.prototype._onPointMarkerMouseEnter=function(e,t){this._peaks.emit("points.mouseenter",{point:t,evt:e.evt})};X.prototype._onPointMarkerMouseLeave=function(e,t){this._peaks.emit("points.mouseleave",{point:t,evt:e.evt})};X.prototype._onPointMarkerDragStart=function(e,t){this._dragPointMarker=this.getPointMarker(t),this._peaks.emit("points.dragstart",{point:t,evt:e.evt})};X.prototype._onPointMarkerDragMove=function(e,t){var i=this._pointMarkers[t.pid],n=i.getX(),r=n+i.getWidth();t._setTime(this._view.pixelOffsetToTime(r)),this._peaks.emit("points.dragmove",{point:t,evt:e.evt})};X.prototype._onPointMarkerDragEnd=function(e,t){this._dragPointMarker=null,this._peaks.emit("points.dragend",{point:t,evt:e.evt})};X.prototype._pointMarkerDragBoundFunc=function(e){return{x:wt(e.x,0,this._view.getWidth()),y:this._dragPointMarker.getAbsolutePosition().y}};X.prototype.updatePoints=function(e,t){var i=this._peaks.points.find(e,t);i.forEach(this._updatePoint.bind(this)),this._removeInvisiblePoints(e,t)};X.prototype._updatePoint=function(e){var t=this.getPointMarker(e);t||(t=this._addPointMarker(e));var i=this._view.timeToPixels(e.time),n=i-this._view.getFrameOffset();return t.setX(n),t};X.prototype._removeInvisiblePoints=function(e,t){for(var i in this._pointMarkers)if(M(this._pointMarkers,i)){var n=this._pointMarkers[i].getPoint();n.isVisible(e,t)||this._removePoint(n)}};X.prototype._removePoint=function(e){var t=this.getPointMarker(e);t&&(t.destroy(),delete this._pointMarkers[e.pid])};X.prototype.setVisible=function(e){this._layer.setVisible(e)};X.prototype.destroy=function(){this._peaks.off("points.update",this._onPointsUpdate),this._peaks.off("points.add",this._onPointsAdd),this._peaks.off("points.remove",this._onPointsRemove),this._peaks.off("points.remove_all",this._onPointsRemoveAll),this._peaks.off("points.dragstart",this._onPointsDrag),this._peaks.off("points.dragmove",this._onPointsDrag),this._peaks.off("points.dragend",this._onPointsDrag)};X.prototype.fitToView=function(){for(var e in this._pointMarkers)if(M(this._pointMarkers,e)){var t=this._pointMarkers[e];t.fitToView()}};X.prototype.draw=function(){this._layer.draw()};function mt(e,t,i){this._player=e,this._view=t,this._playheadPixel=0,this._playheadLineAnimation=null,this._playheadVisible=!1,this._playheadColor=i.playheadColor,this._playheadTextColor=i.playheadTextColor,this._playheadBackgroundColor=i.playheadBackgroundColor,this._playheadPadding=i.playheadPadding,this._playheadWidth=i.playheadWidth,this._playheadFontFamily=i.playheadFontFamily,this._playheadFontSize=i.playheadFontSize,this._playheadFontStyle=i.playheadFontStyle,this._playheadLayer=new nt.Layer,this._createPlayhead(),i.showPlayheadTime&&this._createPlayheadText(),this.fitToView(),this.zoomLevelChanged()}mt.prototype.addToStage=function(e){e.add(this._playheadLayer)};mt.prototype.zoomLevelChanged=function(){var e=this._view.timeToPixels(1);if(this._useAnimation=e>=5,this._useAnimation)this._player.isPlaying()&&!this._playheadLineAnimation&&this._start();else if(this._playheadLineAnimation){var t=this._player.getCurrentTime();this.stop(t)}};mt.prototype.fitToView=function(){var e=this._view.getHeight();this._playheadLine.points([.5,0,.5,e]),this._playheadText&&this._playheadText.y(12)};mt.prototype._createPlayhead=function(){this._playheadLine=new Qe({stroke:this._playheadColor,strokeWidth:this._playheadWidth}),this._playheadGroup=new nt.Group({x:0,y:0}),this._playheadGroup.add(this._playheadLine),this._playheadLayer.add(this._playheadGroup)};mt.prototype._createPlayheadText=function(){var e=this,t=e._player.getCurrentTime(),i=e._view.formatTime(t);e._playheadText=new ee({x:0,y:0,padding:e._playheadPadding,text:i,fontSize:e._playheadFontSize,fontFamily:e._playheadFontFamily,fontStyle:e._playheadFontStyle,fill:e._playheadTextColor,align:"right",sceneFunc:function(r,s){var a=s.width(),o=s.height()+2*e._playheadPadding;r.fillStyle=e._playheadBackgroundColor,r.fillRect(0,-e._playheadPadding,a,o),s._sceneFunc(r)}}),e._playheadGroup.add(e._playheadText)};mt.prototype.updatePlayheadTime=function(e){this._syncPlayhead(e),this._player.isPlaying()&&this._start()};mt.prototype._syncPlayhead=function(e){var t=this._view.timeToPixels(e),i=this._view.getFrameOffset(),n=this._view.getWidth(),r=t>=i&&t<=i+n;if(this._playheadPixel=t,r){var s=this._playheadPixel-i;if(this._playheadVisible||(this._playheadVisible=!0,this._playheadGroup.show()),this._playheadGroup.setX(s),this._playheadText){var a=this._view.formatTime(e),o=this._playheadText.width();this._playheadText.setText(a),o+s>n-2?this._playheadText.setX(-o):o+s<n&&this._playheadText.setX(0)}}else this._playheadVisible&&(this._playheadVisible=!1,this._playheadGroup.hide());this._view.playheadPosChanged&&this._view.playheadPosChanged(e)};mt.prototype._start=function(){var e=this;if(e._playheadLineAnimation&&(e._playheadLineAnimation.stop(),e._playheadLineAnimation=null),!!e._useAnimation){var t=null;e._playheadLineAnimation=new ln(function(){var i=e._player.getCurrentTime(),n=e._view.timeToPixels(i);n!==t&&(e._syncPlayhead(i),t=n)},e._playheadLayer),e._playheadLineAnimation.start()}};mt.prototype.stop=function(e){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null),this._syncPlayhead(e)};mt.prototype.getPlayheadPixel=function(){return this._playheadPixel};mt.prototype.showPlayheadTime=function(e){e?this._playheadText||(this._createPlayheadText(this._playheadTextColor,this._playheadBackgroundColor,this._playheadPadding),this.fitToView()):this._playheadText&&(this._playheadText.remove(),this._playheadText.destroy(),this._playheadText=null)};mt.prototype.updatePlayheadText=function(){if(this._playheadText){var e=this._player.getCurrentTime(),t=this._view.formatTime(e);this._playheadText.setText(t)}};mt.prototype.destroy=function(){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null)};function Oe(e){this._options=e}Oe.prototype.init=function(e){var t=10,i=20,n=-5+.5,r=this._options.startMarker?-24:24,s=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new ee({x:r,y:0,text:this._options.layer.formatTime(s),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:!1}),this._handle=new ve({x:n,y:0,width:t,height:i}),e.add(this._label),e.add(this._handle),this.fitToView(),this.bindEventHandlers(e)};Oe.prototype.bindEventHandlers=function(e){var t=this,i=t._options.startMarker?-24:24;e.on("dragstart",function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show()}),e.on("dragend",function(){t._label.hide()}),t._handle.on("mouseover touchstart",function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show(),document.body.style.cursor="ew-resize"}),t._handle.on("mouseout touchend",function(){t._label.hide(),document.body.style.cursor="default"})};Oe.prototype.fitToView=function(){var e=this._options.layer.getHeight(),t=this._options.segmentOptions.overlayOffset,i=wt(0,e-2*t);this._label.y(e/2-5),this._handle.y(t),this._handle.height(i)};Oe.prototype.update=function(e){e.startTime!==void 0&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(e.startTime)),e.endTime!==void 0&&!this._options.startMarker&&this._label.text(this._options.layer.formatTime(e.endTime))};function ct(e){var t=this;t._segment=e.segment,t._marker=e.marker,t._segmentShape=e.segmentShape,t._editable=e.editable,t._startMarker=e.startMarker,t._onDragStart=e.onDragStart,t._onDragMove=e.onDragMove,t._onDragEnd=e.onDragEnd,t._group=new nt.Group({name:"segment-marker",segment:t._segment,draggable:t._editable,visible:t._editable,dragBoundFunc:function(n){return e.dragBoundFunc(t,n)}}),t._bindDefaultEventHandlers(),t._marker.init(t._group)}ct.prototype._bindDefaultEventHandlers=function(){var e=this;e._group.on("dragstart",function(t){e._onDragStart(e,t)}),e._group.on("dragmove",function(t){e._onDragMove(e,t)}),e._group.on("dragend",function(t){e._onDragEnd(e,t)})};ct.prototype.addToLayer=function(e){e.add(this._group)};ct.prototype.moveToTop=function(){this._group.moveToTop()};ct.prototype.fitToView=function(){this._marker.fitToView()};ct.prototype.getSegment=function(){return this._segment};ct.prototype.getX=function(){return this._group.getX()};ct.prototype.setX=function(e){this._group.setX(e)};ct.prototype.getWidth=function(){return this._group.getWidth()};ct.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()};ct.prototype.isStartMarker=function(){return this._startMarker};ct.prototype.update=function(e){e.editable!==void 0&&(this._group.visible(e.editable),this._group.draggable(e.editable)),this._marker.update&&this._marker.update(e)};ct.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()};ct.prototype.startDrag=function(){this._group.startDrag()};ct.prototype.stopDrag=function(){this._group.stopDrag()};function ht(e){this._color=e.color;var t={};if(te(e.color))t.fill=e.color;else if(ri(e.color)){var i=e.view._height*(e.color.linearGradientStart/100),n=e.view._height*(e.color.linearGradientEnd/100);t.fillLinearGradientStartPointY=i,t.fillLinearGradientEndPointY=n,t.fillLinearGradientColorStops=[0,e.color.linearGradientColorStops[0],1,e.color.linearGradientColorStops[1]]}else throw new TypeError("Unknown type for color property");this._shape=new nt.Shape(t),this._view=e.view,this._segment=e.segment,this._shape.sceneFunc(this._sceneFunc.bind(this))}ht.prototype.getX=function(){return this._shape.getX()};ht.prototype.setX=function(e){return this._shape.setX(e)};ht.prototype.setSegment=function(e){this._segment=e};ht.prototype.setWaveformColor=function(e){if(te(e))this._shape.fill(e),this._shape.fillLinearGradientStartPointY(null),this._shape.fillLinearGradientEndPointY(null),this._shape.fillLinearGradientColorStops(null);else if(ri(e)){this._shape.fill(null);var t=this._view._height*(e.linearGradientStart/100),i=this._view._height*(e.linearGradientEnd/100);this._shape.fillLinearGradientStartPointY(t),this._shape.fillLinearGradientEndPointY(i),this._shape.fillLinearGradientColorStops([0,e.linearGradientColorStops[0],1,e.linearGradientColorStops[1]])}else throw new TypeError("Unknown type for color property")};ht.prototype.fitToView=function(){this.setWaveformColor(this._color)};ht.prototype._sceneFunc=function(e){var t=this._view.getFrameOffset(),i=this._view.getWidth(),n=this._view.getHeight();this._drawWaveform(e,this._view.getWaveformData(),t,this._segment?this._view.timeToPixels(this._segment.startTime):t,this._segment?this._view.timeToPixels(this._segment.endTime):t+i,i,n)};ht.prototype._drawWaveform=function(e,t,i,n,r,s,a){n<i&&(n=i);var o=i+s;r>o&&(r=o),r>t.length-1&&(r=t.length-1);for(var l=t.channels,d=0,c=Math.floor(a/l),w=0;w<l;w++)w===l-1&&(c=a-(l-1)*c),this._drawChannel(e,t.channel(w),i,n,r,d,c),d+=c};ht.prototype._drawChannel=function(e,t,i,n,r,s,a){var o,l,d=this._view.getAmplitudeScale(),c,w;for(e.beginPath(),o=n;o<=r;o++)l=t.min_sample(o),c=o-i+.5,w=s+ht.scaleY(l,a,d)+.5,e.lineTo(c,w);for(o=r;o>=n;o--)l=t.max_sample(o),c=o-i+.5,w=s+ht.scaleY(l,a,d)+1,e.lineTo(c,w);e.closePath(),e.fillShape(this._shape)};ht.prototype.addToLayer=function(e){e.add(this._shape)};ht.prototype.destroy=function(){this._shape.destroy(),this._shape=null};ht.prototype.on=function(e,t){this._shape.on(e,t)};ht.prototype.off=function(e,t){this._shape.off(e,t)};ht.scaleY=function(e,t,i){var n=-(t-1)*(e*i+128)/255+(t-1);return wt(Math.floor(n),0,t-1)};var Ki="sans-serif",ji=10,Ji="normal";function V(e,t,i,n){this._segment=e,this._peaks=t,this._layer=i,this._view=n,this._label=null,this._startMarker=null,this._endMarker=null,this._color=e.color,this._borderColor=e.borderColor,this._draggable=this._segment.editable&&this._view.isSegmentDraggingEnabled(),this._dragging=!1;var r=n.getViewOptions().segmentOptions;this._overlayOffset=r.overlayOffset,r.overlay||(this._waveformShape=new ht({color:e.color,view:n,segment:e})),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onSegmentDragStart=this._onSegmentDragStart.bind(this),this._onSegmentDragMove=this._onSegmentDragMove.bind(this),this._onSegmentDragEnd=this._onSegmentDragEnd.bind(this),this._onSegmentMarkerDragStart=this._onSegmentMarkerDragStart.bind(this),this._onSegmentMarkerDragMove=this._onSegmentMarkerDragMove.bind(this),this._onSegmentMarkerDragEnd=this._onSegmentMarkerDragEnd.bind(this),this._segmentMarkerDragBoundFunc=this._segmentMarkerDragBoundFunc.bind(this),this._label=this._peaks.options.createSegmentLabel({segment:e,view:this._view.getName(),layer:this._layer,fontFamily:this._peaks.options.fontFamily,fontSize:this._peaks.options.fontSize,fontStyle:this._peaks.options.fontStyle}),this._label&&this._label.hide();var s=this._view.timeToPixelOffset(this._segment.startTime),a=this._view.timeToPixelOffset(this._segment.endTime),o=wt(0,this._view.getHeight()-2*this._overlayOffset);this._overlay=new nt.Group({name:"segment-overlay",segment:this._segment,x:s,y:0,width:a-s,height:this._view.getHeight(),clipX:0,clipY:this._overlayOffset,clipWidth:a-s,clipHeight:o,draggable:this._draggable,dragBoundFunc:this._dragBoundFunc});var l,d,c,w,T;r.overlay&&(l=this._borderColor||r.overlayBorderColor,d=r.overlayBorderWidth,c=this._color||r.overlayColor,w=r.overlayOpacity,T=r.overlayCornerRadius),this._overlayRect=new nt.Rect({x:0,y:this._overlayOffset,width:a-s,stroke:l,strokeWidth:d,height:o,fill:c,opacity:w,cornerRadius:T}),this._overlay.add(this._overlayRect),r.overlay&&(this._overlayText=new nt.Text({x:0,y:this._overlayOffset,text:this._segment.labelText,fontFamily:r.overlayFontFamily,fontSize:r.overlayFontSize,fontStyle:r.overlayFontStyle,fill:r.overlayLabelColor,listening:!1,align:r.overlayLabelAlign,width:a-s,verticalAlign:r.overlayLabelVerticalAlign,height:o,padding:r.overlayLabelPadding}),this._overlay.add(this._overlayText)),this._overlay.on("mouseenter",this._onMouseEnter),this._overlay.on("mouseleave",this._onMouseLeave),this._overlay.on("mousedown",this._onMouseDown),this._overlay.on("mouseup",this._onMouseUp),this._draggable&&(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)),this._createMarkers()}function Ys(e){return new Oe(e)}V.prototype._createMarkers=function(){var e=this._layer.isEditingEnabled()&&this._segment.editable,t=this._view.getViewOptions().segmentOptions,i=t.markers?this._peaks.options.createSegmentMarker:Ys,n=i({segment:this._segment,editable:e,startMarker:!0,color:t.startMarkerColor,fontFamily:this._peaks.options.fontFamily||Ki,fontSize:this._peaks.options.fontSize||ji,fontStyle:this._peaks.options.fontStyle||Ji,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions});n&&(this._startMarker=new ct({segment:this._segment,segmentShape:this,editable:e,startMarker:!0,marker:n,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc}));var r=i({segment:this._segment,editable:e,startMarker:!1,color:t.endMarkerColor,fontFamily:this._peaks.options.fontFamily||Ki,fontSize:this._peaks.options.fontSize||ji,fontStyle:this._peaks.options.fontStyle||Ji,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions});r&&(this._endMarker=new ct({segment:this._segment,segmentShape:this,editable:e,startMarker:!1,marker:r,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc}))};V.prototype._dragBoundFunc=function(e){return{x:e.x,y:0}};V.prototype.update=function(e){var t=this._view.timeToPixelOffset(this._segment.startTime),i=this._view.timeToPixelOffset(this._segment.endTime),n=i-t,r;(r=this.getStartMarker())&&(r.setX(t-r.getWidth()),e&&r.update(e)),(r=this.getEndMarker())&&(r.setX(i),e&&r.update(e)),this._color=this._segment.color,this._borderColor=this._segment.bordercolor,this._overlayText&&this._overlayText.text(this._segment.labelText);var s=this._view.getViewOptions().segmentOptions;s.overlay?(this._color&&this._overlayRect.fill(this._color),this._borderColor&&this._overlayRect.stroke(this._borderColor)):this._waveformShape.setWaveformColor(this._segment.color),this._dragging||this._overlay&&(this._overlay.setAttrs({x:t,width:n,clipWidth:n<1?1:n}),this._overlayRect.setAttrs({x:0,width:n}),this._overlayText&&this._overlayText.setAttrs({width:n}))};V.prototype.getSegment=function(){return this._segment};V.prototype.getStartMarker=function(){return this._startMarker};V.prototype.getEndMarker=function(){return this._endMarker};V.prototype.addToLayer=function(e){this._waveformShape&&this._waveformShape.addToLayer(e),this._label&&e.add(this._label),this._overlay&&e.add(this._overlay),this._startMarker&&this._startMarker.addToLayer(e),this._endMarker&&this._endMarker.addToLayer(e)};V.prototype.isDragging=function(){return this._dragging};V.prototype._onMouseEnter=function(e){this._label&&(this._label.moveToTop(),this._label.show()),this._peaks.emit("segments.mouseenter",{segment:this._segment,evt:e.evt})};V.prototype._onMouseLeave=function(e){this._label&&this._label.hide(),this._peaks.emit("segments.mouseleave",{segment:this._segment,evt:e.evt})};V.prototype._onMouseDown=function(e){this._peaks.emit("segments.mousedown",{segment:this._segment,evt:e.evt})};V.prototype._onMouseUp=function(e){this._peaks.emit("segments.mouseup",{segment:this._segment,evt:e.evt})};V.prototype.segmentClicked=function(e,t){this._moveToTop(),this._peaks.emit("segments."+e,t)};V.prototype._moveToTop=function(){this._overlay.moveToTop(),this._layer.moveSegmentMarkersToTop()};V.prototype.enableSegmentDragging=function(e){this._segment.editable&&(!this._draggable&&e?(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)):this._draggable&&!e&&(this._overlay.off("dragstart",this._onSegmentDragStart),this._overlay.off("dragmove",this._onSegmentDragMove),this._overlay.off("dragend",this._onSegmentDragEnd)),this._overlay.draggable(e),this._draggable=e)};V.prototype._setPreviousAndNextSegments=function(){this._view.getSegmentDragMode()!=="overlap"?(this._nextSegment=this._peaks.segments.findNextSegment(this._segment),this._previousSegment=this._peaks.segments.findPreviousSegment(this._segment)):(this._nextSegment=null,this._previousSegment=null)};V.prototype._onSegmentDragStart=function(e){this._setPreviousAndNextSegments(),this._dragging=!0,this._dragStartX=this._overlay.getX(),this._dragStartTime=this._segment.startTime,this._dragEndTime=this._segment.endTime,this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!1,startMarker:!1,evt:e.evt})};V.prototype._onSegmentDragMove=function(e){var t=this._overlay.getX(),i=t-this._dragStartX,n=this._view.pixelsToTime(i),r=this._dragStartTime+n,s=this._dragEndTime+n,a=this._segment.endTime-this._segment.startTime,o,l=this._view.getMinSegmentDragWidth(),d=this._view.pixelsToTime(l),c=!1,w=!1;if(r<0&&(r=0,s=a,this._overlay.setX(this._view.timeToPixelOffset(r))),this._previousSegment){var T=this._view.timeToPixelOffset(this._previousSegment.endTime);if(r<this._previousSegment.endTime){if(o=this._view.getSegmentDragMode(),o==="no-overlap"||o==="compress"&&!this._previousSegment.editable)r=this._previousSegment.endTime,s=r+a,this._overlay.setX(T);else if(o==="compress"){var g=r,f=this._previousSegment.startTime+d;g<f&&(g=f,T=this._view.timeToPixelOffset(g),this._overlay.setX(T),r=g,s=r+a),this._previousSegment.update({endTime:g}),c=!0}}}if(this._nextSegment){var v=this._view.timeToPixelOffset(this._nextSegment.startTime);if(s>this._nextSegment.startTime){if(o=this._view.getSegmentDragMode(),o==="no-overlap"||o==="compress"&&!this._nextSegment.editable)s=this._nextSegment.startTime,r=s-a,this._overlay.setX(v-this._overlay.getWidth());else if(o==="compress"){var _=s,C=this._nextSegment.endTime-d;_>C&&(_=C,v=this._view.timeToPixelOffset(_),this._overlay.setX(v-this._overlay.getWidth()),s=_,r=s-a),this._nextSegment.update({startTime:_}),w=!0}}}this._segment._setStartTime(r),this._segment._setEndTime(s),this._peaks.emit("segments.dragged",{segment:this._segment,marker:!1,startMarker:!1,evt:e.evt}),c?this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!1,startMarker:!1,evt:e.evt}):w&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!1,startMarker:!1,evt:e.evt})};V.prototype._onSegmentDragEnd=function(e){this._dragging=!1,this._peaks.emit("segments.dragend",{segment:this._segment,marker:!1,startMarker:!1,evt:e.evt})};V.prototype.moveMarkersToTop=function(){this._startMarker&&this._startMarker.moveToTop(),this._endMarker&&this._endMarker.moveToTop()};V.prototype.startDrag=function(){this._endMarker&&this._endMarker.startDrag()};V.prototype.stopDrag=function(){this._endMarker&&this._endMarker.stopDrag()};V.prototype._onSegmentMarkerDragStart=function(e,t){this._setPreviousAndNextSegments(),this._moveToTop(),this._startMarkerX=this._startMarker.getX(),this._endMarkerX=this._endMarker.getX(),this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!0,startMarker:e.isStartMarker(),evt:t.evt})};V.prototype._onSegmentMarkerDragMove=function(e,t){e.isStartMarker()?(this._segmentStartMarkerDragMove(e,t),e.update({startTime:this._segment.startTime})):(this._segmentEndMarkerDragMove(e,t),e.update({endTime:this._segment.endTime}))};function In(e){return e.endTime-e.startTime}V.prototype._segmentStartMarkerDragMove=function(e,t){var i=this._view.getWidth(),n=this._startMarker.getX(),r=this._endMarker.getX(),s=this._view.pixelsToTime(50),a=this._view.getMinSegmentDragWidth(),o=this._endMarker.getX()-a;o>i&&(o=i);var l=!1,d=!1,c;if(this._previousSegment&&(c=this._view.timeToPixelOffset(this._previousSegment.endTime),l=c>=0),n>o)e.setX(o),this._overlay.clipWidth(o-r),a===0&&o<i?this._segment._setStartTime(this._segment.endTime):this._segment._setStartTime(this._view.pixelOffsetToTime(o));else if(this._previousSegment&&l){var w=this._view.getSegmentDragMode(),T=w==="no-overlap"||w==="compress"&&!this._previousSegment.editable,g=w==="compress"&&this._previousSegment.editable;if(n<=c){if(T)e.setX(c),this._overlay.clipWidth(c-r),this._segment._setStartTime(this._previousSegment.endTime);else if(g){var f=In(this._previousSegment);f<s&&(s=f);var v=this._view.timeToPixelOffset(this._previousSegment.startTime+s);n<v&&(n=v),e.setX(n),this._overlay.clipWidth(r-n),this._segment._setStartTime(this._view.pixelOffsetToTime(n)),this._previousSegment.update({endTime:this._view.pixelOffsetToTime(n)}),d=!0}}else n<0&&(n=0),e.setX(n),this._overlay.clipWidth(r-n),this._segment._setStartTime(this._view.pixelOffsetToTime(n))}else n<0&&(n=0),e.setX(n),this._overlay.clipWidth(r-n),this._segment._setStartTime(this._view.pixelOffsetToTime(n));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!0,evt:t.evt}),d&&this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!0,startMarker:!1,evt:t.evt})};V.prototype._segmentEndMarkerDragMove=function(e,t){var i=this._view.getWidth(),n=this._startMarker.getX(),r=this._endMarker.getX(),s=this._view.pixelsToTime(50),a=this._view.getMinSegmentDragWidth(),o=this._startMarker.getX()+a;o<0&&(o=0);var l=!1,d=!1,c;if(this._nextSegment&&(c=this._view.timeToPixelOffset(this._nextSegment.startTime),l=c<i),r<o)e.setX(o),this._overlay.clipWidth(o-n),a===0&&o>0?this._segment._setEndTime(this._segment.startTime):this._segment._setEndTime(this._view.pixelOffsetToTime(o));else if(this._nextSegment&&l){var w=this._view.getSegmentDragMode(),T=w==="no-overlap"||w==="compress"&&!this._nextSegment.editable,g=w==="compress"&&this._nextSegment.editable;if(r>=c){if(T)e.setX(c),this._overlay.clipWidth(c-n),this._segment._setEndTime(this._nextSegment.startTime);else if(g){var f=In(this._nextSegment);f<s&&(s=f);var v=this._view.timeToPixelOffset(this._nextSegment.endTime-s);r>v&&(r=v),e.setX(r),this._overlay.clipWidth(r-n),this._segment._setEndTime(this._view.pixelOffsetToTime(r)),this._nextSegment.update({startTime:this._view.pixelOffsetToTime(r)}),d=!0}}else r>i&&(r=i),e.setX(r),this._overlay.clipWidth(r-n),this._segment._setEndTime(this._view.pixelOffsetToTime(r))}else r>i&&(r=i),e.setX(r),this._overlay.clipWidth(r-n),this._segment._setEndTime(this._view.pixelOffsetToTime(r));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!1,evt:t.evt}),d&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!0,startMarker:!0,evt:t.evt})};V.prototype._onSegmentMarkerDragEnd=function(e,t){this._nextSegment=null,this._previousSegment=null;var i=e.isStartMarker();this._peaks.emit("segments.dragend",{segment:this._segment,marker:!0,startMarker:i,evt:t.evt})};V.prototype._segmentMarkerDragBoundFunc=function(e,t){return{x:t.x,y:e.getAbsolutePosition().y}};V.prototype.fitToView=function(){if(this._startMarker&&this._startMarker.fitToView(),this._endMarker&&this._endMarker.fitToView(),this._overlay){var e=this._view.getHeight(),t=wt(0,e-this._overlayOffset*2);this._overlay.setAttrs({y:0,height:e,clipY:this._overlayOffset,clipHeight:t}),this._overlayRect.setAttrs({y:this._overlayOffset,height:t}),this._overlayText&&this._overlayText.setAttrs({y:this._overlayOffset,height:t})}};V.prototype.destroy=function(){this._waveformShape&&this._waveformShape.destroy(),this._label&&this._label.destroy(),this._startMarker&&this._startMarker.destroy(),this._endMarker&&this._endMarker.destroy(),this._overlay&&this._overlay.destroy()};function K(e,t,i){this._peaks=e,this._view=t,this._allowEditing=i,this._segmentShapes={},this._layer=new nt.Layer,this._onSegmentsUpdate=this._onSegmentsUpdate.bind(this),this._onSegmentsAdd=this._onSegmentsAdd.bind(this),this._onSegmentsRemove=this._onSegmentsRemove.bind(this),this._onSegmentsRemoveAll=this._onSegmentsRemoveAll.bind(this),this._onSegmentsDragged=this._onSegmentsDragged.bind(this),this._peaks.on("segments.update",this._onSegmentsUpdate),this._peaks.on("segments.add",this._onSegmentsAdd),this._peaks.on("segments.remove",this._onSegmentsRemove),this._peaks.on("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.on("segments.dragged",this._onSegmentsDragged)}K.prototype.addToStage=function(e){e.add(this._layer)};K.prototype.enableEditing=function(e){this._allowEditing=e};K.prototype.isEditingEnabled=function(){return this._allowEditing};K.prototype.enableSegmentDragging=function(e){for(var t in this._segmentShapes)M(this._segmentShapes,t)&&this._segmentShapes[t].enableSegmentDragging(e)};K.prototype.getSegmentShape=function(e){return this._segmentShapes[e.pid]};K.prototype.formatTime=function(e){return this._view.formatTime(e)};K.prototype._onSegmentsUpdate=function(e,t){var i=this._view.getStartTime(),n=this._view.getEndTime(),r=this.getSegmentShape(e),s=e.isVisible(i,n);r&&!s?r.isDragging()||this._removeSegment(e):!r&&s?r=this._updateSegment(e):r&&s&&r.update(t)};K.prototype._onSegmentsAdd=function(e){var t=this,i=t._view.getStartTime(),n=t._view.getEndTime();e.segments.forEach(function(r){if(r.isVisible(i,n)){var s=t._addSegmentShape(r);s.update()}}),this.moveSegmentMarkersToTop()};K.prototype._onSegmentsRemove=function(e){var t=this;e.segments.forEach(function(i){t._removeSegment(i)})};K.prototype._onSegmentsRemoveAll=function(){this._layer.removeChildren(),this._segmentShapes={}};K.prototype._onSegmentsDragged=function(e){this._updateSegment(e.segment)};K.prototype._createSegmentShape=function(e){return new V(e,this._peaks,this,this._view)};K.prototype._addSegmentShape=function(e){var t=this._createSegmentShape(e);return t.addToLayer(this._layer),this._segmentShapes[e.pid]=t,t};K.prototype.updateSegments=function(e,t){var i=this._peaks.segments.find(e,t);i.forEach(this._updateSegment.bind(this)),this._removeInvisibleSegments(e,t)};K.prototype._updateSegment=function(e){var t=this.getSegmentShape(e);t||(t=this._addSegmentShape(e)),t.update()};K.prototype._removeInvisibleSegments=function(e,t){for(var i in this._segmentShapes)if(M(this._segmentShapes,i)){var n=this._segmentShapes[i].getSegment();n.isVisible(e,t)||this._removeSegment(n)}};K.prototype._removeSegment=function(e){var t=this._segmentShapes[e.pid];t&&(t.destroy(),delete this._segmentShapes[e.pid])};K.prototype.moveSegmentMarkersToTop=function(){for(var e in this._segmentShapes)M(this._segmentShapes,e)&&this._segmentShapes[e].moveMarkersToTop()};K.prototype.setVisible=function(e){this._layer.setVisible(e)};K.prototype.segmentClicked=function(e,t){var i=this._segmentShapes[t.segment.pid];i&&i.segmentClicked(e,t)};K.prototype.destroy=function(){this._peaks.off("segments.update",this._onSegmentsUpdate),this._peaks.off("segments.add",this._onSegmentsAdd),this._peaks.off("segments.remove",this._onSegmentsRemove),this._peaks.off("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.off("segments.dragged",this._onSegmentsDragged)};K.prototype.fitToView=function(){for(var e in this._segmentShapes)if(M(this._segmentShapes,e)){var t=this._segmentShapes[e];t.fitToView()}};K.prototype.draw=function(){this._layer.draw()};K.prototype.getHeight=function(){return this._layer.getHeight()};function he(e,t){var i=this;i._axisGridlineColor=t.axisGridlineColor,i._axisLabelColor=t.axisLabelColor,i._showAxisLabels=t.showAxisLabels,i._axisTopMarkerHeight=t.axisTopMarkerHeight,i._axisBottomMarkerHeight=t.axisBottomMarkerHeight,t.formatAxisTime?i._formatAxisTime=t.formatAxisTime:i._formatAxisTime=function(n){return yn(n,0)},i._axisLabelFont=he._buildFontString(t.fontFamily,t.fontSize,t.fontStyle),i._axisShape=new nt.Shape({sceneFunc:function(r){i._drawAxis(r,e)}})}he._buildFontString=function(e,t,i){return t||(t=11),e||(e="sans-serif"),i||(i="normal"),i+" "+t+"px "+e};he.prototype.addToLayer=function(e){e.add(this._axisShape)};he.prototype.showAxisLabels=function(e,t){this._showAxisLabels=e,t&&(M(t,"topMarkerHeight")&&(this._axisTopMarkerHeight=t.topMarkerHeight),M(t,"bottomMarkerHeight")&&(this._axisBottomMarkerHeight=t.bottomMarkerHeight))};he.prototype._getAxisLabelScale=function(e){for(var t=1,i=[1,2,5,10,20,30],n=60,r=0,s;;){s=t*i[r];var a=e.timeToPixels(s);if(a<n)++r===i.length&&(t*=60,r=0);else break}return s};he.prototype._drawAxis=function(e,t){var i=t.getStartTime(),n=this._getAxisLabelScale(t),r=ws(i,n),s=r-i,a=t.timeToPixels(s);e.setAttr("strokeStyle",this._axisGridlineColor),e.setAttr("lineWidth",1),e.setAttr("font",this._axisLabelFont),e.setAttr("fillStyle",this._axisLabelColor),e.setAttr("textAlign","left"),e.setAttr("textBaseline","bottom");for(var o=t.getWidth(),l=t.getHeight(),d=r;;){var c=a+t.timeToPixels(d-r);if(c>=o)break;if(this._axisTopMarkerHeight>0&&(e.beginPath(),e.moveTo(c+.5,0),e.lineTo(c+.5,0+this._axisTopMarkerHeight),e.stroke()),this._axisBottomMarkerHeight&&(e.beginPath(),e.moveTo(c+.5,l),e.lineTo(c+.5,l-this._axisBottomMarkerHeight),e.stroke()),this._showAxisLabels){var w=this._formatAxisTime(d),T=e.measureText(w).width,g=c-T/2,f=l-1-this._axisBottomMarkerHeight;g>=0&&e.fillText(w,g,f)}d+=n}};function R(e,t,i,n){var r=this;r._container=t,r._peaks=i,r._options=i.options,r._viewOptions=n,r._originalWaveformData=e,r._data=e,r._frameOffset=0,r._width=t.clientWidth,r._height=t.clientHeight,r._amplitudeScale=1,r._waveformColor=r._viewOptions.waveformColor,r._playedWaveformColor=r._viewOptions.playedWaveformColor,r._timeLabelPrecision=r._viewOptions.timeLabelPrecision,r._viewOptions.formatPlayheadTime?r._formatPlayheadTime=r._viewOptions.formatPlayheadTime:r._formatPlayheadTime=function(s){return yn(s,r._timeLabelPrecision)},r._enableSeek=!0,r.initWaveform(),nt.showWarnings=!1,r._stage=new nt.Stage({container:t,width:r._width,height:r._height}),r._createWaveform(),r._viewOptions.enableSegments&&(r._segmentsLayer=new K(i,r,r._viewOptions.enableEditing),r._segmentsLayer.addToStage(r._stage)),r._viewOptions.enablePoints&&(r._pointsLayer=new X(i,r,r._viewOptions.enableEditing),r._pointsLayer.addToStage(r._stage)),r.initHighlightLayer(),r._createAxisLabels(),r._playheadLayer=new mt(r._peaks.player,r,r._viewOptions),r._playheadLayer.addToStage(r._stage),r._onClick=r._onClick.bind(r),r._onDblClick=r._onDblClick.bind(r),r._onContextMenu=r._onContextMenu.bind(r),r._stage.on("click",r._onClick),r._stage.on("dblclick",r._onDblClick),r._stage.on("contextmenu",r._onContextMenu)}R.prototype.getViewOptions=function(){return this._viewOptions};R.prototype.getWaveformData=function(){return this._data};R.prototype.setWaveformData=function(e){this._data=e};R.prototype.timeToPixels=function(e){return Math.floor(e*this._data.sample_rate/this._data.scale)};R.prototype.pixelsToTime=function(e){return e*this._data.scale/this._data.sample_rate};R.prototype.pixelOffsetToTime=function(e){var t=this._frameOffset+e;return t*this._data.scale/this._data.sample_rate};R.prototype.timeToPixelOffset=function(e){return Math.floor(e*this._data.sample_rate/this._data.scale)-this._frameOffset};R.prototype.getFrameOffset=function(){return this._frameOffset};R.prototype.getWidth=function(){return this._width};R.prototype.getHeight=function(){return this._height};R.prototype.getStartTime=function(){return this.pixelOffsetToTime(0)};R.prototype.getEndTime=function(){return this.pixelOffsetToTime(this._width)};R.prototype._getDuration=function(){return this._peaks.player.getDuration()};R.prototype._createWaveform=function(){this._waveformLayer=new nt.Layer({listening:!1}),this._createWaveformShapes(),this._stage.add(this._waveformLayer)};R.prototype._createWaveformShapes=function(){if(this._waveformShape||(this._waveformShape=new ht({color:this._waveformColor,view:this}),this._waveformShape.addToLayer(this._waveformLayer)),this._playedWaveformColor&&!this._playedWaveformShape){var e=this._peaks.player.getCurrentTime();this._playedSegment={startTime:0,endTime:e},this._unplayedSegment={startTime:e,endTime:this._getDuration()},this._waveformShape.setSegment(this._unplayedSegment),this._playedWaveformShape=new ht({color:this._playedWaveformColor,view:this,segment:this._playedSegment}),this._playedWaveformShape.addToLayer(this._waveformLayer)}};R.prototype.setWaveformColor=function(e){this._waveformColor=e,this._waveformShape.setWaveformColor(e)};R.prototype.setPlayedWaveformColor=function(e){this._playedWaveformColor=e,e?(this._playedWaveformShape||this._createWaveformShapes(),this._playedWaveformShape.setWaveformColor(e)):this._playedWaveformShape&&this._destroyPlayedWaveformShape()};R.prototype._destroyPlayedWaveformShape=function(){this._waveformShape.setSegment(null),this._playedWaveformShape.destroy(),this._playedWaveformShape=null,this._playedSegment=null,this._unplayedSegment=null};R.prototype._createAxisLabels=function(){this._axisLayer=new nt.Layer({listening:!1}),this._axis=new he(this,this._viewOptions),this._axis.addToLayer(this._axisLayer),this._stage.add(this._axisLayer)};R.prototype.showAxisLabels=function(e,t){this._axis.showAxisLabels(e,t),this._axisLayer.draw()};R.prototype.showPlayheadTime=function(e){this._playheadLayer.showPlayheadTime(e)};R.prototype.setTimeLabelPrecision=function(e){this._timeLabelPrecision=e,this._playheadLayer.updatePlayheadText()};R.prototype.formatTime=function(e){return this._formatPlayheadTime(e)};R.prototype.setAmplitudeScale=function(e){if(!bi(e)||!Ss(e))throw new Error("view.setAmplitudeScale(): Scale must be a valid number");this._amplitudeScale=e,this.drawWaveformLayer(),this._segmentsLayer&&this._segmentsLayer.draw()};R.prototype.getAmplitudeScale=function(){return this._amplitudeScale};R.prototype.enableSeek=function(e){this._enableSeek=e};R.prototype.isSeekEnabled=function(){return this._enableSeek};R.prototype._onClick=function(e){this._clickHandler(e,"click")};R.prototype._onDblClick=function(e){this._clickHandler(e,"dblclick")};R.prototype._onContextMenu=function(e){this._clickHandler(e,"contextmenu")};R.prototype._clickHandler=function(e,t){var i=!0;if(e.target!==this._stage){var n=bn(e.target);if(n){if(n.attrs.name==="point-marker"){var r=n.getAttr("point");r&&this._peaks.emit("points."+t,{point:r,evt:e.evt,preventViewEvent:function(){i=!1}})}else if(n.attrs.name==="segment-overlay"){var s=n.getAttr("segment");if(s){var a={segment:s,evt:e.evt,preventViewEvent:function(){i=!1}};this._segmentsLayer&&this._segmentsLayer.segmentClicked(t,a)}}}}if(i){var o=e.evt.layerX,l=this.pixelOffsetToTime(o),d=this.getName();this._peaks.emit(d+"."+t,{time:l,evt:e.evt})}};R.prototype.updatePlayheadTime=function(e){this._playheadLayer.updatePlayheadTime(e)};R.prototype.playheadPosChanged=function(e){this._playedWaveformShape&&(this._playedSegment.endTime=e,this._unplayedSegment.startTime=e,this.drawWaveformLayer())};R.prototype.drawWaveformLayer=function(){this._waveformLayer.draw()};R.prototype.enableMarkerEditing=function(e){this._segmentsLayer&&this._segmentsLayer.enableEditing(e),this._pointsLayer&&this._pointsLayer.enableEditing(e)};R.prototype.fitToContainer=function(){if(!(this._container.clientWidth===0&&this._container.clientHeight===0)){var e=!1;this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.setWidth(this._width),e=this.containerWidthChange()),this._container.clientHeight!==this._height&&(this._height=this._container.clientHeight,this._stage.height(this._height),this._waveformShape.fitToView(),this._playheadLayer.fitToView(),this._segmentsLayer&&this._segmentsLayer.fitToView(),this._pointsLayer&&this._pointsLayer.fitToView(),this.containerHeightChange()),e&&this.updateWaveform(this._frameOffset)}};R.prototype.destroy=function(){this._playheadLayer.destroy(),this._segmentsLayer&&this._segmentsLayer.destroy(),this._pointsLayer&&this._pointsLayer.destroy(),this._stage&&(this._stage.destroy(),this._stage=null)};function Ht(e,t){this._stage=e,this._handlers=t,this._dragging=!1,this._mouseDown=this._mouseDown.bind(this),this._mouseUp=this._mouseUp.bind(this),this._mouseMove=this._mouseMove.bind(this),this._stage.on("mousedown",this._mouseDown),this._stage.on("touchstart",this._mouseDown),this._lastMouseClientX=null}Ht.prototype._mouseDown=function(e){var t=null;if(!(e.type==="mousedown"&&e.evt.button!==0)){var i=bn(e.target);if(i){if(i.attrs.name==="point-marker"||i.attrs.name==="segment-marker")return;i.attrs.name==="segment-overlay"&&(t=i)}if(this._lastMouseClientX=Math.floor(e.type==="touchstart"?e.evt.touches[0].clientX:e.evt.clientX),this._handlers.onMouseDown){var n=this._getMousePosX(this._lastMouseClientX);this._handlers.onMouseDown(n,t)}window.addEventListener("mousemove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("touchmove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("mouseup",this._mouseUp,{capture:!1,passive:!0}),window.addEventListener("touchend",this._mouseUp,{capture:!1,passive:!0}),window.addEventListener("blur",this._mouseUp,{capture:!1,passive:!0})}};Ht.prototype._mouseMove=function(e){var t=Math.floor(e.type==="touchmove"?e.changedTouches[0].clientX:e.clientX);if(t!==this._lastMouseClientX&&(this._lastMouseClientX=t,this._dragging=!0,this._handlers.onMouseMove)){var i=this._getMousePosX(t);this._handlers.onMouseMove(i)}};Ht.prototype._mouseUp=function(e){var t;if(e.type==="touchend"?(t=Math.floor(e.changedTouches[0].clientX),e.cancelable&&e.preventDefault()):t=Math.floor(e.clientX),this._handlers.onMouseUp){var i=this._getMousePosX(t);this._handlers.onMouseUp(i)}window.removeEventListener("mousemove",this._mouseMove,{capture:!1}),window.removeEventListener("touchmove",this._mouseMove,{capture:!1}),window.removeEventListener("mouseup",this._mouseUp,{capture:!1}),window.removeEventListener("touchend",this._mouseUp,{capture:!1}),window.removeEventListener("blur",this._mouseUp,{capture:!1}),this._dragging=!1};Ht.prototype._getMousePosX=function(e){var t=this._stage.getContainer().getBoundingClientRect();return e-t.left};Ht.prototype.isDragging=function(){return this._dragging};Ht.prototype.destroy=function(){this._stage.off("mousedown",this._mouseDown),this._stage.off("touchstart",this._mouseDown)};function Fe(e,t){this._peaks=e,this._view=t,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._mouseDragHandler=new Ht(t._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove})}Fe.prototype._onMouseDown=function(e){this._seek(e)};Fe.prototype._onMouseMove=function(e){this._seek(e)};Fe.prototype._seek=function(e){if(this._view.isSeekEnabled()){e=wt(e,0,this._width);var t=this._view.pixelsToTime(e),i=this._peaks.player.getDuration();t>i&&(t=i),this._view.updatePlayheadTime(t),this._peaks.player.seek(t)}};Fe.prototype.destroy=function(){this._mouseDragHandler.destroy()};function lt(e,t,i){var n=this;R.call(n,e,t,i,i.options.overview),n._onTimeUpdate=n._onTimeUpdate.bind(n),n._onPlaying=n._onPlaying.bind(n),n._onPause=n._onPause.bind(n),n._onZoomviewDisplaying=n._onZoomviewDisplaying.bind(n),i.on("player.timeupdate",n._onTimeUpdate),i.on("player.playing",n._onPlaying),i.on("player.pause",n._onPause),i.on("zoomview.displaying",n._onZoomviewDisplaying);var r=n._peaks.player.getCurrentTime();n._playheadLayer.updatePlayheadTime(r),n._mouseDragHandler=new Fe(i,n)}lt.prototype=Object.create(R.prototype);lt.prototype.initWaveform=function(){this._width!==0&&this._resampleAndSetWaveformData(this._originalWaveformData,this._width)};lt.prototype.initHighlightLayer=function(){this._highlightLayer=new Jt(this,this._viewOptions),this._highlightLayer.addToStage(this._stage)};lt.prototype.isSegmentDraggingEnabled=function(){return!1};lt.prototype.getName=function(){return"overview"};lt.prototype._onTimeUpdate=function(e){this._playheadLayer.updatePlayheadTime(e)};lt.prototype._onPlaying=function(e){this._playheadLayer.updatePlayheadTime(e)};lt.prototype._onPause=function(e){this._playheadLayer.stop(e)};lt.prototype._onZoomviewDisplaying=function(e,t){this.showHighlight(e,t)};lt.prototype.showHighlight=function(e,t){this._highlightLayer.showHighlight(e,t)};lt.prototype.setWaveformData=function(e){this._originalWaveformData=e,this._width!==0?this._resampleAndSetWaveformData(e,this._width):this._data=e,this.updateWaveform()};lt.prototype._resampleAndSetWaveformData=function(e,t){try{return this._data=e.resample({width:t}),!0}catch{return this._data=e,!1}};lt.prototype.removeHighlightRect=function(){this._highlightLayer.removeHighlight()};lt.prototype.updateWaveform=function(){this._waveformLayer.draw(),this._axisLayer.draw();var e=this._peaks.player.getCurrentTime();this._playheadLayer.updatePlayheadTime(e),this._highlightLayer.updateHighlight();var t=0,i=this.pixelsToTime(this._width);this._pointsLayer&&this._pointsLayer.updatePoints(t,i),this._segmentsLayer&&this._segmentsLayer.updateSegments(t,i)};lt.prototype.containerWidthChange=function(){return this._resampleAndSetWaveformData(this._originalWaveformData,this._width)};lt.prototype.containerHeightChange=function(){this._highlightLayer.fitToView()};lt.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("zoomview.displaying",this._onZoomviewDisplaying),this._mouseDragHandler.destroy(),R.prototype.destroy.call(this)};function le(e,t){this._peaks=e,this._view=t,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new Ht(t._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}le.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()};le.prototype._reset=function(){this._insertSegment=null,this._insertSegmentShape=null,this._segmentIsDraggable=!1,this._peaks.segments.setInserting(!1)};le.prototype._onMouseDown=function(e,t){if(this._reset(),this._segment=t,this._segment){if(this._view.getSegmentDragMode()!=="overlap")return;this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1)}var i=this._view.pixelsToTime(e+this._view.getFrameOffset());this._peaks.segments.setInserting(!0),this._insertSegment=this._peaks.segments.add({startTime:i,endTime:i,editable:!0}),this._insertSegmentShape=this._view._segmentsLayer.getSegmentShape(this._insertSegment),this._insertSegmentShape&&(this._insertSegmentShape.moveMarkersToTop(),this._insertSegmentShape.startDrag())};le.prototype._onMouseMove=function(){};le.prototype._onMouseUp=function(){this._insertSegment&&(this._insertSegmentShape&&(this._insertSegmentShape.stopDrag(),this._insertSegmentShape=null),this._segment&&this._segmentIsDraggable&&this._segment.draggable(!0),this._peaks.emit("segments.insert",{segment:this._insertSegment}),this._peaks.segments.setInserting(!1))};le.prototype.destroy=function(){this._mouseDragHandler.destroy()};function qt(e,t){this._peaks=e,this._view=t,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new Ht(t._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}qt.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()};qt.prototype._onMouseDown=function(e,t){this._seeking=!1,t&&!t.attrs.draggable?this._segment=null:this._segment=t;var i=this._view.getPlayheadOffset();if(this._view.isSeekEnabled()&&Math.abs(e-i)<=this._view.getPlayheadClickTolerance()&&(this._seeking=!0,this._segment&&(this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1))),this._seeking){e=wt(e,0,this._view.getWidth());var n=this._view.pixelsToTime(e+this._view.getFrameOffset());this._seek(n)}else this._initialFrameOffset=this._view.getFrameOffset(),this._mouseDownX=e};qt.prototype._onMouseMove=function(e){if(!(this._segment&&!this._seeking)){if(this._seeking){e=wt(e,0,this._view.getWidth());var t=this._view.pixelsToTime(e+this._view.getFrameOffset());this._seek(t)}else if(!this._view.isAutoZoom()){var i=this._mouseDownX-e,n=this._initialFrameOffset+i;n!==this._initialFrameOffset&&this._view.updateWaveform(n)}}};qt.prototype._onMouseUp=function(){if(!this._seeking&&this._view._enableSeek&&!this._mouseDragHandler.isDragging()){var e=this._view.pixelOffsetToTime(this._mouseDownX);this._seek(e)}this._segment&&this._seeking&&this._segmentIsDraggable&&this._segment.draggable(!0)};qt.prototype._seek=function(e){var t=this._peaks.player.getDuration();e>t&&(e=t),this._view.updatePlayheadTime(e),this._peaks.player.seek(e)};qt.prototype.destroy=function(){this._mouseDragHandler.destroy()};function W(e,t,i){var n=this;R.call(n,e,t,i,i.options.zoomview),n._onTimeUpdate=n._onTimeUpdate.bind(n),n._onPlaying=n._onPlaying.bind(n),n._onPause=n._onPause.bind(n),n._onKeyboardLeft=n._onKeyboardLeft.bind(n),n._onKeyboardRight=n._onKeyboardRight.bind(n),n._onKeyboardShiftLeft=n._onKeyboardShiftLeft.bind(n),n._onKeyboardShiftRight=n._onKeyboardShiftRight.bind(n),n._peaks.on("player.timeupdate",n._onTimeUpdate),n._peaks.on("player.playing",n._onPlaying),n._peaks.on("player.pause",n._onPause),n._peaks.on("keyboard.left",n._onKeyboardLeft),n._peaks.on("keyboard.right",n._onKeyboardRight),n._peaks.on("keyboard.shift_left",n._onKeyboardShiftLeft),n._peaks.on("keyboard.shift_right",n._onKeyboardShiftRight),n._autoScroll=n._viewOptions.autoScroll,n._autoScrollOffset=n._viewOptions.autoScrollOffset,n._enableSegmentDragging=!1,n._segmentDragMode="overlap",n._minSegmentDragWidth=0,n._insertSegmentShape=null,n._playheadClickTolerance=n._viewOptions.playheadClickTolerance,n._zoomLevelAuto=!1,n._zoomLevelSeconds=null;var r=n._peaks.player.getCurrentTime();n._syncPlayhead(r),n._mouseDragHandler=new qt(i,n),n._onWheel=n._onWheel.bind(n),n._onWheelCaptureVerticalScroll=n._onWheelCaptureVerticalScroll.bind(n),n.setWheelMode(n._viewOptions.wheelMode),n._peaks.emit("zoomview.displaying",0,n.getEndTime())}W.prototype=Object.create(R.prototype);W.prototype.initWaveform=function(){this._enableWaveformCache=this._options.waveformCache,this._initWaveformCache();var e=this._peaks.zoom.getZoomLevel();this._resampleData({scale:e})};W.prototype._initWaveformCache=function(){this._enableWaveformCache&&(this._waveformData=new Map,this._waveformData.set(this._originalWaveformData.scale,this._originalWaveformData),this._waveformScales=[this._originalWaveformData.scale])};W.prototype.initHighlightLayer=function(){};W.prototype.setWheelMode=function(e,t){if(t||(t={}),e!==this._wheelMode||t.captureVerticalScroll!==this._captureVerticalScroll)switch(this._stage.off("wheel"),this._wheelMode=e,this._captureVerticalScroll=t.captureVerticalScroll,e){case"scroll":t.captureVerticalScroll?this._stage.on("wheel",this._onWheelCaptureVerticalScroll):this._stage.on("wheel",this._onWheel);break}};W.prototype._onWheel=function(e){var t=e.evt,i;if(t.shiftKey)if(t.deltaY!==0)i=t.deltaY;else if(t.deltaX!==0)i=t.deltaX;else return;else{if(Math.abs(t.deltaX)<Math.abs(t.deltaY))return;i=t.deltaX}t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(i*=this._width),t.preventDefault();var n=wt(this._frameOffset+Math.floor(i),0,this._pixelLength-this._width);this.updateWaveform(n)};W.prototype._onWheelCaptureVerticalScroll=function(e){var t=e.evt,i=Math.abs(t.deltaX)<Math.abs(t.deltaY)?t.deltaY:t.deltaX;t.preventDefault();var n=wt(this._frameOffset+Math.floor(i),0,this._pixelLength-this._width);this.updateWaveform(n)};W.prototype.setWaveformDragMode=function(e){this._viewOptions.enableSegments&&(this._mouseDragHandler.destroy(),e==="insert-segment"?this._mouseDragHandler=new le(this._peaks,this):this._mouseDragHandler=new qt(this._peaks,this))};W.prototype.enableSegmentDragging=function(e){this._enableSegmentDragging=e,this._segmentsLayer&&this._segmentsLayer.enableSegmentDragging(e)};W.prototype.isSegmentDraggingEnabled=function(){return this._enableSegmentDragging};W.prototype.setSegmentDragMode=function(e){this._segmentDragMode=e};W.prototype.getSegmentDragMode=function(){return this._segmentDragMode};W.prototype.getName=function(){return"zoomview"};W.prototype._onTimeUpdate=function(e){this._mouseDragHandler.isDragging()||this._syncPlayhead(e)};W.prototype._onPlaying=function(e){this._playheadLayer.updatePlayheadTime(e)};W.prototype._onPause=function(e){this._playheadLayer.stop(e)};W.prototype._onKeyboardLeft=function(){this._keyboardScroll(-1,!1)};W.prototype._onKeyboardRight=function(){this._keyboardScroll(1,!1)};W.prototype._onKeyboardShiftLeft=function(){this._keyboardScroll(-1,!0)};W.prototype._onKeyboardShiftRight=function(){this._keyboardScroll(1,!0)};W.prototype._keyboardScroll=function(e,t){var i;t?i=e*this._width:i=e*this.timeToPixels(this._options.nudgeIncrement),this.scrollWaveform({pixels:i})};W.prototype.setWaveformData=function(e){this._originalWaveformData=e,this._initWaveformCache()};W.prototype.getPlayheadOffset=function(){return this._playheadLayer.getPlayheadPixel()-this._frameOffset};W.prototype.getPlayheadClickTolerance=function(){return this._playheadClickTolerance};W.prototype._syncPlayhead=function(e){if(this._playheadLayer.updatePlayheadTime(e),this._autoScroll&&!this._zoomLevelAuto){var t=this.timeToPixels(e),i=this._frameOffset+this._width-this._autoScrollOffset;(t>=i||t<this._frameOffset)&&(this._frameOffset=t-this._autoScrollOffset,this._frameOffset<0&&(this._frameOffset=0),this.updateWaveform(this._frameOffset))}};W.prototype._getScale=function(e){return Math.floor(e*this._data.sample_rate/this._width)};function Zs(e){return M(e,"scale")&&e.scale==="auto"||M(e,"seconds")&&e.seconds==="auto"}W.prototype.setZoom=function(e){var t;if(Zs(e)){var i=this._originalWaveformData.duration;this._zoomLevelAuto=!0,this._zoomLevelSeconds=null,t=this._getScale(i)}else{if(M(e,"scale"))this._zoomLevelSeconds=null,t=Math.floor(e.scale);else if(M(e,"seconds")){if(!ie(e.seconds))return!1;this._zoomLevelSeconds=e.seconds,t=this._getScale(e.seconds)}this._zoomLevelAuto=!1}t<this._originalWaveformData.scale&&(this._peaks._logger("peaks.zoomview.setZoom(): zoom level must be at least "+this._originalWaveformData.scale),t=this._originalWaveformData.scale);var n=this._peaks.player.getCurrentTime(),r,s=this.getPlayheadOffset();s>=0&&s<this._width?r=n:(s=Math.floor(this._width/2),r=this.pixelOffsetToTime(s));var a=this._scale;this._resampleData({scale:t});var o=this.timeToPixels(r);return this._frameOffset=o-s,this.updateWaveform(this._frameOffset),this._playheadLayer.zoomLevelChanged(),this._playheadLayer.updatePlayheadTime(n),this._peaks.emit("zoom.update",{currentZoom:t,previousZoom:a}),!0};W.prototype._resampleData=function(e){var t=e.scale;if(this._enableWaveformCache){if(!this._waveformData.has(t)){for(var i=this._originalWaveformData,n=0;n<this._waveformScales.length&&this._waveformScales[n]<t;n++)i=this._waveformData.get(this._waveformScales[n]);this._waveformData.set(t,i.resample(e)),this._waveformScales.push(t),this._waveformScales.sort(function(r,s){return r-s})}this._data=this._waveformData.get(t)}else this._data=this._originalWaveformData.resample(e);this._scale=this._data.scale,this._pixelLength=this._data.length};W.prototype.isAutoZoom=function(){return this._zoomLevelAuto};W.prototype.setStartTime=function(e){e<0&&(e=0),this._zoomLevelAuto&&(e=0),this.updateWaveform(this.timeToPixels(e))};W.prototype.getPixelLength=function(){return this._pixelLength};W.prototype.scrollWaveform=function(e){var t;if(M(e,"pixels"))t=Math.floor(e.pixels);else if(M(e,"seconds"))t=this.timeToPixels(e.seconds);else throw new TypeError("view.scrollWaveform(): Missing umber of pixels or seconds");this.updateWaveform(this._frameOffset+t)};W.prototype.updateWaveform=function(e){var t;this._pixelLength<this._width?(e=0,t=this._width):t=this._pixelLength-this._width,e=wt(e,0,t),this._frameOffset=e;var i=this._playheadLayer.getPlayheadPixel();this._playheadLayer.updatePlayheadTime(this.pixelsToTime(i)),this.drawWaveformLayer(),this._axisLayer.draw();var n=this.getStartTime(),r=this.getEndTime();this._pointsLayer&&this._pointsLayer.updatePoints(n,r),this._segmentsLayer&&this._segmentsLayer.updateSegments(n,r),this._peaks.emit("zoomview.displaying",n,r)};W.prototype.enableAutoScroll=function(e,t){t||(t={}),this._autoScroll=e,M(t,"offset")&&(this._autoScrollOffset=t.offset)};W.prototype.getMinSegmentDragWidth=function(){return this._insertSegmentShape?0:this._minSegmentDragWidth};W.prototype.setMinSegmentDragWidth=function(e){this._minSegmentDragWidth=e};W.prototype.containerWidthChange=function(){var e=!1,t=!1,i;if(this._zoomLevelAuto?(t=!0,i={width:this._width}):this._zoomLevelSeconds!==null&&(t=!0,i={scale:this._getScale(this._zoomLevelSeconds)}),t)try{this._resampleData(i),e=!0}catch{}return e};W.prototype.containerHeightChange=function(){};W.prototype.getStage=function(){return this._stage};W.prototype.getSegmentsLayer=function(){return this._segmentsLayer};W.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("keyboard.left",this._onKeyboardLeft),this._peaks.off("keyboard.right",this._onKeyboardRight),this._peaks.off("keyboard.shift_left",this._onKeyboardShiftLeft),this._peaks.off("keyboard.shift_right",this._onKeyboardShiftRight),this._mouseDragHandler.destroy(),R.prototype.destroy.call(this)};function vt(e,t,i){this._waveformData=e,this._container=t,this._peaks=i,this._options=i.options.scrollbar,this._zoomview=i.views.getView("zoomview"),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onScrollboxDragStart=this._onScrollboxDragStart.bind(this),this._onScrollboxDragMove=this._onScrollboxDragMove.bind(this),this._onScrollboxDragEnd=this._onScrollboxDragEnd.bind(this),this._onZoomviewDisplaying=this._onZoomviewDisplaying.bind(this),this._onScrollbarClick=this._onScrollbarClick.bind(this),i.on("zoomview.displaying",this._onZoomviewDisplaying),this._width=t.clientWidth,this._height=t.clientHeight,this._stage=new nt.Stage({container:t,width:this._width,height:this._height}),this._layer=new nt.Layer,this._stage.on("click",this._onScrollbarClick),this._stage.add(this._layer),this._color=this._options.color,this._scrollboxX=0,this._minScrollboxWidth=this._options.minWidth,this._offsetY=0,this._scrollbox=new nt.Group({draggable:!0,dragBoundFunc:this._dragBoundFunc}),this._scrollboxRect=new ve({x:this._scrollboxX,y:this._offsetY,width:0,height:this._height,fill:this._color}),this._scrollbox.add(this._scrollboxRect),this._setScrollboxWidth(),this._scrollbox.on("dragstart",this._onScrollboxDragStart),this._scrollbox.on("dragmove",this._onScrollboxDragMove),this._scrollbox.on("dragend",this._onScrollboxDragEnd),this._layer.add(this._scrollbox),this._layer.draw()}vt.prototype.setZoomview=function(e){this._zoomview=e,this._updateScrollbarWidthAndPosition()};vt.prototype._setScrollboxWidth=function(){this._zoomview?(this._scrollboxWidth=Math.floor(this._width*this._zoomview.pixelsToTime(this._zoomview.getWidth())/this._peaks.player.getDuration()),this._scrollboxWidth<this._minScrollboxWidth&&(this._scrollboxWidth=this._minScrollboxWidth)):this._scrollboxWidth=this._width,this._scrollboxRect.width(this._scrollboxWidth)};vt.prototype._getScrollbarRange=function(){return this._width-this._scrollboxWidth};vt.prototype._dragBoundFunc=function(e){return{x:e.x,y:0}};vt.prototype._onScrollboxDragStart=function(){this._dragging=!0};vt.prototype._onScrollboxDragEnd=function(){this._dragging=!1};vt.prototype._onScrollboxDragMove=function(){var e=this._getScrollbarRange(),t=wt(this._scrollbox.x(),0,e);this._scrollbox.x(t),t!==this._scrollboxX&&(this._scrollboxX=t,this._zoomview&&this._updateWaveform(t))};vt.prototype._onZoomviewDisplaying=function(){this._dragging||this._updateScrollbarWidthAndPosition()};vt.prototype._updateScrollbarWidthAndPosition=function(){if(this._setScrollboxWidth(),this._zoomview){var e=this._zoomview.getStartTime(),t=this._zoomview.getPixelLength()-this._zoomview.getWidth(),i=Math.floor(this._zoomview.timeToPixels(e)*this._getScrollbarRange()/t);this._scrollbox.x(i),this._layer.draw()}};vt.prototype._onScrollbarClick=function(e){if(e.target===this._stage&&this._zoomview){var t=Math.floor(e.evt.layerX-this._scrollboxWidth/2);t<0&&(t=0),this._updateWaveform(t)}};vt.prototype._updateWaveform=function(e){var t=Math.floor((this._zoomview.getPixelLength()-this._zoomview.getWidth())*e/this._getScrollbarRange());this._zoomview.updateWaveform(t)};vt.prototype.fitToContainer=function(){this._container.clientWidth===0&&this._container.clientHeight===0||(this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.width(this._width),this._updateScrollbarWidthAndPosition()),this._height=this._container.clientHeight,this._stage.height(this._height))};vt.prototype.destroy=function(){this._layer.destroy(),this._stage.destroy(),this._stage=null};function Vt(e){this._peaks=e,this._overview=null,this._zoomview=null,this._scrollbar=null}Vt.prototype.createOverview=function(e){if(this._overview)return this._overview;var t=this._peaks.getWaveformData();return this._overview=new lt(t,e,this._peaks),this._zoomview&&this._overview.showHighlight(this._zoomview.getStartTime(),this._zoomview.getEndTime()),this._overview};Vt.prototype.createZoomview=function(e){if(this._zoomview)return this._zoomview;var t=this._peaks.getWaveformData();return this._zoomview=new W(t,e,this._peaks),this._scrollbar&&this._scrollbar.setZoomview(this._zoomview),this._zoomview};Vt.prototype.createScrollbar=function(e){var t=this._peaks.getWaveformData();return this._scrollbar=new vt(t,e,this._peaks),this._scrollbar};Vt.prototype.destroyOverview=function(){this._overview&&this._zoomview&&(this._overview.destroy(),this._overview=null)};Vt.prototype.destroyZoomview=function(){this._zoomview&&this._overview&&(this._zoomview.destroy(),this._zoomview=null,this._overview.removeHighlightRect())};Vt.prototype.destroy=function(){this._overview&&(this._overview.destroy(),this._overview=null),this._zoomview&&(this._zoomview.destroy(),this._zoomview=null),this._scrollbar&&(this._scrollbar.destroy(),this._scrollbar=null)};Vt.prototype.getView=function(e){if(kt(e))return this._overview&&this._zoomview?null:this._overview?this._overview:this._zoomview?this._zoomview:null;switch(e){case"overview":return this._overview;case"zoomview":return this._zoomview;default:return null}};Vt.prototype.getScrollbar=function(){return this._scrollbar};function de(e,t){this._peaks=e,this._zoomLevels=t,this._zoomLevelIndex=0}de.prototype.setZoomLevels=function(e){this._zoomLevels=e,this.setZoom(0,!0)};de.prototype.zoomIn=function(){this.setZoom(this._zoomLevelIndex-1)};de.prototype.zoomOut=function(){this.setZoom(this._zoomLevelIndex+1)};de.prototype.setZoom=function(e,t){if(e>=this._zoomLevels.length&&(e=this._zoomLevels.length-1),e<0&&(e=0),!(!t&&e===this._zoomLevelIndex)){this._zoomLevelIndex=e;var i=this._peaks.views.getView("zoomview");i&&i.setZoom({scale:this._zoomLevels[e]})}};de.prototype.getZoom=function(){return this._zoomLevelIndex};de.prototype.getZoomLevel=function(){return this._zoomLevels[this._zoomLevelIndex]};var qi="withCredentials"in new XMLHttpRequest;function It(e){this._peaks=e}It.prototype.init=function(e,t){if(e.dataUri&&(e.webAudio||e.audioContext)||e.waveformData&&(e.webAudio||e.audioContext)||e.dataUri&&e.waveformData){t(new TypeError("Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data."));return}if(e.audioContext&&(this._peaks._logger("Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead"),e.webAudio={audioContext:e.audioContext}),e.dataUri)return this._getRemoteWaveformData(e,t);if(e.waveformData)return this._buildWaveformFromLocalData(e,t);if(e.webAudio)return e.webAudio.audioBuffer?this._buildWaveformDataFromAudioBuffer(e,t):this._buildWaveformDataUsingWebAudio(e,t);t(new Error("Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data"))};function Mn(e){var t=e.getResponseHeader("content-range");if(!t)return!1;var i=t.match(/^bytes (\d+)-(\d+)\/(\d+)$/);if(i&&i.length===4){var n=parseInt(i[1],10),r=parseInt(i[2],10),s=parseInt(i[3],10);return n===0&&r+1===s}return!1}It.prototype._getRemoteWaveformData=function(e,t){var i=this,n=null,r=null,s;if(ke(e.dataUri))n=e.dataUri;else{t(new TypeError("Peaks.init(): The dataUri option must be an object"));return}if(["ArrayBuffer","JSON"].some(function(a){if(window[a])return r=a.toLowerCase(),s=n[r],!!s}),!s){t(new Error("Peaks.init(): Unable to determine a compatible dataUri format for this browser"));return}i._xhr=i._createXHR(s,r,e.withCredentials,function(a){if(this.readyState===4){if(this.status!==200&&!(this.status===206&&Mn(this))){t(new Error("Unable to fetch remote data. HTTP status "+this.status));return}i._xhr=null;var o=pt.create(a.target.response);if(o.channels!==1&&o.channels!==2){t(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));return}else if(o.bits!==8){t(new Error("Peaks.init(): 16-bit waveform data is not supported"));return}t(null,o)}},function(){t(new Error("XHR failed"))},function(){t(new Error("XHR aborted"))}),i._xhr.send()};It.prototype._buildWaveformFromLocalData=function(e,t){var i=null,n=null;if(ke(e.waveformData))i=e.waveformData;else{t(new Error("Peaks.init(): The waveformData option must be an object"));return}if(ke(i.json)?n=i.json:Cs(i.arraybuffer)&&(n=i.arraybuffer),!n){t(new Error("Peaks.init(): Unable to determine a compatible waveformData format"));return}try{var r=pt.create(n);if(r.channels!==1&&r.channels!==2){t(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));return}else if(r.bits!==8){t(new Error("Peaks.init(): 16-bit waveform data is not supported"));return}t(null,r)}catch(s){t(s)}};It.prototype._buildWaveformDataUsingWebAudio=function(e,t){var i=this,n=window.AudioContext||window.webkitAudioContext;if(!(e.webAudio.audioContext instanceof n)){t(new TypeError("Peaks.init(): The webAudio.audioContext option must be a valid AudioContext"));return}var r=e.webAudio;r.scale!==e.zoomLevels[0]&&(r.scale=e.zoomLevels[0]);var s=i._peaks.options.mediaElement.currentSrc;s?i._requestAudioAndBuildWaveformData(s,r,e.withCredentials,t):i._peaks.once("player.canplay",function(){i._requestAudioAndBuildWaveformData(i._peaks.options.mediaElement.currentSrc,r,e.withCredentials,t)})};It.prototype._buildWaveformDataFromAudioBuffer=function(e,t){var i=e.webAudio;i.scale!==e.zoomLevels[0]&&(i.scale=e.zoomLevels[0]);var n={audio_buffer:i.audioBuffer,split_channels:i.multiChannel,scale:i.scale,disable_worker:!0};pt.createFromAudio(n,t)};It.prototype._requestAudioAndBuildWaveformData=function(e,t,i,n){var r=this;if(!e){r._peaks._logger("Peaks.init(): The mediaElement src is invalid");return}r._xhr=r._createXHR(e,"arraybuffer",i,function(s){if(this.readyState===4){if(this.status!==200&&!(this.status===206&&Mn(this))){n(new Error("Unable to fetch remote data. HTTP status "+this.status));return}r._xhr=null;var a={audio_context:t.audioContext,array_buffer:s.target.response,split_channels:t.multiChannel,scale:t.scale};pt.createFromAudio(a,n)}},function(){n(new Error("XHR failed"))},function(){n(new Error("XHR aborted"))}),r._xhr.send()};It.prototype.abort=function(){this._xhr&&this._xhr.abort()};It.prototype._createXHR=function(e,t,i,n,r,s){var a=new XMLHttpRequest;if(a.open("GET",e,!0),qi)try{a.responseType=t}catch{}return a.onload=n,a.onerror=r,qi&&i&&(a.withCredentials=!0),a.addEventListener("abort",s),a};function ne(){return vn.call(this),this.options={zoomLevels:[512,1024,2048,4096],waveformCache:!0,mediaElement:null,mediaUrl:null,dataUri:null,withCredentials:!1,waveformData:null,webAudio:null,nudgeIncrement:1,pointMarkerColor:"#39cccc",createSegmentMarker:Hs,createSegmentLabel:Vs,createPointMarker:Us,logger:console.error.bind(console)},this}ne.prototype=Object.create(vn.prototype);var Ze={playheadColor:"#111111",playheadTextColor:"#aaaaaa",playheadBackgroundColor:"transparent",playheadPadding:2,playheadWidth:1,axisGridlineColor:"#cccccc",showAxisLabels:!0,axisTopMarkerHeight:10,axisBottomMarkerHeight:10,axisLabelColor:"#aaaaaa",fontFamily:"sans-serif",fontSize:11,fontStyle:"normal",timeLabelPrecision:2,enablePoints:!0,enableSegments:!0},$i={playheadClickTolerance:3,waveformColor:"rgba(0, 225, 128, 1)",wheelMode:"none",autoScroll:!0,autoScrollOffset:100,enableEditing:!0},Qi={waveformColor:"rgba(0, 0, 0, 0.2)",highlightColor:"#aaaaaa",highlightStrokeColor:"transparent",highlightOpacity:.3,highlightOffset:11,highlightCornerRadius:2,enableEditing:!1},Ks={overlay:!1,markers:!0,startMarkerColor:"#aaaaaa",endMarkerColor:"#aaaaaa",waveformColor:"#0074d9",overlayColor:"#ff0000",overlayOpacity:.3,overlayBorderColor:"#ff0000",overlayBorderWidth:2,overlayCornerRadius:5,overlayOffset:25,overlayLabelAlign:"left",overlayLabelVerticalAlign:"top",overlayLabelPadding:8,overlayLabelColor:"#000000",overlayFontFamily:"sans-serif",overlayFontSize:12,overlayFontStyle:"normal"},js={color:"#888888",minWidth:50};function Js(e){var t={};e.overview&&e.overview.showPlayheadTime&&(t.showPlayheadTime=e.overview.showPlayheadTime);var i=["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","highlightColor","highlightStrokeColor","highlightOpacity","highlightCornerRadius","highlightOffset","enablePoints","enableSegments","enableEditing"];return i.forEach(function(n){e.overview&&M(e.overview,n)?t[n]=e.overview[n]:M(e,n)?t[n]=e[n]:M(t,n)||(M(Qi,n)?t[n]=Qi[n]:M(Ze,n)&&(t[n]=Ze[n]))}),t}function qs(e){var t={};e.showPlayheadTime?t.showPlayheadTime=e.showPlayheadTime:e.zoomview&&e.zoomview.showPlayheadTime&&(t.showPlayheadTime=e.zoomview.showPlayheadTime);var i=["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","playheadClickTolerance","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","wheelMode","autoScroll","autoScrollOffset","enablePoints","enableSegments","enableEditing"];return i.forEach(function(n){e.zoomview&&M(e.zoomview,n)?t[n]=e.zoomview[n]:M(e,n)?t[n]=e[n]:M(t,n)||(M($i,n)?t[n]=$i[n]:M(Ze,n)&&(t[n]=Ze[n]))}),t}function $s(e){if(!M(e,"scrollbar"))return null;var t={},i=["container","color","minWidth"];return i.forEach(function(n){M(e.scrollbar,n)?t[n]=e.scrollbar[n]:t[n]=js[n]}),t}function Ue(e,t){for(var i in t)M(t,i)&&M(e,i)&&(e[i]=t[i]);return e}function Qs(e,t){e.segmentOptions={},Ce(e.segmentOptions,Ks),t.segmentOptions&&Ue(e.segmentOptions,t.segmentOptions),e.zoomview.segmentOptions={},Ce(e.zoomview.segmentOptions,e.segmentOptions),t.zoomview&&t.zoomview.segmentOptions&&Ue(e.zoomview.segmentOptions,t.zoomview.segmentOptions),e.overview.segmentOptions={},Ce(e.overview.segmentOptions,e.segmentOptions),t.overview&&t.overview.segmentOptions&&Ue(e.overview.segmentOptions,t.overview.segmentOptions)}function tn(e){var t=e.zoomview.container,i=e.overview.container;if(!Si(t)&&!Si(i))return new TypeError("Peaks.init(): The zoomview and/or overview container options must be valid HTML elements");if(t&&(t.clientWidth<=0||t.clientHeight<=0))return new Error("Peaks.init(): The zoomview container must be visible and have non-zero width and height");if(i&&(i.clientWidth<=0||i.clientHeight<=0))return new Error("Peaks.init(): The overview container must be visible and have non-zero width and height")}ne.init=function(e,t){var i=new ne,n=i._setOptions(e);if(n||(n=tn(i.options)),n){t(n);return}var r=null;if(i.options.scrollbar){if(r=i.options.scrollbar.container,!Si(r)){t(new TypeError("Peaks.init(): The scrollbar container option must be a valid HTML element"));return}if(r.clientWidth<=0){t(new TypeError("Peaks.init(): The scrollbar container must be visible and have non-zero width"));return}}e.keyboard&&(i._keyboardHandler=new Di(i));var s=e.player?e.player:new xt(i.options.mediaElement);return i.player=new bt(i,s),i.segments=new J(i),i.points=new ut(i),i.zoom=new de(i,i.options.zoomLevels),i.views=new Vt(i),i._waveformBuilder=new It(i),i.player.init(i).then(function(){i._waveformBuilder.init(i.options,function(a,o){if(a){t&&t(a);return}if(a=tn(i.options),a){t&&t(a);return}i._waveformBuilder=null,i._waveformData=o;var l=i.options.zoomview.container,d=i.options.overview.container;d&&i.views.createOverview(d),l&&i.views.createZoomview(l),r&&i.views.createScrollbar(r),e.segments&&i.segments.add(e.segments),e.points&&i.points.add(e.points),e.emitCueEvents&&(i._cueEmitter=new Pt(i)),setTimeout(function(){i.emit("peaks.ready")},0),t(null,i)})}).catch(function(a){t&&t(a)}),i};ne.prototype._setOptions=function(e){if(!ke(e))return new TypeError("Peaks.init(): The options parameter should be an object");if(!e.player){if(!e.mediaElement)return new Error("Peaks.init(): Missing mediaElement option");if(!(e.mediaElement instanceof HTMLMediaElement))return new TypeError("Peaks.init(): The mediaElement option should be an HTMLMediaElement")}if(e.logger&&!Ts(e.logger))return new TypeError("Peaks.init(): The logger option should be a function");if(e.segments&&!Array.isArray(e.segments))return new TypeError("Peaks.init(): options.segments must be an array of segment objects");if(e.points&&!Array.isArray(e.points))return new TypeError("Peaks.init(): options.points must be an array of point objects");if(Ue(this.options,e),this.options.overview=Js(e),this.options.zoomview=qs(e),this.options.scrollbar=$s(e),Qs(this.options,e),Array.isArray(this.options.zoomLevels)){if(this.options.zoomLevels.length===0)return new Error("Peaks.init(): The zoomLevels array must not be empty");if(!bs(this.options.zoomLevels))return new Error("Peaks.init(): The zoomLevels array must be sorted in ascending order")}else return new TypeError("Peaks.init(): The zoomLevels option should be an array");this._logger=this.options.logger};ne.prototype.setSource=function(e,t){var i=this;i.player._setSource(e).then(function(){e.zoomLevels||(e.zoomLevels=i.options.zoomLevels),i._waveformBuilder=new It(i),i._waveformBuilder.init(e,function(n,r){if(n){t(n);return}i._waveformBuilder=null,i._waveformData=r,["overview","zoomview"].forEach(function(s){var a=i.views.getView(s);a&&a.setWaveformData(r)}),i.zoom.setZoomLevels(e.zoomLevels),t()})}).catch(function(n){t(n)})};ne.prototype.getWaveformData=function(){return this._waveformData};ne.prototype.destroy=function(){this._waveformBuilder&&this._waveformBuilder.abort(),this._keyboardHandler&&this._keyboardHandler.destroy(),this.views&&this.views.destroy(),this.player&&this.player.destroy(),this._cueEmitter&&this._cueEmitter.destroy()};export{ne as default};
//# sourceMappingURL=peaks.esm.CqL5hw5o.js.map
