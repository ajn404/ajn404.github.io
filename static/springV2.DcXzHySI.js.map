{"version":3,"file":"springV2.DcXzHySI.js","sources":["../../src/components/react/p5/Oscillation/spring/springV2.tsx"],"sourcesContent":["import type p5 from \"p5\";\nimport Basic from \"@components/react/p5/index.tsx\";\nimport { useCallback, useState, useRef, useEffect } from \"react\";\nimport { BobBob } from \"./Bob\";\nimport { BobSpring } from \"./Spring\";\nimport { useDebounce } from \"@uidotdev/usehooks\";\nimport { Slider } from \"@shadcn/ui/slider\";\nimport { cn } from \"@utils/utils\";\n\ninterface CanvasConfig {\n  width: number;\n  height: number;\n}\n\ninterface SpringV2 {\n  showControl: Boolean | String;\n}\n\nconst springV2: React.FC<SpringV2> = ({ showControl }) => {\n  const [k, setK] = useState(0.2);\n  const debounceK = useDebounce(k, 500);\n  const [num, setNum] = useState(10);\n  const debounceNum = useDebounce(num, 500);\n\n  const [canvasConfig, setCanvasConfig] = useState<CanvasConfig>({\n    width: 500,\n    height: 500,\n  });\n\n  const debounceCanvasConfig = useDebounce(canvasConfig, 500);\n\n  // Using refs to persist bobs and springs across renders\n  const bobsRef = useRef<BobBob[]>([]);\n  const springsRef = useRef<BobSpring[]>([]);\n\n  const sketch = useCallback(\n    (p: p5) => {\n      const width = !showControl\n        ? p.windowWidth / 3\n        : Math.max(debounceCanvasConfig.width, p.windowWidth / 2);\n      const setup = () => {\n        p.createCanvas(width, debounceCanvasConfig.height);\n        p.frameRate(120);\n\n        // Initialize bobs\n        bobsRef.current = [];\n        springsRef.current = [];\n        new Array(debounceNum).fill(p.random(5, 20)).forEach(_ => {\n          const bob = new BobBob(p, p.random(p.width), p.random(p.height), _);\n          bobsRef.current.push(bob);\n        });\n\n        // 遍历 bobsRef 中的 Bob 对象,两两连接\n        for (let i = 0; i < bobsRef.current.length; i++) {\n          for (let j = i + 1; j < bobsRef.current.length; j++) {\n            springsRef.current.push(\n              new BobSpring(\n                p,\n                200,\n                debounceK,\n                bobsRef.current[i],\n                bobsRef.current[j]\n              )\n            );\n          }\n        }\n      };\n\n      const draw = () => {\n        p.background(33, 39, 55);\n        bobsRef.current.forEach(bob => {\n          bob.update();\n          bob.handleDrag(p.mouseX, p.mouseY);\n        });\n\n        springsRef.current.forEach(spring => {\n          spring.connect();\n        });\n\n        springsRef.current.forEach(spring => {\n          if (spring.bobA && spring.bobB) {\n            spring.constrainLength(spring.bobA, spring.bobB, 50, 250);\n          } else if (spring.bobA && spring.anchor) {\n            spring.constrainLengthToAnchor(spring.bobA, 50, 250);\n          }\n        });\n        springsRef.current.forEach(spring => spring.show());\n        bobsRef.current.forEach(bob => bob.show());\n      };\n\n      p.mousePressed = () => {\n        bobsRef.current.forEach(bob => {\n          bob.handleMousePressed(p.mouseX, p.mouseY);\n        });\n      };\n\n      p.touchStarted = () => {\n        bobsRef.current.forEach(bob => {\n          bob.handleMousePressed(p.mouseX, p.mouseY);\n        });\n      };\n\n      p.touchEnded = () => {\n        bobsRef.current.forEach(bob => bob.handleMouseReleased());\n      };\n\n      p.mouseReleased = () => {\n        bobsRef.current.forEach(bob => bob.handleMouseReleased());\n      };\n\n      const resize = () => {\n        p.resizeCanvas(\n          Math.max(debounceCanvasConfig.width, p.windowWidth / 2),\n          debounceCanvasConfig.height\n        );\n      };\n\n      p.setup = setup;\n      p.draw = draw;\n      p.windowResized = resize;\n    },\n    [debounceK, debounceNum, debounceCanvasConfig]\n  );\n\n  useEffect(() => {\n    springsRef.current.forEach(spring => {\n      spring.k = debounceK;\n    });\n  }, [debounceK]);\n\n  return (\n    <div className=\"max-w-[90vw] overflow-auto flex items-center shadow justify-around \">\n      <Basic sketch={sketch} showControls={Boolean(showControl)} />\n      {showControl && (\n        <div className=\"w-1/5 toolbox\">\n          <label className=\"select-none\">弹性系数：{debounceK}</label>\n          <Slider\n            defaultValue={[0.2]}\n            max={0.7}\n            min={0.1}\n            step={0.01}\n            className={cn(\"w-[100%] m-4\")}\n            onValueChange={value => {\n              setK(value[0]);\n            }}\n            value={[k]}\n          />\n          <label className=\"select-none\">小球数量：{debounceNum}</label>\n          <Slider\n            defaultValue={[10]}\n            max={20}\n            min={2}\n            step={1}\n            className={cn(\"w-[100%] m-4\")}\n            onValueChange={value => {\n              setNum(value[0]);\n            }}\n            value={[num]}\n          />\n\n          <label className=\"select-none\">\n            canvas width：{canvasConfig.width}\n          </label>\n          <Slider\n            defaultValue={[500]}\n            max={1000}\n            min={100}\n            step={20}\n            className={cn(\"w-[100%] m-4\")}\n            onValueChange={value => {\n              setCanvasConfig({ width: value[0], height: canvasConfig.height });\n            }}\n            value={[canvasConfig.width]}\n          />\n\n          <label className=\"select-none\">\n            canvas height:{canvasConfig.height}\n          </label>\n          <Slider\n            defaultValue={[500]}\n            max={1000}\n            min={100}\n            step={20}\n            className={cn(\"w-[100%] m-4\")}\n            onValueChange={value => {\n              setCanvasConfig({ width: canvasConfig.width, height: value[0] });\n            }}\n            value={[canvasConfig.height]}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default springV2;\n"],"names":["springV2","showControl","k","setK","useState","debounceK","useDebounce","num","setNum","debounceNum","canvasConfig","setCanvasConfig","debounceCanvasConfig","bobsRef","useRef","springsRef","sketch","useCallback","p","width","setup","_","bob","BobBob","i","j","BobSpring","draw","spring","resize","useEffect","jsxs","jsx","Basic","Slider","cn","value"],"mappings":"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"}