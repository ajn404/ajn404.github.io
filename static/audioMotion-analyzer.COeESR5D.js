/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 4.5.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */(function(){try{var W=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new W.Error().stack;e&&(W._sentryDebugIds=W._sentryDebugIds||{},W._sentryDebugIds[e]="b4a79f00-5589-49c2-97b2-a7435a5266f9",W._sentryDebugIdIdentifier="sentry-dbid-b4a79f00-5589-49c2-97b2-a7435a5266f9")}catch{}})();const Pt="4.5.0",ht=Math.PI,Fe=2*ht,at=ht/2,gt=8.17579892,pt="dual-combined",Ve="dual-horizontal",ye="single",Re="dual-vertical",mt="bar-index",Lt="bar-level",je="gradient",Rt=60,wt="click",Xt="fullscreenchange",kt="resize",Wt="#111",Ft="",yt="A",At="B",Et="C",bt="D",St="468",Ye="sans-serif",Ut="#0f0",Vt="#7f7f7f22",De=10,Ct="create",Tt="fschange",Yt="lores",$t=kt,nt="user",jt="#000c",vt="#fff",Qt="#4f4",xt="#888",Kt="#555",rt="bark",qe="linear",Ne="log",lt="mel",Bt=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],Dt=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:Bt}],["rainbow",{dir:"h",colorStops:["#817",...Bt,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],Pe={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:ye,colorMode:je,fadePeaks:!1,fftSize:8192,fillAlpha:1,frequencyScale:Ne,gradient:Dt[0][0],gravity:3.8,height:void 0,ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakFadeTime:750,peakHoldTime:500,peakLine:!1,radial:!1,radialInvert:!1,radius:.3,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:Ft,width:void 0},Jt=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],Zt=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],ei=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],ot=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],ti=["ERR_INVALID_MODE","Invalid mode"],ii=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],si=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],ai=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],ni=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],ri=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class he extends Error{constructor(e,i){const[s,n]=e;super(n+(i!==void 0?`: ${i}`:"")),this.name="AudioMotionError",this.code=s}}const It=(W,e)=>console.warn(`${W} is deprecated. Use ${e} instead.`),Ot=W=>{for(const e in W)return!1;return!0},$e=(W,e,i="toLowerCase")=>e[Math.max(0,e.indexOf((""+W)[i]()))],li=(W,e,i,s,n)=>e+(s-e)*(n-W)/(i-W);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(W){let e=this.length;for(;e-- >0;)if(W(this[e]))return e;return-1});class hi{constructor(e,i={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[],e instanceof Element||(Ot(i)&&!Ot(e)&&(i=e),e=null),this._ownCanvas=!(i.canvas instanceof HTMLCanvasElement);const s=this._ownCanvas?document.createElement("canvas"):i.canvas;s.style="max-width: 100%;",this._ctx=s.getContext("2d");for(const[g,v]of Dt)this.registerGradient(g,v);this._container=e||!this._ownCanvas&&s.parentElement||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let n;if(!(i.source&&(n=i.source.context))){if(!(n=i.audioCtx))try{n=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new he(Jt)}}if(!n.createGain)throw new he(Zt);const d=this._analyzer=[n.createAnalyser(),n.createAnalyser()],r=this._splitter=n.createChannelSplitter(2),l=this._merger=n.createChannelMerger(2);this._input=n.createGain(),this._output=n.createGain(),i.source&&this.connectInput(i.source);for(const g of[0,1])r.connect(d[g],g);l.connect(this._output),i.connectSpeakers!==!1&&this.connectOutput();for(const g of["_scaleX","_scaleR"])this[g]=document.createElement("canvas").getContext("2d");this._fsEl=i.fsElement||s;const h=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas($t),this._fsTimeout=0)},Rt))};window.ResizeObserver&&(this._observer=new ResizeObserver(h),this._observer.observe(this._container)),this._controller=new AbortController;const E=this._controller.signal;window.addEventListener(kt,h,{signal:E}),s.addEventListener(Xt,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(Tt),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},Rt)},{signal:E});const u=()=>{n.state=="suspended"&&n.resume(),window.removeEventListener(wt,u)};window.addEventListener(wt,u),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:E}),this._setProps(i,!0),this.useCanvas&&this._ownCanvas&&this._container.appendChild(s),this._ready=!0,this._setCanvas(Ct)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=$e(e,[ye,Ve,Re,pt]),this._input.disconnect(),this._input.connect(this._chLayout!=ye?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=ye?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=$e(e,[je,mt,Lt])}get fadePeaks(){return this._fadePeaks}set fadePeaks(e){this._fadePeaks=!!e}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const s of[0,1])this._analyzer[s].fftSize=e;const i=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(i),new Float32Array(i)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=$e(e,[Ne,rt,lt,qe]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get gravity(){return this._gravity}set gravity(e){this._gravity=e>0?+e:this._gravity||Pe.gravity}get height(){return this._height}set height(e){this._height=e,this._setCanvas(nt)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(Yt)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const i of[0,1])this._analyzer[i].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new he(ot);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const i of[0,1])this._analyzer[i].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new he(ot);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const i=e|0;if(i>=0&&i<=10&&i!=9)this._mode=i,this._calcBars(),this._makeGrad();else throw new he(ti,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakFadeTime(){return this._peakFadeTime}set peakFadeTime(e){this._peakFadeTime=e>=0?+e:this._peakFadeTime||Pe.peakFadeTime}get peakHoldTime(){return this._peakHoldTime}set peakHoldTime(e){this._peakHoldTime=+e||0}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get radialInvert(){return this._radialInvert}set radialInvert(e){this._radialInvert=!!e,this._calcBars(),this._makeGrad()}get radius(){return this._radius}set radius(e){this._radius=+e||0,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new he(ii);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const i of[0,1])this._analyzer[i].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-at),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return It("stereo","channelLayout"),this._chLayout!=ye}set stereo(e){It("stereo","channelLayout"),this.channelLayout=e?Re:ye}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=$e(e,[Ft,yt,At,Et,bt,St],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(nt)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return Pt}connectInput(e){const i=e instanceof HTMLMediaElement;if(!(i||e.connect))throw new he(si);const s=i?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(s)||(s.connect(this._input),this._sources.push(s)),s}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const i of[0,1])this._analyzer[i].connect(this._chLayout==ye&&!i?this._output:this._merger,0,i)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:i,_controller:s,_input:n,_merger:d,_observer:r,_ownCanvas:l,_ownContext:h,_splitter:E}=this;this._destroyed=!0,this._ready=!1,this.stop(),s.abort(),r&&r.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),n.disconnect(),E.disconnect(),d.disconnect(),h&&e.close(),l&&i.remove(),this._calcBars()}disconnectInput(e,i){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const s of e){const n=this._sources.indexOf(s);if(i&&s.mediaStream)for(const d of s.mediaStream.getAudioTracks())d.stop();n>=0&&(s.disconnect(this._input),this._sources.splice(n,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(i=>i!==e):[],this._outNodes.length==0))for(const i of[0,1])this._analyzer[i].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:i,freqLo:s,freqHi:n,hold:d,peak:r,value:l})=>({posX:e,freq:i,freqLo:s,freqHi:n,hold:d,peak:r,value:l}))}getEnergy(e,i){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const l={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!l[e])return null;[e,i]=l[e]}const s=this._freqToBin(e),n=i?this._freqToBin(i):s,d=this._chLayout==ye?1:2;let r=0;for(let l=0;l<d;l++)for(let h=s;h<=n;h++)r+=this._normalizedB(this._fftData[l][h]);return r/(n-s+1)/d}getOptions(e){Array.isArray(e)||(e=[e]);let i={};for(const s of Object.keys(Pe))e.includes(s)||(s=="gradient"&&this.gradientLeft!=this.gradientRight?(i.gradientLeft=this.gradientLeft,i.gradientRight=this.gradientRight):s!="start"&&(i[s]=this[s]));return i}registerGradient(e,i){if(typeof e!="string"||e.trim().length==0)throw new he(ai);if(typeof i!="object")throw new he(ni);const{colorStops:s}=i;if(!Array.isArray(s)||!s.length)throw new he(ri);const n=s.length,d=r=>+r!=r||r<0||r>1;s.forEach((r,l)=>{const h=l/Math.max(1,n-1);typeof r!="object"?s[l]={pos:h,color:r}:d(r.pos)&&(r.pos=h),d(r.level)&&(s[l].level=1-l/n)}),s.sort((r,l)=>r.level<l.level?1:r.level>l.level?-1:0),s[0].level=1,this._gradients[e]={bgColor:i.bgColor||Wt,dir:i.dir,colorStops:s},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,i){this._width=e,this._height=i,this._setCanvas(nt)}setFreqRange(e,i){if(e<1||i<1)throw new he(ot);this._minFreq=Math.min(e,i),this.maxFreq=Math.max(e,i)}setLedParams(e){let i,s,n;e&&(i=e.maxLeds|0,s=+e.spaceV,n=+e.spaceH),this._ledParams=i>0&&s>0&&n>=0?[i,s,n]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,i){for(const s of[0,1])this._analyzer[s].minDecibels=Math.min(e,i),this._analyzer[s].maxDecibels=Math.max(e,i)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const i=this.isOn;return e===void 0&&(e=!i),i&&!e?(cancelAnimationFrame(this._runId),this._runId=0):!i&&e&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(s=>this._draw(s))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:i,_barSpace:s,canvas:n,_chLayout:d,_maxFreq:r,_minFreq:l,_mirror:h,_mode:E,_radial:u,_radialInvert:g,_reflexRatio:v}=this,H=n.width>>1,Q=n.height>>1,U=d==Re&&!u,V=d==Ve,M=E%10!=0,ne=M&&this._frequencyScale==Ne,R=this._showLeds&&M&&!u,G=this._lumiBars&&M&&!u,ce=this._alphaBars&&!G&&E!=De,ee=this._outlineBars&&M&&!G&&!R,w=this._roundBars&&M&&!G&&!R,K=d!=Re||v>0&&!G,z=n.height-(U&&!R?.5:0)>>U,$=z*(G||u?1:1-v)|0,t=n.width-H*(V||h!=0),J=U?n.height-z*2:0,ue=H*(h==-1&&!V&&!u);let le=Math.min(n.width,n.height)*.375*(d==Re?1:this._radius)|0,O=Math.min(H,Q);g&&d!=Re&&([le,O]=[O,le]);const x=S=>e.push({...S,peak:[0,0],hold:[0],alpha:[0],value:[0]}),y=S=>{const B=this._freqToBin(S,"floor"),p=this._binToFreq(B),L=this._binToFreq(B+1),F=Math.log2(S/p)/Math.log2(L/p);return[B,F]};let _,q,T;if(ne){const S=(C,N,b)=>+C.toPrecision(b?Math.max(N,1+Math.log10(C)|0):N),B=C=>{const N=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],b=Math.log10(C)|0,ge=C/10**b;let fe=1;for(;fe<N.length&&ge>N[fe];)fe++;return ge-N[fe-1]<N[fe]-ge&&fe--,(N[fe]*10**(b+5)|0)/1e5},p=[0,24,12,8,6,4,3,2,1][E],L=i?10**(3/(p*10)):2**(1/p),F=L**.5;let te=i?7.94328235/(p%2?1:F):gt;do{let C=te;const N=S(C/F,4,!0),b=S(C*F,4,!0),[ge,fe]=y(N),[Me,pe]=y(b);i?C=p<4?B(C):S(C,C.toString()[0]<5?3:2):C=S(C,4,!0),C>=l&&x({posX:0,freq:C,freqLo:N,freqHi:b,binLo:ge,binHi:Me,ratioLo:fe,ratioHi:pe}),te*=L}while(te<=r);_=t/e.length,e.forEach((C,N)=>C.posX=ue+N*_);const D=e[0],Z=e[e.length-1];q=this._freqScaling(D.freqLo),T=t/(this._freqScaling(Z.freqHi)-q),D.freqLo<l&&(D.freqLo=l,[D.binLo,D.ratioLo]=y(l)),Z.freqHi>r&&(Z.freqHi=r,[Z.binHi,Z.ratioHi]=y(r))}else if(M){const S=[0,24,12,8,6,4,3,2,1][E]*10,B=p=>{switch(this._frequencyScale){case rt:return 1960/(26.81/(p+.53)-1);case lt:return 700*(2**p-1);case qe:return p}};_=t/S,q=this._freqScaling(l),T=t/(this._freqScaling(r)-q);for(let p=0,L=0;p<S;p++,L+=_){const F=B(q+L/T),te=B(q+(L+_/2)/T),D=B(q+(L+_)/T),[Z,C]=y(F),[N,b]=y(D);x({posX:ue+L,freq:te,freqLo:F,freqHi:D,binLo:Z,binHi:N,ratioLo:C,ratioHi:b})}}else{_=1,q=this._freqScaling(l),T=t/(this._freqScaling(r)-q);const S=this._freqToBin(l,"floor"),B=this._freqToBin(r);let p=-999;for(let L=S;L<=B;L++){const F=this._binToFreq(L),te=ue+Math.round(T*(this._freqScaling(F)-q));if(te>p)x({posX:te,freq:F,freqLo:F,freqHi:F,binLo:L,binHi:L,ratioLo:0,ratioHi:0}),p=te;else if(e.length){const D=e[e.length-1];D.binHi=L,D.freqHi=F,D.freq=(D.freqLo*F)**.5}}}let se=0,X=0;if(R){const S=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),B=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],p=this._ledParams,[L,F,te]=p||B[E];let D,Z=$;if(p){const C=2*S;let N;D=L+1;do D--,N=Z/D/(1+F),X=N*F;while((N<C||X<C)&&D>1)}else{const C=540/F;X=Math.min(F*S,Math.max(2,Z/C+.1|0))}K&&(Z+=X),p||(D=Math.min(L,Z/(X*2)|0)),se=te>=1?te:_*te,this._leds=[D,se,X,Z/D-X]}const A=Math.min(_-1,s*(s>0&&s<1?_:1));M&&(_-=Math.max(R?se:0,A)),e.forEach((S,B)=>{let p=S.posX,L=_;M&&(s==0&&!R?(p|=0,L|=0,B>0&&p>e[B-1].posX+e[B-1].width&&(p--,L++)):p+=Math.max(R?se:0,A)/2,S.posX=p),S.barCenter=p+(_==1?0:L/2),S.width=L});const de=[];for(const S of[0,1]){const B=d==Re?(z+J)*S:0,p=B+z,L=B+$-(!R||K?0:X);de.push({channelTop:B,channelBottom:p,analyzerBottom:L})}this._aux={analyzerHeight:$,analyzerWidth:t,centerX:H,centerY:Q,channelCoords:de,channelHeight:z,channelGap:J,initialX:ue,innerRadius:le,outerRadius:O,scaleMin:q,unitWidth:T},this._flg={isAlpha:ce,isBands:M,isLeds:R,isLumi:G,isOctaves:ne,isOutline:ee,isRound:w,noLedGap:K},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:i,innerRadius:s,scaleMin:n,unitWidth:d}=this._aux,{canvas:r,_frequencyScale:l,_mirror:h,_noteLabels:E,_radial:u,_scaleX:g,_scaleR:v}=this,H=g.canvas,Q=v.canvas,U=[],V=this._chLayout==Ve,M=this._chLayout==Re,ne=Math.min(r.width,r.height),R=["C",,"D",,"E","F",,"G",,"A",,"B"],G=ne/34|0,ce=H.height>>1,ee=G>>1,w=ce*(E?.7:1.5),K=ee*(E?1:2),z=2**(1/12);if(!E&&(this._ansiBands||l!=Ne))U.push(16,31.5,63,125,250,500,1e3,2e3,4e3),l==qe?U.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):U.push(8e3,16e3);else{let O=gt;for(let x=-1;x<11;x++)for(let y=0;y<12;y++){if(O>=this._minFreq&&O<=this._maxFreq){const _=R[y],q=_=="C";(_&&E&&!h&&!V||q)&&U.push(E?[O,_+(q?x:"")]:O)}O*=z}}Q.width=Q.height=Math.max(ne*.15,(s<<1)+M*G);const $=Q.width>>1,t=$-G*.7,J=(O,x)=>{const y=Fe*(O/r.width),_=y-at,q=t*Math.cos(_),T=t*Math.sin(_);v.save(),v.translate($+q,$+T),v.rotate(y),v.fillText(x,0,0),v.restore()};H.width|=0,g.fillStyle=v.strokeStyle=jt,g.fillRect(0,0,H.width,H.height),v.arc($,$,$-G/2,0,Fe),v.lineWidth=G,v.stroke(),g.fillStyle=v.fillStyle=vt,g.font=`${ce}px ${Ye}`,v.font=`${ee}px ${Ye}`,g.textAlign=v.textAlign="center";let ue=-w/4,le=-K;for(const O of U){const[x,y]=Array.isArray(O)?O:[O,O<1e3?O|0:`${(O/100|0)/10}k`],_=d*(this._freqScaling(x)-n),q=H.height*.75,T=y[0]=="C",se=ce*(E&&!h&&!V?T?1.2:.6:3);if(g.fillStyle=v.fillStyle=T&&!h&&!V?Qt:vt,E){const X=l==Ne,A=l==qe;let de=["C"];if((X||x>2e3||!A&&x>250||(!u||M)&&(!A&&x>125||x>1e3))&&de.push("G"),(X||x>4e3||!A&&x>500||(!u||M)&&(!A&&x>250||x>2e3))&&de.push("E"),(A&&x>4e3||(!u||M)&&(X||x>2e3||!A&&x>500))&&de.push("D","F","A","B"),!de.includes(y[0]))continue}_>=ue+w/2&&_<=e&&(g.fillText(y,V&&h==-1?e-_:i+_,q,se),(V||h&&(_>w||h==1))&&g.fillText(y,V&&h!=1?e+_:(i||r.width)-_,q,se),ue=_+Math.min(se,g.measureText(y).width)/2),_>=le+K&&_<e-K&&(J(V&&h==1?e-_:_,y),(V||h&&(_>K||h==1))&&J(V&&h!=-1?e+_:-_,y),le=_)}}_draw(e){this._runId=requestAnimationFrame(a=>this._draw(a));const i=e-this._time,s=e-this._last,n=this._maxFPS?975/this._maxFPS:0;if(s<n)return;this._last=e-(n?s%n:0),this._frames++,i>=1e3&&(this._fps=this._frames/i*1e3,this._frames=0,this._time=e);const{isAlpha:d,isBands:r,isLeds:l,isLumi:h,isOctaves:E,isOutline:u,isRound:g,noLedGap:v}=this._flg,{analyzerHeight:H,centerX:Q,centerY:U,channelCoords:V,channelHeight:M,channelGap:ne,initialX:R,innerRadius:G,outerRadius:ce}=this._aux,{_bars:ee,canvas:w,_canvasGradients:K,_chLayout:z,_colorMode:$,_ctx:t,_energy:J,_fadePeaks:ue,fillAlpha:le,_fps:O,_linearAmplitude:x,_lineWidth:y,maxDecibels:_,minDecibels:q,_mirror:T,_mode:se,overlay:X,_radial:A,showBgColor:de,showPeaks:S,useCanvas:B,_weightingFilter:p}=this,L=this._scaleX.canvas,F=this._scaleR.canvas,te=O*this._peakFadeTime/1e3,D=O**2,Z=this._gravity*1e3,C=O*this._peakHoldTime/1e3,N=z==pt,b=z==Ve,ge=z==Re,fe=z==ye,Me=l&&this._trueLeds&&$==je,pe=A?w.width:this._aux.analyzerWidth,Qe=R+pe,Ge=S&&this._peakLine&&se==De,Ae=A?ce-G:H,Nt=Ae/this._pixelRatio,[Mt,oi,He,Ke]=this._leds||[];J.val>0&&O>0&&(this._spinAngle+=this._spinSpeed*Fe/60/O);const Gt=a=>{if(this._reflexRatio>0&&!h&&!A){let m,me;this.reflexFit||ge?(m=ge&&a==0?M+ne:0,me=M-H):(m=w.height-H*2,me=H),t.save(),t.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(t.filter=`brightness(${this.reflexBright})`),t.setTransform(1,0,0,-1,0,w.height),t.drawImage(w,0,V[a].channelTop,w.width,H,0,m,w.width,me),t.restore()}},Ht=()=>{this.showScaleX&&(A?(t.save(),t.translate(Q,U),this._spinSpeed&&t.rotate(this._spinAngle+at),t.drawImage(F,-F.width>>1,-F.width>>1),t.restore()):t.drawImage(L,0,w.height-L.height))},zt=a=>{const m=a**2,me=424.36,j=11599.29,Xe=25122.25,Ee=544496.41,we=148693636,Te=ve=>20*Math.log10(ve);switch(p){case yt:const ve=we*m**2/((m+me)*Math.sqrt((m+j)*(m+Ee))*(m+we));return 2+Te(ve);case At:const xe=we*m*a/((m+me)*Math.sqrt(m+Xe)*(m+we));return .17+Te(xe);case Et:const et=we*m/((m+me)*(m+we));return .06+Te(et);case bt:const We=((103791848e-2-m)**2+108076816e-2*m)/((9837328-m)**2+11723776*m),tt=a/68966888496476e-18*Math.sqrt(We/((m+79919.29)*(m+1345600)));return Te(tt);case St:const Ue=-4737338981378384e-39*a**6+2043828333606125e-30*a**4-1363894795463638e-22*m+1,Be=1306612257412824e-34*a**5-2118150887518656e-26*a**3+.0005559488023498642*a,re=.0001246332637532143*a/Math.hypot(Ue,Be);return 18.2+Te(re)}return 0},Je=(a,m,me)=>{t.beginPath(),t.moveTo(a,m),t.lineTo(a,me),t.stroke()},Ze=a=>{if(a&&y){const m=t.globalAlpha;t.globalAlpha=1,t.stroke(),t.globalAlpha=m}},Ce=a=>Math.max(0,(a*Mt|0)*(Ke+He)-He),qt=a=>{J.val=a,J.peak>0&&(J.hold--,J.hold<0&&(J.peak+=J.hold*Z/D/w.height*this._pixelRatio)),a>=J.peak&&(J.peak=a,J.hold=C)};X&&t.clearRect(0,0,w.width,w.height);let ct=0;const dt=ee.length,ft=fe?1:2;for(let a=0;a<ft;a++){const{channelTop:m,channelBottom:me,analyzerBottom:j}=V[a],Xe=this._gradients[this._selectedGrads[a]],Ee=Xe.colorStops,we=Ee.length,Te=!de||l&&!X?"#000":Xe.bgColor,ve=ge&&A&&a?-1:1,xe=!a&&T==-1||a&&T==1,et=!b||a&&T!=1?0:pe>>(a||!xe),We=b&&xe?-1:1,tt=()=>{const o=L.height,c=o>>1,f=x?100:_,k=x?0:q,P=x?20:5,ae=H/(f-k),Le=T!=-1&&(!b||a==0||T==1),be=T!=1&&(!b||a!=T);t.save(),t.fillStyle=xt,t.font=`${c}px ${Ye}`,t.textAlign="right",t.lineWidth=1;for(let Se=f;Se>k;Se-=P){const Oe=m+(f-Se)*ae,Y=Se%2==0|0;if(Y){const ie=Oe+c*(Oe==m?.8:.35);Le&&t.fillText(Se,o*.85,ie),be&&t.fillText(Se,(b?pe:w.width)-o*.1,ie),t.strokeStyle=xt,t.setLineDash([2,4]),t.lineDashOffset=0}else t.strokeStyle=Kt,t.setLineDash([2,8]),t.lineDashOffset=1;t.beginPath(),t.moveTo(R+o*Y*Le,~~Oe+.5),t.lineTo(Qe-o*Y*be,~~Oe+.5),t.stroke()}t.restore()},Ue=(o,c)=>{const f=_e[o]+(o<_e.length-1?(_e[o+1]-_e[o])*c:0);return isNaN(f)?-1/0:f},Be=(o,c=We)=>c*Fe*((o+et)/w.width)+this._spinAngle,re=(o,c,f)=>{const k=G+c*ve,P=Be(o,f);return[Q+k*Math.cos(P),U+k*Math.sin(P)]},it=(o,c,f,k,P)=>{t.beginPath();for(const ae of T&&!b?[1,-1]:[We]){const[Le,be]=g?[Be(o,ae),Be(o+f,ae)]:[];t.moveTo(...re(o,c,ae)),t.lineTo(...re(o,c+k,ae)),g?t.arc(Q,U,G+(c+k)*ve,Le,be,ae!=1):t.lineTo(...re(o+f,c+k,ae)),t.lineTo(...re(o+f,c,ae)),g&&!P&&t.arc(Q,U,G+c*ve,be,Le,ae==1)}Ze(P),t.fill()},st=(o=0,c=0)=>{let f;if($==je&&!Me||se==De)f=K[a];else{const k=$==mt?c%we:Ee.findLastIndex(P=>l?Ce(o)<=Ce(P.level):o<=P.level);f=Ee[k].color}t.fillStyle=t.strokeStyle=f};if(B){if(b&&!A){const o=pe*(a+xe),c=xe?-1:1;t.setTransform(c,0,0,1,o,0)}if((!X||de)&&(X&&(t.globalAlpha=this.bgAlpha),t.fillStyle=Te,(a==0||!A&&!N)&&t.fillRect(R,m-ne,pe,(X&&this.reflexAlpha==1?H:M)+ne),t.globalAlpha=1),this.showScaleY&&!h&&!A&&(a==0||!N)&&tt(),l?(t.setLineDash([Ke,He]),t.lineWidth=ee[0].width):t.lineWidth=u?Math.min(y,ee[0].width/2):y,t.save(),!A){const o=new Path2D;o.rect(0,m,w.width,H),t.clip(o)}}let _e=this._fftData[a];this._analyzer[a].getFloatFrequencyData(_e),p&&(_e=_e.map((o,c)=>o+zt(this._binToFreq(c)))),t.beginPath();let ze=[];for(let o=0;o<dt;o++){const c=ee[o],{posX:f,barCenter:k,width:P,freq:ae,binLo:Le,binHi:be,ratioLo:Se,ratioHi:Oe}=c;let Y=Math.max(Ue(Le,Se),Ue(be,Oe));for(let I=Le+1;I<be;I++)_e[I]>Y&&(Y=_e[I]);if(Y=this._normalizedB(Y),c.value[a]=Y,ct+=Y,c.peak[a]>0&&c.alpha[a]>0&&(c.hold[a]--,c.hold[a]<0)){if(ue&&!Ge){const I=!d||u&&y>0?1:d?c.peak[a]:le;c.alpha[a]=I*(1+c.hold[a]/te)}else c.peak[a]+=c.hold[a]*Z/D/Nt;c.alpha[a]<=0&&(c.peak[a]=0)}if(Y>=c.peak[a]&&(c.peak[a]=Y,c.hold[a]=C,c.alpha[a]=!d||u&&y>0?1:d?Y:le),!B)continue;t.globalAlpha=h||d?Y:u?le:1,st(Y,o);const ie=h?Ae:l?Ce(Y):Y*Ae|0;if(se==De){const I=o?0:(this._normalizedB(_e[ee[1].binLo])*Ae+ie)/2;if(A){if(o==0&&(b&&t.moveTo(...re(0,0)),t.lineTo(...re(0,f<0?I:ie))),f>=0){const oe=[f,ie];t.lineTo(...re(...oe)),ze.push(oe)}}else{if(o==0)if(T==-1&&!b)t.moveTo(R,j-(f<R?I:ie));else{const oe=Le?this._normalizedB(_e[Le-1])*Ae:ie;t.moveTo(R-y,j-oe)}(b||T!=-1||f>=R)&&t.lineTo(f,j-ie)}}else if(l){if(de&&!X&&(a==0||!N)){const I=t.globalAlpha;t.strokeStyle=Vt,t.globalAlpha=1,Je(k,m,j),t.strokeStyle=t.fillStyle,t.globalAlpha=I}if(Me){const I=h?0:Ee.findLastIndex(Ie=>Ce(Y)<=Ce(Ie.level));let oe=j;for(let Ie=we-1;Ie>=I;Ie--){t.strokeStyle=Ee[Ie].color;let ut=j-(Ie==I?ie:Ce(Ee[Ie].level));Je(k,oe,ut),oe=ut-He}}else Je(k,j,j-ie)}else if(f>=R)if(A)it(f,0,P,ie,u);else if(g){const I=P/2,oe=j+I;t.beginPath(),t.moveTo(f,oe),t.lineTo(f,oe-ie),t.arc(k,oe-ie,I,ht,Fe),t.lineTo(f+P,oe),Ze(u),t.fill()}else{const I=u?t.lineWidth:0;t.beginPath(),t.rect(f,j+I,P,-ie-I),Ze(u),t.fill()}const ke=c.peak[a],_t=c.alpha[a];if(ke>0&&_t>0&&S&&!Ge&&!h&&f>=R&&f<Qe){if(ue?t.globalAlpha=_t:u&&y>0?t.globalAlpha=1:d&&(t.globalAlpha=ke),($==Lt||Me)&&st(ke),l){const I=Ce(ke);I>=He&&t.fillRect(f,j-I,P,Ke)}else if(!A)t.fillRect(f,j-ke*Ae,P,2);else if(se!=De){const I=ke*Ae;it(f,I,P,!this._radialInvert||ge||I+G>=2?-2:2)}}}if(B){if(t.globalAlpha=1,se==De){if(st(),A&&!b){if(T){let o;for(;o=ze.pop();)t.lineTo(...re(...o,-1))}t.closePath()}if(y>0&&t.stroke(),le>0){if(A){const o=b?Be(pe>>1):0,c=b?Be(pe):Fe;t.moveTo(...re(b?pe>>1:0,0)),t.arc(Q,U,G,o,c,b?!xe:!0)}else t.lineTo(Qe,j),t.lineTo(R,j);t.globalAlpha=le,t.fill(),t.globalAlpha=1}if((Ge||A&&S)&&(ze=[],t.beginPath(),ee.forEach((o,c)=>{let f=o.posX,k=o.peak[a],P=c?"lineTo":"moveTo";if(A&&f<0){const ae=ee[c+1];k=li(f,k,ae.posX,ae.peak[a],0),f=0}k*=Ae,Ge?(t[P](...A?re(f,k):[f,j-k]),A&&T&&!b&&ze.push([f,k])):k>0&&it(f,k,1,-2)}),Ge)){let o;for(;o=ze.pop();)t.lineTo(...re(...o,-1));t.lineWidth=1,t.stroke()}}t.restore(),b&&!A&&t.setTransform(1,0,0,1,0,0),(!b&&!N||a)&&Gt(a)}}if(qt(ct/(dt<<ft-1)),B&&(T&&!A&&!b&&(t.setTransform(-1,0,0,1,w.width-R,0),t.drawImage(w,R,0,Q,w.height,0,0,Q,w.height),t.setTransform(1,0,0,1,0,0)),t.setLineDash([]),Ht()),this.showFPS){const a=L.height;t.font=`bold ${a}px ${Ye}`,t.fillStyle=Ut,t.textAlign="right",t.fillText(Math.round(O),w.width-a,a*2)}this.onCanvasDraw&&(t.save(),t.fillStyle=t.strokeStyle=K[0],this.onCanvasDraw(this,{timestamp:e,canvasGradients:K}),t.restore())}_freqScaling(e){switch(this._frequencyScale){case Ne:return Math.log2(e);case rt:return 26.81*e/(1960+e)-.53;case lt:return Math.log2(1+e/700);case qe:return e}}_freqToBin(e,i="round"){const s=this._analyzer[0].frequencyBinCount-1,n=Math[i](e*this.fftSize/this.audioCtx.sampleRate);return n<s?n:s}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:i,_radial:s,_reflexRatio:n}=this,{analyzerWidth:d,centerX:r,centerY:l,initialX:h,innerRadius:E,outerRadius:u}=this._aux,{isLumi:g}=this._flg,v=this._chLayout==Re,H=1-n,Q=g?e.height:e.height*(1-n*!v)|0;for(const U of[0,1]){const V=this._gradients[this._selectedGrads[U]],M=V.colorStops,ne=V.dir=="h";let R;if(s?R=i.createRadialGradient(r,l,u,r,l,E-(u-E)*v):R=i.createLinearGradient(...ne?[h,0,h+d,0]:[0,0,0,Q]),M){const G=v&&!this._splitGradient&&(!ne||s);for(let ce=0;ce<1+G;ce++){const ee=M.length-1;M.forEach((w,K)=>{let z=w.pos;if(G&&(z/=2),v&&!g&&!s&&!ne&&(z*=H,!G&&z>.5*H&&(z+=.5*n)),ce==1)if(s||g){const $=ee-K;w=M[$],z=1-w.pos/2}else K==0&&z>0&&R.addColorStop(.5,w.color),z+=.5;R.addColorStop(z,w.color),v&&K==ee&&z<.5&&R.addColorStop(.5,w.color)})}}this._canvasGradients[U]=R}}_normalizedB(e){const i=this._linearAmplitude,s=i?1/this._linearBoost:1,n=(h,E,u)=>h<=E?E:h>=u?u:h,d=h=>10**(h/20);let r=this.maxDecibels,l=this.minDecibels;return i&&(r=d(r),l=d(l),e=d(e)**s),n((e-l)/(r-l)**s,0,1)}_setCanvas(e){if(!this._ready)return;const{canvas:i,_ctx:s}=this,n=this._scaleX.canvas,d=window.devicePixelRatio/(this._loRes+1);let r=window.screen.width*d,l=window.screen.height*d;Math.abs(window.orientation)==90&&r<l&&([r,l]=[l,r]);const h=this.isFullscreen,E=h&&this._fsEl==i,u=E?r:(this._width||this._container.clientWidth||this._defaultWidth)*d|0,g=E?l:(this._height||this._container.clientHeight||this._defaultHeight)*d|0;this._pixelRatio=d,this._fsWidth=r,this._fsHeight=l,!(e!=Ct&&i.width==u&&i.height==g)&&(i.width=u,i.height=g,this.overlay||(s.fillStyle="#000",s.fillRect(0,0,u,g)),s.lineJoin="bevel",n.width=u,n.height=Math.max(20*d,Math.min(u,g)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==h&&(e=Tt),this._fsStatus=h,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,i){if(!this._gradients.hasOwnProperty(e))throw new he(ei,e);[0,1].includes(i)||(this._selectedGrads[1]=e,i=0),this._selectedGrads[i]=e,this._makeGrad()}_setProps(e,i){const s=["onCanvasDraw","onCanvasResize"],n=["gradientLeft","gradientRight","stereo"],d=Object.keys(Pe).filter(r=>r!="start").concat(s,n);(i||e===void 0)&&(e={...Pe,...e});for(const r of Object.keys(e))s.includes(r)&&typeof e[r]!="function"?this[r]=void 0:d.includes(r)&&(this[r]=e[r]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}export{hi as A};
//# sourceMappingURL=audioMotion-analyzer.COeESR5D.js.map
