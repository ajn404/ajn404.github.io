import{j as jsxRuntimeExports}from"./jsx-runtime.DZ3s2XAB.js";import{aD as MeshDistanceMaterial,aE as MeshDepthMaterial,aF as RGBADepthPacking,U as UniformsUtils,aG as ShaderChunk,f as Mesh,e as MeshBasicMaterial,p as Color,d as Vector3,v as Matrix4,V as Vector2,aH as InstancedBufferGeometry,an as Sphere,am as Box3,w as InstancedBufferAttribute,a as Texture,H as LinearFilter,aI as Matrix3,ao as Vector4,a0 as DoubleSide,P as PlaneGeometry,aJ as REVISION,S as ShaderMaterial,aK as NoBlending,aL as Uniform,aM as WebGLRenderTarget,aN as HalfFloatType,b as Scene,ax as Camera,a2 as BufferGeometry,B as BufferAttribute,$ as MeshStandardMaterial,j as Plane,c as PerspectiveCamera,aO as DepthTexture,aP as DepthFormat,aQ as UnsignedShortType,Q as Quaternion}from"./three.module.BN9nGcjX.js";import{r as reactExports,R as React}from"./index.D4IXJ7me.js";import{u as useThree,s as suspend,e as extend,b as useFrame,C as Canvas}from"./react-three-fiber.esm.DyszzK9N.js";import{s as shimExports}from"./index.a17AFfOI.js";import{e as easing}from"./easing-0f4db1c0.esm.ChcYbd4l.js";import{c as commonjsGlobal,g as getDefaultExportFromCjs}from"./_commonjsHelpers.DqoTaOmB.js";import"./_sentry-release-injection-file.B-UwqLso.js";import{_ as _extends}from"./extends.BdUe_S6O.js";import{s as shaderMaterial}from"./shaderMaterial.CxB1mKoW.js";import{u as useTexture}from"./Texture.K6QlXbwF.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new a.Error().stack;t&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[t]="d6ed967d-856f-4214-8fe6-f561fc764eb9",a._sentryDebugIdIdentifier="sentry-dbid-d6ed967d-856f-4214-8fe6-f561fc764eb9")}catch{}})();function useCursor(a,t="pointer",f="auto",s=document.body){reactExports.useEffect(()=>{if(a)return s.style.cursor=t,()=>void(s.style.cursor=f)},[a])}function workerBootstrap(){var a=Object.create(null);function t(r,e){var n=r.id,i=r.name,o=r.dependencies;o===void 0&&(o=[]);var l=r.init;l===void 0&&(l=function(){});var u=r.getTransferables;if(u===void 0&&(u=null),!a[n])try{o=o.map(function(h){return h&&h.isWorkerModule&&(t(h,function(d){if(d instanceof Error)throw d}),h=a[h.id].value),h}),l=s("<"+i+">.init",l),u&&(u=s("<"+i+">.getTransferables",u));var c=null;typeof l=="function"?c=l.apply(void 0,o):console.error("worker module init function failed to rehydrate"),a[n]={id:n,value:c,getTransferables:u},e(c)}catch(h){h&&h.noLog||console.error(h),e(h)}}function f(r,e){var n,i=r.id,o=r.args;(!a[i]||typeof a[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var l=(n=a[i]).value.apply(n,o);l&&typeof l.then=="function"?l.then(u,function(c){return e(c instanceof Error?c:new Error(""+c))}):u(l)}catch(c){e(c)}function u(c){try{var h=a[i].getTransferables&&a[i].getTransferables(c);(!h||!Array.isArray(h)||!h.length)&&(h=void 0),e(c,h)}catch(d){console.error(d),e(d)}}}function s(r,e){var n=void 0;self.troikaDefine=function(o){return n=o};var i=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(o){console.error(o)}return URL.revokeObjectURL(i),delete self.troikaDefine,n}self.addEventListener("message",function(r){var e=r.data,n=e.messageId,i=e.action,o=e.data;try{i==="registerModule"&&t(o,function(l){l instanceof Error?postMessage({messageId:n,success:!1,error:l.message}):postMessage({messageId:n,success:!0,result:{isCallable:typeof l=="function"}})}),i==="callModule"&&f(o,function(l,u){l instanceof Error?postMessage({messageId:n,success:!1,error:l.message}):postMessage({messageId:n,success:!0,result:l},u||void 0)})}catch(l){postMessage({messageId:n,success:!1,error:l.stack})}})}function defineMainThreadModule(a){var t=function(){for(var f=[],s=arguments.length;s--;)f[s]=arguments[s];return t._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,f);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var f=a.dependencies,s=a.init;f=Array.isArray(f)?f.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var r=Promise.all(f).then(function(e){return s.apply(null,e)});return t._getInitResult=function(){return r},r},t}var supportsWorkers=function(){var a=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),a=!0}catch(f){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+f.message+"]")}return supportsWorkers=function(){return a},a},_workerModuleId=0,_messageId=0,_allowInitAsString=!1,workers=Object.create(null),registeredModules=Object.create(null),openRequests=Object.create(null);function defineWorkerModule(a){if((!a||typeof a.init!="function")&&!_allowInitAsString)throw new Error("requires `options.init` function");var t=a.dependencies,f=a.init,s=a.getTransferables,r=a.workerId,e=defineMainThreadModule(a);r==null&&(r="#default");var n="workerModule"+ ++_workerModuleId,i=a.name||n,o=null;t=t&&t.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(_allowInitAsString=!0,u=defineWorkerModule({workerId:r,name:"<"+i+"> function dependency: "+u.name,init:`function(){return (
`+stringifyFunction(u)+`
)}`}),_allowInitAsString=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function l(){for(var u=[],c=arguments.length;c--;)u[c]=arguments[c];if(!supportsWorkers())return e.apply(void 0,u);if(!o){o=callWorker(r,"registerModule",l.workerModuleData);var h=function(){o=null,registeredModules[r].delete(h)};(registeredModules[r]||(registeredModules[r]=new Set)).add(h)}return o.then(function(d){var p=d.isCallable;if(p)return callWorker(r,"callModule",{id:n,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return l.workerModuleData={isWorkerModule:!0,id:n,name:i,dependencies:t,init:stringifyFunction(f),getTransferables:s&&stringifyFunction(s)},l.onMainThread=e,l}function terminateWorker(a){registeredModules[a]&&registeredModules[a].forEach(function(t){t()}),workers[a]&&(workers[a].terminate(),delete workers[a])}function stringifyFunction(a){var t=a.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function getWorker(a){var t=workers[a];if(!t){var f=stringifyFunction(workerBootstrap);t=workers[a]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+a.replace(/\*/g,"")+` **/

;(`+f+")()"],{type:"application/javascript"}))),t.onmessage=function(s){var r=s.data,e=r.messageId,n=openRequests[e];if(!n)throw new Error("WorkerModule response with empty or unknown messageId");delete openRequests[e],n(r)}}return t}function callWorker(a,t,f){return new Promise(function(s,r){var e=++_messageId;openRequests[e]=function(n){n.success?s(n.result):r(new Error("Error in worker "+t+" call: "+n.error))},getWorker(a).postMessage({messageId:e,action:t,data:f})})}function SDFGenerator(){var a=function(t){function f(G,D,v,x,b,k,E,H){var M=1-E;H.x=M*M*G+2*M*E*v+E*E*b,H.y=M*M*D+2*M*E*x+E*E*k}function s(G,D,v,x,b,k,E,H,M,L){var Y=1-M;L.x=Y*Y*Y*G+3*Y*Y*M*v+3*Y*M*M*b+M*M*M*E,L.y=Y*Y*Y*D+3*Y*Y*M*x+3*Y*M*M*k+M*M*M*H}function r(G,D){for(var v=/([MLQCZ])([^MLQCZ]*)/g,x,b,k,E,H;x=v.exec(G);){var M=x[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(L){return parseFloat(L)});switch(x[1]){case"M":E=b=M[0],H=k=M[1];break;case"L":(M[0]!==E||M[1]!==H)&&D("L",E,H,E=M[0],H=M[1]);break;case"Q":{D("Q",E,H,E=M[2],H=M[3],M[0],M[1]);break}case"C":{D("C",E,H,E=M[4],H=M[5],M[0],M[1],M[2],M[3]);break}case"Z":(E!==b||H!==k)&&D("L",E,H,b,k);break}}}function e(G,D,v){v===void 0&&(v=16);var x={x:0,y:0};r(G,function(b,k,E,H,M,L,Y,ee,V){switch(b){case"L":D(k,E,H,M);break;case"Q":{for(var N=k,pe=E,ue=1;ue<v;ue++)f(k,E,L,Y,H,M,ue/(v-1),x),D(N,pe,x.x,x.y),N=x.x,pe=x.y;break}case"C":{for(var Z=k,te=E,se=1;se<v;se++)s(k,E,L,Y,ee,V,H,M,se/(v-1),x),D(Z,te,x.x,x.y),Z=x.x,te=x.y;break}}})}var n="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",o=new WeakMap,l={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(G,D){var v=G.getContext?G.getContext("webgl",l):G,x=o.get(v);if(!x){let Y=function(Z){var te=k[Z];if(!te&&(te=k[Z]=v.getExtension(Z),!te))throw new Error(Z+" not supported");return te},ee=function(Z,te){var se=v.createShader(te);return v.shaderSource(se,Z),v.compileShader(se),se},V=function(Z,te,se,z){if(!E[Z]){var re={},q={},I=v.createProgram();v.attachShader(I,ee(te,v.VERTEX_SHADER)),v.attachShader(I,ee(se,v.FRAGMENT_SHADER)),v.linkProgram(I),E[Z]={program:I,transaction:function(Q){v.useProgram(I),Q({setUniform:function(J,ye){for(var ne=[],oe=arguments.length-2;oe-- >0;)ne[oe]=arguments[oe+2];var fe=q[ye]||(q[ye]=v.getUniformLocation(I,ye));v["uniform"+J].apply(v,[fe].concat(ne))},setAttribute:function(J,ye,ne,oe,fe){var de=re[J];de||(de=re[J]={buf:v.createBuffer(),loc:v.getAttribLocation(I,J),data:null}),v.bindBuffer(v.ARRAY_BUFFER,de.buf),v.vertexAttribPointer(de.loc,ye,v.FLOAT,!1,0,0),v.enableVertexAttribArray(de.loc),b?v.vertexAttribDivisor(de.loc,oe):Y("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(de.loc,oe),fe!==de.data&&(v.bufferData(v.ARRAY_BUFFER,fe,ne),de.data=fe)}})}}}E[Z].transaction(z)},N=function(Z,te){M++;try{v.activeTexture(v.TEXTURE0+M);var se=H[Z];se||(se=H[Z]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,se),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,se),te(se,M)}finally{M--}},pe=function(Z,te,se){var z=v.createFramebuffer();L.push(z),v.bindFramebuffer(v.FRAMEBUFFER,z),v.activeTexture(v.TEXTURE0+te),v.bindTexture(v.TEXTURE_2D,Z),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,Z,0);try{se(z)}finally{v.deleteFramebuffer(z),v.bindFramebuffer(v.FRAMEBUFFER,L[--L.length-1]||null)}},ue=function(){k={},E={},H={},M=-1,L.length=0};var b=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,k={},E={},H={},M=-1,L=[];v.canvas.addEventListener("webglcontextlost",function(Z){ue(),Z.preventDefault()},!1),o.set(v,x={gl:v,isWebGL2:b,getExtension:Y,withProgram:V,withTexture:N,withTextureFramebuffer:pe,handleContextLoss:ue})}D(x)}function c(G,D,v,x,b,k,E,H){E===void 0&&(E=15),H===void 0&&(H=null),u(G,function(M){var L=M.gl,Y=M.withProgram,ee=M.withTexture;ee("copy",function(V,N){L.texImage2D(L.TEXTURE_2D,0,L.RGBA,b,k,0,L.RGBA,L.UNSIGNED_BYTE,D),Y("copy",n,i,function(pe){var ue=pe.setUniform,Z=pe.setAttribute;Z("aUV",2,L.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ue("1i","image",N),L.bindFramebuffer(L.FRAMEBUFFER,H||null),L.disable(L.BLEND),L.colorMask(E&8,E&4,E&2,E&1),L.viewport(v,x,b,k),L.scissor(v,x,b,k),L.drawArrays(L.TRIANGLES,0,3)})})})}function h(G,D,v){var x=G.width,b=G.height;u(G,function(k){var E=k.gl,H=new Uint8Array(x*b*4);E.readPixels(0,0,x,b,E.RGBA,E.UNSIGNED_BYTE,H),G.width=D,G.height=v,c(E,H,0,0,x,b)})}var d=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:c,resizeWebGLCanvasWithoutClearing:h});function p(G,D,v,x,b,k){k===void 0&&(k=1);var E=new Uint8Array(G*D),H=x[2]-x[0],M=x[3]-x[1],L=[];e(v,function(Z,te,se,z){L.push({x1:Z,y1:te,x2:se,y2:z,minX:Math.min(Z,se),minY:Math.min(te,z),maxX:Math.max(Z,se),maxY:Math.max(te,z)})}),L.sort(function(Z,te){return Z.maxX-te.maxX});for(var Y=0;Y<G;Y++)for(var ee=0;ee<D;ee++){var V=pe(x[0]+H*(Y+.5)/G,x[1]+M*(ee+.5)/D),N=Math.pow(1-Math.abs(V)/b,k)/2;V<0&&(N=1-N),N=Math.max(0,Math.min(255,Math.round(N*255))),E[ee*G+Y]=N}return E;function pe(Z,te){for(var se=1/0,z=1/0,re=L.length;re--;){var q=L[re];if(q.maxX+z<=Z)break;if(Z+z>q.minX&&te-z<q.maxY&&te+z>q.minY){var I=O(Z,te,q.x1,q.y1,q.x2,q.y2);I<se&&(se=I,z=Math.sqrt(se))}}return ue(Z,te)&&(z=-z),z}function ue(Z,te){for(var se=0,z=L.length;z--;){var re=L[z];if(re.maxX<=Z)break;var q=re.y1>te!=re.y2>te&&Z<(re.x2-re.x1)*(te-re.y1)/(re.y2-re.y1)+re.x1;q&&(se+=re.y1<re.y2?1:-1)}return se!==0}}function m(G,D,v,x,b,k,E,H,M,L){k===void 0&&(k=1),H===void 0&&(H=0),M===void 0&&(M=0),L===void 0&&(L=0),g(G,D,v,x,b,k,E,null,H,M,L)}function g(G,D,v,x,b,k,E,H,M,L,Y){k===void 0&&(k=1),M===void 0&&(M=0),L===void 0&&(L=0),Y===void 0&&(Y=0);for(var ee=p(G,D,v,x,b,k),V=new Uint8Array(ee.length*4),N=0;N<ee.length;N++)V[N*4+Y]=ee[N];c(E,V,M,L,G,D,1<<3-Y,H)}function O(G,D,v,x,b,k){var E=b-v,H=k-x,M=E*E+H*H,L=M?Math.max(0,Math.min(1,((G-v)*E+(D-x)*H)/M)):0,Y=G-(v+L*E),ee=D-(x+L*H);return Y*Y+ee*ee}var S=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:m,generateIntoFramebuffer:g}),T="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",_="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",U="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",B=new Float32Array([0,0,2,0,0,2]),F=null,A=!1,P={},R=new WeakMap;function X(G){if(!A&&!W(G))throw new Error("WebGL generation not supported")}function y(G,D,v,x,b,k,E){if(k===void 0&&(k=1),E===void 0&&(E=null),!E&&(E=F,!E)){var H=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!H)throw new Error("OffscreenCanvas or DOM canvas not supported");E=F=H.getContext("webgl",{depth:!1})}X(E);var M=new Uint8Array(G*D*4);u(E,function(V){var N=V.gl,pe=V.withTexture,ue=V.withTextureFramebuffer;pe("readable",function(Z,te){N.texImage2D(N.TEXTURE_2D,0,N.RGBA,G,D,0,N.RGBA,N.UNSIGNED_BYTE,null),ue(Z,te,function(se){w(G,D,v,x,b,k,N,se,0,0,0),N.readPixels(0,0,G,D,N.RGBA,N.UNSIGNED_BYTE,M)})})});for(var L=new Uint8Array(G*D),Y=0,ee=0;Y<M.length;Y+=4)L[ee++]=M[Y];return L}function C(G,D,v,x,b,k,E,H,M,L){k===void 0&&(k=1),H===void 0&&(H=0),M===void 0&&(M=0),L===void 0&&(L=0),w(G,D,v,x,b,k,E,null,H,M,L)}function w(G,D,v,x,b,k,E,H,M,L,Y){k===void 0&&(k=1),M===void 0&&(M=0),L===void 0&&(L=0),Y===void 0&&(Y=0),X(E);var ee=[];e(v,function(V,N,pe,ue){ee.push(V,N,pe,ue)}),ee=new Float32Array(ee),u(E,function(V){var N=V.gl,pe=V.isWebGL2,ue=V.getExtension,Z=V.withProgram,te=V.withTexture,se=V.withTextureFramebuffer,z=V.handleContextLoss;if(te("rawDistances",function(re,q){(G!==re._lastWidth||D!==re._lastHeight)&&N.texImage2D(N.TEXTURE_2D,0,N.RGBA,re._lastWidth=G,re._lastHeight=D,0,N.RGBA,N.UNSIGNED_BYTE,null),Z("main",T,_,function(I){var he=I.setAttribute,Q=I.setUniform,ae=!pe&&ue("ANGLE_instanced_arrays"),J=!pe&&ue("EXT_blend_minmax");he("aUV",2,N.STATIC_DRAW,0,B),he("aLineSegment",4,N.DYNAMIC_DRAW,1,ee),Q.apply(void 0,["4f","uGlyphBounds"].concat(x)),Q("1f","uMaxDistance",b),Q("1f","uExponent",k),se(re,q,function(ye){N.enable(N.BLEND),N.colorMask(!0,!0,!0,!0),N.viewport(0,0,G,D),N.scissor(0,0,G,D),N.blendFunc(N.ONE,N.ONE),N.blendEquationSeparate(N.FUNC_ADD,pe?N.MAX:J.MAX_EXT),N.clear(N.COLOR_BUFFER_BIT),pe?N.drawArraysInstanced(N.TRIANGLES,0,3,ee.length/4):ae.drawArraysInstancedANGLE(N.TRIANGLES,0,3,ee.length/4)})}),Z("post",n,U,function(I){I.setAttribute("aUV",2,N.STATIC_DRAW,0,B),I.setUniform("1i","tex",q),N.bindFramebuffer(N.FRAMEBUFFER,H),N.disable(N.BLEND),N.colorMask(Y===0,Y===1,Y===2,Y===3),N.viewport(M,L,G,D),N.scissor(M,L,G,D),N.drawArrays(N.TRIANGLES,0,3)})}),N.isContextLost())throw z(),new Error("webgl context lost")})}function W(G){var D=!G||G===F?P:G.canvas||G,v=R.get(D);if(v===void 0){A=!0;var x=null;try{var b=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],k=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,G);v=k&&b.length===k.length&&k.every(function(E,H){return E===b[H]}),v||(x="bad trial run results",console.info(b,k))}catch(E){v=!1,x=E.message}x&&console.warn("WebGL SDF generation not supported:",x),A=!1,R.set(D,v)}return v}var j=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:C,generateIntoFramebuffer:w,isSupported:W});function K(G,D,v,x,b,k){b===void 0&&(b=Math.max(x[2]-x[0],x[3]-x[1])/2),k===void 0&&(k=1);try{return y.apply(j,arguments)}catch(E){return console.info("WebGL SDF generation failed, falling back to JS",E),p.apply(S,arguments)}}function $(G,D,v,x,b,k,E,H,M,L){b===void 0&&(b=Math.max(x[2]-x[0],x[3]-x[1])/2),k===void 0&&(k=1),H===void 0&&(H=0),M===void 0&&(M=0),L===void 0&&(L=0);try{return C.apply(j,arguments)}catch(Y){return console.info("WebGL SDF generation failed, falling back to JS",Y),m.apply(S,arguments)}}return t.forEachPathCommand=r,t.generate=K,t.generateIntoCanvas=$,t.javascript=S,t.pathToLineSegments=e,t.webgl=j,t.webglUtils=d,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return a}function bidiFactory(){var a=function(t){var f={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},s={},r={};s.L=1,r[1]="L",Object.keys(f).forEach(function(z,re){s[z]=1<<re+1,r[s[z]]=z}),Object.freeze(s);var e=s.LRI|s.RLI|s.FSI,n=s.L|s.R|s.AL,i=s.B|s.S|s.WS|s.ON|s.FSI|s.LRI|s.RLI|s.PDI,o=s.BN|s.RLE|s.LRE|s.RLO|s.LRO|s.PDF,l=s.S|s.WS|s.B|e|s.PDI|o,u=null;function c(){if(!u){u=new Map;var z=function(q){if(f.hasOwnProperty(q)){var I=0;f[q].split(",").forEach(function(he){var Q=he.split("+"),ae=Q[0],J=Q[1];ae=parseInt(ae,36),J=J?parseInt(J,36):0,u.set(I+=ae,s[q]);for(var ye=0;ye<J;ye++)u.set(++I,s[q])})}};for(var re in f)z(re)}}function h(z){return c(),u.get(z.codePointAt(0))||s.L}function d(z){return r[h(z)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function m(z,re){var q=36,I=0,he=new Map,Q=re&&new Map,ae;return z.split(",").forEach(function J(ye){if(ye.indexOf("+")!==-1)for(var ne=+ye;ne--;)J(ae);else{ae=ye;var oe=ye.split(">"),fe=oe[0],de=oe[1];fe=String.fromCodePoint(I+=parseInt(fe,q)),de=String.fromCodePoint(I+=parseInt(de,q)),he.set(fe,de),re&&Q.set(de,fe)}}),{map:he,reverseMap:Q}}var g,O,S;function T(){if(!g){var z=m(p.pairs,!0),re=z.map,q=z.reverseMap;g=re,O=q,S=m(p.canonical,!1).map}}function _(z){return T(),g.get(z)||null}function U(z){return T(),O.get(z)||null}function B(z){return T(),S.get(z)||null}var F=s.L,A=s.R,P=s.EN,R=s.ES,X=s.ET,y=s.AN,C=s.CS,w=s.B,W=s.S,j=s.ON,K=s.BN,$=s.NSM,G=s.AL,D=s.LRO,v=s.RLO,x=s.LRE,b=s.RLE,k=s.PDF,E=s.LRI,H=s.RLI,M=s.FSI,L=s.PDI;function Y(z,re){for(var q=125,I=new Uint32Array(z.length),he=0;he<z.length;he++)I[he]=h(z[he]);var Q=new Map;function ae(Oe,He){var Ie=I[Oe];I[Oe]=He,Q.set(Ie,Q.get(Ie)-1),Ie&i&&Q.set(i,Q.get(i)-1),Q.set(He,(Q.get(He)||0)+1),He&i&&Q.set(i,(Q.get(i)||0)+1)}for(var J=new Uint8Array(z.length),ye=new Map,ne=[],oe=null,fe=0;fe<z.length;fe++)oe||ne.push(oe={start:fe,end:z.length-1,level:re==="rtl"?1:re==="ltr"?0:ur(fe,!1)}),I[fe]&w&&(oe.end=fe,oe=null);for(var de=b|x|v|D|e|L|k|w,Se=function(Oe){return Oe+(Oe&1?1:2)},we=function(Oe){return Oe+(Oe&1?2:1)},me=0;me<ne.length;me++){oe=ne[me];var ge=[{_level:oe.level,_override:0,_isolate:0}],le=void 0,Ae=0,Fe=0,Be=0;Q.clear();for(var Ue=oe.start;Ue<=oe.end;Ue++){var ce=I[Ue];if(le=ge[ge.length-1],Q.set(ce,(Q.get(ce)||0)+1),ce&i&&Q.set(i,(Q.get(i)||0)+1),ce&de)if(ce&(b|x)){J[Ue]=le._level;var _e=(ce===b?we:Se)(le._level);_e<=q&&!Ae&&!Fe?ge.push({_level:_e,_override:0,_isolate:0}):Ae||Fe++}else if(ce&(v|D)){J[Ue]=le._level;var ze=(ce===v?we:Se)(le._level);ze<=q&&!Ae&&!Fe?ge.push({_level:ze,_override:ce&v?A:F,_isolate:0}):Ae||Fe++}else if(ce&e){ce&M&&(ce=ur(Ue+1,!0)===1?H:E),J[Ue]=le._level,le._override&&ae(Ue,le._override);var be=(ce===H?we:Se)(le._level);be<=q&&Ae===0&&Fe===0?(Be++,ge.push({_level:be,_override:0,_isolate:1,_isolInitIndex:Ue})):Ae++}else if(ce&L){if(Ae>0)Ae--;else if(Be>0){for(Fe=0;!ge[ge.length-1]._isolate;)ge.pop();var xe=ge[ge.length-1]._isolInitIndex;xe!=null&&(ye.set(xe,Ue),ye.set(Ue,xe)),ge.pop(),Be--}le=ge[ge.length-1],J[Ue]=le._level,le._override&&ae(Ue,le._override)}else ce&k?(Ae===0&&(Fe>0?Fe--:!le._isolate&&ge.length>1&&(ge.pop(),le=ge[ge.length-1])),J[Ue]=le._level):ce&w&&(J[Ue]=oe.level);else J[Ue]=le._level,le._override&&ce!==K&&ae(Ue,le._override)}for(var ke=[],Ee=null,ve=oe.start;ve<=oe.end;ve++){var Te=I[ve];if(!(Te&o)){var De=J[ve],Re=Te&e,Ce=Te===L;Ee&&De===Ee._level?(Ee._end=ve,Ee._endsWithIsolInit=Re):ke.push(Ee={_start:ve,_end:ve,_level:De,_startsWithPDI:Ce,_endsWithIsolInit:Re})}}for(var Ge=[],Ve=0;Ve<ke.length;Ve++){var We=ke[Ve];if(!We._startsWithPDI||We._startsWithPDI&&!ye.has(We._start)){for(var Xe=[Ee=We],Ke=void 0;Ee&&Ee._endsWithIsolInit&&(Ke=ye.get(Ee._end))!=null;)for(var je=Ve+1;je<ke.length;je++)if(ke[je]._start===Ke){Xe.push(Ee=ke[je]);break}for(var Me=[],Qe=0;Qe<Xe.length;Qe++)for(var zt=Xe[Qe],Ft=zt._start;Ft<=zt._end;Ft++)Me.push(Ft);for(var hr=J[Me[0]],Vt=oe.level,ct=Me[0]-1;ct>=0;ct--)if(!(I[ct]&o)){Vt=J[ct];break}var Et=Me[Me.length-1],dr=J[Et],Xt=oe.level;if(!(I[Et]&e)){for(var ht=Et+1;ht<=oe.end;ht++)if(!(I[ht]&o)){Xt=J[ht];break}}Ge.push({_seqIndices:Me,_sosType:Math.max(Vt,hr)%2?A:F,_eosType:Math.max(Xt,dr)%2?A:F})}}for(var Tt=0;Tt<Ge.length;Tt++){var wt=Ge[Tt],ie=wt._seqIndices,tt=wt._sosType,vr=wt._eosType,Ze=J[ie[0]]&1?A:F;if(Q.get($))for(var dt=0;dt<ie.length;dt++){var Yt=ie[dt];if(I[Yt]&$){for(var At=tt,vt=dt-1;vt>=0;vt--)if(!(I[ie[vt]]&o)){At=I[ie[vt]];break}ae(Yt,At&(e|L)?j:At)}}if(Q.get(P))for(var pt=0;pt<ie.length;pt++){var Jt=ie[pt];if(I[Jt]&P)for(var mt=pt-1;mt>=-1;mt--){var Kt=mt===-1?tt:I[ie[mt]];if(Kt&n){Kt===G&&ae(Jt,y);break}}}if(Q.get(G))for(var kt=0;kt<ie.length;kt++){var Qt=ie[kt];I[Qt]&G&&ae(Qt,A)}if(Q.get(R)||Q.get(C))for(var rt=1;rt<ie.length-1;rt++){var Ct=ie[rt];if(I[Ct]&(R|C)){for(var qe=0,Rt=0,Dt=rt-1;Dt>=0&&(qe=I[ie[Dt]],!!(qe&o));Dt--);for(var Mt=rt+1;Mt<ie.length&&(Rt=I[ie[Mt]],!!(Rt&o));Mt++);qe===Rt&&(I[Ct]===R?qe===P:qe&(P|y))&&ae(Ct,qe)}}if(Q.get(P))for(var Ne=0;Ne<ie.length;Ne++){var pr=ie[Ne];if(I[pr]&P){for(var gt=Ne-1;gt>=0&&I[ie[gt]]&(X|o);gt--)ae(ie[gt],P);for(Ne++;Ne<ie.length&&I[ie[Ne]]&(X|o|P);Ne++)I[ie[Ne]]!==P&&ae(ie[Ne],P)}}if(Q.get(X)||Q.get(R)||Q.get(C))for(var nt=0;nt<ie.length;nt++){var Zt=ie[nt];if(I[Zt]&(X|R|C)){ae(Zt,j);for(var xt=nt-1;xt>=0&&I[ie[xt]]&o;xt--)ae(ie[xt],j);for(var yt=nt+1;yt<ie.length&&I[ie[yt]]&o;yt++)ae(ie[yt],j)}}if(Q.get(P))for(var Bt=0,qt=tt;Bt<ie.length;Bt++){var $t=ie[Bt],Ot=I[$t];Ot&P?qt===F&&ae($t,F):Ot&n&&(qt=Ot)}if(Q.get(i)){var at=A|P|y,er=at|F,_t=[];{for(var $e=[],et=0;et<ie.length;et++)if(I[ie[et]]&i){var ot=z[ie[et]],tr=void 0;if(_(ot)!==null)if($e.length<63)$e.push({char:ot,seqIndex:et});else break;else if((tr=U(ot))!==null)for(var it=$e.length-1;it>=0;it--){var It=$e[it].char;if(It===tr||It===U(B(ot))||_(B(It))===ot){_t.push([$e[it].seqIndex,et]),$e.length=it;break}}}_t.sort(function(Oe,He){return Oe[0]-He[0]})}for(var Pt=0;Pt<_t.length;Pt++){for(var rr=_t[Pt],bt=rr[0],Gt=rr[1],nr=!1,Le=0,Lt=bt+1;Lt<Gt;Lt++){var ar=ie[Lt];if(I[ar]&er){nr=!0;var or=I[ar]&at?A:F;if(or===Ze){Le=or;break}}}if(nr&&!Le){Le=tt;for(var Ht=bt-1;Ht>=0;Ht--){var ir=ie[Ht];if(I[ir]&er){var sr=I[ir]&at?A:F;sr!==Ze?Le=sr:Le=Ze;break}}}if(Le){if(I[ie[bt]]=I[ie[Gt]]=Le,Le!==Ze){for(var st=bt+1;st<ie.length;st++)if(!(I[ie[st]]&o)){h(z[ie[st]])&$&&(I[ie[st]]=Le);break}}if(Le!==Ze){for(var lt=Gt+1;lt<ie.length;lt++)if(!(I[ie[lt]]&o)){h(z[ie[lt]])&$&&(I[ie[lt]]=Le);break}}}}for(var Ye=0;Ye<ie.length;Ye++)if(I[ie[Ye]]&i){for(var lr=Ye,Nt=Ye,Wt=tt,ft=Ye-1;ft>=0;ft--)if(I[ie[ft]]&o)lr=ft;else{Wt=I[ie[ft]]&at?A:F;break}for(var fr=vr,ut=Ye+1;ut<ie.length;ut++)if(I[ie[ut]]&(i|o))Nt=ut;else{fr=I[ie[ut]]&at?A:F;break}for(var jt=lr;jt<=Nt;jt++)I[ie[jt]]=Wt===fr?Wt:Ze;Ye=Nt}}}for(var Pe=oe.start;Pe<=oe.end;Pe++){var mr=J[Pe],St=I[Pe];if(mr&1?St&(F|P|y)&&J[Pe]++:St&A?J[Pe]++:St&(y|P)&&(J[Pe]+=2),St&o&&(J[Pe]=Pe===0?oe.level:J[Pe-1]),Pe===oe.end||h(z[Pe])&(W|w))for(var Ut=Pe;Ut>=0&&h(z[Ut])&l;Ut--)J[Ut]=oe.level}}return{levels:J,paragraphs:ne};function ur(Oe,He){for(var Ie=Oe;Ie<z.length;Ie++){var Je=I[Ie];if(Je&(A|G))return 1;if(Je&(w|F)||He&&Je===L)return 0;if(Je&e){var cr=gr(Ie);Ie=cr===-1?z.length:cr}}return 0}function gr(Oe){for(var He=1,Ie=Oe+1;Ie<z.length;Ie++){var Je=I[Ie];if(Je&w)break;if(Je&L){if(--He===0)return Ie}else Je&e&&He++}return-1}}var ee="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",V;function N(){if(!V){var z=m(ee,!0),re=z.map,q=z.reverseMap;q.forEach(function(I,he){re.set(he,I)}),V=re}}function pe(z){return N(),V.get(z)||null}function ue(z,re,q,I){var he=z.length;q=Math.max(0,q==null?0:+q),I=Math.min(he-1,I==null?he-1:+I);for(var Q=new Map,ae=q;ae<=I;ae++)if(re[ae]&1){var J=pe(z[ae]);J!==null&&Q.set(ae,J)}return Q}function Z(z,re,q,I){var he=z.length;q=Math.max(0,q==null?0:+q),I=Math.min(he-1,I==null?he-1:+I);var Q=[];return re.paragraphs.forEach(function(ae){var J=Math.max(q,ae.start),ye=Math.min(I,ae.end);if(J<ye){for(var ne=re.levels.slice(J,ye+1),oe=ye;oe>=J&&h(z[oe])&l;oe--)ne[oe]=ae.level;for(var fe=ae.level,de=1/0,Se=0;Se<ne.length;Se++){var we=ne[Se];we>fe&&(fe=we),we<de&&(de=we|1)}for(var me=fe;me>=de;me--)for(var ge=0;ge<ne.length;ge++)if(ne[ge]>=me){for(var le=ge;ge+1<ne.length&&ne[ge+1]>=me;)ge++;ge>le&&Q.push([le+J,ge+J])}}}),Q}function te(z,re,q,I){var he=se(z,re,q,I),Q=[].concat(z);return he.forEach(function(ae,J){Q[J]=(re.levels[ae]&1?pe(z[ae]):null)||z[ae]}),Q.join("")}function se(z,re,q,I){for(var he=Z(z,re,q,I),Q=[],ae=0;ae<z.length;ae++)Q[ae]=ae;return he.forEach(function(J){for(var ye=J[0],ne=J[1],oe=Q.slice(ye,ne+1),fe=oe.length;fe--;)Q[ne-fe]=oe[fe]}),Q}return t.closingToOpeningBracket=U,t.getBidiCharType=h,t.getBidiCharTypeName=d,t.getCanonicalBracket=B,t.getEmbeddingLevels=Y,t.getMirroredCharacter=pe,t.getMirroredCharactersMap=ue,t.getReorderSegments=Z,t.getReorderedIndices=se,t.getReorderedString=te,t.openingToClosingBracket=_,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return a}const voidMainRegExp=/\bvoid\s+main\s*\(\s*\)\s*{/g;function expandShaderIncludes(a){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function f(s,r){let e=ShaderChunk[r];return e?expandShaderIncludes(e):s}return a.replace(t,f)}const _lut=[];for(let a=0;a<256;a++)_lut[a]=(a<16?"0":"")+a.toString(16);function generateUUID(){const a=Math.random()*4294967295|0,t=Math.random()*4294967295|0,f=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(_lut[a&255]+_lut[a>>8&255]+_lut[a>>16&255]+_lut[a>>24&255]+"-"+_lut[t&255]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[f&63|128]+_lut[f>>8&255]+"-"+_lut[f>>16&255]+_lut[f>>24&255]+_lut[s&255]+_lut[s>>8&255]+_lut[s>>16&255]+_lut[s>>24&255]).toUpperCase()}const assign$1=Object.assign||function(){let a=arguments[0];for(let t=1,f=arguments.length;t<f;t++){let s=arguments[t];if(s)for(let r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},epoch=Date.now(),CONSTRUCTOR_CACHE=new WeakMap,SHADER_UPGRADE_CACHE=new Map;let materialInstanceId=1e10;function createDerivedMaterial(a,t){const f=getKeyForOptions(t);let s=CONSTRUCTOR_CACHE.get(a);if(s||CONSTRUCTOR_CACHE.set(a,s=Object.create(null)),s[f])return new s[f];const r=`_onBeforeCompile${f}`,e=function(l,u){a.onBeforeCompile.call(this,l,u);const c=this.customProgramCacheKey()+"|"+l.vertexShader+"|"+l.fragmentShader;let h=SHADER_UPGRADE_CACHE[c];if(!h){const d=upgradeShaders(this,l,t,f);h=SHADER_UPGRADE_CACHE[c]=d}l.vertexShader=h.vertexShader,l.fragmentShader=h.fragmentShader,assign$1(l.uniforms,this.uniforms),t.timeUniform&&(l.uniforms[t.timeUniform]={get value(){return Date.now()-epoch}}),this[r]&&this[r](l)},n=function(){return i(t.chained?a:a.clone())},i=function(l){const u=Object.create(l,o);return Object.defineProperty(u,"baseMaterial",{value:a}),Object.defineProperty(u,"id",{value:materialInstanceId++}),u.uuid=generateUUID(),u.uniforms=assign$1({},l.uniforms,t.uniforms),u.defines=assign$1({},l.defines,t.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${f}`]="",u.extensions=assign$1({},l.extensions,t.extensions),u._listeners=void 0,u},o={constructor:{value:n},isDerivedMaterial:{value:!0},type:{get:()=>a.type,set:l=>{a.type=l}},isDerivedFrom:{writable:!0,configurable:!0,value:function(l){const u=this.baseMaterial;return l===u||u.isDerivedMaterial&&u.isDerivedFrom(l)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return a.customProgramCacheKey()+"|"+f}},onBeforeCompile:{get(){return e},set(l){this[r]=l}},copy:{writable:!0,configurable:!0,value:function(l){return a.copy.call(this,l),!a.isShaderMaterial&&!a.isDerivedMaterial&&(assign$1(this.extensions,l.extensions),assign$1(this.defines,l.defines),assign$1(this.uniforms,UniformsUtils.clone(l.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const l=new a.constructor;return i(l).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let l=this._depthMaterial;return l||(l=this._depthMaterial=createDerivedMaterial(a.isDerivedMaterial?a.getDepthMaterial():new MeshDepthMaterial({depthPacking:RGBADepthPacking}),t),l.defines.IS_DEPTH_MATERIAL="",l.uniforms=this.uniforms),l}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let l=this._distanceMaterial;return l||(l=this._distanceMaterial=createDerivedMaterial(a.isDerivedMaterial?a.getDistanceMaterial():new MeshDistanceMaterial,t),l.defines.IS_DISTANCE_MATERIAL="",l.uniforms=this.uniforms),l}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:l,_distanceMaterial:u}=this;l&&l.dispose(),u&&u.dispose(),a.dispose.call(this)}}};return s[f]=n,new n}function upgradeShaders(a,{vertexShader:t,fragmentShader:f},s,r){let{vertexDefs:e,vertexMainIntro:n,vertexMainOutro:i,vertexTransform:o,fragmentDefs:l,fragmentMainIntro:u,fragmentMainOutro:c,fragmentColorTransform:h,customRewriter:d,timeUniform:p}=s;if(e=e||"",n=n||"",i=i||"",l=l||"",u=u||"",c=c||"",(o||d)&&(t=expandShaderIncludes(t)),(h||d)&&(f=f.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),f=expandShaderIncludes(f)),d){let m=d({vertexShader:t,fragmentShader:f});t=m.vertexShader,f=m.fragmentShader}if(h){let m=[];f=f.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,g=>(m.push(g),"")),c=`${h}
${m.join(`
`)}
${c}`}if(p){const m=`
uniform float ${p};
`;e=m+e,l=m+l}return o&&(t=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${t}
`,e=`${e}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${o}
}
`,n=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${n}
`,t=t.replace(/\b(position|normal|uv)\b/g,(m,g,O,S)=>/\battribute\s+vec[23]\s+$/.test(S.substr(0,O))?g:`troika_${g}_${r}`),a.map&&a.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),t=injectIntoShaderCode(t,r,e,n,i),f=injectIntoShaderCode(f,r,l,u,c),{vertexShader:t,fragmentShader:f}}function injectIntoShaderCode(a,t,f,s,r){return(s||r||f)&&(a=a.replace(voidMainRegExp,`
${f}
void troikaOrigMain${t}() {`),a+=`
void main() {
  ${s}
  troikaOrigMain${t}();
  ${r}
}`),a}function optionsJsonReplacer(a,t){return a==="uniforms"?void 0:typeof t=="function"?t.toString():t}let _idCtr=0;const optionsHashesToIds=new Map;function getKeyForOptions(a){const t=JSON.stringify(a,optionsJsonReplacer);let f=optionsHashesToIds.get(t);return f==null&&optionsHashesToIds.set(t,f=++_idCtr),f}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function typrFactory(){return typeof window>"u"&&(self.window=self),function(a){var t={parse:function(r){var e=t._bin,n=new Uint8Array(r);if(e.readASCII(n,0,4)=="ttcf"){var i=4;e.readUshort(n,i),i+=2,e.readUshort(n,i),i+=2;var o=e.readUint(n,i);i+=4;for(var l=[],u=0;u<o;u++){var c=e.readUint(n,i);i+=4,l.push(t._readFont(n,c))}return l}return[t._readFont(n,0)]},_readFont:function(r,e){var n=t._bin,i=e;n.readFixed(r,e),e+=4;var o=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2,n.readUshort(r,e),e+=2,n.readUshort(r,e),e+=2;for(var l=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:r,_offset:i},c={},h=0;h<o;h++){var d=n.readASCII(r,e,4);e+=4,n.readUint(r,e),e+=4;var p=n.readUint(r,e);e+=4;var m=n.readUint(r,e);e+=4,c[d]={offset:p,length:m}}for(h=0;h<l.length;h++){var g=l[h];c[g]&&(u[g.trim()]=t[g.trim()].parse(r,c[g].offset,c[g].length,u))}return u},_tabOffset:function(r,e,n){for(var i=t._bin,o=i.readUshort(r,n+4),l=n+12,u=0;u<o;u++){var c=i.readASCII(r,l,4);l+=4,i.readUint(r,l),l+=4;var h=i.readUint(r,l);if(l+=4,i.readUint(r,l),l+=4,c==e)return h}return 0}};t._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,e){return t._bin.readShort(r,e)/16384},readInt:function(r,e){return t._bin._view(r).getInt32(e)},readInt8:function(r,e){return t._bin._view(r).getInt8(e)},readShort:function(r,e){return t._bin._view(r).getInt16(e)},readUshort:function(r,e){return t._bin._view(r).getUint16(e)},readUshorts:function(r,e,n){for(var i=[],o=0;o<n;o++)i.push(t._bin.readUshort(r,e+2*o));return i},readUint:function(r,e){return t._bin._view(r).getUint32(e)},readUint64:function(r,e){return 4294967296*t._bin.readUint(r,e)+t._bin.readUint(r,e+4)},readASCII:function(r,e,n){for(var i="",o=0;o<n;o++)i+=String.fromCharCode(r[e+o]);return i},readUnicode:function(r,e,n){for(var i="",o=0;o<n;o++){var l=r[e++]<<8|r[e++];i+=String.fromCharCode(l)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,e,n){var i=t._bin._tdec;return i&&e==0&&n==r.length?i.decode(r):t._bin.readASCII(r,e,n)},readBytes:function(r,e,n){for(var i=[],o=0;o<n;o++)i.push(r[e+o]);return i},readASCIIArray:function(r,e,n){for(var i=[],o=0;o<n;o++)i.push(String.fromCharCode(r[e+o]));return i},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},t._lctf={},t._lctf.parse=function(r,e,n,i,o){var l=t._bin,u={},c=e;l.readFixed(r,e),e+=4;var h=l.readUshort(r,e);e+=2;var d=l.readUshort(r,e);e+=2;var p=l.readUshort(r,e);return e+=2,u.scriptList=t._lctf.readScriptList(r,c+h),u.featureList=t._lctf.readFeatureList(r,c+d),u.lookupList=t._lctf.readLookupList(r,c+p,o),u},t._lctf.readLookupList=function(r,e,n){var i=t._bin,o=e,l=[],u=i.readUshort(r,e);e+=2;for(var c=0;c<u;c++){var h=i.readUshort(r,e);e+=2;var d=t._lctf.readLookupTable(r,o+h,n);l.push(d)}return l},t._lctf.readLookupTable=function(r,e,n){var i=t._bin,o=e,l={tabs:[]};l.ltype=i.readUshort(r,e),e+=2,l.flag=i.readUshort(r,e),e+=2;var u=i.readUshort(r,e);e+=2;for(var c=l.ltype,h=0;h<u;h++){var d=i.readUshort(r,e);e+=2;var p=n(r,c,o+d,l);l.tabs.push(p)}return l},t._lctf.numOfOnes=function(r){for(var e=0,n=0;n<32;n++)r>>>n&1&&e++;return e},t._lctf.readClassDef=function(r,e){var n=t._bin,i=[],o=n.readUshort(r,e);if(e+=2,o==1){var l=n.readUshort(r,e);e+=2;var u=n.readUshort(r,e);e+=2;for(var c=0;c<u;c++)i.push(l+c),i.push(l+c),i.push(n.readUshort(r,e)),e+=2}if(o==2){var h=n.readUshort(r,e);for(e+=2,c=0;c<h;c++)i.push(n.readUshort(r,e)),e+=2,i.push(n.readUshort(r,e)),e+=2,i.push(n.readUshort(r,e)),e+=2}return i},t._lctf.getInterval=function(r,e){for(var n=0;n<r.length;n+=3){var i=r[n],o=r[n+1];if(r[n+2],i<=e&&e<=o)return n}return-1},t._lctf.readCoverage=function(r,e){var n=t._bin,i={};i.fmt=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);return e+=2,i.fmt==1&&(i.tab=n.readUshorts(r,e,o)),i.fmt==2&&(i.tab=n.readUshorts(r,e,3*o)),i},t._lctf.coverageIndex=function(r,e){var n=r.tab;if(r.fmt==1)return n.indexOf(e);if(r.fmt==2){var i=t._lctf.getInterval(n,e);if(i!=-1)return n[i+2]+(e-n[i])}return-1},t._lctf.readFeatureList=function(r,e){var n=t._bin,i=e,o=[],l=n.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var c=n.readASCII(r,e,4);e+=4;var h=n.readUshort(r,e);e+=2;var d=t._lctf.readFeatureTable(r,i+h);d.tag=c.trim(),o.push(d)}return o},t._lctf.readFeatureTable=function(r,e){var n=t._bin,i=e,o={},l=n.readUshort(r,e);e+=2,l>0&&(o.featureParams=i+l);var u=n.readUshort(r,e);e+=2,o.tab=[];for(var c=0;c<u;c++)o.tab.push(n.readUshort(r,e+2*c));return o},t._lctf.readScriptList=function(r,e){var n=t._bin,i=e,o={},l=n.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var c=n.readASCII(r,e,4);e+=4;var h=n.readUshort(r,e);e+=2,o[c.trim()]=t._lctf.readScriptTable(r,i+h)}return o},t._lctf.readScriptTable=function(r,e){var n=t._bin,i=e,o={},l=n.readUshort(r,e);e+=2,l>0&&(o.default=t._lctf.readLangSysTable(r,i+l));var u=n.readUshort(r,e);e+=2;for(var c=0;c<u;c++){var h=n.readASCII(r,e,4);e+=4;var d=n.readUshort(r,e);e+=2,o[h.trim()]=t._lctf.readLangSysTable(r,i+d)}return o},t._lctf.readLangSysTable=function(r,e){var n=t._bin,i={};n.readUshort(r,e),e+=2,i.reqFeature=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);return e+=2,i.features=n.readUshorts(r,e,o),i},t.CFF={},t.CFF.parse=function(r,e,n){var i=t._bin;(r=new Uint8Array(r.buffer,e,n))[e=0],r[++e],r[++e],r[++e],e++;var o=[];e=t.CFF.readIndex(r,e,o);for(var l=[],u=0;u<o.length-1;u++)l.push(i.readASCII(r,e+o[u],o[u+1]-o[u]));e+=o[o.length-1];var c=[];e=t.CFF.readIndex(r,e,c);var h=[];for(u=0;u<c.length-1;u++)h.push(t.CFF.readDict(r,e+c[u],e+c[u+1]));e+=c[c.length-1];var d=h[0],p=[];e=t.CFF.readIndex(r,e,p);var m=[];for(u=0;u<p.length-1;u++)m.push(i.readASCII(r,e+p[u],p[u+1]-p[u]));if(e+=p[p.length-1],t.CFF.readSubrs(r,e,d),d.CharStrings){e=d.CharStrings,p=[],e=t.CFF.readIndex(r,e,p);var g=[];for(u=0;u<p.length-1;u++)g.push(i.readBytes(r,e+p[u],p[u+1]-p[u]));d.CharStrings=g}if(d.ROS){e=d.FDArray;var O=[];for(e=t.CFF.readIndex(r,e,O),d.FDArray=[],u=0;u<O.length-1;u++){var S=t.CFF.readDict(r,e+O[u],e+O[u+1]);t.CFF._readFDict(r,S,m),d.FDArray.push(S)}e+=O[O.length-1],e=d.FDSelect,d.FDSelect=[];var T=r[e];if(e++,T!=3)throw T;var _=i.readUshort(r,e);for(e+=2,u=0;u<_+1;u++)d.FDSelect.push(i.readUshort(r,e),r[e+2]),e+=3}return d.Encoding&&(d.Encoding=t.CFF.readEncoding(r,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=t.CFF.readCharset(r,d.charset,d.CharStrings.length)),t.CFF._readFDict(r,d,m),d},t.CFF._readFDict=function(r,e,n){var i;for(var o in e.Private&&(i=e.Private[1],e.Private=t.CFF.readDict(r,i,i+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(r,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)!=-1&&(e[o]=n[e[o]-426+35])},t.CFF.readSubrs=function(r,e,n){var i=t._bin,o=[];e=t.CFF.readIndex(r,e,o);var l,u=o.length;l=u<1240?107:u<33900?1131:32768,n.Bias=l,n.Subrs=[];for(var c=0;c<o.length-1;c++)n.Subrs.push(i.readBytes(r,e+o[c],o[c+1]-o[c]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(r,e){for(var n=0;n<r.charset.length;n++)if(r.charset[n]==e)return n;return-1},t.CFF.glyphBySE=function(r,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(r,t.CFF.tableSE[e])},t.CFF.readEncoding=function(r,e,n){t._bin;var i=[".notdef"],o=r[e];if(e++,o!=0)throw"error: unknown encoding format: "+o;var l=r[e];e++;for(var u=0;u<l;u++)i.push(r[e+u]);return i},t.CFF.readCharset=function(r,e,n){var i=t._bin,o=[".notdef"],l=r[e];if(e++,l==0)for(var u=0;u<n;u++){var c=i.readUshort(r,e);e+=2,o.push(c)}else{if(l!=1&&l!=2)throw"error: format: "+l;for(;o.length<n;){c=i.readUshort(r,e),e+=2;var h=0;for(l==1?(h=r[e],e++):(h=i.readUshort(r,e),e+=2),u=0;u<=h;u++)o.push(c),c++}}return o},t.CFF.readIndex=function(r,e,n){var i=t._bin,o=i.readUshort(r,e)+1,l=r[e+=2];if(e++,l==1)for(var u=0;u<o;u++)n.push(r[e+u]);else if(l==2)for(u=0;u<o;u++)n.push(i.readUshort(r,e+2*u));else if(l==3)for(u=0;u<o;u++)n.push(16777215&i.readUint(r,e+3*u-1));else if(o!=1)throw"unsupported offset size: "+l+", count: "+o;return(e+=o*l)-1},t.CFF.getCharString=function(r,e,n){var i=t._bin,o=r[e],l=r[e+1];r[e+2],r[e+3],r[e+4];var u=1,c=null,h=null;o<=20&&(c=o,u=1),o==12&&(c=100*o+l,u=2),21<=o&&o<=27&&(c=o,u=1),o==28&&(h=i.readShort(r,e+1),u=3),29<=o&&o<=31&&(c=o,u=1),32<=o&&o<=246&&(h=o-139,u=1),247<=o&&o<=250&&(h=256*(o-247)+l+108,u=2),251<=o&&o<=254&&(h=256*-(o-251)-l-108,u=2),o==255&&(h=i.readInt(r,e+1)/65535,u=5),n.val=h??"o"+c,n.size=u},t.CFF.readCharString=function(r,e,n){for(var i=e+n,o=t._bin,l=[];e<i;){var u=r[e],c=r[e+1];r[e+2],r[e+3],r[e+4];var h=1,d=null,p=null;u<=20&&(d=u,h=1),u==12&&(d=100*u+c,h=2),u!=19&&u!=20||(d=u,h=2),21<=u&&u<=27&&(d=u,h=1),u==28&&(p=o.readShort(r,e+1),h=3),29<=u&&u<=31&&(d=u,h=1),32<=u&&u<=246&&(p=u-139,h=1),247<=u&&u<=250&&(p=256*(u-247)+c+108,h=2),251<=u&&u<=254&&(p=256*-(u-251)-c-108,h=2),u==255&&(p=o.readInt(r,e+1)/65535,h=5),l.push(p??"o"+d),e+=h}return l},t.CFF.readDict=function(r,e,n){for(var i=t._bin,o={},l=[];e<n;){var u=r[e],c=r[e+1];r[e+2],r[e+3],r[e+4];var h=1,d=null,p=null;if(u==28&&(p=i.readShort(r,e+1),h=3),u==29&&(p=i.readInt(r,e+1),h=5),32<=u&&u<=246&&(p=u-139,h=1),247<=u&&u<=250&&(p=256*(u-247)+c+108,h=2),251<=u&&u<=254&&(p=256*-(u-251)-c-108,h=2),u==255)throw p=i.readInt(r,e+1)/65535,h=5,"unknown number";if(u==30){var m=[];for(h=1;;){var g=r[e+h];h++;var O=g>>4,S=15&g;if(O!=15&&m.push(O),S!=15&&m.push(S),S==15)break}for(var T="",_=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],U=0;U<m.length;U++)T+=_[m[U]];p=parseFloat(T)}u<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],h=1,u==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][c],h=2)),d!=null?(o[d]=l.length==1?l[0]:l,l=[]):l.push(p),e+=h}return o},t.cmap={},t.cmap.parse=function(r,e,n){r=new Uint8Array(r.buffer,e,n),e=0;var i=t._bin,o={};i.readUshort(r,e),e+=2;var l=i.readUshort(r,e);e+=2;var u=[];o.tables=[];for(var c=0;c<l;c++){var h=i.readUshort(r,e);e+=2;var d=i.readUshort(r,e);e+=2;var p=i.readUint(r,e);e+=4;var m="p"+h+"e"+d,g=u.indexOf(p);if(g==-1){var O;g=o.tables.length,u.push(p);var S=i.readUshort(r,p);S==0?O=t.cmap.parse0(r,p):S==4?O=t.cmap.parse4(r,p):S==6?O=t.cmap.parse6(r,p):S==12?O=t.cmap.parse12(r,p):console.debug("unknown format: "+S,h,d,p),o.tables.push(O)}if(o[m]!=null)throw"multiple tables for one platform+encoding";o[m]=g}return o},t.cmap.parse0=function(r,e){var n=t._bin,i={};i.format=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2,i.map=[];for(var l=0;l<o-6;l++)i.map.push(r[e+l]);return i},t.cmap.parse4=function(r,e){var n=t._bin,i=e,o={};o.format=n.readUshort(r,e),e+=2;var l=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2;var u=n.readUshort(r,e);e+=2;var c=u/2;o.searchRange=n.readUshort(r,e),e+=2,o.entrySelector=n.readUshort(r,e),e+=2,o.rangeShift=n.readUshort(r,e),e+=2,o.endCount=n.readUshorts(r,e,c),e+=2*c,e+=2,o.startCount=n.readUshorts(r,e,c),e+=2*c,o.idDelta=[];for(var h=0;h<c;h++)o.idDelta.push(n.readShort(r,e)),e+=2;for(o.idRangeOffset=n.readUshorts(r,e,c),e+=2*c,o.glyphIdArray=[];e<i+l;)o.glyphIdArray.push(n.readUshort(r,e)),e+=2;return o},t.cmap.parse6=function(r,e){var n=t._bin,i={};i.format=n.readUshort(r,e),e+=2,n.readUshort(r,e),e+=2,n.readUshort(r,e),e+=2,i.firstCode=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);e+=2,i.glyphIdArray=[];for(var l=0;l<o;l++)i.glyphIdArray.push(n.readUshort(r,e)),e+=2;return i},t.cmap.parse12=function(r,e){var n=t._bin,i={};i.format=n.readUshort(r,e),e+=2,e+=2,n.readUint(r,e),e+=4,n.readUint(r,e),e+=4;var o=n.readUint(r,e);e+=4,i.groups=[];for(var l=0;l<o;l++){var u=e+12*l,c=n.readUint(r,u+0),h=n.readUint(r,u+4),d=n.readUint(r,u+8);i.groups.push([c,h,d])}return i},t.glyf={},t.glyf.parse=function(r,e,n,i){for(var o=[],l=0;l<i.maxp.numGlyphs;l++)o.push(null);return o},t.glyf._parseGlyf=function(r,e){var n=t._bin,i=r._data,o=t._tabOffset(i,"glyf",r._offset)+r.loca[e];if(r.loca[e]==r.loca[e+1])return null;var l={};if(l.noc=n.readShort(i,o),o+=2,l.xMin=n.readShort(i,o),o+=2,l.yMin=n.readShort(i,o),o+=2,l.xMax=n.readShort(i,o),o+=2,l.yMax=n.readShort(i,o),o+=2,l.xMin>=l.xMax||l.yMin>=l.yMax)return null;if(l.noc>0){l.endPts=[];for(var u=0;u<l.noc;u++)l.endPts.push(n.readUshort(i,o)),o+=2;var c=n.readUshort(i,o);if(o+=2,i.length-o<c)return null;l.instructions=n.readBytes(i,o,c),o+=c;var h=l.endPts[l.noc-1]+1;for(l.flags=[],u=0;u<h;u++){var d=i[o];if(o++,l.flags.push(d),(8&d)!=0){var p=i[o];o++;for(var m=0;m<p;m++)l.flags.push(d),u++}}for(l.xs=[],u=0;u<h;u++){var g=(2&l.flags[u])!=0,O=(16&l.flags[u])!=0;g?(l.xs.push(O?i[o]:-i[o]),o++):O?l.xs.push(0):(l.xs.push(n.readShort(i,o)),o+=2)}for(l.ys=[],u=0;u<h;u++)g=(4&l.flags[u])!=0,O=(32&l.flags[u])!=0,g?(l.ys.push(O?i[o]:-i[o]),o++):O?l.ys.push(0):(l.ys.push(n.readShort(i,o)),o+=2);var S=0,T=0;for(u=0;u<h;u++)S+=l.xs[u],T+=l.ys[u],l.xs[u]=S,l.ys[u]=T}else{var _;l.parts=[];do{_=n.readUshort(i,o),o+=2;var U={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(l.parts.push(U),U.glyphIndex=n.readUshort(i,o),o+=2,1&_){var B=n.readShort(i,o);o+=2;var F=n.readShort(i,o);o+=2}else B=n.readInt8(i,o),o++,F=n.readInt8(i,o),o++;2&_?(U.m.tx=B,U.m.ty=F):(U.p1=B,U.p2=F),8&_?(U.m.a=U.m.d=n.readF2dot14(i,o),o+=2):64&_?(U.m.a=n.readF2dot14(i,o),o+=2,U.m.d=n.readF2dot14(i,o),o+=2):128&_&&(U.m.a=n.readF2dot14(i,o),o+=2,U.m.b=n.readF2dot14(i,o),o+=2,U.m.c=n.readF2dot14(i,o),o+=2,U.m.d=n.readF2dot14(i,o),o+=2)}while(32&_);if(256&_){var A=n.readUshort(i,o);for(o+=2,l.instr=[],u=0;u<A;u++)l.instr.push(i[o]),o++}}return l},t.GDEF={},t.GDEF.parse=function(r,e,n,i){var o=e;e+=4;var l=t._bin.readUshort(r,e);return{glyphClassDef:l===0?null:t._lctf.readClassDef(r,o+l)}},t.GPOS={},t.GPOS.parse=function(r,e,n,i){return t._lctf.parse(r,e,n,i,t.GPOS.subt)},t.GPOS.subt=function(r,e,n,i){var o=t._bin,l=n,u={};if(u.fmt=o.readUshort(r,n),n+=2,e==1||e==2||e==3||e==7||e==8&&u.fmt<=2){var c=o.readUshort(r,n);n+=2,u.coverage=t._lctf.readCoverage(r,c+l)}if(e==1&&u.fmt==1){var h=o.readUshort(r,n);n+=2,h!=0&&(u.pos=t.GPOS.readValueRecord(r,n,h))}else if(e==2&&u.fmt>=1&&u.fmt<=2){h=o.readUshort(r,n),n+=2;var d=o.readUshort(r,n);n+=2;var p=t._lctf.numOfOnes(h),m=t._lctf.numOfOnes(d);if(u.fmt==1){u.pairsets=[];var g=o.readUshort(r,n);n+=2;for(var O=0;O<g;O++){var S=l+o.readUshort(r,n);n+=2;var T=o.readUshort(r,S);S+=2;for(var _=[],U=0;U<T;U++){var B=o.readUshort(r,S);S+=2,h!=0&&(y=t.GPOS.readValueRecord(r,S,h),S+=2*p),d!=0&&(C=t.GPOS.readValueRecord(r,S,d),S+=2*m),_.push({gid2:B,val1:y,val2:C})}u.pairsets.push(_)}}if(u.fmt==2){var F=o.readUshort(r,n);n+=2;var A=o.readUshort(r,n);n+=2;var P=o.readUshort(r,n);n+=2;var R=o.readUshort(r,n);for(n+=2,u.classDef1=t._lctf.readClassDef(r,l+F),u.classDef2=t._lctf.readClassDef(r,l+A),u.matrix=[],O=0;O<P;O++){var X=[];for(U=0;U<R;U++){var y=null,C=null;h!=0&&(y=t.GPOS.readValueRecord(r,n,h),n+=2*p),d!=0&&(C=t.GPOS.readValueRecord(r,n,d),n+=2*m),X.push({val1:y,val2:C})}u.matrix.push(X)}}}else if(e==4&&u.fmt==1)u.markCoverage=t._lctf.readCoverage(r,o.readUshort(r,n)+l),u.baseCoverage=t._lctf.readCoverage(r,o.readUshort(r,n+2)+l),u.markClassCount=o.readUshort(r,n+4),u.markArray=t.GPOS.readMarkArray(r,o.readUshort(r,n+6)+l),u.baseArray=t.GPOS.readBaseArray(r,o.readUshort(r,n+8)+l,u.markClassCount);else if(e==6&&u.fmt==1)u.mark1Coverage=t._lctf.readCoverage(r,o.readUshort(r,n)+l),u.mark2Coverage=t._lctf.readCoverage(r,o.readUshort(r,n+2)+l),u.markClassCount=o.readUshort(r,n+4),u.mark1Array=t.GPOS.readMarkArray(r,o.readUshort(r,n+6)+l),u.mark2Array=t.GPOS.readBaseArray(r,o.readUshort(r,n+8)+l,u.markClassCount);else{if(e==9&&u.fmt==1){var w=o.readUshort(r,n);n+=2;var W=o.readUint(r,n);if(n+=4,i.ltype==9)i.ltype=w;else if(i.ltype!=w)throw"invalid extension substitution";return t.GPOS.subt(r,i.ltype,l+W)}console.debug("unsupported GPOS table LookupType",e,"format",u.fmt)}return u},t.GPOS.readValueRecord=function(r,e,n){var i=t._bin,o=[];return o.push(1&n?i.readShort(r,e):0),e+=1&n?2:0,o.push(2&n?i.readShort(r,e):0),e+=2&n?2:0,o.push(4&n?i.readShort(r,e):0),e+=4&n?2:0,o.push(8&n?i.readShort(r,e):0),e+=8&n?2:0,o},t.GPOS.readBaseArray=function(r,e,n){var i=t._bin,o=[],l=e,u=i.readUshort(r,e);e+=2;for(var c=0;c<u;c++){for(var h=[],d=0;d<n;d++)h.push(t.GPOS.readAnchorRecord(r,l+i.readUshort(r,e))),e+=2;o.push(h)}return o},t.GPOS.readMarkArray=function(r,e){var n=t._bin,i=[],o=e,l=n.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var c=t.GPOS.readAnchorRecord(r,n.readUshort(r,e+2)+o);c.markClass=n.readUshort(r,e),i.push(c),e+=4}return i},t.GPOS.readAnchorRecord=function(r,e){var n=t._bin,i={};return i.fmt=n.readUshort(r,e),i.x=n.readShort(r,e+2),i.y=n.readShort(r,e+4),i},t.GSUB={},t.GSUB.parse=function(r,e,n,i){return t._lctf.parse(r,e,n,i,t.GSUB.subt)},t.GSUB.subt=function(r,e,n,i){var o=t._bin,l=n,u={};if(u.fmt=o.readUshort(r,n),n+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&u.fmt<=2||e==6&&u.fmt<=2){var c=o.readUshort(r,n);n+=2,u.coverage=t._lctf.readCoverage(r,l+c)}if(e==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=o.readShort(r,n),n+=2;else if(u.fmt==2){var h=o.readUshort(r,n);n+=2,u.newg=o.readUshorts(r,n,h),n+=2*u.newg.length}}else if(e==2&&u.fmt==1){h=o.readUshort(r,n),n+=2,u.seqs=[];for(var d=0;d<h;d++){var p=o.readUshort(r,n)+l;n+=2;var m=o.readUshort(r,p);u.seqs.push(o.readUshorts(r,p+2,m))}}else if(e==4)for(u.vals=[],h=o.readUshort(r,n),n+=2,d=0;d<h;d++){var g=o.readUshort(r,n);n+=2,u.vals.push(t.GSUB.readLigatureSet(r,l+g))}else if(e==5&&u.fmt==2){if(u.fmt==2){var O=o.readUshort(r,n);n+=2,u.cDef=t._lctf.readClassDef(r,l+O),u.scset=[];var S=o.readUshort(r,n);for(n+=2,d=0;d<S;d++){var T=o.readUshort(r,n);n+=2,u.scset.push(T==0?null:t.GSUB.readSubClassSet(r,l+T))}}}else if(e==6&&u.fmt==3){if(u.fmt==3){for(d=0;d<3;d++){h=o.readUshort(r,n),n+=2;for(var _=[],U=0;U<h;U++)_.push(t._lctf.readCoverage(r,l+o.readUshort(r,n+2*U)));n+=2*h,d==0&&(u.backCvg=_),d==1&&(u.inptCvg=_),d==2&&(u.ahedCvg=_)}h=o.readUshort(r,n),n+=2,u.lookupRec=t.GSUB.readSubstLookupRecords(r,n,h)}}else{if(e==7&&u.fmt==1){var B=o.readUshort(r,n);n+=2;var F=o.readUint(r,n);if(n+=4,i.ltype==9)i.ltype=B;else if(i.ltype!=B)throw"invalid extension substitution";return t.GSUB.subt(r,i.ltype,l+F)}console.debug("unsupported GSUB table LookupType",e,"format",u.fmt)}return u},t.GSUB.readSubClassSet=function(r,e){var n=t._bin.readUshort,i=e,o=[],l=n(r,e);e+=2;for(var u=0;u<l;u++){var c=n(r,e);e+=2,o.push(t.GSUB.readSubClassRule(r,i+c))}return o},t.GSUB.readSubClassRule=function(r,e){var n=t._bin.readUshort,i={},o=n(r,e),l=n(r,e+=2);e+=2,i.input=[];for(var u=0;u<o-1;u++)i.input.push(n(r,e)),e+=2;return i.substLookupRecords=t.GSUB.readSubstLookupRecords(r,e,l),i},t.GSUB.readSubstLookupRecords=function(r,e,n){for(var i=t._bin.readUshort,o=[],l=0;l<n;l++)o.push(i(r,e),i(r,e+2)),e+=4;return o},t.GSUB.readChainSubClassSet=function(r,e){var n=t._bin,i=e,o=[],l=n.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var c=n.readUshort(r,e);e+=2,o.push(t.GSUB.readChainSubClassRule(r,i+c))}return o},t.GSUB.readChainSubClassRule=function(r,e){for(var n=t._bin,i={},o=["backtrack","input","lookahead"],l=0;l<o.length;l++){var u=n.readUshort(r,e);e+=2,l==1&&u--,i[o[l]]=n.readUshorts(r,e,u),e+=2*i[o[l]].length}return u=n.readUshort(r,e),e+=2,i.subst=n.readUshorts(r,e,2*u),e+=2*i.subst.length,i},t.GSUB.readLigatureSet=function(r,e){var n=t._bin,i=e,o=[],l=n.readUshort(r,e);e+=2;for(var u=0;u<l;u++){var c=n.readUshort(r,e);e+=2,o.push(t.GSUB.readLigature(r,i+c))}return o},t.GSUB.readLigature=function(r,e){var n=t._bin,i={chain:[]};i.nglyph=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);e+=2;for(var l=0;l<o-1;l++)i.chain.push(n.readUshort(r,e)),e+=2;return i},t.head={},t.head.parse=function(r,e,n){var i=t._bin,o={};return i.readFixed(r,e),e+=4,o.fontRevision=i.readFixed(r,e),e+=4,i.readUint(r,e),e+=4,i.readUint(r,e),e+=4,o.flags=i.readUshort(r,e),e+=2,o.unitsPerEm=i.readUshort(r,e),e+=2,o.created=i.readUint64(r,e),e+=8,o.modified=i.readUint64(r,e),e+=8,o.xMin=i.readShort(r,e),e+=2,o.yMin=i.readShort(r,e),e+=2,o.xMax=i.readShort(r,e),e+=2,o.yMax=i.readShort(r,e),e+=2,o.macStyle=i.readUshort(r,e),e+=2,o.lowestRecPPEM=i.readUshort(r,e),e+=2,o.fontDirectionHint=i.readShort(r,e),e+=2,o.indexToLocFormat=i.readShort(r,e),e+=2,o.glyphDataFormat=i.readShort(r,e),e+=2,o},t.hhea={},t.hhea.parse=function(r,e,n){var i=t._bin,o={};return i.readFixed(r,e),e+=4,o.ascender=i.readShort(r,e),e+=2,o.descender=i.readShort(r,e),e+=2,o.lineGap=i.readShort(r,e),e+=2,o.advanceWidthMax=i.readUshort(r,e),e+=2,o.minLeftSideBearing=i.readShort(r,e),e+=2,o.minRightSideBearing=i.readShort(r,e),e+=2,o.xMaxExtent=i.readShort(r,e),e+=2,o.caretSlopeRise=i.readShort(r,e),e+=2,o.caretSlopeRun=i.readShort(r,e),e+=2,o.caretOffset=i.readShort(r,e),e+=2,e+=8,o.metricDataFormat=i.readShort(r,e),e+=2,o.numberOfHMetrics=i.readUshort(r,e),e+=2,o},t.hmtx={},t.hmtx.parse=function(r,e,n,i){for(var o=t._bin,l={aWidth:[],lsBearing:[]},u=0,c=0,h=0;h<i.maxp.numGlyphs;h++)h<i.hhea.numberOfHMetrics&&(u=o.readUshort(r,e),e+=2,c=o.readShort(r,e),e+=2),l.aWidth.push(u),l.lsBearing.push(c);return l},t.kern={},t.kern.parse=function(r,e,n,i){var o=t._bin,l=o.readUshort(r,e);if(e+=2,l==1)return t.kern.parseV1(r,e-2,n,i);var u=o.readUshort(r,e);e+=2;for(var c={glyph1:[],rval:[]},h=0;h<u;h++){e+=2,n=o.readUshort(r,e),e+=2;var d=o.readUshort(r,e);e+=2;var p=d>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=t.kern.readFormat0(r,e,c)}return c},t.kern.parseV1=function(r,e,n,i){var o=t._bin;o.readFixed(r,e),e+=4;var l=o.readUint(r,e);e+=4;for(var u={glyph1:[],rval:[]},c=0;c<l;c++){o.readUint(r,e),e+=4;var h=o.readUshort(r,e);e+=2,o.readUshort(r,e),e+=2;var d=h>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;e=t.kern.readFormat0(r,e,u)}return u},t.kern.readFormat0=function(r,e,n){var i=t._bin,o=-1,l=i.readUshort(r,e);e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2;for(var u=0;u<l;u++){var c=i.readUshort(r,e);e+=2;var h=i.readUshort(r,e);e+=2;var d=i.readShort(r,e);e+=2,c!=o&&(n.glyph1.push(c),n.rval.push({glyph2:[],vals:[]}));var p=n.rval[n.rval.length-1];p.glyph2.push(h),p.vals.push(d),o=c}return e},t.loca={},t.loca.parse=function(r,e,n,i){var o=t._bin,l=[],u=i.head.indexToLocFormat,c=i.maxp.numGlyphs+1;if(u==0)for(var h=0;h<c;h++)l.push(o.readUshort(r,e+(h<<1))<<1);if(u==1)for(h=0;h<c;h++)l.push(o.readUint(r,e+(h<<2)));return l},t.maxp={},t.maxp.parse=function(r,e,n){var i=t._bin,o={},l=i.readUint(r,e);return e+=4,o.numGlyphs=i.readUshort(r,e),e+=2,l==65536&&(o.maxPoints=i.readUshort(r,e),e+=2,o.maxContours=i.readUshort(r,e),e+=2,o.maxCompositePoints=i.readUshort(r,e),e+=2,o.maxCompositeContours=i.readUshort(r,e),e+=2,o.maxZones=i.readUshort(r,e),e+=2,o.maxTwilightPoints=i.readUshort(r,e),e+=2,o.maxStorage=i.readUshort(r,e),e+=2,o.maxFunctionDefs=i.readUshort(r,e),e+=2,o.maxInstructionDefs=i.readUshort(r,e),e+=2,o.maxStackElements=i.readUshort(r,e),e+=2,o.maxSizeOfInstructions=i.readUshort(r,e),e+=2,o.maxComponentElements=i.readUshort(r,e),e+=2,o.maxComponentDepth=i.readUshort(r,e),e+=2),o},t.name={},t.name.parse=function(r,e,n){var i=t._bin,o={};i.readUshort(r,e),e+=2;var l=i.readUshort(r,e);e+=2,i.readUshort(r,e);for(var u,c=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=e+=2,d=0;d<l;d++){var p=i.readUshort(r,e);e+=2;var m=i.readUshort(r,e);e+=2;var g=i.readUshort(r,e);e+=2;var O=i.readUshort(r,e);e+=2;var S=i.readUshort(r,e);e+=2;var T=i.readUshort(r,e);e+=2;var _,U=c[O],B=h+12*l+T;if(p==0)_=i.readUnicode(r,B,S/2);else if(p==3&&m==0)_=i.readUnicode(r,B,S/2);else if(m==0)_=i.readASCII(r,B,S);else if(m==1)_=i.readUnicode(r,B,S/2);else if(m==3)_=i.readUnicode(r,B,S/2);else{if(p!=1)throw"unknown encoding "+m+", platformID: "+p;_=i.readASCII(r,B,S),console.debug("reading unknown MAC encoding "+m+" as ASCII")}var F="p"+p+","+g.toString(16);o[F]==null&&(o[F]={}),o[F][U!==void 0?U:O]=_,o[F]._lang=g}for(var A in o)if(o[A].postScriptName!=null&&o[A]._lang==1033)return o[A];for(var A in o)if(o[A].postScriptName!=null&&o[A]._lang==0)return o[A];for(var A in o)if(o[A].postScriptName!=null&&o[A]._lang==3084)return o[A];for(var A in o)if(o[A].postScriptName!=null)return o[A];for(var A in o){u=A;break}return console.debug("returning name table with languageID "+o[u]._lang),o[u]},t["OS/2"]={},t["OS/2"].parse=function(r,e,n){var i=t._bin.readUshort(r,e);e+=2;var o={};if(i==0)t["OS/2"].version0(r,e,o);else if(i==1)t["OS/2"].version1(r,e,o);else if(i==2||i==3||i==4)t["OS/2"].version2(r,e,o);else{if(i!=5)throw"unknown OS/2 table version: "+i;t["OS/2"].version5(r,e,o)}return o},t["OS/2"].version0=function(r,e,n){var i=t._bin;return n.xAvgCharWidth=i.readShort(r,e),e+=2,n.usWeightClass=i.readUshort(r,e),e+=2,n.usWidthClass=i.readUshort(r,e),e+=2,n.fsType=i.readUshort(r,e),e+=2,n.ySubscriptXSize=i.readShort(r,e),e+=2,n.ySubscriptYSize=i.readShort(r,e),e+=2,n.ySubscriptXOffset=i.readShort(r,e),e+=2,n.ySubscriptYOffset=i.readShort(r,e),e+=2,n.ySuperscriptXSize=i.readShort(r,e),e+=2,n.ySuperscriptYSize=i.readShort(r,e),e+=2,n.ySuperscriptXOffset=i.readShort(r,e),e+=2,n.ySuperscriptYOffset=i.readShort(r,e),e+=2,n.yStrikeoutSize=i.readShort(r,e),e+=2,n.yStrikeoutPosition=i.readShort(r,e),e+=2,n.sFamilyClass=i.readShort(r,e),e+=2,n.panose=i.readBytes(r,e,10),e+=10,n.ulUnicodeRange1=i.readUint(r,e),e+=4,n.ulUnicodeRange2=i.readUint(r,e),e+=4,n.ulUnicodeRange3=i.readUint(r,e),e+=4,n.ulUnicodeRange4=i.readUint(r,e),e+=4,n.achVendID=[i.readInt8(r,e),i.readInt8(r,e+1),i.readInt8(r,e+2),i.readInt8(r,e+3)],e+=4,n.fsSelection=i.readUshort(r,e),e+=2,n.usFirstCharIndex=i.readUshort(r,e),e+=2,n.usLastCharIndex=i.readUshort(r,e),e+=2,n.sTypoAscender=i.readShort(r,e),e+=2,n.sTypoDescender=i.readShort(r,e),e+=2,n.sTypoLineGap=i.readShort(r,e),e+=2,n.usWinAscent=i.readUshort(r,e),e+=2,n.usWinDescent=i.readUshort(r,e),e+=2},t["OS/2"].version1=function(r,e,n){var i=t._bin;return e=t["OS/2"].version0(r,e,n),n.ulCodePageRange1=i.readUint(r,e),e+=4,n.ulCodePageRange2=i.readUint(r,e),e+=4},t["OS/2"].version2=function(r,e,n){var i=t._bin;return e=t["OS/2"].version1(r,e,n),n.sxHeight=i.readShort(r,e),e+=2,n.sCapHeight=i.readShort(r,e),e+=2,n.usDefault=i.readUshort(r,e),e+=2,n.usBreak=i.readUshort(r,e),e+=2,n.usMaxContext=i.readUshort(r,e),e+=2},t["OS/2"].version5=function(r,e,n){var i=t._bin;return e=t["OS/2"].version2(r,e,n),n.usLowerOpticalPointSize=i.readUshort(r,e),e+=2,n.usUpperOpticalPointSize=i.readUshort(r,e),e+=2},t.post={},t.post.parse=function(r,e,n){var i=t._bin,o={};return o.version=i.readFixed(r,e),e+=4,o.italicAngle=i.readFixed(r,e),e+=4,o.underlinePosition=i.readShort(r,e),e+=2,o.underlineThickness=i.readShort(r,e),e+=2,o},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(r,e){var n=r.cmap,i=-1;if(n.p0e4!=null?i=n.p0e4:n.p3e1!=null?i=n.p3e1:n.p1e0!=null?i=n.p1e0:n.p0e3!=null&&(i=n.p0e3),i==-1)throw"no familiar platform and encoding!";var o=n.tables[i];if(o.format==0)return e>=o.map.length?0:o.map[e];if(o.format==4){for(var l=-1,u=0;u<o.endCount.length;u++)if(e<=o.endCount[u]){l=u;break}return l==-1||o.startCount[l]>e?0:65535&(o.idRangeOffset[l]!=0?o.glyphIdArray[e-o.startCount[l]+(o.idRangeOffset[l]>>1)-(o.idRangeOffset.length-l)]:e+o.idDelta[l])}if(o.format==12){if(e>o.groups[o.groups.length-1][1])return 0;for(u=0;u<o.groups.length;u++){var c=o.groups[u];if(c[0]<=e&&e<=c[1])return c[2]+(e-c[0])}return 0}throw"unknown cmap table format "+o.format},t.U.glyphToPath=function(r,e){var n={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[e]){var i=r.SVG.entries[e];return i==null?n:(typeof i=="string"&&(i=t.SVG.toPath(i),r.SVG.entries[e]=i),i)}if(r.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},l=r.CFF,u=r.CFF.Private;if(l.ROS){for(var c=0;l.FDSelect[c+2]<=e;)c+=2;u=l.FDArray[l.FDSelect[c+1]].Private}t.U._drawCFF(r.CFF.CharStrings[e],o,l,u,n)}else r.glyf&&t.U._drawGlyf(e,r,n);return n},t.U._drawGlyf=function(r,e,n){var i=e.glyf[r];i==null&&(i=e.glyf[r]=t.glyf._parseGlyf(e,r)),i!=null&&(i.noc>-1?t.U._simpleGlyph(i,n):t.U._compoGlyph(i,e,n))},t.U._simpleGlyph=function(r,e){for(var n=0;n<r.noc;n++){for(var i=n==0?0:r.endPts[n-1]+1,o=r.endPts[n],l=i;l<=o;l++){var u=l==i?o:l-1,c=l==o?i:l+1,h=1&r.flags[l],d=1&r.flags[u],p=1&r.flags[c],m=r.xs[l],g=r.ys[l];if(l==i)if(h){if(!d){t.U.P.moveTo(e,m,g);continue}t.U.P.moveTo(e,r.xs[u],r.ys[u])}else d?t.U.P.moveTo(e,r.xs[u],r.ys[u]):t.U.P.moveTo(e,(r.xs[u]+m)/2,(r.ys[u]+g)/2);h?d&&t.U.P.lineTo(e,m,g):p?t.U.P.qcurveTo(e,m,g,r.xs[c],r.ys[c]):t.U.P.qcurveTo(e,m,g,(m+r.xs[c])/2,(g+r.ys[c])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(r,e,n){for(var i=0;i<r.parts.length;i++){var o={cmds:[],crds:[]},l=r.parts[i];t.U._drawGlyf(l.glyphIndex,e,o);for(var u=l.m,c=0;c<o.crds.length;c+=2){var h=o.crds[c],d=o.crds[c+1];n.crds.push(h*u.a+d*u.b+u.tx),n.crds.push(h*u.c+d*u.d+u.ty)}for(c=0;c<o.cmds.length;c++)n.cmds.push(o.cmds[c])}},t.U._getGlyphClass=function(r,e){var n=t._lctf.getInterval(e,r);return n==-1?0:e[n+2]},t.U._applySubs=function(r,e,n,i){for(var o=r.length-e-1,l=0;l<n.tabs.length;l++)if(n.tabs[l]!=null){var u,c=n.tabs[l];if(!c.coverage||(u=t._lctf.coverageIndex(c.coverage,r[e]))!=-1){if(n.ltype==1)r[e],c.fmt==1?r[e]=r[e]+c.delta:r[e]=c.newg[u];else if(n.ltype==4)for(var h=c.vals[u],d=0;d<h.length;d++){var p=h[d],m=p.chain.length;if(!(m>o)){for(var g=!0,O=0,S=0;S<m;S++){for(;r[e+O+(1+S)]==-1;)O++;p.chain[S]!=r[e+O+(1+S)]&&(g=!1)}if(g){for(r[e]=p.nglyph,S=0;S<m+O;S++)r[e+S+1]=-1;break}}}else if(n.ltype==5&&c.fmt==2)for(var T=t._lctf.getInterval(c.cDef,r[e]),_=c.cDef[T+2],U=c.scset[_],B=0;B<U.length;B++){var F=U[B],A=F.input;if(!(A.length>o)){for(g=!0,S=0;S<A.length;S++){var P=t._lctf.getInterval(c.cDef,r[e+1+S]);if(T==-1&&c.cDef[P+2]!=A[S]){g=!1;break}}if(g){var R=F.substLookupRecords;for(d=0;d<R.length;d+=2)R[d],R[d+1]}}}else if(n.ltype==6&&c.fmt==3){if(!t.U._glsCovered(r,c.backCvg,e-c.backCvg.length)||!t.U._glsCovered(r,c.inptCvg,e)||!t.U._glsCovered(r,c.ahedCvg,e+c.inptCvg.length))continue;var X=c.lookupRec;for(B=0;B<X.length;B+=2){T=X[B];var y=i[X[B+1]];t.U._applySubs(r,e+T,y,i)}}}}},t.U._glsCovered=function(r,e,n){for(var i=0;i<e.length;i++)if(t._lctf.coverageIndex(e[i],r[n+i])==-1)return!1;return!0},t.U.glyphsToPath=function(r,e,n){for(var i={cmds:[],crds:[]},o=0,l=0;l<e.length;l++){var u=e[l];if(u!=-1){for(var c=l<e.length-1&&e[l+1]!=-1?e[l+1]:0,h=t.U.glyphToPath(r,u),d=0;d<h.crds.length;d+=2)i.crds.push(h.crds[d]+o),i.crds.push(h.crds[d+1]);for(n&&i.cmds.push(n),d=0;d<h.cmds.length;d++)i.cmds.push(h.cmds[d]);n&&i.cmds.push("X"),o+=r.hmtx.aWidth[u],l<e.length-1&&(o+=t.U.getPairAdjustment(r,u,c))}}return i},t.U.P={},t.U.P.moveTo=function(r,e,n){r.cmds.push("M"),r.crds.push(e,n)},t.U.P.lineTo=function(r,e,n){r.cmds.push("L"),r.crds.push(e,n)},t.U.P.curveTo=function(r,e,n,i,o,l,u){r.cmds.push("C"),r.crds.push(e,n,i,o,l,u)},t.U.P.qcurveTo=function(r,e,n,i,o){r.cmds.push("Q"),r.crds.push(e,n,i,o)},t.U.P.closePath=function(r){r.cmds.push("Z")},t.U._drawCFF=function(r,e,n,i,o){for(var l=e.stack,u=e.nStems,c=e.haveWidth,h=e.width,d=e.open,p=0,m=e.x,g=e.y,O=0,S=0,T=0,_=0,U=0,B=0,F=0,A=0,P=0,R=0,X={val:0,size:0};p<r.length;){t.CFF.getCharString(r,p,X);var y=X.val;if(p+=X.size,y=="o1"||y=="o18")l.length%2!=0&&!c&&(h=l.shift()+i.nominalWidthX),u+=l.length>>1,l.length=0,c=!0;else if(y=="o3"||y=="o23")l.length%2!=0&&!c&&(h=l.shift()+i.nominalWidthX),u+=l.length>>1,l.length=0,c=!0;else if(y=="o4")l.length>1&&!c&&(h=l.shift()+i.nominalWidthX,c=!0),d&&t.U.P.closePath(o),g+=l.pop(),t.U.P.moveTo(o,m,g),d=!0;else if(y=="o5")for(;l.length>0;)m+=l.shift(),g+=l.shift(),t.U.P.lineTo(o,m,g);else if(y=="o6"||y=="o7")for(var C=l.length,w=y=="o6",W=0;W<C;W++){var j=l.shift();w?m+=j:g+=j,w=!w,t.U.P.lineTo(o,m,g)}else if(y=="o8"||y=="o24"){C=l.length;for(var K=0;K+6<=C;)O=m+l.shift(),S=g+l.shift(),T=O+l.shift(),_=S+l.shift(),m=T+l.shift(),g=_+l.shift(),t.U.P.curveTo(o,O,S,T,_,m,g),K+=6;y=="o24"&&(m+=l.shift(),g+=l.shift(),t.U.P.lineTo(o,m,g))}else{if(y=="o11")break;if(y=="o1234"||y=="o1235"||y=="o1236"||y=="o1237")y=="o1234"&&(S=g,T=(O=m+l.shift())+l.shift(),R=_=S+l.shift(),B=_,A=g,m=(F=(U=(P=T+l.shift())+l.shift())+l.shift())+l.shift(),t.U.P.curveTo(o,O,S,T,_,P,R),t.U.P.curveTo(o,U,B,F,A,m,g)),y=="o1235"&&(O=m+l.shift(),S=g+l.shift(),T=O+l.shift(),_=S+l.shift(),P=T+l.shift(),R=_+l.shift(),U=P+l.shift(),B=R+l.shift(),F=U+l.shift(),A=B+l.shift(),m=F+l.shift(),g=A+l.shift(),l.shift(),t.U.P.curveTo(o,O,S,T,_,P,R),t.U.P.curveTo(o,U,B,F,A,m,g)),y=="o1236"&&(O=m+l.shift(),S=g+l.shift(),T=O+l.shift(),R=_=S+l.shift(),B=_,F=(U=(P=T+l.shift())+l.shift())+l.shift(),A=B+l.shift(),m=F+l.shift(),t.U.P.curveTo(o,O,S,T,_,P,R),t.U.P.curveTo(o,U,B,F,A,m,g)),y=="o1237"&&(O=m+l.shift(),S=g+l.shift(),T=O+l.shift(),_=S+l.shift(),P=T+l.shift(),R=_+l.shift(),U=P+l.shift(),B=R+l.shift(),F=U+l.shift(),A=B+l.shift(),Math.abs(F-m)>Math.abs(A-g)?m=F+l.shift():g=A+l.shift(),t.U.P.curveTo(o,O,S,T,_,P,R),t.U.P.curveTo(o,U,B,F,A,m,g));else if(y=="o14"){if(l.length>0&&!c&&(h=l.shift()+n.nominalWidthX,c=!0),l.length==4){var $=l.shift(),G=l.shift(),D=l.shift(),v=l.shift(),x=t.CFF.glyphBySE(n,D),b=t.CFF.glyphBySE(n,v);t.U._drawCFF(n.CharStrings[x],e,n,i,o),e.x=$,e.y=G,t.U._drawCFF(n.CharStrings[b],e,n,i,o)}d&&(t.U.P.closePath(o),d=!1)}else if(y=="o19"||y=="o20")l.length%2!=0&&!c&&(h=l.shift()+i.nominalWidthX),u+=l.length>>1,l.length=0,c=!0,p+=u+7>>3;else if(y=="o21")l.length>2&&!c&&(h=l.shift()+i.nominalWidthX,c=!0),g+=l.pop(),m+=l.pop(),d&&t.U.P.closePath(o),t.U.P.moveTo(o,m,g),d=!0;else if(y=="o22")l.length>1&&!c&&(h=l.shift()+i.nominalWidthX,c=!0),m+=l.pop(),d&&t.U.P.closePath(o),t.U.P.moveTo(o,m,g),d=!0;else if(y=="o25"){for(;l.length>6;)m+=l.shift(),g+=l.shift(),t.U.P.lineTo(o,m,g);O=m+l.shift(),S=g+l.shift(),T=O+l.shift(),_=S+l.shift(),m=T+l.shift(),g=_+l.shift(),t.U.P.curveTo(o,O,S,T,_,m,g)}else if(y=="o26")for(l.length%2&&(m+=l.shift());l.length>0;)O=m,S=g+l.shift(),m=T=O+l.shift(),g=(_=S+l.shift())+l.shift(),t.U.P.curveTo(o,O,S,T,_,m,g);else if(y=="o27")for(l.length%2&&(g+=l.shift());l.length>0;)S=g,T=(O=m+l.shift())+l.shift(),_=S+l.shift(),m=T+l.shift(),g=_,t.U.P.curveTo(o,O,S,T,_,m,g);else if(y=="o10"||y=="o29"){var k=y=="o10"?i:n;if(l.length==0)console.debug("error: empty stack");else{var E=l.pop(),H=k.Subrs[E+k.Bias];e.x=m,e.y=g,e.nStems=u,e.haveWidth=c,e.width=h,e.open=d,t.U._drawCFF(H,e,n,i,o),m=e.x,g=e.y,u=e.nStems,c=e.haveWidth,h=e.width,d=e.open}}else if(y=="o30"||y=="o31"){var M=l.length,L=(K=0,y=="o31");for(K+=M-(C=-3&M);K<C;)L?(S=g,T=(O=m+l.shift())+l.shift(),g=(_=S+l.shift())+l.shift(),C-K==5?(m=T+l.shift(),K++):m=T,L=!1):(O=m,S=g+l.shift(),T=O+l.shift(),_=S+l.shift(),m=T+l.shift(),C-K==5?(g=_+l.shift(),K++):g=_,L=!0),t.U.P.curveTo(o,O,S,T,_,m,g),K+=4}else{if((y+"").charAt(0)=="o")throw console.debug("Unknown operation: "+y,r),y;l.push(y)}}}e.x=m,e.y=g,e.nStems=u,e.haveWidth=c,e.width=h,e.open=d};var f=t,s={Typr:f};return a.Typr=f,a.default=s,Object.defineProperty(a,"__esModule",{value:!0}),a}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function woff2otfFactory(){return function(a){var t=Uint8Array,f=Uint16Array,s=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),n=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(y,C){for(var w=new f(31),W=0;W<31;++W)w[W]=C+=1<<y[W-1];var j=new s(w[30]);for(W=1;W<30;++W)for(var K=w[W];K<w[W+1];++K)j[K]=K-w[W]<<5|W;return[w,j]},o=i(r,2),l=o[0],u=o[1];l[28]=258,u[258]=28;for(var c=i(e,0)[0],h=new f(32768),d=0;d<32768;++d){var p=(43690&d)>>>1|(21845&d)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,h[d]=((65280&p)>>>8|(255&p)<<8)>>>1}var m=function(y,C,w){for(var W=y.length,j=0,K=new f(C);j<W;++j)++K[y[j]-1];var $,G=new f(C);for(j=0;j<C;++j)G[j]=G[j-1]+K[j-1]<<1;{$=new f(1<<C);var D=15-C;for(j=0;j<W;++j)if(y[j])for(var v=j<<4|y[j],x=C-y[j],b=G[y[j]-1]++<<x,k=b|(1<<x)-1;b<=k;++b)$[h[b]>>>D]=v}return $},g=new t(288);for(d=0;d<144;++d)g[d]=8;for(d=144;d<256;++d)g[d]=9;for(d=256;d<280;++d)g[d]=7;for(d=280;d<288;++d)g[d]=8;var O=new t(32);for(d=0;d<32;++d)O[d]=5;var S=m(g,9),T=m(O,5),_=function(y){for(var C=y[0],w=1;w<y.length;++w)y[w]>C&&(C=y[w]);return C},U=function(y,C,w){var W=C/8|0;return(y[W]|y[W+1]<<8)>>(7&C)&w},B=function(y,C){var w=C/8|0;return(y[w]|y[w+1]<<8|y[w+2]<<16)>>(7&C)},F=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],A=function(y,C,w){var W=new Error(C||F[y]);if(W.code=y,Error.captureStackTrace&&Error.captureStackTrace(W,A),!w)throw W;return W},P=function(y,C,w){var W=y.length;if(!W||w&&!w.l&&W<5)return C||new t(0);var j=!C||w,K=!w||w.i;w||(w={}),C||(C=new t(3*W));var $,G=function(le){var Ae=C.length;if(le>Ae){var Fe=new t(Math.max(2*Ae,le));Fe.set(C),C=Fe}},D=w.f||0,v=w.p||0,x=w.b||0,b=w.l,k=w.d,E=w.m,H=w.n,M=8*W;do{if(!b){w.f=D=U(y,v,1);var L=U(y,v+1,3);if(v+=3,!L){var Y=y[(q=(($=v)/8|0)+(7&$&&1)+4)-4]|y[q-3]<<8,ee=q+Y;if(ee>W){K&&A(0);break}j&&G(x+Y),C.set(y.subarray(q,ee),x),w.b=x+=Y,w.p=v=8*ee;continue}if(L==1)b=S,k=T,E=9,H=5;else if(L==2){var V=U(y,v,31)+257,N=U(y,v+10,15)+4,pe=V+U(y,v+5,31)+1;v+=14;for(var ue=new t(pe),Z=new t(19),te=0;te<N;++te)Z[n[te]]=U(y,v+3*te,7);v+=3*N;var se=_(Z),z=(1<<se)-1,re=m(Z,se);for(te=0;te<pe;){var q,I=re[U(y,v,z)];if(v+=15&I,(q=I>>>4)<16)ue[te++]=q;else{var he=0,Q=0;for(q==16?(Q=3+U(y,v,3),v+=2,he=ue[te-1]):q==17?(Q=3+U(y,v,7),v+=3):q==18&&(Q=11+U(y,v,127),v+=7);Q--;)ue[te++]=he}}var ae=ue.subarray(0,V),J=ue.subarray(V);E=_(ae),H=_(J),b=m(ae,E),k=m(J,H)}else A(1);if(v>M){K&&A(0);break}}j&&G(x+131072);for(var ye=(1<<E)-1,ne=(1<<H)-1,oe=v;;oe=v){var fe=(he=b[B(y,v)&ye])>>>4;if((v+=15&he)>M){K&&A(0);break}if(he||A(2),fe<256)C[x++]=fe;else{if(fe==256){oe=v,b=null;break}var de=fe-254;if(fe>264){var Se=r[te=fe-257];de=U(y,v,(1<<Se)-1)+l[te],v+=Se}var we=k[B(y,v)&ne],me=we>>>4;if(we||A(3),v+=15&we,J=c[me],me>3&&(Se=e[me],J+=B(y,v)&(1<<Se)-1,v+=Se),v>M){K&&A(0);break}j&&G(x+131072);for(var ge=x+de;x<ge;x+=4)C[x]=C[x-J],C[x+1]=C[x+1-J],C[x+2]=C[x+2-J],C[x+3]=C[x+3-J];x=ge}}w.l=b,w.p=oe,w.b=x,b&&(D=1,w.m=E,w.d=k,w.n=H)}while(!D);return x==C.length?C:function(le,Ae,Fe){(Fe==null||Fe>le.length)&&(Fe=le.length);var Be=new(le instanceof f?f:le instanceof s?s:t)(Fe-Ae);return Be.set(le.subarray(Ae,Fe)),Be}(C,0,x)},R=new t(0),X=typeof TextDecoder<"u"&&new TextDecoder;try{X.decode(R,{stream:!0})}catch{}return a.convert_streams=function(y){var C=new DataView(y),w=0;function W(){var V=C.getUint16(w);return w+=2,V}function j(){var V=C.getUint32(w);return w+=4,V}function K(V){Y.setUint16(ee,V),ee+=2}function $(V){Y.setUint32(ee,V),ee+=4}for(var G={signature:j(),flavor:j(),length:j(),numTables:W(),reserved:W(),totalSfntSize:j(),majorVersion:W(),minorVersion:W(),metaOffset:j(),metaLength:j(),metaOrigLength:j(),privOffset:j(),privLength:j()},D=0;Math.pow(2,D)<=G.numTables;)D++;D--;for(var v=16*Math.pow(2,D),x=16*G.numTables-v,b=12,k=[],E=0;E<G.numTables;E++)k.push({tag:j(),offset:j(),compLength:j(),origLength:j(),origChecksum:j()}),b+=16;var H,M=new Uint8Array(12+16*k.length+k.reduce(function(V,N){return V+N.origLength+4},0)),L=M.buffer,Y=new DataView(L),ee=0;return $(G.flavor),K(G.numTables),K(v),K(D),K(x),k.forEach(function(V){$(V.tag),$(V.origChecksum),$(b),$(V.origLength),V.outOffset=b,(b+=V.origLength)%4!=0&&(b+=4-b%4)}),k.forEach(function(V){var N,pe=y.slice(V.offset,V.offset+V.compLength);if(V.compLength!=V.origLength){var ue=new Uint8Array(V.origLength);N=new Uint8Array(pe,2),P(N,ue)}else ue=new Uint8Array(pe);M.set(ue,V.outOffset);var Z=0;(b=V.outOffset+V.origLength)%4!=0&&(Z=4-b%4),M.set(new Uint8Array(Z).buffer,V.outOffset+V.origLength),H=b+Z}),L.slice(0,H)},Object.defineProperty(a,"__esModule",{value:!0}),a}({}).convert_streams}function parserFactory(a,t){const f={M:2,L:2,Q:4,C:6,Z:0},s={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,e=2,n=4,i=8,o=16,l=32;let u;function c(F){if(!u){const A={R:e,L:r,D:n,C:o,U:l,T:i};u=new Map;for(let P in s){let R=0;s[P].split(",").forEach(X=>{let[y,C]=X.split("+");y=parseInt(y,36),C=C?parseInt(C,36):0,u.set(R+=y,A[P]);for(let w=C;w--;)u.set(++R,A[P])})}}return u.get(F)||l}const h=1,d=2,p=3,m=4,g=[null,"isol","init","fina","medi"];function O(F){const A=new Uint8Array(F.length);let P=l,R=h,X=-1;for(let y=0;y<F.length;y++){const C=F.codePointAt(y);let w=c(C)|0,W=h;w&i||(P&(r|n|o)?w&(e|n|o)?(W=p,(R===h||R===p)&&A[X]++):w&(r|l)&&(R===d||R===m)&&A[X]--:P&(e|l)&&(R===d||R===m)&&A[X]--,R=A[y]=W,P=w,X=y,C>65535&&y++)}return A}function S(F,A){const P=[];for(let X=0;X<A.length;X++){const y=A.codePointAt(X);y>65535&&X++,P.push(a.U.codeToGlyph(F,y))}const R=F.GSUB;if(R){const{lookupList:X,featureList:y}=R;let C;const w=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,W=[];y.forEach(j=>{if(w.test(j.tag))for(let K=0;K<j.tab.length;K++){if(W[j.tab[K]])continue;W[j.tab[K]]=!0;const $=X[j.tab[K]],G=/^(isol|init|fina|medi)$/.test(j.tag);G&&!C&&(C=O(A));for(let D=0;D<P.length;D++)(!C||!G||g[C[D]]===j.tag)&&a.U._applySubs(P,D,$,X)}})}return P}function T(F,A){const P=new Int16Array(A.length*3);let R=0;for(;R<A.length;R++){const w=A[R];if(w===-1)continue;P[R*3+2]=F.hmtx.aWidth[w];const W=F.GPOS;if(W){const j=W.lookupList;for(let K=0;K<j.length;K++){const $=j[K];for(let G=0;G<$.tabs.length;G++){const D=$.tabs[G];if($.ltype===1){if(a._lctf.coverageIndex(D.coverage,w)!==-1&&D.pos){C(D.pos,R);break}}else if($.ltype===2){let v=null,x=X();if(x!==-1){const b=a._lctf.coverageIndex(D.coverage,A[x]);if(b!==-1){if(D.fmt===1){const k=D.pairsets[b];for(let E=0;E<k.length;E++)k[E].gid2===w&&(v=k[E])}else if(D.fmt===2){const k=a.U._getGlyphClass(A[x],D.classDef1),E=a.U._getGlyphClass(w,D.classDef2);v=D.matrix[k][E]}if(v){v.val1&&C(v.val1,x),v.val2&&C(v.val2,R);break}}}}else if($.ltype===4){const v=a._lctf.coverageIndex(D.markCoverage,w);if(v!==-1){const x=X(y),b=x===-1?-1:a._lctf.coverageIndex(D.baseCoverage,A[x]);if(b!==-1){const k=D.markArray[v],E=D.baseArray[b][k.markClass];P[R*3]=E.x-k.x+P[x*3]-P[x*3+2],P[R*3+1]=E.y-k.y+P[x*3+1];break}}}else if($.ltype===6){const v=a._lctf.coverageIndex(D.mark1Coverage,w);if(v!==-1){const x=X();if(x!==-1){const b=A[x];if(_(F,b)===3){const k=a._lctf.coverageIndex(D.mark2Coverage,b);if(k!==-1){const E=D.mark1Array[v],H=D.mark2Array[k][E.markClass];P[R*3]=H.x-E.x+P[x*3]-P[x*3+2],P[R*3+1]=H.y-E.y+P[x*3+1];break}}}}}}}}else if(F.kern&&!F.cff){const j=X();if(j!==-1){const K=F.kern.glyph1.indexOf(A[j]);if(K!==-1){const $=F.kern.rval[K].glyph2.indexOf(w);$!==-1&&(P[j*3+2]+=F.kern.rval[K].vals[$])}}}}return P;function X(w){for(let W=R-1;W>=0;W--)if(A[W]!==-1&&(!w||w(A[W])))return W;return-1}function y(w){return _(F,w)===1}function C(w,W){for(let j=0;j<3;j++)P[W*3+j]+=w[j]||0}}function _(F,A){const P=F.GDEF&&F.GDEF.glyphClassDef;return P?a.U._getGlyphClass(A,P):0}function U(...F){for(let A=0;A<F.length;A++)if(typeof F[A]=="number")return F[A]}function B(F){const A=Object.create(null),P=F["OS/2"],R=F.hhea,X=F.head.unitsPerEm,y=U(P&&P.sTypoAscender,R&&R.ascender,X),C={unitsPerEm:X,ascender:y,descender:U(P&&P.sTypoDescender,R&&R.descender,0),capHeight:U(P&&P.sCapHeight,y),xHeight:U(P&&P.sxHeight,y),lineGap:U(P&&P.sTypoLineGap,R&&R.lineGap),supportsCodePoint(w){return a.U.codeToGlyph(F,w)>0},forEachGlyph(w,W,j,K){let $=0;const G=1/C.unitsPerEm*W,D=S(F,w);let v=0;const x=T(F,D);return D.forEach((b,k)=>{if(b!==-1){let E=A[b];if(!E){const{cmds:H,crds:M}=a.U.glyphToPath(F,b);let L="",Y=0;for(let ue=0,Z=H.length;ue<Z;ue++){const te=f[H[ue]];L+=H[ue];for(let se=1;se<=te;se++)L+=(se>1?",":"")+M[Y++]}let ee,V,N,pe;if(M.length){ee=V=1/0,N=pe=-1/0;for(let ue=0,Z=M.length;ue<Z;ue+=2){let te=M[ue],se=M[ue+1];te<ee&&(ee=te),se<V&&(V=se),te>N&&(N=te),se>pe&&(pe=se)}}else ee=N=V=pe=0;E=A[b]={index:b,advanceWidth:F.hmtx.aWidth[b],xMin:ee,yMin:V,xMax:N,yMax:pe,path:L}}K.call(null,E,$+x[k*3]*G,x[k*3+1]*G,v),$+=x[k*3+2]*G,j&&($+=j*W)}v+=w.codePointAt(v)>65535?2:1}),$}};return C}return function(A){const P=new Uint8Array(A,0,4),R=a._bin.readASCII(P,0,4);if(R==="wOFF")A=t(A);else if(R==="wOF2")throw new Error("woff2 fonts not supported");return B(a.parse(A)[0])}}const workerModule=defineWorkerModule({name:"Typr Font Parser",dependencies:[typrFactory,woff2otfFactory,parserFactory],init(a,t,f){const s=a(),r=t();return f(s,r)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function unicodeFontResolverClientFactory(){return function(a){var t=function(){this.buckets=new Map};t.prototype.add=function(T){var _=T>>5;this.buckets.set(_,(this.buckets.get(_)||0)|1<<(31&T))},t.prototype.has=function(T){var _=this.buckets.get(T>>5);return _!==void 0&&(_&1<<(31&T))!=0},t.prototype.serialize=function(){var T=[];return this.buckets.forEach(function(_,U){T.push((+U).toString(36)+":"+_.toString(36))}),T.join(",")},t.prototype.deserialize=function(T){var _=this;this.buckets.clear(),T.split(",").forEach(function(U){var B=U.split(":");_.buckets.set(parseInt(B[0],36),parseInt(B[1],36))})};var f=Math.pow(2,8),s=f-1,r=~s;function e(T){var _=function(B){return B&r}(T).toString(16),U=function(B){return(B&r)+f-1}(T).toString(16);return"codepoint-index/plane"+(T>>16)+"/"+_+"-"+U+".json"}function n(T,_){var U=T&s,B=_.codePointAt(U/6|0);return((B=(B||48)-48)&1<<U%6)!=0}function i(T,_){var U;(U=T,U.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(B){return B.split("-").map(function(F){return parseInt(F.trim(),16)})})).forEach(function(B){var F=B[0],A=B[1];A===void 0&&(A=F),_(F,A)})}function o(T,_){i(T,function(U,B){for(var F=U;F<=B;F++)_(F)})}var l={},u={},c=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(T){var _=c.get(T);return _||(_=new t,o(T.ranges,function(U){return _.add(U)}),c.set(T,_)),_}var p,m=new Map;function g(T,_,U){return T[_]?_:T[U]?U:function(B){for(var F in B)return F}(T)}function O(T,_){var U=_;if(!T.includes(U)){U=1/0;for(var B=0;B<T.length;B++)Math.abs(T[B]-_)<Math.abs(U-_)&&(U=T[B])}return U}function S(T){return p||(p=new Set,o("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(_){p.add(_)})),p.has(T)}return a.CodePointSet=t,a.clearCache=function(){l={},u={}},a.getFontsForString=function(T,_){_===void 0&&(_={});var U,B=_.lang;B===void 0&&(B=/\p{Script=Hangul}/u.test(U=T)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(U)?"ja":"en");var F=_.category;F===void 0&&(F="sans-serif");var A=_.style;A===void 0&&(A="normal");var P=_.weight;P===void 0&&(P=400);var R=(_.dataUrl||h).replace(/\/$/g,""),X=new Map,y=new Uint8Array(T.length),C={},w={},W=new Array(T.length),j=new Map,K=!1;function $(v){var x=m.get(v);return x||(x=fetch(R+"/"+v).then(function(b){if(!b.ok)throw new Error(b.statusText);return b.json().then(function(k){if(!Array.isArray(k)||k[0]!==1)throw new Error("Incorrect schema version; need 1, got "+k[0]);return k[1]})}).catch(function(b){if(R!==h)return K||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+R+'", trying default CDN. '+b.message),K=!0),R=h,m.delete(v),$(v);throw b}),m.set(v,x)),x}for(var G=function(v){var x=T.codePointAt(v),b=e(x);W[v]=b,l[b]||j.has(b)||j.set(b,$(b).then(function(k){l[b]=k})),x>65535&&(v++,D=v)},D=0;D<T.length;D++)G(D);return Promise.all(j.values()).then(function(){j.clear();for(var v=function(b){var k=T.codePointAt(b),E=null,H=l[W[b]],M=void 0;for(var L in H){var Y=w[L];if(Y===void 0&&(Y=w[L]=new RegExp(L).test(B||"en")),Y){for(var ee in M=L,H[L])if(n(k,H[L][ee])){E=ee;break}break}}if(!E){e:for(var V in H)if(V!==M){for(var N in H[V])if(n(k,H[V][N])){E=N;break e}}}E||(console.debug("No font coverage for U+"+k.toString(16)),E="latin"),W[b]=E,u[E]||j.has(E)||j.set(E,$("font-meta/"+E+".json").then(function(pe){u[E]=pe})),k>65535&&(b++,x=b)},x=0;x<T.length;x++)v(x);return Promise.all(j.values())}).then(function(){for(var v,x=null,b=0;b<T.length;b++){var k=T.codePointAt(b);if(x&&(S(k)||d(x).has(k)))y[b]=y[b-1];else{x=u[W[b]];var E=C[x.id];if(!E){var H=x.typeforms,M=g(H,F,"sans-serif"),L=g(H[M],A,"normal"),Y=O((v=H[M])===null||v===void 0?void 0:v[L],P);E=C[x.id]=R+"/font-files/"+x.id+"/"+M+"."+L+"."+Y+".woff"}var ee=X.get(E);ee==null&&(ee=X.size,X.set(E,ee)),y[b]=ee}k>65535&&(b++,y[b]=y[b-1])}return{fontUrls:Array.from(X.keys()),chars:y}})},Object.defineProperty(a,"__esModule",{value:!0}),a}({})}function createFontResolver(a,t){const f=Object.create(null),s=Object.create(null);function r(n,i){const o=l=>{console.error(`Failure loading font ${n}`,l)};try{const l=new XMLHttpRequest;l.open("get",n,!0),l.responseType="arraybuffer",l.onload=function(){if(l.status>=400)o(new Error(l.statusText));else if(l.status>0)try{const u=a(l.response);u.src=n,i(u)}catch(u){o(u)}},l.onerror=o,l.send()}catch(l){o(l)}}function e(n,i){let o=f[n];o?i(o):s[n]?s[n].push(i):(s[n]=[i],r(n,l=>{l.src=n,f[n]=l,s[n].forEach(u=>u(l)),delete s[n]}))}return function(n,i,{lang:o,fonts:l=[],style:u="normal",weight:c="normal",unicodeFontsURL:h}={}){const d=new Uint8Array(n.length),p=[];n.length||S();const m=new Map,g=[];if(u!=="italic"&&(u="normal"),typeof c!="number"&&(c=c==="bold"?700:400),l&&!Array.isArray(l)&&(l=[l]),l=l.slice().filter(_=>!_.lang||_.lang.test(o)).reverse(),l.length){let F=0;(function A(P=0){for(let R=P,X=n.length;R<X;R++){const y=n.codePointAt(R);if(F===1&&p[d[R-1]].supportsCodePoint(y)||R>0&&/\s/.test(n[R]))d[R]=d[R-1],F===2&&(g[g.length-1][1]=R);else for(let C=d[R],w=l.length;C<=w;C++)if(C===w){const W=F===2?g[g.length-1]:g[g.length]=[R,R];W[1]=R,F=2}else{d[R]=C;const{src:W,unicodeRange:j}=l[C];if(!j||T(y,j)){const K=f[W];if(!K){e(W,()=>{A(R)});return}if(K.supportsCodePoint(y)){let $=m.get(K);typeof $!="number"&&($=p.length,p.push(K),m.set(K,$)),d[R]=$,F=1;break}}}y>65535&&R+1<X&&(d[R+1]=d[R],R++,F===2&&(g[g.length-1][1]=R))}O()})()}else g.push([0,n.length-1]),O();function O(){if(g.length){const _=g.map(U=>n.substring(U[0],U[1]+1)).join(`
`);t.getFontsForString(_,{lang:o||void 0,style:u,weight:c,dataUrl:h}).then(({fontUrls:U,chars:B})=>{const F=p.length;let A=0;g.forEach(R=>{for(let X=0,y=R[1]-R[0];X<=y;X++)d[R[0]+X]=B[A++]+F;A++});let P=0;U.forEach((R,X)=>{e(R,y=>{p[X+F]=y,++P===U.length&&S()})})})}else S()}function S(){i({chars:d,fonts:p})}function T(_,U){for(let B=0;B<U.length;B++){const[F,A=F]=U[B];if(F<=_&&_<=A)return!0}return!1}}}const fontResolverWorkerModule=defineWorkerModule({name:"FontResolver",dependencies:[createFontResolver,workerModule,unicodeFontResolverClientFactory],init(a,t,f){return a(t,f())}});function createTypesetter(a,t){const s=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",e=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function n({text:p,lang:m,fonts:g,style:O,weight:S,preResolvedFonts:T,unicodeFontsURL:_},U){const B=({chars:F,fonts:A})=>{let P,R;const X=[];for(let y=0;y<F.length;y++)F[y]!==R?(R=F[y],X.push(P={start:y,end:y,fontObj:A[F[y]]})):P.end=y;U(X)};T?B(T):a(p,B,{lang:m,fonts:g,style:O,weight:S,unicodeFontsURL:_})}function i({text:p="",font:m,lang:g,sdfGlyphSize:O=64,fontSize:S=400,fontWeight:T=1,fontStyle:_="normal",letterSpacing:U=0,lineHeight:B="normal",maxWidth:F=1/0,direction:A,textAlign:P="left",textIndent:R=0,whiteSpace:X="normal",overflowWrap:y="normal",anchorX:C=0,anchorY:w=0,metricsOnly:W=!1,unicodeFontsURL:j,preResolvedFonts:K=null,includeCaretPositions:$=!1,chunkedBoundsSize:G=8192,colorRanges:D=null},v){const x=c(),b={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),S=+S,U=+U,F=+F,B=B||"normal",R=+R,n({text:p,lang:g,style:_,weight:T,fonts:typeof m=="string"?[{src:m}]:m,unicodeFontsURL:j,preResolvedFonts:K},k=>{b.fontLoad=c()-x;const E=isFinite(F);let H=null,M=null,L=null,Y=null,ee=null,V=null,N=null,pe=null,ue=0,Z=0,te=X!=="nowrap";const se=new Map,z=c();let re=R,q=0,I=new h;const he=[I];k.forEach(ne=>{const{fontObj:oe}=ne,{ascender:fe,descender:de,unitsPerEm:Se,lineGap:we,capHeight:me,xHeight:ge}=oe;let le=se.get(oe);if(!le){const ce=S/Se,_e=B==="normal"?(fe-de+we)*ce:B*S,ze=(_e-(fe-de)*ce)/2,be=Math.min(_e,(fe-de)*ce),xe=(fe+de)/2*ce+be/2;le={index:se.size,src:oe.src,fontObj:oe,fontSizeMult:ce,unitsPerEm:Se,ascender:fe*ce,descender:de*ce,capHeight:me*ce,xHeight:ge*ce,lineHeight:_e,baseline:-ze-fe*ce,caretTop:xe,caretBottom:xe-be},se.set(oe,le)}const{fontSizeMult:Ae}=le,Fe=p.slice(ne.start,ne.end+1);let Be,Ue;oe.forEachGlyph(Fe,S,U,(ce,_e,ze,be)=>{_e+=q,be+=ne.start,Be=_e,Ue=ce;const xe=p.charAt(be),ke=ce.advanceWidth*Ae,Ee=I.count;let ve;if("isEmpty"in ce||(ce.isWhitespace=!!xe&&new RegExp(r).test(xe),ce.canBreakAfter=!!xe&&e.test(xe),ce.isEmpty=ce.xMin===ce.xMax||ce.yMin===ce.yMax||s.test(xe)),!ce.isWhitespace&&!ce.isEmpty&&Z++,te&&E&&!ce.isWhitespace&&_e+ke+re>F&&Ee){if(I.glyphAt(Ee-1).glyphObj.canBreakAfter)ve=new h,re=-_e;else for(let De=Ee;De--;)if(De===0&&y==="break-word"){ve=new h,re=-_e;break}else if(I.glyphAt(De).glyphObj.canBreakAfter){ve=I.splitAt(De+1);const Re=ve.glyphAt(0).x;re-=Re;for(let Ce=ve.count;Ce--;)ve.glyphAt(Ce).x-=Re;break}ve&&(I.isSoftWrapped=!0,I=ve,he.push(I),ue=F)}let Te=I.glyphAt(I.count);Te.glyphObj=ce,Te.x=_e+re,Te.y=ze,Te.width=ke,Te.charIndex=be,Te.fontData=le,xe===`
`&&(I=new h,he.push(I),re=-(_e+ke+U*S)+R)}),q=Be+Ue.advanceWidth*Ae+U*S});let Q=0;he.forEach(ne=>{let oe=!0;for(let fe=ne.count;fe--;){const de=ne.glyphAt(fe);oe&&!de.glyphObj.isWhitespace&&(ne.width=de.x+de.width,ne.width>ue&&(ue=ne.width),oe=!1);let{lineHeight:Se,capHeight:we,xHeight:me,baseline:ge}=de.fontData;Se>ne.lineHeight&&(ne.lineHeight=Se);const le=ge-ne.baseline;le<0&&(ne.baseline+=le,ne.cap+=le,ne.ex+=le),ne.cap=Math.max(ne.cap,ne.baseline+we),ne.ex=Math.max(ne.ex,ne.baseline+me)}ne.baseline-=Q,ne.cap-=Q,ne.ex-=Q,Q+=ne.lineHeight});let ae=0,J=0;if(C&&(typeof C=="number"?ae=-C:typeof C=="string"&&(ae=-ue*(C==="left"?0:C==="center"?.5:C==="right"?1:l(C)))),w&&(typeof w=="number"?J=-w:typeof w=="string"&&(J=w==="top"?0:w==="top-baseline"?-he[0].baseline:w==="top-cap"?-he[0].cap:w==="top-ex"?-he[0].ex:w==="middle"?Q/2:w==="bottom"?Q:w==="bottom-baseline"?-he[he.length-1].baseline:l(w)*Q)),!W){const ne=t.getEmbeddingLevels(p,A);H=new Uint16Array(Z),M=new Uint8Array(Z),L=new Float32Array(Z*2),Y={},N=[1/0,1/0,-1/0,-1/0],pe=[],$&&(V=new Float32Array(p.length*4)),D&&(ee=new Uint8Array(Z*3));let oe=0,fe=-1,de=-1,Se,we;if(he.forEach((me,ge)=>{let{count:le,width:Ae}=me;if(le>0){let Fe=0;for(let be=le;be--&&me.glyphAt(be).glyphObj.isWhitespace;)Fe++;let Be=0,Ue=0;if(P==="center")Be=(ue-Ae)/2;else if(P==="right")Be=ue-Ae;else if(P==="justify"&&me.isSoftWrapped){let be=0;for(let xe=le-Fe;xe--;)me.glyphAt(xe).glyphObj.isWhitespace&&be++;Ue=(ue-Ae)/be}if(Ue||Be){let be=0;for(let xe=0;xe<le;xe++){let ke=me.glyphAt(xe);const Ee=ke.glyphObj;ke.x+=Be+be,Ue!==0&&Ee.isWhitespace&&xe<le-Fe&&(be+=Ue,ke.width+=Ue)}}const ce=t.getReorderSegments(p,ne,me.glyphAt(0).charIndex,me.glyphAt(me.count-1).charIndex);for(let be=0;be<ce.length;be++){const[xe,ke]=ce[be];let Ee=1/0,ve=-1/0;for(let Te=0;Te<le;Te++)if(me.glyphAt(Te).charIndex>=xe){let De=Te,Re=Te;for(;Re<le;Re++){let Ce=me.glyphAt(Re);if(Ce.charIndex>ke)break;Re<le-Fe&&(Ee=Math.min(Ee,Ce.x),ve=Math.max(ve,Ce.x+Ce.width))}for(let Ce=De;Ce<Re;Ce++){const Ge=me.glyphAt(Ce);Ge.x=ve-(Ge.x+Ge.width-Ee)}break}}let _e;const ze=be=>_e=be;for(let be=0;be<le;be++){const xe=me.glyphAt(be);_e=xe.glyphObj;const ke=_e.index,Ee=ne.levels[xe.charIndex]&1;if(Ee){const ve=t.getMirroredCharacter(p[xe.charIndex]);ve&&xe.fontData.fontObj.forEachGlyph(ve,0,0,ze)}if($){const{charIndex:ve,fontData:Te}=xe,De=xe.x+ae,Re=xe.x+xe.width+ae;V[ve*4]=Ee?Re:De,V[ve*4+1]=Ee?De:Re,V[ve*4+2]=me.baseline+Te.caretBottom+J,V[ve*4+3]=me.baseline+Te.caretTop+J;const Ce=ve-fe;Ce>1&&u(V,fe,Ce),fe=ve}if(D){const{charIndex:ve}=xe;for(;ve>de;)de++,D.hasOwnProperty(de)&&(we=D[de])}if(!_e.isWhitespace&&!_e.isEmpty){const ve=oe++,{fontSizeMult:Te,src:De,index:Re}=xe.fontData,Ce=Y[De]||(Y[De]={});Ce[ke]||(Ce[ke]={path:_e.path,pathBounds:[_e.xMin,_e.yMin,_e.xMax,_e.yMax]});const Ge=xe.x+ae,Ve=xe.y+me.baseline+J;L[ve*2]=Ge,L[ve*2+1]=Ve;const We=Ge+_e.xMin*Te,Xe=Ve+_e.yMin*Te,Ke=Ge+_e.xMax*Te,je=Ve+_e.yMax*Te;We<N[0]&&(N[0]=We),Xe<N[1]&&(N[1]=Xe),Ke>N[2]&&(N[2]=Ke),je>N[3]&&(N[3]=je),ve%G===0&&(Se={start:ve,end:ve,rect:[1/0,1/0,-1/0,-1/0]},pe.push(Se)),Se.end++;const Me=Se.rect;if(We<Me[0]&&(Me[0]=We),Xe<Me[1]&&(Me[1]=Xe),Ke>Me[2]&&(Me[2]=Ke),je>Me[3]&&(Me[3]=je),H[ve]=ke,M[ve]=Re,D){const Qe=ve*3;ee[Qe]=we>>16&255,ee[Qe+1]=we>>8&255,ee[Qe+2]=we&255}}}}}),V){const me=p.length-fe;me>1&&u(V,fe,me)}}const ye=[];se.forEach(({index:ne,src:oe,unitsPerEm:fe,ascender:de,descender:Se,lineHeight:we,capHeight:me,xHeight:ge})=>{ye[ne]={src:oe,unitsPerEm:fe,ascender:de,descender:Se,lineHeight:we,capHeight:me,xHeight:ge}}),b.typesetting=c()-z,v({glyphIds:H,glyphFontIndices:M,glyphPositions:L,glyphData:Y,fontData:ye,caretPositions:V,glyphColors:ee,chunkedBounds:pe,fontSize:S,topBaseline:J+he[0].baseline,blockBounds:[ae,J-Q,ae+ue,J],visibleBounds:N,timings:b})})}function o(p,m){i({...p,metricsOnly:!0},g=>{const[O,S,T,_]=g.blockBounds;m({width:T-O,height:_-S})})}function l(p){let m=p.match(/^([\d.]+)%$/),g=m?parseFloat(m[1]):NaN;return isNaN(g)?0:g/100}function u(p,m,g){const O=p[m*4],S=p[m*4+1],T=p[m*4+2],_=p[m*4+3],U=(S-O)/g;for(let B=0;B<g;B++){const F=(m+B)*4;p[F]=O+U*B,p[F+1]=O+U*(B+1),p[F+2]=T,p[F+3]=_}}function c(){return(self.performance||Date).now()}function h(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(p){let m=h.flyweight;return m.data=this.data,m.index=p,m},splitAt(p){let m=new h;return m.data=this.data.splice(p*d.length),m}},h.flyweight=d.reduce((p,m,g,O)=>(Object.defineProperty(p,m,{get(){return this.data[this.index*d.length+g]},set(S){this.data[this.index*d.length+g]=S}}),p),{data:null,index:0}),{typeset:i,measure:o}}const now=()=>(self.performance||Date).now(),mainThreadGenerator=SDFGenerator();let warned;function generateSDF(a,t,f,s,r,e,n,i,o,l,u=!0){return u?generateSDF_GL(a,t,f,s,r,e,n,i,o,l).then(null,c=>(warned||(console.warn("WebGL SDF generation failed, falling back to JS",c),warned=!0),generateSDF_JS_Worker(a,t,f,s,r,e,n,i,o,l))):generateSDF_JS_Worker(a,t,f,s,r,e,n,i,o,l)}const queue=[],chunkTimeBudget=5;let timer=0;function nextChunk(){const a=now();for(;queue.length&&now()-a<chunkTimeBudget;)queue.shift()();timer=queue.length?setTimeout(nextChunk,0):0}const generateSDF_GL=(...a)=>new Promise((t,f)=>{queue.push(()=>{const s=now();try{mainThreadGenerator.webgl.generateIntoCanvas(...a),t({timing:now()-s})}catch(r){f(r)}}),timer||(timer=setTimeout(nextChunk,0))}),threadCount=4,idleTimeout=2e3,threads={};let callNum=0;function generateSDF_JS_Worker(a,t,f,s,r,e,n,i,o,l){const u="TroikaTextSDFGenerator_JS_"+callNum++%threadCount;let c=threads[u];return c||(c=threads[u]={workerModule:defineWorkerModule({name:u,workerId:u,dependencies:[SDFGenerator,now],init(h,d){const p=h().javascript.generate;return function(...m){const g=d();return{textureData:p(...m),timing:d()-g}}},getTransferables(h){return[h.textureData.buffer]}}),requests:0,idleTimer:null}),c.requests++,clearTimeout(c.idleTimer),c.workerModule(a,t,f,s,r,e).then(({textureData:h,timing:d})=>{const p=now(),m=new Uint8Array(h.length*4);for(let g=0;g<h.length;g++)m[g*4+l]=h[g];return mainThreadGenerator.webglUtils.renderImageData(n,m,i,o,a,t,1<<3-l),d+=now()-p,--c.requests===0&&(c.idleTimer=setTimeout(()=>{terminateWorker(u)},idleTimeout)),{timing:d}})}function warmUpSDFCanvas(a){a._warm||(mainThreadGenerator.webgl.isSupported(a),a._warm=!0)}const resizeWebGLCanvasWithoutClearing=mainThreadGenerator.webglUtils.resizeWebGLCanvasWithoutClearing,CONFIG={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},tempColor=new Color;function now$1(){return(self.performance||Date).now()}const atlases=Object.create(null);function getTextRenderInfo(a,t){a=assign({},a);const f=now$1(),s=[];if(a.font&&s.push({label:"user",src:toAbsoluteURL(a.font)}),a.font=s,a.text=""+a.text,a.sdfGlyphSize=a.sdfGlyphSize||CONFIG.sdfGlyphSize,a.unicodeFontsURL=a.unicodeFontsURL||CONFIG.unicodeFontsURL,a.colorRanges!=null){let h={};for(let d in a.colorRanges)if(a.colorRanges.hasOwnProperty(d)){let p=a.colorRanges[d];typeof p!="number"&&(p=tempColor.set(p).getHex()),h[d]=p}a.colorRanges=h}Object.freeze(a);const{textureWidth:r,sdfExponent:e}=CONFIG,{sdfGlyphSize:n}=a,i=r/n*4;let o=atlases[n];if(!o){const h=document.createElement("canvas");h.width=r,h.height=n*256/i,o=atlases[n]={glyphCount:0,sdfGlyphSize:n,sdfCanvas:h,sdfTexture:new Texture(h,void 0,void 0,void 0,LinearFilter,LinearFilter),contextLost:!1,glyphsByFont:new Map},o.sdfTexture.generateMipmaps=!1,initContextLossHandling(o)}const{sdfTexture:l,sdfCanvas:u}=o;typesetInWorker(a).then(h=>{const{glyphIds:d,glyphFontIndices:p,fontData:m,glyphPositions:g,fontSize:O,timings:S}=h,T=[],_=new Float32Array(d.length*4);let U=0,B=0;const F=now$1(),A=m.map(C=>{let w=o.glyphsByFont.get(C.src);return w||o.glyphsByFont.set(C.src,w=new Map),w});d.forEach((C,w)=>{const W=p[w],{src:j,unitsPerEm:K}=m[W];let $=A[W].get(C);if(!$){const{path:b,pathBounds:k}=h.glyphData[j][C],E=Math.max(k[2]-k[0],k[3]-k[1])/n*(CONFIG.sdfMargin*n+.5),H=o.glyphCount++,M=[k[0]-E,k[1]-E,k[2]+E,k[3]+E];A[W].set(C,$={path:b,atlasIndex:H,sdfViewBox:M}),T.push($)}const{sdfViewBox:G}=$,D=g[B++],v=g[B++],x=O/K;_[U++]=D+G[0]*x,_[U++]=v+G[1]*x,_[U++]=D+G[2]*x,_[U++]=v+G[3]*x,d[w]=$.atlasIndex}),S.quads=(S.quads||0)+(now$1()-F);const P=now$1();S.sdf={};const R=u.height,X=Math.ceil(o.glyphCount/i),y=Math.pow(2,Math.ceil(Math.log2(X*n)));y>R&&(console.info(`Increasing SDF texture size ${R}->${y}`),resizeWebGLCanvasWithoutClearing(u,r,y),l.dispose()),Promise.all(T.map(C=>generateGlyphSDF(C,o,a.gpuAccelerateSDF).then(({timing:w})=>{S.sdf[C.atlasIndex]=w}))).then(()=>{T.length&&!o.contextLost&&(safariPre15Workaround(o),l.needsUpdate=!0),S.sdfTotal=now$1()-P,S.total=now$1()-f,t(Object.freeze({parameters:a,sdfTexture:l,sdfGlyphSize:n,sdfExponent:e,glyphBounds:_,glyphAtlasIndices:d,glyphColors:h.glyphColors,caretPositions:h.caretPositions,chunkedBounds:h.chunkedBounds,ascender:h.ascender,descender:h.descender,lineHeight:h.lineHeight,capHeight:h.capHeight,xHeight:h.xHeight,topBaseline:h.topBaseline,blockBounds:h.blockBounds,visibleBounds:h.visibleBounds,timings:h.timings}))})}),Promise.resolve().then(()=>{o.contextLost||warmUpSDFCanvas(u)})}function generateGlyphSDF({path:a,atlasIndex:t,sdfViewBox:f},{sdfGlyphSize:s,sdfCanvas:r,contextLost:e},n){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:o}=CONFIG,l=Math.max(f[2]-f[0],f[3]-f[1]),u=Math.floor(t/4),c=u%(i/s)*s,h=Math.floor(u/(i/s))*s,d=t%4;return generateSDF(s,s,a,f,l,o,r,c,h,d,n)}function initContextLossHandling(a){const t=a.sdfCanvas;t.addEventListener("webglcontextlost",f=>{console.log("Context Lost",f),f.preventDefault(),a.contextLost=!0}),t.addEventListener("webglcontextrestored",f=>{console.log("Context Restored",f),a.contextLost=!1;const s=[];a.glyphsByFont.forEach(r=>{r.forEach(e=>{s.push(generateGlyphSDF(e,a,!0))})}),Promise.all(s).then(()=>{safariPre15Workaround(a),a.sdfTexture.needsUpdate=!0})})}function preloadFont({font:a,characters:t,sdfGlyphSize:f},s){let r=Array.isArray(t)?t.join(`
`):""+t;getTextRenderInfo({font:a,sdfGlyphSize:f,text:r},s)}function assign(a,t){for(let f in t)t.hasOwnProperty(f)&&(a[f]=t[f]);return a}let linkEl;function toAbsoluteURL(a){return linkEl||(linkEl=typeof document>"u"?{}:document.createElement("a")),linkEl.href=a,linkEl.href}function safariPre15Workaround(a){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:f}=a,{width:s,height:r}=t,e=a.sdfCanvas.getContext("webgl");let n=f.image.data;(!n||n.length!==s*r*4)&&(n=new Uint8Array(s*r*4),f.image={width:s,height:r,data:n},f.flipY=!1,f.isDataTexture=!0),e.readPixels(0,0,s,r,e.RGBA,e.UNSIGNED_BYTE,n)}}const typesetterWorkerModule=defineWorkerModule({name:"Typesetter",dependencies:[createTypesetter,fontResolverWorkerModule,bidiFactory],init(a,t,f){return a(t,f())}}),typesetInWorker=defineWorkerModule({name:"Typesetter",dependencies:[typesetterWorkerModule],init(a){return function(t){return new Promise(f=>{a.typeset(t,f)})}},getTransferables(a){const t=[];for(let f in a)a[f]&&a[f].buffer&&t.push(a[f].buffer);return t}});typesetInWorker.onMainThread;const templateGeometries={};function getTemplateGeometry(a){let t=templateGeometries[a];return t||(t=templateGeometries[a]=new PlaneGeometry(1,1,a,a).translate(.5,.5,0)),t}const glyphBoundsAttrName="aTroikaGlyphBounds",glyphIndexAttrName="aTroikaGlyphIndex",glyphColorAttrName="aTroikaGlyphColor";class GlyphsGeometry extends InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Sphere,this.boundingBox=new Box3}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let f=getTemplateGeometry(t);["position","normal","uv"].forEach(s=>{this.attributes[s]=f.attributes[s].clone()}),this.setIndex(f.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,f,s,r,e){this.updateAttributeData(glyphBoundsAttrName,t,4),this.updateAttributeData(glyphIndexAttrName,f,1),this.updateAttributeData(glyphColorAttrName,e,3),this._blockBounds=s,this._chunkedBounds=r,this.instanceCount=f.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:f,boundingBox:s}=this;if(f){const{PI:r,floor:e,min:n,max:i,sin:o,cos:l}=Math,u=r/2,c=r*2,h=Math.abs(f),d=t[0]/h,p=t[2]/h,m=e((d+u)/c)!==e((p+u)/c)?-h:n(o(d)*h,o(p)*h),g=e((d-u)/c)!==e((p-u)/c)?h:i(o(d)*h,o(p)*h),O=e((d+r)/c)!==e((p+r)/c)?h*2:i(h-l(d)*h,h-l(p)*h);s.min.set(m,t[1],f<0?-O:0),s.max.set(g,t[3],f<0?0:O)}else s.min.set(t[0],t[1],0),s.max.set(t[2],t[3],0);s.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let f=this.getAttribute(glyphIndexAttrName).count,s=this._chunkedBounds;if(s)for(let r=s.length;r--;){f=s[r].end;let e=s[r].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=f}updateAttributeData(t,f,s){const r=this.getAttribute(t);f?r&&r.array.length===f.length?(r.array.set(f),r.needsUpdate=!0):(this.setAttribute(t,new InstancedBufferAttribute(f,s)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(t)}}const VERTEX_DEFS=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,VERTEX_TRANSFORM=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,FRAGMENT_DEFS=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,FRAGMENT_TRANSFORM=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function createTextDerivedMaterial(a){const t=createDerivedMaterial(a,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Vector4(0,0,0,0)},uTroikaClipRect:{value:new Vector4(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:VERTEX_DEFS,vertexTransform:VERTEX_TRANSFORM,fragmentDefs:FRAGMENT_DEFS,fragmentColorTransform:FRAGMENT_TRANSFORM,customRewriter({vertexShader:f,fragmentShader:s}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(s)&&(s=s.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(f)||(f=f.replace(voidMainRegExp,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:f,fragmentShader:s}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const defaultMaterial=new MeshBasicMaterial({color:16777215,side:DoubleSide,transparent:!0}),defaultStrokeColor=8421504,tempMat4=new Matrix4,tempVec3a=new Vector3,tempVec3b=new Vector3,tempArray=[],origin=new Vector3,defaultOrient="+x+y";function first(a){return Array.isArray(a)?a[0]:a}let getFlatRaycastMesh=()=>{const a=new Mesh(new PlaneGeometry(1,1),defaultMaterial);return getFlatRaycastMesh=()=>a,a},getCurvedRaycastMesh=()=>{const a=new Mesh(new PlaneGeometry(1,1,32,1),defaultMaterial);return getCurvedRaycastMesh=()=>a,a};const syncStartEvent={type:"syncstart"},syncCompleteEvent={type:"synccomplete"},SYNCABLE_PROPS=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],COPYABLE_PROPS=SYNCABLE_PROPS.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Text$1=class extends Mesh{constructor(){const t=new GlyphsGeometry;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=defaultStrokeColor,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=defaultOrient,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(syncStartEvent),getTextRenderInfo({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},f=>{this._isSyncing=!1,this._textRenderInfo=f,this.geometry.updateGlyphs(f.glyphBounds,f.glyphAtlasIndices,f.blockBounds,f.chunkedBounds,f.glyphColors);const s=this._queuedSyncs;s&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{s.forEach(r=>r&&r())})),this.dispatchEvent(syncCompleteEvent),t&&t()})))}onBeforeRender(t,f,s,r,e,n){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return createTextDerivedMaterial(t)}get material(){let t=this._derivedMaterial;const f=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=defaultMaterial.clone());if((!t||!t.isDerivedFrom(f))&&(t=this._derivedMaterial=this.createDerivedMaterial(f),f.addEventListener("dispose",function s(){f.removeEventListener("dispose",s),t.dispose()})),this.hasOutline()){let s=t._outlineMtl;return s||(s=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),s.isTextOutlineMaterial=!0,s.depthWrite=!1,s.map=null,t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),s.dispose()})),[s,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return first(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const f=t.isTextOutlineMaterial,s=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:i,blockBounds:o}=r;s.uTroikaSDFTexture.value=i,s.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),s.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,s.uTroikaSDFExponent.value=r.sdfExponent,s.uTroikaTotalBounds.value.fromArray(o),s.uTroikaUseGlyphColors.value=!f&&!!r.glyphColors;let l=0,u=0,c=0,h,d,p,m=0,g=0;if(f){let{outlineWidth:S,outlineOffsetX:T,outlineOffsetY:_,outlineBlur:U,outlineOpacity:B}=this;l=this._parsePercent(S)||0,u=Math.max(0,this._parsePercent(U)||0),h=B,m=this._parsePercent(T)||0,g=this._parsePercent(_)||0}else c=Math.max(0,this._parsePercent(this.strokeWidth)||0),c&&(p=this.strokeColor,s.uTroikaStrokeColor.value.set(p??defaultStrokeColor),d=this.strokeOpacity,d==null&&(d=1)),h=this.fillOpacity;s.uTroikaEdgeOffset.value=l,s.uTroikaPositionOffset.value.set(m,g),s.uTroikaBlurRadius.value=u,s.uTroikaStrokeWidth.value=c,s.uTroikaStrokeOpacity.value=d,s.uTroikaFillOpacity.value=h??1,s.uTroikaCurveRadius.value=this.curveRadius||0;let O=this.clipRect;if(O&&Array.isArray(O)&&O.length===4)s.uTroikaClipRect.value.fromArray(O);else{const S=(this.fontSize||.1)*100;s.uTroikaClipRect.value.set(o[0]-S,o[1]-S,o[2]+S,o[3]+S)}this.geometry.applyClipRect(s.uTroikaClipRect.value)}s.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=f?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const i=t.hasOwnProperty("color")?t.color:t.color=new Color;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let n=this.orientation||defaultOrient;if(n!==t._orientation){let i=s.uTroikaOrient.value;n=n.replace(/[^-+xyz]/g,"");let o=n!==defaultOrient&&n.match(/^([-+])([xyz])([-+])([xyz])$/);if(o){let[,l,u,c,h]=o;tempVec3a.set(0,0,0)[u]=l==="-"?1:-1,tempVec3b.set(0,0,0)[h]=c==="-"?-1:1,tempMat4.lookAt(origin,tempVec3a.cross(tempVec3b),tempVec3b),i.setFromMatrix4(tempMat4)}else i.identity();t._orientation=n}}_parsePercent(t){if(typeof t=="string"){let f=t.match(/^(-?[\d.]+)%$/),s=f?parseFloat(f[1]):NaN;t=(isNaN(s)?0:s/100)*this.fontSize}return t}localPositionToTextCoords(t,f=new Vector2){f.copy(t);const s=this.curveRadius;return s&&(f.x=Math.atan2(t.x,Math.abs(s)-Math.abs(t.z))*Math.abs(s)),f}worldPositionToTextCoords(t,f=new Vector2){return tempVec3a.copy(t),this.localPositionToTextCoords(this.worldToLocal(tempVec3a),f)}raycast(t,f){const{textRenderInfo:s,curveRadius:r}=this;if(s){const e=s.blockBounds,n=r?getCurvedRaycastMesh():getFlatRaycastMesh(),i=n.geometry,{position:o,uv:l}=i.attributes;for(let u=0;u<l.count;u++){let c=e[0]+l.getX(u)*(e[2]-e[0]);const h=e[1]+l.getY(u)*(e[3]-e[1]);let d=0;r&&(d=r-Math.cos(c/r)*r,c=Math.sin(c/r)*r),o.setXYZ(u,c,h,d)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,n.matrixWorld=this.matrixWorld,n.material.side=this.material.side,tempArray.length=0,n.raycast(t,tempArray);for(let u=0;u<tempArray.length;u++)tempArray[u].object=this,f.push(tempArray[u])}}copy(t){const f=this.geometry;return super.copy(t),this.geometry=f,COPYABLE_PROPS.forEach(s=>{this[s]=t[s]}),this}clone(){return new this.constructor().copy(this)}};SYNCABLE_PROPS.forEach(a=>{const t="_private_"+a;Object.defineProperty(Text$1.prototype,a,{get(){return this[t]},set(f){f!==this[t]&&(this[t]=f,this._needsSync=!0)}})});new Box3;new Color;const Text=reactExports.forwardRef(({sdfGlyphSize:a=64,anchorX:t="center",anchorY:f="middle",font:s,fontSize:r=1,children:e,characters:n,onSync:i,...o},l)=>{const u=useThree(({invalidate:p})=>p),[c]=reactExports.useState(()=>new Text$1),[h,d]=reactExports.useMemo(()=>{const p=[];let m="";return reactExports.Children.forEach(e,g=>{typeof g=="string"||typeof g=="number"?m+=g:p.push(g)}),[p,m]},[e]);return suspend(()=>new Promise(p=>preloadFont({font:s,characters:n},p)),["troika-text",s,n]),reactExports.useLayoutEffect(()=>void c.sync(()=>{u(),i&&i(c)})),reactExports.useEffect(()=>()=>c.dispose(),[c]),reactExports.createElement("primitive",_extends({object:c,ref:l,font:s,text:d,anchorX:t,anchorY:f,fontSize:r,sdfGlyphSize:a},o),h)}),getVersion=()=>parseInt(REVISION.replace(/\D+/g,"")),version=getVersion(),ImageMaterialImpl=shaderMaterial({color:new Color("white"),scale:new Vector2(1,1),imageBounds:new Vector2(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${version>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),ImageBase=reactExports.forwardRef(({children:a,color:t,segments:f=1,scale:s=1,zoom:r=1,grayscale:e=0,opacity:n=1,radius:i=0,texture:o,toneMapped:l,transparent:u,side:c,...h},d)=>{extend({ImageMaterial:ImageMaterialImpl});const p=reactExports.useRef(null),m=useThree(T=>T.size),g=Array.isArray(s)?[s[0],s[1]]:[s,s],O=[o.image.width,o.image.height],S=Math.max(m.width,m.height);return reactExports.useImperativeHandle(d,()=>p.current,[]),reactExports.useLayoutEffect(()=>{p.current.geometry.parameters&&p.current.material.scale.set(g[0]*p.current.geometry.parameters.width,g[1]*p.current.geometry.parameters.height)},[g[0],g[1]]),reactExports.createElement("mesh",_extends({ref:p,scale:Array.isArray(s)?[...s,1]:s},h),reactExports.createElement("planeGeometry",{args:[1,1,f,f]}),reactExports.createElement("imageMaterial",{color:t,map:o,zoom:r,grayscale:e,opacity:n,scale:g,imageBounds:O,resolution:S,radius:i,toneMapped:l,transparent:u,side:c,key:ImageMaterialImpl.key}),a)}),ImageWithUrl=reactExports.forwardRef(({url:a,...t},f)=>{const s=useTexture(a);return reactExports.createElement(ImageBase,_extends({},t,{texture:s,ref:f}))}),ImageWithTexture=reactExports.forwardRef(({url:a,...t},f)=>reactExports.createElement(ImageBase,_extends({},t,{ref:f}))),Image=reactExports.forwardRef((a,t)=>{if(a.url)return reactExports.createElement(ImageWithUrl,_extends({},a,{ref:t}));if(a.texture)return reactExports.createElement(ImageWithTexture,_extends({},a,{ref:t}));throw new Error("<Image /> requires a url or texture")});class ConvolutionMaterial extends ShaderMaterial{constructor(t=new Vector2){super({uniforms:{inputBuffer:new Uniform(null),depthBuffer:new Uniform(null),resolution:new Uniform(new Vector2),texelSize:new Uniform(new Vector2),halfTexelSize:new Uniform(new Vector2),kernel:new Uniform(0),scale:new Uniform(1),cameraNear:new Uniform(0),cameraFar:new Uniform(1),minDepthThreshold:new Uniform(0),maxDepthThreshold:new Uniform(1),depthScale:new Uniform(0),depthToBlurRatioBias:new Uniform(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${version>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(t.x,t.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(t,f){this.uniforms.texelSize.value.set(t,f),this.uniforms.halfTexelSize.value.set(t,f).multiplyScalar(.5)}setResolution(t){this.uniforms.resolution.value.copy(t)}}class BlurPass{constructor({gl:t,resolution:f,width:s=500,height:r=500,minDepthThreshold:e=0,maxDepthThreshold:n=1,depthScale:i=0,depthToBlurRatioBias:o=.25}){this.renderToScreen=!1,this.renderTargetA=new WebGLRenderTarget(f,f,{minFilter:LinearFilter,magFilter:LinearFilter,stencilBuffer:!1,depthBuffer:!1,type:HalfFloatType}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new ConvolutionMaterial,this.convolutionMaterial.setTexelSize(1/s,1/r),this.convolutionMaterial.setResolution(new Vector2(s,r)),this.scene=new Scene,this.camera=new Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=e,this.convolutionMaterial.uniforms.maxDepthThreshold.value=n,this.convolutionMaterial.uniforms.depthScale.value=i,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=o,this.convolutionMaterial.defines.USE_DEPTH=i>0;const l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),u=new Float32Array([0,0,2,0,0,2]),c=new BufferGeometry;c.setAttribute("position",new BufferAttribute(l,3)),c.setAttribute("uv",new BufferAttribute(u,2)),this.screen=new Mesh(c,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(t,f,s){const r=this.scene,e=this.camera,n=this.renderTargetA,i=this.renderTargetB;let o=this.convolutionMaterial,l=o.uniforms;l.depthBuffer.value=f.depthTexture;const u=o.kernel;let c=f,h,d,p;for(d=0,p=u.length-1;d<p;++d)h=d&1?i:n,l.kernel.value=u[d],l.inputBuffer.value=c.texture,t.setRenderTarget(h),t.render(r,e),c=h;l.kernel.value=u[d],l.inputBuffer.value=c.texture,t.setRenderTarget(this.renderToScreen?null:s),t.render(r,e)}}let MeshReflectorMaterial$1=class extends MeshStandardMaterial{constructor(t={}){super(t),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(t)}onBeforeCompile(t){var f;(f=t.defines)!=null&&f.USE_UV||(t.defines.USE_UV=""),t.uniforms.hasBlur=this._hasBlur,t.uniforms.tDiffuse=this._tDiffuse,t.uniforms.tDepth=this._tDepth,t.uniforms.distortionMap=this._distortionMap,t.uniforms.tDiffuseBlur=this._tDiffuseBlur,t.uniforms.textureMatrix=this._textureMatrix,t.uniforms.mirror=this._mirror,t.uniforms.mixBlur=this._mixBlur,t.uniforms.mixStrength=this._blurStrength,t.uniforms.minDepthThreshold=this._minDepthThreshold,t.uniforms.maxDepthThreshold=this._maxDepthThreshold,t.uniforms.depthScale=this._depthScale,t.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,t.uniforms.distortion=this._distortion,t.uniforms.mixContrast=this._mixContrast,t.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${t.vertexShader}`,t.vertexShader=t.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),t.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${t.fragmentShader}`,t.fragmentShader=t.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(t){this._tDiffuse.value=t}get tDepth(){return this._tDepth.value}set tDepth(t){this._tDepth.value=t}get distortionMap(){return this._distortionMap.value}set distortionMap(t){this._distortionMap.value=t}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(t){this._tDiffuseBlur.value=t}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(t){this._textureMatrix.value=t}get hasBlur(){return this._hasBlur.value}set hasBlur(t){this._hasBlur.value=t}get mirror(){return this._mirror.value}set mirror(t){this._mirror.value=t}get mixBlur(){return this._mixBlur.value}set mixBlur(t){this._mixBlur.value=t}get mixStrength(){return this._blurStrength.value}set mixStrength(t){this._blurStrength.value=t}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(t){this._minDepthThreshold.value=t}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(t){this._maxDepthThreshold.value=t}get depthScale(){return this._depthScale.value}set depthScale(t){this._depthScale.value=t}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(t){this._depthToBlurRatioBias.value=t}get distortion(){return this._distortion.value}set distortion(t){this._distortion.value=t}get mixContrast(){return this._mixContrast.value}set mixContrast(t){this._mixContrast.value=t}};const MeshReflectorMaterial=reactExports.forwardRef(({mixBlur:a=0,mixStrength:t=1,resolution:f=256,blur:s=[0,0],minDepthThreshold:r=.9,maxDepthThreshold:e=1,depthScale:n=0,depthToBlurRatioBias:i=.25,mirror:o=0,distortion:l=1,mixContrast:u=1,distortionMap:c,reflectorOffset:h=0,...d},p)=>{extend({MeshReflectorMaterialImpl:MeshReflectorMaterial$1});const m=useThree(({gl:v})=>v),g=useThree(({camera:v})=>v),O=useThree(({scene:v})=>v);s=Array.isArray(s)?s:[s,s];const S=s[0]+s[1]>0,T=reactExports.useRef(null);reactExports.useImperativeHandle(p,()=>T.current,[]);const[_]=reactExports.useState(()=>new Plane),[U]=reactExports.useState(()=>new Vector3),[B]=reactExports.useState(()=>new Vector3),[F]=reactExports.useState(()=>new Vector3),[A]=reactExports.useState(()=>new Matrix4),[P]=reactExports.useState(()=>new Vector3(0,0,-1)),[R]=reactExports.useState(()=>new Vector4),[X]=reactExports.useState(()=>new Vector3),[y]=reactExports.useState(()=>new Vector3),[C]=reactExports.useState(()=>new Vector4),[w]=reactExports.useState(()=>new Matrix4),[W]=reactExports.useState(()=>new PerspectiveCamera),j=reactExports.useCallback(()=>{var v;const x=T.current.parent||((v=T.current)==null?void 0:v.__r3f.parent);if(!x||(B.setFromMatrixPosition(x.matrixWorld),F.setFromMatrixPosition(g.matrixWorld),A.extractRotation(x.matrixWorld),U.set(0,0,1),U.applyMatrix4(A),B.addScaledVector(U,h),X.subVectors(B,F),X.dot(U)>0))return;X.reflect(U).negate(),X.add(B),A.extractRotation(g.matrixWorld),P.set(0,0,-1),P.applyMatrix4(A),P.add(F),y.subVectors(B,P),y.reflect(U).negate(),y.add(B),W.position.copy(X),W.up.set(0,1,0),W.up.applyMatrix4(A),W.up.reflect(U),W.lookAt(y),W.far=g.far,W.updateMatrixWorld(),W.projectionMatrix.copy(g.projectionMatrix),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(W.projectionMatrix),w.multiply(W.matrixWorldInverse),w.multiply(x.matrixWorld),_.setFromNormalAndCoplanarPoint(U,B),_.applyMatrix4(W.matrixWorldInverse),R.set(_.normal.x,_.normal.y,_.normal.z,_.constant);const b=W.projectionMatrix;C.x=(Math.sign(R.x)+b.elements[8])/b.elements[0],C.y=(Math.sign(R.y)+b.elements[9])/b.elements[5],C.z=-1,C.w=(1+b.elements[10])/b.elements[14],R.multiplyScalar(2/R.dot(C)),b.elements[2]=R.x,b.elements[6]=R.y,b.elements[10]=R.z+1,b.elements[14]=R.w},[g,h]),[K,$,G,D]=reactExports.useMemo(()=>{const v={minFilter:LinearFilter,magFilter:LinearFilter,type:HalfFloatType},x=new WebGLRenderTarget(f,f,v);x.depthBuffer=!0,x.depthTexture=new DepthTexture(f,f),x.depthTexture.format=DepthFormat,x.depthTexture.type=UnsignedShortType;const b=new WebGLRenderTarget(f,f,v),k=new BlurPass({gl:m,resolution:f,width:s[0],height:s[1],minDepthThreshold:r,maxDepthThreshold:e,depthScale:n,depthToBlurRatioBias:i}),E={mirror:o,textureMatrix:w,mixBlur:a,tDiffuse:x.texture,tDepth:x.depthTexture,tDiffuseBlur:b.texture,hasBlur:S,mixStrength:t,minDepthThreshold:r,maxDepthThreshold:e,depthScale:n,depthToBlurRatioBias:i,distortion:l,distortionMap:c,mixContrast:u,"defines-USE_BLUR":S?"":void 0,"defines-USE_DEPTH":n>0?"":void 0,"defines-USE_DISTORTION":c?"":void 0};return[x,b,k,E]},[m,s,w,f,o,S,a,t,r,e,n,i,l,c,u]);return useFrame(()=>{var v;const x=T.current.parent||((v=T.current)==null?void 0:v.__r3f.parent);if(!x)return;x.visible=!1;const b=m.xr.enabled,k=m.shadowMap.autoUpdate;j(),m.xr.enabled=!1,m.shadowMap.autoUpdate=!1,m.setRenderTarget(K),m.state.buffers.depth.setMask(!0),m.autoClear||m.clear(),m.render(O,W),S&&G.render(m,K,$),m.xr.enabled=b,m.shadowMap.autoUpdate=k,x.visible=!0,m.setRenderTarget(null)}),reactExports.createElement("meshReflectorMaterialImpl",_extends({attach:"material",key:"key"+D["defines-USE_BLUR"]+D["defines-USE_DEPTH"]+D["defines-USE_DISTORTION"],ref:T},D,d))}),{useEffect,useLayoutEffect,useRef,useInsertionEffect:useBuiltinInsertionEffect}=React,canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",useIsomorphicLayoutEffect=canUseDOM?useLayoutEffect:useEffect,useInsertionEffect=useBuiltinInsertionEffect||useIsomorphicLayoutEffect,useEvent=a=>{const t=useRef([a,(...f)=>t[0](...f)]).current;return useInsertionEffect(()=>{t[0]=a}),t[1]},relativePath=(a="",t=location.pathname)=>t.toLowerCase().indexOf(a.toLowerCase())?"~"+t:t.slice(a.length)||"/",absolutePath=(a,t="")=>a[0]==="~"?a.slice(1):t+a,eventPopstate="popstate",eventPushState="pushState",eventReplaceState="replaceState",eventHashchange="hashchange",events=[eventPopstate,eventPushState,eventReplaceState,eventHashchange],subscribeToLocationUpdates=a=>{for(const t of events)addEventListener(t,a);return()=>{for(const t of events)removeEventListener(t,a)}},useLocationProperty=(a,t)=>shimExports.useSyncExternalStore(subscribeToLocationUpdates,a,t),currentPathname=()=>location.pathname,usePathname=({ssrPath:a}={})=>useLocationProperty(currentPathname,a?()=>a:currentPathname),navigate=(a,{replace:t=!1}={})=>history[t?eventReplaceState:eventPushState](null,"",a),useLocation$1=(a={})=>[relativePath(a.base,usePathname(a)),useEvent((t,f)=>navigate(absolutePath(t,a.base),f))];if(typeof history<"u")for(const a of[eventPushState,eventReplaceState]){const t=history[a];history[a]=function(){const f=t.apply(this,arguments),s=new Event(a);return s.arguments=arguments,dispatchEvent(s),f}}function makeMatcher(a=pathToRegexp){let t={};const f=s=>t[s]||(t[s]=a(s));return(s,r)=>{const{regexp:e,keys:n}=f(s||""),i=e.exec(r);return i?[!0,n.reduce((l,u,c)=>(l[u.name]=i[c+1],l),{})]:[!1,null]}}const escapeRx=a=>a.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),rxForSegment=(a,t,f)=>{let s=a?"((?:[^\\/]+?)(?:\\/(?:[^\\/]+?))*)":"([^\\/]+?)";return t&&f&&(s="(?:\\/"+s+")"),s+(t?"?":"")},pathToRegexp=a=>{const t=/:([A-Za-z0-9_]+)([?+*]?)/g;let f=null,s=0,r=[],e="";for(;(f=t.exec(a))!==null;){const[n,i,o]=f,l=o==="+"||o==="*",u=o==="?"||o==="*",c=u&&a[f.index-1]==="/"?1:0,h=a.substring(s,f.index-c);r.push({name:i}),s=t.lastIndex,e+=escapeRx(h)+rxForSegment(l,u,c)}return e+=escapeRx(a.substring(s)),{keys:r,regexp:new RegExp("^"+e+"(?:\\/)?$","i")}},defaultRouter={hook:useLocation$1,matcher:makeMatcher(),base:""},RouterCtx=reactExports.createContext(defaultRouter),useRouter=()=>reactExports.useContext(RouterCtx),useLocationFromRouter=a=>a.hook(a),useLocation=()=>useLocationFromRouter(useRouter()),useRoute=a=>{const t=useRouter(),[f]=useLocationFromRouter(t);return t.matcher(a,f)};reactExports.createContext({params:{}});reactExports.forwardRef((a,t)=>{const f=useRouter(),[,s]=useLocationFromRouter(f),{to:r,href:e=r,children:n,onClick:i}=a,o=useEvent(c=>{c.ctrlKey||c.metaKey||c.altKey||c.shiftKey||c.button!==0||(i&&i(c),c.defaultPrevented||(c.preventDefault(),s(r||e,a)))}),l={href:e[0]==="~"?e.slice(1):f.base+e,onClick:o,to:null,ref:t},u=reactExports.isValidElement(n)?n:reactExports.createElement("a",a);return reactExports.cloneElement(u,l)});var md5$1={exports:{}};/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */(function(module){(function(){var ERROR="input is invalid type",WINDOW=typeof window=="object",root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&typeof self=="object",NODE_JS=!root.JS_MD5_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&!0&&module.exports,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}(root.JS_MD5_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"}),ARRAY_BUFFER&&(root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(a){return typeof a=="object"&&a.buffer&&a.buffer.constructor===ArrayBuffer});var createOutputMethod=function(a){return function(t){return new Md5(!0).update(t)[a]()}},createMethod=function(){var a=createOutputMethod("hex");NODE_JS&&(a=nodeWrap(a)),a.create=function(){return new Md5},a.update=function(s){return a.create().update(s)};for(var t=0;t<OUTPUT_TYPES.length;++t){var f=OUTPUT_TYPES[t];a[f]=createOutputMethod(f)}return a},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(a){if(typeof a=="string")return crypto.createHash("md5").update(a,"utf8").digest("hex");if(a==null)throw ERROR;return a.constructor===ArrayBuffer&&(a=new Uint8Array(a)),Array.isArray(a)||ArrayBuffer.isView(a)||a.constructor===Buffer?crypto.createHash("md5").update(new Buffer(a)).digest("hex"):method(a)};return nodeMethod};function Md5(a){if(a)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(a){if(!this.finalized){var t,f=typeof a;if(f!=="string"){if(f==="object"){if(a===null)throw ERROR;if(ARRAY_BUFFER&&a.constructor===ArrayBuffer)a=new Uint8Array(a);else if(!Array.isArray(a)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(a)))throw ERROR}else throw ERROR;t=!0}for(var s,r=0,e,n=a.length,i=this.blocks,o=this.buffer8;r<n;){if(this.hashed&&(this.hashed=!1,i[0]=i[16],i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),t)if(ARRAY_BUFFER)for(e=this.start;r<n&&e<64;++r)o[e++]=a[r];else for(e=this.start;r<n&&e<64;++r)i[e>>2]|=a[r]<<SHIFT[e++&3];else if(ARRAY_BUFFER)for(e=this.start;r<n&&e<64;++r)s=a.charCodeAt(r),s<128?o[e++]=s:s<2048?(o[e++]=192|s>>6,o[e++]=128|s&63):s<55296||s>=57344?(o[e++]=224|s>>12,o[e++]=128|s>>6&63,o[e++]=128|s&63):(s=65536+((s&1023)<<10|a.charCodeAt(++r)&1023),o[e++]=240|s>>18,o[e++]=128|s>>12&63,o[e++]=128|s>>6&63,o[e++]=128|s&63);else for(e=this.start;r<n&&e<64;++r)s=a.charCodeAt(r),s<128?i[e>>2]|=s<<SHIFT[e++&3]:s<2048?(i[e>>2]|=(192|s>>6)<<SHIFT[e++&3],i[e>>2]|=(128|s&63)<<SHIFT[e++&3]):s<55296||s>=57344?(i[e>>2]|=(224|s>>12)<<SHIFT[e++&3],i[e>>2]|=(128|s>>6&63)<<SHIFT[e++&3],i[e>>2]|=(128|s&63)<<SHIFT[e++&3]):(s=65536+((s&1023)<<10|a.charCodeAt(++r)&1023),i[e>>2]|=(240|s>>18)<<SHIFT[e++&3],i[e>>2]|=(128|s>>12&63)<<SHIFT[e++&3],i[e>>2]|=(128|s>>6&63)<<SHIFT[e++&3],i[e>>2]|=(128|s&63)<<SHIFT[e++&3]);this.lastByteIndex=e,this.bytes+=e-this.start,e>=64?(this.start=e-64,this.hash(),this.hashed=!0):this.start=e}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var a=this.blocks,t=this.lastByteIndex;a[t>>2]|=EXTRA[t&3],t>=56&&(this.hashed||this.hash(),a[0]=a[16],a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),a[14]=this.bytes<<3,a[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var a,t,f,s,r,e,n=this.blocks;this.first?(a=n[0]-680876937,a=(a<<7|a>>>25)-271733879<<0,s=(-1732584194^a&2004318071)+n[1]-117830708,s=(s<<12|s>>>20)+a<<0,f=(-271733879^s&(a^-271733879))+n[2]-1126478375,f=(f<<17|f>>>15)+s<<0,t=(a^f&(s^a))+n[3]-1316259209,t=(t<<22|t>>>10)+f<<0):(a=this.h0,t=this.h1,f=this.h2,s=this.h3,a+=(s^t&(f^s))+n[0]-680876936,a=(a<<7|a>>>25)+t<<0,s+=(f^a&(t^f))+n[1]-389564586,s=(s<<12|s>>>20)+a<<0,f+=(t^s&(a^t))+n[2]+606105819,f=(f<<17|f>>>15)+s<<0,t+=(a^f&(s^a))+n[3]-1044525330,t=(t<<22|t>>>10)+f<<0),a+=(s^t&(f^s))+n[4]-176418897,a=(a<<7|a>>>25)+t<<0,s+=(f^a&(t^f))+n[5]+1200080426,s=(s<<12|s>>>20)+a<<0,f+=(t^s&(a^t))+n[6]-1473231341,f=(f<<17|f>>>15)+s<<0,t+=(a^f&(s^a))+n[7]-45705983,t=(t<<22|t>>>10)+f<<0,a+=(s^t&(f^s))+n[8]+1770035416,a=(a<<7|a>>>25)+t<<0,s+=(f^a&(t^f))+n[9]-1958414417,s=(s<<12|s>>>20)+a<<0,f+=(t^s&(a^t))+n[10]-42063,f=(f<<17|f>>>15)+s<<0,t+=(a^f&(s^a))+n[11]-1990404162,t=(t<<22|t>>>10)+f<<0,a+=(s^t&(f^s))+n[12]+1804603682,a=(a<<7|a>>>25)+t<<0,s+=(f^a&(t^f))+n[13]-40341101,s=(s<<12|s>>>20)+a<<0,f+=(t^s&(a^t))+n[14]-1502002290,f=(f<<17|f>>>15)+s<<0,t+=(a^f&(s^a))+n[15]+1236535329,t=(t<<22|t>>>10)+f<<0,a+=(f^s&(t^f))+n[1]-165796510,a=(a<<5|a>>>27)+t<<0,s+=(t^f&(a^t))+n[6]-1069501632,s=(s<<9|s>>>23)+a<<0,f+=(a^t&(s^a))+n[11]+643717713,f=(f<<14|f>>>18)+s<<0,t+=(s^a&(f^s))+n[0]-373897302,t=(t<<20|t>>>12)+f<<0,a+=(f^s&(t^f))+n[5]-701558691,a=(a<<5|a>>>27)+t<<0,s+=(t^f&(a^t))+n[10]+38016083,s=(s<<9|s>>>23)+a<<0,f+=(a^t&(s^a))+n[15]-660478335,f=(f<<14|f>>>18)+s<<0,t+=(s^a&(f^s))+n[4]-405537848,t=(t<<20|t>>>12)+f<<0,a+=(f^s&(t^f))+n[9]+568446438,a=(a<<5|a>>>27)+t<<0,s+=(t^f&(a^t))+n[14]-1019803690,s=(s<<9|s>>>23)+a<<0,f+=(a^t&(s^a))+n[3]-187363961,f=(f<<14|f>>>18)+s<<0,t+=(s^a&(f^s))+n[8]+1163531501,t=(t<<20|t>>>12)+f<<0,a+=(f^s&(t^f))+n[13]-1444681467,a=(a<<5|a>>>27)+t<<0,s+=(t^f&(a^t))+n[2]-51403784,s=(s<<9|s>>>23)+a<<0,f+=(a^t&(s^a))+n[7]+1735328473,f=(f<<14|f>>>18)+s<<0,t+=(s^a&(f^s))+n[12]-1926607734,t=(t<<20|t>>>12)+f<<0,r=t^f,a+=(r^s)+n[5]-378558,a=(a<<4|a>>>28)+t<<0,s+=(r^a)+n[8]-2022574463,s=(s<<11|s>>>21)+a<<0,e=s^a,f+=(e^t)+n[11]+1839030562,f=(f<<16|f>>>16)+s<<0,t+=(e^f)+n[14]-35309556,t=(t<<23|t>>>9)+f<<0,r=t^f,a+=(r^s)+n[1]-1530992060,a=(a<<4|a>>>28)+t<<0,s+=(r^a)+n[4]+1272893353,s=(s<<11|s>>>21)+a<<0,e=s^a,f+=(e^t)+n[7]-155497632,f=(f<<16|f>>>16)+s<<0,t+=(e^f)+n[10]-1094730640,t=(t<<23|t>>>9)+f<<0,r=t^f,a+=(r^s)+n[13]+681279174,a=(a<<4|a>>>28)+t<<0,s+=(r^a)+n[0]-358537222,s=(s<<11|s>>>21)+a<<0,e=s^a,f+=(e^t)+n[3]-722521979,f=(f<<16|f>>>16)+s<<0,t+=(e^f)+n[6]+76029189,t=(t<<23|t>>>9)+f<<0,r=t^f,a+=(r^s)+n[9]-640364487,a=(a<<4|a>>>28)+t<<0,s+=(r^a)+n[12]-421815835,s=(s<<11|s>>>21)+a<<0,e=s^a,f+=(e^t)+n[15]+530742520,f=(f<<16|f>>>16)+s<<0,t+=(e^f)+n[2]-995338651,t=(t<<23|t>>>9)+f<<0,a+=(f^(t|~s))+n[0]-198630844,a=(a<<6|a>>>26)+t<<0,s+=(t^(a|~f))+n[7]+1126891415,s=(s<<10|s>>>22)+a<<0,f+=(a^(s|~t))+n[14]-1416354905,f=(f<<15|f>>>17)+s<<0,t+=(s^(f|~a))+n[5]-57434055,t=(t<<21|t>>>11)+f<<0,a+=(f^(t|~s))+n[12]+1700485571,a=(a<<6|a>>>26)+t<<0,s+=(t^(a|~f))+n[3]-1894986606,s=(s<<10|s>>>22)+a<<0,f+=(a^(s|~t))+n[10]-1051523,f=(f<<15|f>>>17)+s<<0,t+=(s^(f|~a))+n[1]-2054922799,t=(t<<21|t>>>11)+f<<0,a+=(f^(t|~s))+n[8]+1873313359,a=(a<<6|a>>>26)+t<<0,s+=(t^(a|~f))+n[15]-30611744,s=(s<<10|s>>>22)+a<<0,f+=(a^(s|~t))+n[6]-1560198380,f=(f<<15|f>>>17)+s<<0,t+=(s^(f|~a))+n[13]+1309151649,t=(t<<21|t>>>11)+f<<0,a+=(f^(t|~s))+n[4]-145523070,a=(a<<6|a>>>26)+t<<0,s+=(t^(a|~f))+n[11]-1120210379,s=(s<<10|s>>>22)+a<<0,f+=(a^(s|~t))+n[2]+718787259,f=(f<<15|f>>>17)+s<<0,t+=(s^(f|~a))+n[9]-343485551,t=(t<<21|t>>>11)+f<<0,this.first?(this.h0=a+1732584193<<0,this.h1=t-271733879<<0,this.h2=f-1732584194<<0,this.h3=s+271733878<<0,this.first=!1):(this.h0=this.h0+a<<0,this.h1=this.h1+t<<0,this.h2=this.h2+f<<0,this.h3=this.h3+s<<0)},Md5.prototype.hex=function(){this.finalize();var a=this.h0,t=this.h1,f=this.h2,s=this.h3;return HEX_CHARS[a>>4&15]+HEX_CHARS[a&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[t&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[f>>4&15]+HEX_CHARS[f&15]+HEX_CHARS[f>>12&15]+HEX_CHARS[f>>8&15]+HEX_CHARS[f>>20&15]+HEX_CHARS[f>>16&15]+HEX_CHARS[f>>28&15]+HEX_CHARS[f>>24&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[s&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var a=this.h0,t=this.h1,f=this.h2,s=this.h3;return[a&255,a>>8&255,a>>16&255,a>>24&255,t&255,t>>8&255,t>>16&255,t>>24&255,f&255,f>>8&255,f>>16&255,f>>24&255,s&255,s>>8&255,s>>16&255,s>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var a=new ArrayBuffer(16),t=new Uint32Array(a);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,a},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var a,t,f,s="",r=this.array(),e=0;e<15;)a=r[e++],t=r[e++],f=r[e++],s+=BASE64_ENCODE_CHAR[a>>>2]+BASE64_ENCODE_CHAR[(a<<4|t>>>4)&63]+BASE64_ENCODE_CHAR[(t<<2|f>>>6)&63]+BASE64_ENCODE_CHAR[f&63];return a=r[e],s+=BASE64_ENCODE_CHAR[a>>>2]+BASE64_ENCODE_CHAR[a<<4&63]+"==",s};var exports=createMethod();COMMON_JS?module.exports=exports:root.md5=exports})()})(md5$1);var md5Exports=md5$1.exports,sha1$1={exports:{}};/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */(function(module){(function(){var root=typeof window=="object"?window:{},NODE_JS=!root.JS_SHA1_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;NODE_JS&&(root=commonjsGlobal);var COMMON_JS=!root.JS_SHA1_NO_COMMON_JS&&!0&&module.exports,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[],createOutputMethod=function(a){return function(t){return new Sha1(!0).update(t)[a]()}},createMethod=function(){var a=createOutputMethod("hex");NODE_JS&&(a=nodeWrap(a)),a.create=function(){return new Sha1},a.update=function(s){return a.create().update(s)};for(var t=0;t<OUTPUT_TYPES.length;++t){var f=OUTPUT_TYPES[t];a[f]=createOutputMethod(f)}return a},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(a){if(typeof a=="string")return crypto.createHash("sha1").update(a,"utf8").digest("hex");if(a.constructor===ArrayBuffer)a=new Uint8Array(a);else if(a.length===void 0)return method(a);return crypto.createHash("sha1").update(new Buffer(a)).digest("hex")};return nodeMethod};function Sha1(a){a?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(a){if(!this.finalized){var t=typeof a!="string";t&&a.constructor===root.ArrayBuffer&&(a=new Uint8Array(a));for(var f,s=0,r,e=a.length||0,n=this.blocks;s<e;){if(this.hashed&&(this.hashed=!1,n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),t)for(r=this.start;s<e&&r<64;++s)n[r>>2]|=a[s]<<SHIFT[r++&3];else for(r=this.start;s<e&&r<64;++s)f=a.charCodeAt(s),f<128?n[r>>2]|=f<<SHIFT[r++&3]:f<2048?(n[r>>2]|=(192|f>>6)<<SHIFT[r++&3],n[r>>2]|=(128|f&63)<<SHIFT[r++&3]):f<55296||f>=57344?(n[r>>2]|=(224|f>>12)<<SHIFT[r++&3],n[r>>2]|=(128|f>>6&63)<<SHIFT[r++&3],n[r>>2]|=(128|f&63)<<SHIFT[r++&3]):(f=65536+((f&1023)<<10|a.charCodeAt(++s)&1023),n[r>>2]|=(240|f>>18)<<SHIFT[r++&3],n[r>>2]|=(128|f>>12&63)<<SHIFT[r++&3],n[r>>2]|=(128|f>>6&63)<<SHIFT[r++&3],n[r>>2]|=(128|f&63)<<SHIFT[r++&3]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=n[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var a=this.blocks,t=this.lastByteIndex;a[16]=this.block,a[t>>2]|=EXTRA[t&3],this.block=a[16],t>=56&&(this.hashed||this.hash(),a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),a[14]=this.hBytes<<3|this.bytes>>>29,a[15]=this.bytes<<3,this.hash()}},Sha1.prototype.hash=function(){var a=this.h0,t=this.h1,f=this.h2,s=this.h3,r=this.h4,e,n,i,o=this.blocks;for(n=16;n<80;++n)i=o[n-3]^o[n-8]^o[n-14]^o[n-16],o[n]=i<<1|i>>>31;for(n=0;n<20;n+=5)e=t&f|~t&s,i=a<<5|a>>>27,r=i+e+r+1518500249+o[n]<<0,t=t<<30|t>>>2,e=a&t|~a&f,i=r<<5|r>>>27,s=i+e+s+1518500249+o[n+1]<<0,a=a<<30|a>>>2,e=r&a|~r&t,i=s<<5|s>>>27,f=i+e+f+1518500249+o[n+2]<<0,r=r<<30|r>>>2,e=s&r|~s&a,i=f<<5|f>>>27,t=i+e+t+1518500249+o[n+3]<<0,s=s<<30|s>>>2,e=f&s|~f&r,i=t<<5|t>>>27,a=i+e+a+1518500249+o[n+4]<<0,f=f<<30|f>>>2;for(;n<40;n+=5)e=t^f^s,i=a<<5|a>>>27,r=i+e+r+1859775393+o[n]<<0,t=t<<30|t>>>2,e=a^t^f,i=r<<5|r>>>27,s=i+e+s+1859775393+o[n+1]<<0,a=a<<30|a>>>2,e=r^a^t,i=s<<5|s>>>27,f=i+e+f+1859775393+o[n+2]<<0,r=r<<30|r>>>2,e=s^r^a,i=f<<5|f>>>27,t=i+e+t+1859775393+o[n+3]<<0,s=s<<30|s>>>2,e=f^s^r,i=t<<5|t>>>27,a=i+e+a+1859775393+o[n+4]<<0,f=f<<30|f>>>2;for(;n<60;n+=5)e=t&f|t&s|f&s,i=a<<5|a>>>27,r=i+e+r-1894007588+o[n]<<0,t=t<<30|t>>>2,e=a&t|a&f|t&f,i=r<<5|r>>>27,s=i+e+s-1894007588+o[n+1]<<0,a=a<<30|a>>>2,e=r&a|r&t|a&t,i=s<<5|s>>>27,f=i+e+f-1894007588+o[n+2]<<0,r=r<<30|r>>>2,e=s&r|s&a|r&a,i=f<<5|f>>>27,t=i+e+t-1894007588+o[n+3]<<0,s=s<<30|s>>>2,e=f&s|f&r|s&r,i=t<<5|t>>>27,a=i+e+a-1894007588+o[n+4]<<0,f=f<<30|f>>>2;for(;n<80;n+=5)e=t^f^s,i=a<<5|a>>>27,r=i+e+r-899497514+o[n]<<0,t=t<<30|t>>>2,e=a^t^f,i=r<<5|r>>>27,s=i+e+s-899497514+o[n+1]<<0,a=a<<30|a>>>2,e=r^a^t,i=s<<5|s>>>27,f=i+e+f-899497514+o[n+2]<<0,r=r<<30|r>>>2,e=s^r^a,i=f<<5|f>>>27,t=i+e+t-899497514+o[n+3]<<0,s=s<<30|s>>>2,e=f^s^r,i=t<<5|t>>>27,a=i+e+a-899497514+o[n+4]<<0,f=f<<30|f>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+t<<0,this.h2=this.h2+f<<0,this.h3=this.h3+s<<0,this.h4=this.h4+r<<0},Sha1.prototype.hex=function(){this.finalize();var a=this.h0,t=this.h1,f=this.h2,s=this.h3,r=this.h4;return HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[a&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[t&15]+HEX_CHARS[f>>28&15]+HEX_CHARS[f>>24&15]+HEX_CHARS[f>>20&15]+HEX_CHARS[f>>16&15]+HEX_CHARS[f>>12&15]+HEX_CHARS[f>>8&15]+HEX_CHARS[f>>4&15]+HEX_CHARS[f&15]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[s&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[r&15]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var a=this.h0,t=this.h1,f=this.h2,s=this.h3,r=this.h4;return[a>>24&255,a>>16&255,a>>8&255,a&255,t>>24&255,t>>16&255,t>>8&255,t&255,f>>24&255,f>>16&255,f>>8&255,f&255,s>>24&255,s>>16&255,s>>8&255,s&255,r>>24&255,r>>16&255,r>>8&255,r&255]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var a=new ArrayBuffer(20),t=new DataView(a);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),a};var exports=createMethod();COMMON_JS?module.exports=exports:root.sha1=exports})()})(sha1$1);var sha1Exports=sha1$1.exports,md5=md5Exports,sha1=sha1Exports,HEX_DIGITS="0123456789abcdef".split(""),UUID_LENGTH=36,UUID_REGEXP=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i,HEX_TO_BYTE_MAP=function(){for(var a={},t=0;t<256;t++){var f=t.toString(16);a[f.length===1?"0"+f:f]=t}return a}(),uint8ToHex=function(a){var t=a>>4,f=a-(t<<4);return HEX_DIGITS[t]+HEX_DIGITS[f]},uint8ArrayToHex=function(a){for(var t="",f=0;f<a.length;f++)t+=uint8ToHex(a[f]);return t},stringToCharBuffer=function(a){for(var t=unescape(encodeURIComponent(a)),f=new Uint8Array(t.length),s=0;s<t.length;s++)f[s]=t[s].charCodeAt(0);return f},md5Hash=function(a){return new Uint8Array(md5.arrayBuffer(a))},sha1Hash=function(a){return new Uint8Array(sha1.arrayBuffer(a))},concatBuffers=function(a,t){var f=new Uint8Array(a.length+t.length);return f.set(new Uint8Array(a),0),f.set(new Uint8Array(t),a.byteLength),f},validateUuid=function(a){return typeof a=="string"&&a.length===UUID_LENGTH&&UUID_REGEXP.test(a)},parseUuid=function(a){if(!validateUuid(a))throw TypeError("Invalid UUID");for(var t=new Uint8Array(16),f=0,s=0;f<a.length;){if(a[f]==="-"){f++;continue}var r=(a[f]+a[f+1]).toLowerCase();t[s]=HEX_TO_BYTE_MAP[r],s++,f+=2}return t},hashToUuid=function(a,t){return uint8ArrayToHex(a.slice(0,4))+"-"+uint8ArrayToHex(a.slice(4,6))+"-"+uint8ToHex(a[6]&15|parseInt(t*10,16))+uint8ToHex(a[7])+"-"+uint8ToHex(a[8]&63|128)+uint8ToHex(a[9])+"-"+uint8ArrayToHex(a.slice(10,16))},lib$1={uint8ToHex,uint8ArrayToHex,stringToCharBuffer,md5Hash,sha1Hash,concatBuffers,validateUuid,parseUuid,hashToUuid},lib=lib$1,EMPTY_UINT8_ARRAY=new Uint8Array(0);function generateUuid(a,t,f){if(typeof a!="string")throw TypeError("Value must be string");if(typeof t=="number")return generateUuid(a,void 0,t);if(f==null)return generateUuid(a,t,5);if(f!==3&&f!==5)throw TypeError("Version of UUID can be only 3 or 5");var s=lib.stringToCharBuffer(a),r=typeof t=="string"?lib.parseUuid(t):EMPTY_UINT8_ARRAY,e=lib.concatBuffers(r,s),n=f===3?lib.md5Hash(e):lib.sha1Hash(e);return lib.hashToUuid(n,f)}var src=generateUuid;const getUuid=getDefaultExportFromCjs(src),GOLDENRATIO=1.61803398875,pexel=a=>`https://images.pexels.com/photos/${a}/pexels-photo-${a}.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260`,images=[{position:[0,0,1.5],rotation:[0,0,0],url:pexel(1103970)},{position:[-.8,0,-.6],rotation:[0,0,0],url:pexel(416430)},{position:[.8,0,-.6],rotation:[0,0,0],url:pexel(310452)},{position:[-1.75,0,.25],rotation:[0,Math.PI/2.5,0],url:pexel(327482)},{position:[-2.15,0,1.5],rotation:[0,Math.PI/2.5,0],url:pexel(325185)},{position:[-2,0,2.75],rotation:[0,Math.PI/2.5,0],url:pexel(358574)},{position:[1.75,0,.25],rotation:[0,-Math.PI/2.5,0],url:pexel(227675)},{position:[2.15,0,1.5],rotation:[0,-Math.PI/2.5,0],url:pexel(911738)},{position:[2,0,2.75],rotation:[0,-Math.PI/2.5,0],url:pexel(1738986)}],gallery=()=>jsxRuntimeExports.jsxs(Canvas,{dpr:[1,1.5],style:{margin:"auto"},camera:{fov:70,position:[0,2,15]},children:[jsxRuntimeExports.jsx("color",{attach:"background",args:["#191920"]}),jsxRuntimeExports.jsx("fog",{attach:"fog",args:["#191920",0,15]}),jsxRuntimeExports.jsxs("group",{position:[0,-.5,0],children:[jsxRuntimeExports.jsx(Frames,{images}),jsxRuntimeExports.jsxs("mesh",{rotation:[-Math.PI/2,0,0],children:[jsxRuntimeExports.jsx("planeGeometry",{args:[50,50]}),jsxRuntimeExports.jsx(MeshReflectorMaterial,{blur:[300,100],resolution:2048,mixBlur:1,mixStrength:80,roughness:1,depthScale:1.2,minDepthThreshold:.4,maxDepthThreshold:1.4,color:"#050505",metalness:.5})]})]})]});function Frames({images:a,q:t=new Quaternion,p:f=new Vector3}){const s=reactExports.useRef(),r=reactExports.useRef(),[,e]=useRoute("/"),[,n]=useLocation();return reactExports.useEffect(()=>{r.current=s.current.getObjectByName(e?.id),console.log(r),r.current?(r.current.parent.updateWorldMatrix(!0,!0),r.current.parent.localToWorld(f.set(0,GOLDENRATIO/2,1.25)),r.current.parent.getWorldQuaternion(t)):(f.set(0,0,5.5),t.identity())}),useFrame((i,o)=>{easing.damp3(i.camera.position,f,.4,o),easing.dampQ(i.camera.quaternion,t,.4,o)}),jsxRuntimeExports.jsx("group",{ref:s,onClick:i=>(i.stopPropagation(),n("/posts/gallery#5")),onPointerMissed:()=>n("/"),children:a.map(i=>jsxRuntimeExports.jsx(Frame,{...i},i.url))})}function Frame({url:a,c:t=new Color,...f}){const s=reactExports.useRef(),r=reactExports.useRef(),[,e]=useRoute("/"),[n,i]=reactExports.useState(!1),[o]=reactExports.useState(()=>Math.random()),l=getUuid(a),u=e?.id===l;return useCursor(n),useFrame((c,h)=>{s.current.material.zoom=2+Math.sin(o*1e4+c.clock.elapsedTime/3)/2,easing.damp3(s.current.scale,[.85*(!u&&n?.85:1),.9*(!u&&n?.905:1),1],.1,h),easing.dampC(r.current.material.color,n?"orange":"white",.1,h)}),jsxRuntimeExports.jsxs("group",{...f,children:[jsxRuntimeExports.jsxs("mesh",{name:l,onPointerOver:c=>(c.stopPropagation(),i(!0)),onPointerOut:()=>i(!1),scale:[1,GOLDENRATIO,.05],position:[0,GOLDENRATIO/2,0],children:[jsxRuntimeExports.jsx("boxGeometry",{}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:"#151515",metalness:.5,roughness:.5,envMapIntensity:2}),jsxRuntimeExports.jsxs("mesh",{ref:r,raycast:()=>null,scale:[.9,.93,.9],position:[0,0,.2],children:[jsxRuntimeExports.jsx("boxGeometry",{}),jsxRuntimeExports.jsx("meshBasicMaterial",{toneMapped:!1,fog:!1})]}),jsxRuntimeExports.jsx(Image,{raycast:()=>null,ref:s,position:[0,0,.7],url:a})]}),jsxRuntimeExports.jsx(Text,{maxWidth:.1,anchorX:"left",anchorY:"top",position:[.55,GOLDENRATIO,0],fontSize:.025,children:l.split("-").join(" ")})]})}export{gallery as default};
//# sourceMappingURL=gallery.CS7B76GL.js.map
