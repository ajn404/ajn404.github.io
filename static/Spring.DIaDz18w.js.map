{"version":3,"file":"Spring.DIaDz18w.js","sources":["../../src/components/react/p5/Oscillation/spring/Bob.ts","../../src/components/react/p5/Oscillation/spring/Spring.ts"],"sourcesContent":["import type p5 from \"p5\";\n\nexport class Bob {\n  p5: p5;\n  position: p5.Vector;\n  velocity: p5.Vector;\n  acceleration: p5.Vector;\n  mass: number = 24;\n  damping: number = 0.98;\n  dragging: boolean = false;\n  draftOffset: p5.Vector;\n  constructor(p5: p5, x: number, y: number) {\n    this.p5 = p5;\n    this.position = p5.createVector(x, y);\n    this.velocity = p5.createVector();\n    this.acceleration = p5.createVector();\n    this.draftOffset = p5.createVector();\n    this.dragging = false;\n  }\n  show() {\n    const p = this.p5;\n    p.stroke(0);\n    p.strokeWeight(2);\n    p.fill(this.dragging ? 200 : 128);\n    p.circle(this.position.x, this.position.y, this.mass * 2);\n  }\n  update() {\n    this.velocity.add(this.acceleration);\n    this.velocity.mult(this.damping);\n    this.position.add(this.velocity);\n    this.acceleration.mult(0);\n  }\n  handleMousePressed(mx: number, my: number) {\n    let dist = this.p5.dist(mx, my, this.position.x, this.position.y);\n    if (dist < this.mass) {\n      this.dragging = true;\n      this.draftOffset.x = this.position.x - mx;\n      this.draftOffset.y = this.position.y - my;\n    }\n  }\n\n  handleDrag(mx: number, my: number) {\n    if (this.dragging) {\n      this.position.x = mx + this.draftOffset.x;\n      this.position.y = my + this.draftOffset.y;\n    }\n  }\n\n  handleMouseReleased() {\n    this.dragging = false;\n  }\n\n  applyForce(force: p5.Vector) {\n    let f = force.copy();\n    f.div(this.mass);\n    this.acceleration.add(f);\n  }\n}\n\nexport class BobBob {\n  p5: p5;\n  position: p5.Vector;\n  velocity: p5.Vector;\n  acceleration: p5.Vector;\n  mass: number = 24;\n  damping: number = 0.98;\n  dragging: boolean = false;\n  draftOffset: p5.Vector;\n\n  constructor(p5: p5, x: number, y: number, mass?: number) {\n    this.p5 = p5;\n    this.position = p5.createVector(x, y);\n    this.velocity = p5.createVector();\n    this.acceleration = p5.createVector();\n    this.draftOffset = p5.createVector();\n    this.mass = Math.max(5, mass);\n  }\n\n  show() {\n    const p = this.p5;\n    p.stroke(0);\n    p.strokeWeight(2);\n    p.fill(this.dragging ? 200 : 128);\n    p.circle(this.position.x, this.position.y, this.mass * 2);\n  }\n\n  update() {\n    this.velocity.add(this.acceleration);\n    this.velocity.mult(this.damping);\n    this.position.add(this.velocity);\n    this.acceleration.mult(0);\n  }\n\n  handleMousePressed(mx: number, my: number) {\n    let dist = this.p5.dist(mx, my, this.position.x, this.position.y);\n    if (dist < this.mass) {\n      this.dragging = true;\n      this.draftOffset.x = this.position.x - mx;\n      this.draftOffset.y = this.position.y - my;\n    }\n  }\n\n  handleDrag(mx: number, my: number) {\n    if (this.dragging) {\n      this.position.x = mx + this.draftOffset.x;\n      this.position.y = my + this.draftOffset.y;\n    }\n  }\n\n  handleMouseReleased() {\n    this.dragging = false;\n  }\n\n  applyForce(force: p5.Vector) {\n    let f = force.copy();\n    f.div(this.mass);\n    this.acceleration.add(f);\n  }\n}\n","import type p5 from \"p5\";\nimport type { Bob } from \"./Bob\";\n\nexport class Spring {\n  p5: p5;\n  anchor: p5.Vector;\n  restLength: number;\n  k: number = 0.2;\n  constructor(p5: p5, x: number, y: number, length: number, k: number = 0.2) {\n    this.p5 = p5;\n    this.anchor = p5.createVector(x, y);\n    this.restLength = length;\n    this.k = k;\n  }\n\n  /**\n   * 计算 bob 的位置与锚点之间的向量 force。\n   * 计算当前长度 currentLength。\n   * 计算弹簧的拉伸量 stretch（当前长度与静止长度的差）。\n   * 根据弹簧常数 k 计算施加的力，并将其应用到 bob 上。\n   */\n  connect(bob: Bob) {\n    let force = bob.position.copy().sub(this.anchor);\n    let currentLength = force.mag();\n    let stretch = currentLength - this.restLength;\n    force.setMag(-1 * this.k * stretch);\n    bob.applyForce(force);\n  }\n\n  /**\n   *\n   * @param bob\n   * @param minLen\n   * @param maxLen\n   * 计算 bob 到锚点的方向向量 direction。\n   * 检查长度是否在限制范围内，如果不在，则调整方向向量的大小。\n   * 更新 bob 的位置，并将其速度设置为 0，以防止其穿过锚点。\n   */\n  constrainLength(bob: Bob, minLen: number, maxLen: number) {\n    let direction = bob.position.copy().sub(this.anchor);\n    let length = direction.mag();\n    const updateBobPosition = () => {\n      let f = this.anchor.copy().add(direction);\n      bob.position = f;\n      bob.velocity.mult(0);\n    };\n\n    if (length < minLen) {\n      direction.setMag(minLen);\n      updateBobPosition();\n    } else if (length > maxLen) {\n      direction.setMag(maxLen);\n      updateBobPosition();\n    }\n  }\n\n  show() {\n    this.p5.fill(127);\n    this.p5.circle(this.anchor.x, this.anchor.y, 10);\n  }\n\n  /**\n   *\n   * @param bob\n   * 显示弹簧体和rest line\n   */\n\n  showLine(bob: Bob) {\n    this.p5.stroke(0);\n    this.p5.line(bob.position.x, bob.position.y, this.anchor.x, this.anchor.y);\n\n    // rest line\n    this.p5.stroke(78, 255, 67);\n    let restEnd = this.anchor\n      .copy()\n      .add(\n        bob.position.copy().sub(this.anchor).normalize().mult(this.restLength)\n      );\n    this.p5.line(this.anchor.x, this.anchor.y, restEnd.x, restEnd.y);\n  }\n}\n\nexport class BobSpring {\n  p5: p5;\n  anchor?: p5.Vector; // Optional fixed anchor\n  bobA?: Bob;\n  bobB?: Bob;\n  restLength: number;\n  k: number;\n\n  constructor(\n    p5: p5,\n    restLength: number,\n    k: number = 0.2,\n    bobA?: Bob,\n    bobB?: Bob,\n    anchor?: p5.Vector\n  ) {\n    this.p5 = p5;\n    this.restLength = restLength;\n    this.k = k;\n    this.bobA = bobA;\n    this.bobB = bobB;\n    this.anchor = anchor;\n  }\n\n  connect() {\n    if (this.bobA && this.bobB) {\n      this.applySpringForce(this.bobA, this.bobB);\n    } else if (this.bobA && this.anchor) {\n      this.applySpringForceToAnchor(this.bobA);\n    }\n  }\n\n  private applySpringForce(bobA: Bob, bobB: Bob) {\n    let force = bobB.position.copy().sub(bobA.position);\n    let currentLength = force.mag();\n    let stretch = currentLength - this.restLength;\n    force.setMag(this.k * stretch);\n    bobA.applyForce(force);\n    force.mult(-1);\n    bobB.applyForce(force);\n  }\n\n  private applySpringForceToAnchor(bob: Bob) {\n    let force = bob.position.copy().sub(this.anchor!);\n    let currentLength = force.mag();\n    let stretch = currentLength - this.restLength;\n    force.setMag(-this.k * stretch);\n    bob.applyForce(force);\n  }\n\n  constrainLength(bobA: Bob, bobB: Bob, minLen: number, maxLen: number) {\n    let direction = bobB.position.copy().sub(bobA.position);\n    let length = direction.mag();\n    const updateBobPositions = () => {\n      let midPoint = bobA.position.copy().add(bobB.position).div(2);\n      bobA.position = midPoint.copy().sub(direction.copy().setMag(length / 2));\n      bobB.position = midPoint.copy().add(direction.copy().setMag(length / 2));\n      bobA.velocity.mult(0);\n      bobB.velocity.mult(0);\n    };\n\n    if (length < minLen || length > maxLen) {\n      direction.setMag(Math.min(Math.max(length, minLen), maxLen));\n      updateBobPositions();\n    }\n  }\n\n  constrainLengthToAnchor(bob: Bob, minLen: number, maxLen: number) {\n    let direction = bob.position.copy().sub(this.anchor!);\n    let length = direction.mag();\n    const updateBobPosition = () => {\n      let newPos = this.anchor!.copy().add(\n        direction.setMag(Math.min(Math.max(length, minLen), maxLen))\n      );\n      bob.position = newPos;\n      bob.velocity.mult(0);\n    };\n\n    if (length < minLen || length > maxLen) {\n      updateBobPosition();\n    }\n  }\n\n  show() {\n    if (this.bobA && this.bobB) {\n      this.p5.stroke(0);\n      this.p5.line(\n        this.bobA.position.x,\n        this.bobA.position.y,\n        this.bobB.position.x,\n        this.bobB.position.y\n      );\n    }\n  }\n}\n"],"names":["Bob","p5","x","y","p","mx","my","force","f","BobBob","mass","Spring","length","k","bob","stretch","minLen","maxLen","direction","updateBobPosition","restEnd","BobSpring","restLength","bobA","bobB","anchor","updateBobPositions","midPoint","newPos"],"mappings":"+YAEO,MAAMA,CAAI,CASf,YAAYC,EAAQC,EAAWC,EAAW,CAJ3B,KAAA,KAAA,GACG,KAAA,QAAA,IACE,KAAA,SAAA,GAGlB,KAAK,GAAKF,EACV,KAAK,SAAWA,EAAG,aAAaC,EAAGC,CAAC,EAC/B,KAAA,SAAWF,EAAG,aAAa,EAC3B,KAAA,aAAeA,EAAG,aAAa,EAC/B,KAAA,YAAcA,EAAG,aAAa,EACnC,KAAK,SAAW,EAAA,CAElB,MAAO,CACL,MAAMG,EAAI,KAAK,GACfA,EAAE,OAAO,CAAC,EACVA,EAAE,aAAa,CAAC,EAChBA,EAAE,KAAK,KAAK,SAAW,IAAM,GAAG,EAC9BA,EAAA,OAAO,KAAK,SAAS,EAAG,KAAK,SAAS,EAAG,KAAK,KAAO,CAAC,CAAA,CAE1D,QAAS,CACF,KAAA,SAAS,IAAI,KAAK,YAAY,EAC9B,KAAA,SAAS,KAAK,KAAK,OAAO,EAC1B,KAAA,SAAS,IAAI,KAAK,QAAQ,EAC1B,KAAA,aAAa,KAAK,CAAC,CAAA,CAE1B,mBAAmBC,EAAYC,EAAY,CAC9B,KAAK,GAAG,KAAKD,EAAIC,EAAI,KAAK,SAAS,EAAG,KAAK,SAAS,CAAC,EACrD,KAAK,OACd,KAAK,SAAW,GAChB,KAAK,YAAY,EAAI,KAAK,SAAS,EAAID,EACvC,KAAK,YAAY,EAAI,KAAK,SAAS,EAAIC,EACzC,CAGF,WAAWD,EAAYC,EAAY,CAC7B,KAAK,WACP,KAAK,SAAS,EAAID,EAAK,KAAK,YAAY,EACxC,KAAK,SAAS,EAAIC,EAAK,KAAK,YAAY,EAC1C,CAGF,qBAAsB,CACpB,KAAK,SAAW,EAAA,CAGlB,WAAWC,EAAkB,CACvB,IAAAC,EAAID,EAAM,KAAK,EACjBC,EAAA,IAAI,KAAK,IAAI,EACV,KAAA,aAAa,IAAIA,CAAC,CAAA,CAE3B,CAEO,MAAMC,CAAO,CAUlB,YAAYR,EAAQC,EAAWC,EAAWO,EAAe,CAL1C,KAAA,KAAA,GACG,KAAA,QAAA,IACE,KAAA,SAAA,GAIlB,KAAK,GAAKT,EACV,KAAK,SAAWA,EAAG,aAAaC,EAAGC,CAAC,EAC/B,KAAA,SAAWF,EAAG,aAAa,EAC3B,KAAA,aAAeA,EAAG,aAAa,EAC/B,KAAA,YAAcA,EAAG,aAAa,EACnC,KAAK,KAAO,KAAK,IAAI,EAAGS,CAAI,CAAA,CAG9B,MAAO,CACL,MAAMN,EAAI,KAAK,GACfA,EAAE,OAAO,CAAC,EACVA,EAAE,aAAa,CAAC,EAChBA,EAAE,KAAK,KAAK,SAAW,IAAM,GAAG,EAC9BA,EAAA,OAAO,KAAK,SAAS,EAAG,KAAK,SAAS,EAAG,KAAK,KAAO,CAAC,CAAA,CAG1D,QAAS,CACF,KAAA,SAAS,IAAI,KAAK,YAAY,EAC9B,KAAA,SAAS,KAAK,KAAK,OAAO,EAC1B,KAAA,SAAS,IAAI,KAAK,QAAQ,EAC1B,KAAA,aAAa,KAAK,CAAC,CAAA,CAG1B,mBAAmBC,EAAYC,EAAY,CAC9B,KAAK,GAAG,KAAKD,EAAIC,EAAI,KAAK,SAAS,EAAG,KAAK,SAAS,CAAC,EACrD,KAAK,OACd,KAAK,SAAW,GAChB,KAAK,YAAY,EAAI,KAAK,SAAS,EAAID,EACvC,KAAK,YAAY,EAAI,KAAK,SAAS,EAAIC,EACzC,CAGF,WAAWD,EAAYC,EAAY,CAC7B,KAAK,WACP,KAAK,SAAS,EAAID,EAAK,KAAK,YAAY,EACxC,KAAK,SAAS,EAAIC,EAAK,KAAK,YAAY,EAC1C,CAGF,qBAAsB,CACpB,KAAK,SAAW,EAAA,CAGlB,WAAWC,EAAkB,CACvB,IAAAC,EAAID,EAAM,KAAK,EACjBC,EAAA,IAAI,KAAK,IAAI,EACV,KAAA,aAAa,IAAIA,CAAC,CAAA,CAE3B,CCnHO,MAAMG,CAAO,CAKlB,YAAYV,EAAQC,EAAWC,EAAWS,EAAgBC,EAAY,GAAK,CAD/D,KAAA,EAAA,GAEV,KAAK,GAAKZ,EACV,KAAK,OAASA,EAAG,aAAaC,EAAGC,CAAC,EAClC,KAAK,WAAaS,EAClB,KAAK,EAAIC,CAAA,CASX,QAAQC,EAAU,CAChB,IAAIP,EAAQO,EAAI,SAAS,OAAO,IAAI,KAAK,MAAM,EAE3CC,EADgBR,EAAM,IAAI,EACA,KAAK,WACnCA,EAAM,OAAO,GAAK,KAAK,EAAIQ,CAAO,EAClCD,EAAI,WAAWP,CAAK,CAAA,CAYtB,gBAAgBO,EAAUE,EAAgBC,EAAgB,CACxD,IAAIC,EAAYJ,EAAI,SAAS,OAAO,IAAI,KAAK,MAAM,EAC/CF,EAASM,EAAU,IAAI,EAC3B,MAAMC,EAAoB,IAAM,CAC9B,IAAIX,EAAI,KAAK,OAAO,KAAK,EAAE,IAAIU,CAAS,EACxCJ,EAAI,SAAWN,EACXM,EAAA,SAAS,KAAK,CAAC,CACrB,EAEIF,EAASI,GACXE,EAAU,OAAOF,CAAM,EACLG,EAAA,GACTP,EAASK,IAClBC,EAAU,OAAOD,CAAM,EACLE,EAAA,EACpB,CAGF,MAAO,CACA,KAAA,GAAG,KAAK,GAAG,EACX,KAAA,GAAG,OAAO,KAAK,OAAO,EAAG,KAAK,OAAO,EAAG,EAAE,CAAA,CASjD,SAASL,EAAU,CACZ,KAAA,GAAG,OAAO,CAAC,EAChB,KAAK,GAAG,KAAKA,EAAI,SAAS,EAAGA,EAAI,SAAS,EAAG,KAAK,OAAO,EAAG,KAAK,OAAO,CAAC,EAGzE,KAAK,GAAG,OAAO,GAAI,IAAK,EAAE,EAC1B,IAAIM,EAAU,KAAK,OAChB,KACA,EAAA,IACCN,EAAI,SAAS,KAAK,EAAE,IAAI,KAAK,MAAM,EAAE,UAAU,EAAE,KAAK,KAAK,UAAU,CACvE,EACG,KAAA,GAAG,KAAK,KAAK,OAAO,EAAG,KAAK,OAAO,EAAGM,EAAQ,EAAGA,EAAQ,CAAC,CAAA,CAEnE,CAEO,MAAMC,CAAU,CAQrB,YACEpB,EACAqB,EACAT,EAAY,GACZU,EACAC,EACAC,EACA,CACA,KAAK,GAAKxB,EACV,KAAK,WAAaqB,EAClB,KAAK,EAAIT,EACT,KAAK,KAAOU,EACZ,KAAK,KAAOC,EACZ,KAAK,OAASC,CAAA,CAGhB,SAAU,CACJ,KAAK,MAAQ,KAAK,KACpB,KAAK,iBAAiB,KAAK,KAAM,KAAK,IAAI,EACjC,KAAK,MAAQ,KAAK,QACtB,KAAA,yBAAyB,KAAK,IAAI,CACzC,CAGM,iBAAiBF,EAAWC,EAAW,CAC7C,IAAIjB,EAAQiB,EAAK,SAAS,OAAO,IAAID,EAAK,QAAQ,EAE9CR,EADgBR,EAAM,IAAI,EACA,KAAK,WAC7BA,EAAA,OAAO,KAAK,EAAIQ,CAAO,EAC7BQ,EAAK,WAAWhB,CAAK,EACrBA,EAAM,KAAK,EAAE,EACbiB,EAAK,WAAWjB,CAAK,CAAA,CAGf,yBAAyBO,EAAU,CACzC,IAAIP,EAAQO,EAAI,SAAS,OAAO,IAAI,KAAK,MAAO,EAE5CC,EADgBR,EAAM,IAAI,EACA,KAAK,WACnCA,EAAM,OAAO,CAAC,KAAK,EAAIQ,CAAO,EAC9BD,EAAI,WAAWP,CAAK,CAAA,CAGtB,gBAAgBgB,EAAWC,EAAWR,EAAgBC,EAAgB,CACpE,IAAIC,EAAYM,EAAK,SAAS,OAAO,IAAID,EAAK,QAAQ,EAClDX,EAASM,EAAU,IAAI,EAC3B,MAAMQ,EAAqB,IAAM,CAC3B,IAAAC,EAAWJ,EAAK,SAAS,KAAK,EAAE,IAAIC,EAAK,QAAQ,EAAE,IAAI,CAAC,EACvDD,EAAA,SAAWI,EAAS,KAAO,EAAA,IAAIT,EAAU,OAAO,OAAON,EAAS,CAAC,CAAC,EAClEY,EAAA,SAAWG,EAAS,KAAO,EAAA,IAAIT,EAAU,OAAO,OAAON,EAAS,CAAC,CAAC,EAClEW,EAAA,SAAS,KAAK,CAAC,EACfC,EAAA,SAAS,KAAK,CAAC,CACtB,GAEIZ,EAASI,GAAUJ,EAASK,KACpBC,EAAA,OAAO,KAAK,IAAI,KAAK,IAAIN,EAAQI,CAAM,EAAGC,CAAM,CAAC,EACxCS,EAAA,EACrB,CAGF,wBAAwBZ,EAAUE,EAAgBC,EAAgB,CAChE,IAAIC,EAAYJ,EAAI,SAAS,OAAO,IAAI,KAAK,MAAO,EAChDF,EAASM,EAAU,IAAI,EAC3B,MAAMC,EAAoB,IAAM,CAC9B,IAAIS,EAAS,KAAK,OAAQ,KAAO,EAAA,IAC/BV,EAAU,OAAO,KAAK,IAAI,KAAK,IAAIN,EAAQI,CAAM,EAAGC,CAAM,CAAC,CAC7D,EACAH,EAAI,SAAWc,EACXd,EAAA,SAAS,KAAK,CAAC,CACrB,GAEIF,EAASI,GAAUJ,EAASK,IACZE,EAAA,CACpB,CAGF,MAAO,CACD,KAAK,MAAQ,KAAK,OACf,KAAA,GAAG,OAAO,CAAC,EAChB,KAAK,GAAG,KACN,KAAK,KAAK,SAAS,EACnB,KAAK,KAAK,SAAS,EACnB,KAAK,KAAK,SAAS,EACnB,KAAK,KAAK,SAAS,CACrB,EACF,CAEJ"}