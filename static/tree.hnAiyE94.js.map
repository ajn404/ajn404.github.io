{"version":3,"file":"tree.hnAiyE94.js","sources":["../../src/components/react/d3/tree.tsx"],"sourcesContent":["import * as d3 from \"d3\";\nimport type { SimulationNodeDatum, SimulationLinkDatum } from \"d3\";\nimport { useEffect, useRef, type ReactNode } from \"react\";\nimport data from \"./tree.json\";\n\ninterface Props {\n  children: ReactNode;\n  float?: Boolean;\n}\n\nconst Circle: React.FunctionComponent<Props> = props => {\n  console.log(props);\n  const ref = useRef<SVGSVGElement | null>(null);\n  useEffect(() => {\n    const svgElement = d3.select(ref.current);\n    const width = 928;\n    const height = 600;\n    let root = d3.hierarchy(data);\n    const links = root.links();\n    const nodes = root.descendants();\n    function dragstarted(event: any, d: any) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n    function dragged(event: any, d: any) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n    function dragended(event: any, d: any) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n    const drag: any = d3\n      .drag()\n      .on(\"start\", dragstarted)\n      .on(\"drag\", dragged)\n      .on(\"end\", dragended);\n    const simulation = d3\n      .forceSimulation(nodes as SimulationNodeDatum[])\n      .force(\n        \"link\",\n        d3\n          .forceLink(links as SimulationLinkDatum<any>[])\n          .id((d: any) => d.id)\n          .distance(0)\n          .strength(1)\n      )\n      .force(\"charge\", d3.forceManyBody().strength(-50))\n      .force(\"x\", d3.forceX())\n      .force(\"y\", d3.forceY());\n    svgElement.attr(\"viewBox\", [-width / 2, -height / 2, width, height]).attr(\n      \"style\",\n      `width:${100}vw;max-width: 100%; height: calc( 100vh - 100px);\n        position:${\n          props?.float ? \"absolute\" : \"static\"\n        };left:0;top:100px;pointer-events:none;`\n    );\n    const link = svgElement\n      .append(\"g\")\n      .attr(\"stroke\", \"#999\")\n      .attr(\"stroke-opacity\", 0.6)\n      .selectAll(\"line\")\n      .data(links)\n      .join(\"line\");\n    const node = svgElement\n      .append(\"g\")\n      .attr(\"fill\", \"#fff\")\n      .attr(\"stroke\", \"#000\")\n      .attr(\"style\", \"pointer-events: auto;\")\n      .attr(\"stroke-width\", 1.5)\n      .selectAll(\"circle\")\n      .data(nodes)\n      .join(\"circle\")\n      .attr(\"fill\", (d: any) => (d.children ? null : \"#000 \"))\n      .attr(\"stroke\", (d: any) => (d.children ? null : \"#fff\"))\n      .attr(\"r\", 5.5)\n      .call(drag, simulation);\n\n    simulation.on(\"tick\", () => {\n      link\n        .attr(\"x1\", (d: any) => d.source.x)\n        .attr(\"y1\", (d: any) => d.source.y)\n        .attr(\"x2\", (d: any) => d.target.x)\n        .attr(\"y2\", (d: any) => d.target.y);\n      node.attr(\"cx\", (d: any) => d.x).attr(\"cy\", (d: any) => d.y);\n    });\n    node.append(\"title\").text((d: any) => d.data.name);\n  });\n\n  return <svg ref={ref}></svg>;\n};\n\nexport default Circle;\n"],"names":["Circle","props","ref","useRef","useEffect","svgElement","d3.select","width","height","root","d3.hierarchy","data","links","nodes","dragstarted","event","d","dragged","dragended","simulation","drag","d3.drag","d3.forceSimulation","d3.forceLink","d3.forceManyBody","d3.forceX","d3.forceY","link","node","jsx"],"mappings":"44LAUMA,EAAkDC,GAAA,CACtD,QAAQ,IAAIA,CAAK,EACX,MAAAC,EAAMC,SAA6B,IAAI,EAC7CC,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAaC,EAAUJ,EAAI,OAAO,EAClCK,EAAQ,IACRC,EAAS,IACX,IAAAC,EAAOC,EAAaC,CAAI,EACtB,MAAAC,EAAQH,EAAK,MAAM,EACnBI,EAAQJ,EAAK,YAAY,EACtB,SAAAK,EAAYC,EAAYC,EAAQ,CAClCD,EAAM,UAAmB,YAAY,EAAG,EAAE,QAAQ,EACvDC,EAAE,GAAKA,EAAE,EACTA,EAAE,GAAKA,EAAE,CAAA,CAEF,SAAAC,EAAQF,EAAYC,EAAQ,CACnCA,EAAE,GAAKD,EAAM,EACbC,EAAE,GAAKD,EAAM,CAAA,CAEN,SAAAG,EAAUH,EAAYC,EAAQ,CAChCD,EAAM,QAAQI,EAAW,YAAY,CAAC,EAC3CH,EAAE,GAAK,KACPA,EAAE,GAAK,IAAA,CAET,MAAMI,EAAYC,EACV,EACL,GAAG,QAASP,CAAW,EACvB,GAAG,OAAQG,CAAO,EAClB,GAAG,MAAOC,CAAS,EAChBC,EAAaG,EACAT,CAA8B,EAC9C,MACC,OACAU,EACaX,CAAmC,EAC7C,GAAII,GAAWA,EAAE,EAAE,EACnB,SAAS,CAAC,EACV,SAAS,CAAC,CAAA,EAEd,MAAM,SAAUQ,EAAmB,EAAA,SAAS,GAAG,CAAC,EAChD,MAAM,IAAKC,GAAW,EACtB,MAAM,IAAKC,GAAW,EACzBrB,EAAW,KAAK,UAAW,CAAC,KAAS,EAAG,KAAU,EAAGE,EAAOC,CAAM,CAAC,EAAE,KACnE,QACA;AAAA,mBAEIP,GAAO,MAAQ,WAAa,QAC9B,wCACJ,EACM,MAAA0B,EAAOtB,EACV,OAAO,GAAG,EACV,KAAK,SAAU,MAAM,EACrB,KAAK,iBAAkB,EAAG,EAC1B,UAAU,MAAM,EAChB,KAAKO,CAAK,EACV,KAAK,MAAM,EACRgB,EAAOvB,EACV,OAAO,GAAG,EACV,KAAK,OAAQ,MAAM,EACnB,KAAK,SAAU,MAAM,EACrB,KAAK,QAAS,uBAAuB,EACrC,KAAK,eAAgB,GAAG,EACxB,UAAU,QAAQ,EAClB,KAAKQ,CAAK,EACV,KAAK,QAAQ,EACb,KAAK,OAASG,GAAYA,EAAE,SAAW,KAAO,OAAQ,EACtD,KAAK,SAAWA,GAAYA,EAAE,SAAW,KAAO,MAAO,EACvD,KAAK,IAAK,GAAG,EACb,KAAKI,EAAMD,CAAU,EAEbA,EAAA,GAAG,OAAQ,IAAM,CAC1BQ,EACG,KAAK,KAAOX,GAAWA,EAAE,OAAO,CAAC,EACjC,KAAK,KAAOA,GAAWA,EAAE,OAAO,CAAC,EACjC,KAAK,KAAOA,GAAWA,EAAE,OAAO,CAAC,EACjC,KAAK,KAAOA,GAAWA,EAAE,OAAO,CAAC,EACpCY,EAAK,KAAK,KAAOZ,GAAWA,EAAE,CAAC,EAAE,KAAK,KAAOA,GAAWA,EAAE,CAAC,CAAA,CAC5D,EACIY,EAAA,OAAO,OAAO,EAAE,KAAMZ,GAAWA,EAAE,KAAK,IAAI,CAAA,CAClD,EAEMa,MAAC,OAAI,IAAA3B,EAAU,CACxB"}