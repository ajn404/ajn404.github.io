import{j as v}from"./jsx-runtime.DZ3s2XAB.js";import{r as t}from"./index.D4IXJ7me.js";import{C as T,u as j,b as F}from"./react-three-fiber.esm.DyszzK9N.js";import{P as M,V as _,S as R,T as k,C}from"./three.module.BN9nGcjX.js";import"./_sentry-release-injection-file.B-UwqLso.js";import"./_commonjsHelpers.DqoTaOmB.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},o=new r.Error().stack;o&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[o]="f674d2cb-1d11-40ba-81ca-c6ab7263732c",r._sentryDebugIdIdentifier="sentry-dbid-f674d2cb-1d11-40ba-81ca-c6ab7263732c")}catch{}})();const D=({mouse:r,vertexShader:o,fragmentShader:f,texturePaths:u})=>{const c=t.useMemo(()=>new M(2,2),[]),s=t.useMemo(()=>{const l={u_time:{value:0},u_resolution:{value:new _},u_mouse:{value:new _},u_frame:{value:0}};return u.forEach((p,m)=>{l[`u_texture${m}`]={value:null}}),new R({vertexShader:o,fragmentShader:f,uniforms:l})},[o,f,u]),{size:d,gl:E}=j(),g=t.useRef(0);return t.useEffect(()=>{s.uniforms.u_resolution.value.set(d.width,d.height);const l=new k;return u.forEach((p,m)=>{l.load(p,i=>{i.wrapS=C,i.wrapT=C,s.uniforms[`u_texture${m}`].value=i})}),()=>{s.dispose(),c.dispose()}},[d,s,u,c]),F(({clock:l})=>{s.uniforms.u_time.value=l.getElapsedTime(),s.uniforms.u_mouse.value.set(r.x,r.y),s.uniforms.u_frame.value=g.current,g.current+=1}),v.jsx("mesh",{geometry:c,material:s})},z=({vertexShaderPath:r="/assets/glsl/all.vert",fragmentShaderPath:o="/assets/glsl/draft/1.frag",width:f="45",height:u="45",imgPaths:c=""})=>{const[s,d]=t.useState({vertexShader:"",fragmentShader:""}),[E,g]=t.useState({x:0,y:0}),[l,p]=t.useState(!1),[m,i]=t.useState(!0),[w,b]=t.useState(!1),n=t.useRef(null),L=t.useMemo(()=>c.split(",").map(e=>e.trim()),[c]),S=t.useCallback(async()=>{try{i(!0);const[e,a]=await Promise.all([fetch(r),fetch(o)]);if(!e.ok||!a.ok)throw new Error("Failed to load shaders.");const[x,y]=await Promise.all([e.text(),a.text()]);d({vertexShader:x,fragmentShader:y})}catch(e){console.error("Error loading shaders:",e)}finally{i(!1)}},[r,o]);t.useEffect(()=>{S()},[S]);const h=t.useCallback(e=>{if(!n.current)return;const a=n.current.getBoundingClientRect(),x="clientX"in e?e.clientX:e.touches[0]?.clientX,y="clientY"in e?e.clientY:e.touches[0]?.clientY;g({x:(x-a.left)/a.width,y:1-(y-a.top)/a.height})},[n]);t.useEffect(()=>{const e=n.current;return e&&(e.addEventListener("mousemove",h),e.addEventListener("touchmove",h)),()=>{e&&(e.removeEventListener("mousemove",h),e.removeEventListener("touchmove",h))}},[h]),t.useEffect(()=>{const e=new IntersectionObserver(([a])=>p(a.isIntersecting),{threshold:.1});return n.current&&e.observe(n.current),()=>e.disconnect()},[]);const I=t.useCallback(async()=>{if(n.current)if(document.fullscreenElement)await document.exitFullscreen(),b(!1);else try{await n.current.requestFullscreen(),b(!0)}catch(e){console.error("全屏切换失败:",e)}},[]);return t.useEffect(()=>{const e=()=>{b(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]),v.jsx("div",{ref:n,onClick:I,style:{width:w?"80vw":`${Math.min(80,Number(f))}vw`,height:w?"80vh":`${u}vw`,margin:"2rem auto",padding:w?"10vh calc(50vw - 40vh)":"0",boxShadow:"rgba(200, 211, 211, 0.2) 0px 7px 29px 0px",cursor:"pointer"},children:m||!l?v.jsx("div",{className:"flex justify-center items-center h-full",children:"Loading..."}):v.jsx(T,{dpr:[1,2],camera:{position:[0,0,1],fov:45},gl:{antialias:!0,powerPreference:"high-performance",alpha:!1},className:"w-full h-full",children:v.jsx(D,{mouse:E,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,texturePaths:L})})})};export{z as default};
//# sourceMappingURL=templateFromUrl.BzmmK_HM.js.map
